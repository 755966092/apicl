<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <style type="text/css">
    body,
    html {
      width: 100%;
      height: 100%;
      margin: 0;
      font-family: "微软雅黑";
    }

    #allmap {
      width: 100%;
      height: 500px;
    }

    p {
      margin-left: 5px;
      font-size: 14px;
    }
  </style>
  <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=uVI0viOM0c4W64xi19cVxza3q9IniAIy"></script>
  <script type="text/javascript" src="../script/doT.min.js"></script>
  <title>根据关键字本地搜索</title>
</head>

<body>
  <div id="allmap"></div>
  <p>返回北京市“景点”关键字的检索结果，并展示在地图上</p>
  <ul class="resultList"></ul>
  <script type="text/x-dot-template" id="listT">
    {{~it:value:index}}
    <li onclick="setPoint(this)" data-point="{{=value.point}}" data-lat="{{=value.point.lat}}" data-lng="{{=value.point.lng}}">{{=value.title}}</li>
    {{~}}
  </script>

</body>

</html>
<script type="text/javascript">
  // // 百度地图API功能
  var map = new BMap.Map("allmap");
  map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);
  map.enableScrollWheelZoom(true);
  var local = new BMap.LocalSearch(map, {
    renderOptions: {
      map: map,
    },
    pageCapacity: 12,
    onSearchComplete: function (ret) {
      console.log(ret.vr)
      getData(ret.vr)
    }
  });
  // loc?al.setPageCapacity(100)
  local.search("清华大学东南门");

  function getData(data) {
    // 原生方法
    document.getElementsByClassName('resultList')[0].innerHTML = doT.template(document.getElementById('listT').innerHTML)
      (data)
  }

  function setPoint(point) {
    var pointP = new BMap.Point(point.getAttribute("data-lng"), point.getAttribute("data-lat"));
    // map.setCenter(pointP)
    map.centerAndZoom(pointP, 18);
    console.log(JSON.stringify(point.getAttribute("data-lat")))
    console.log(JSON.stringify(point.getAttribute("data-lng")))
    console.log(JSON.stringify(point.getAttribute("data-lat")), JSON.stringify(point.getAttribute("data-lng")))
  }

  // 
  // 
  // 
  // 
  // var local = new BMap.LocalSearch(map, 
  //   { 
  //     renderOptions:{map: map},
  //     onSearchComplete : getLocalResult 
  //   }); 
  // local.search("车站"); 
  // function getLocalResult(){

  //   var local = new BMap.LocalSearch(map, {  
  //     renderOptions: {  
  //         map: map,  
  //     },
  //     onSearchComplete: function(results){ 
  //         //可以得到搜索结果且搜索结果不为空 
  //         if(local.getStatus() == BMAP_STATUS_SUCCESS){
  //        var html="";
  //        //遍历结果第一页的点，自定义结果面板
  //        for (var i = 0; i < results.getCurrentNumPois(); i++){  
  //            var poi = results.getPoi(i);
  //                //下面根据LocalResultPoi对象的值拼html代码，此处略
  //                title[i] = poi.title;
  //                if(poi.address)
  //                    address[i] = poi.address;
  //                if(poi.phoneNumber)
  //                    telephone[i] = poi.phoneNumber;
  //            } 

  //            //重新遍历第一页所有点，对结果面板中的每一条记录添加click事件
  //            for (var i = 0; i < results.getCurrentNumPois(); i++){  
  //               $("#poi" + i).click(function(){
  //                   //这里用前面title、address、telephone三个数组中存放的值来拼信息窗里的html代码，存在变量content中，然后：
  //                    var info = new BMap.InfoWindow(content);
  //                    //利用在第一个问题中的markerArr数组设置触发函数，但注意数组的索引值不能用i，因为函数运行时i已不存在，因此在构造结果面板时，每个节点我添加了一个index属性，并用下面的代码获取，设置属性的代码类似于：<div id='poi5' index='5'></div>                        
  //                    markerArr[$(this).attr("index")].openInfoWindow(info);
  //               })
  //            } 
  //        } 
  //    },
  //    pageCapacity: 8  
  // });
</script>