<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <style>
        body,html{
            background-color: #EFEFF4;
        }
        .main {
            margin-top: .36rem;
            background-color: #EDECF3;
            font-size: 0;

        }
        .list {
            height: .8rem;
            /*margin-left: .27rem;*/
            padding-left: .27rem;
            background-color: #fff;
            font-size: 0;
            /*line-height: .8rem;*/
            

        }

        .dynamicState {
             margin-right: .2rem;
             margin-top: .11rem;
        }
        .dynamicState img {
            width: .57rem;
            height: .57rem;
            float: right;
        }
        .wrap1 {
            font-size: 0;
                box-sizing: border-box; 
            /*border-bottom: .01rem solid #f00;*/
            padding-right: .36rem;
            padding-left: .83rem;   
            border-bottom: .01rem solid #EDEDED;
            /*margin-top: .01rem;*/
        }
        .wrap1 span {
            font-size: 0;
            line-height: .8rem;
        }
        .aft:before {
            content: "";
            display: inline-block;
            width: .1rem;
            height: .1rem;
            background-color: #f00;
            border-radius: 50%;
            position: absolute;
            top: .07rem;
            right: .3rem;
        }
        .wrap1 span {
            font-size: .3rem;
        }
        .rightArrowhead {
            float: right;
            display: inline-block;
            width: .15rem;
            height: .8rem;
            background: url(../image/icon_zk.png)no-repeat;
            -webkit-background-size: .15rem .25rem;
            background-size: .15rem .25rem;
            background-position: 0 center;
            float: right;
        }
            
        .list:nth-child(1) .wrap1 {
            margin-bottom: .2rem;
            background: #fff url(../image/icon_find/icon_myCircle.png)no-repeat;
            -webkit-background-size: .44rem .44rem;
            background-size: .44rem .44rem;
            background-position: .11rem center;
        }
        .list:nth-child(2){
            margin-top: .36rem;
            padding-bottom: .02rem;   
        }
        .list:nth-child(3) {
            margin-bottom: .2rem;
        }
        .list:nth-child(2) .wrap1 {
            background: #fff url(../image/icon_find/icon_person.png)no-repeat;
            -webkit-background-size: .42rem .37rem;
            background-size: .42rem .37rem;
            background-position: .11rem center;
        }
        .list:nth-child(3) .wrap1 {
            background: #fff url(../image/icon_find/icon_peopleAround.png)no-repeat;
            -webkit-background-size: .38rem .43rem;
            background-size: .38rem .43rem;
            background-position: .11rem center;

        }
        .list:nth-child(3) .wrap1 {
            background: #fff url(../image/icon_find/icon_supply.png)no-repeat;
            -webkit-background-size: .37rem .38rem;
            background-size: .37rem .38rem;
            background-position: .11rem center;
        }
    </style>
</head>
<body>
    <div class="main">
            <div class="list"   tapmode   onclick="openFindPage(0)">
                <div class="wrap1">
                <span class="text">我在圈</span>
                <div class="wrap fr">
                    <span class="rightArrowhead "></span>
                    <div class="fr dynamicState"><img src="../image/tx_5.jpg"></div class="fr">
                </div>
           </div>
        </div>
        <div class="list" tapmode   onclick="openPage(1)">
           <div class="wrap1">
                <span class="text"   >找人</span>
                <span class="rightArrowhead"></span>
           </div>
        </div>
       <!--  <div class="list" tapmode   onclick="openPage(2)">
           <div class="wrap1">
                <span class="text"   >附近的人</span>
                <span class="rightArrowhead"></span>
           </div>
        </div> -->
        <div class="list" tapmode   onclick="openPage(0)">
           <div class="wrap1">
                <span class="text">找供求</span>
                <span class="rightArrowhead"></span>
           </div>
        </div>
    </div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript" src="../script/pinyin4js.js"></script>
<script type="text/javascript">
    apiready = function(){
        moduleInit();
    };
    function openFindPage(n) {
        if (n == 0) {
            api.openWin({
                name: 'winname',
                url: './find/find_win.html',
                bounces: false,
            });
        }
    }
    function openPage(n) {
        // openDb($api.getStorage('userToken'));
        // requestData();
        if (n === 1) {
            api.openWin({
                name: 'txl_fellowSearch2',
                url: './addressList/txl_fellowSearch.html',
                pageParam: {
                    type: 'mix'
                }
                
            });
        } else if (n === 0) {
            api.openWin({
                name: 'supply_searchSupply_win2',
                url: './supply/supply_searchSupply_win.html',
                pageParam: {
                    typePage: 0
                }
            });
        } else {
            api.openWin({
                name: 'find_peopleAround_win',
                url: './find/find_peopleAround_win.html'
            });
        }
        
    }

    
    function openMain() {
        api.openWin({
            name: 'main',
            url: 'me/me_gs.html',
            slidBackEnabled: false,
            pageParam: {
                userToken: api.pageParam.userToken,
                rongToken: api.pageParam.rongToken
            }
        });
    }
    // 请求数据
    function requestData() {
        // console.log('请求数据')
        api.ajax({
            url: apiSite + '/contact/index',
            method: 'post',
            headers: apiHeader,
            data: {
               values: { 
                  token: $api.getStorage('userToken'),
               }
            }
       }, function(ret, err) {
            console.log('请求数据2222222')
            disData(ret.data.single_list, 1)
            disData(ret.data.both_list, 2)
            disData(ret.data.unavailable_list, 3)
            disData(ret.data.friend_list, 4)
       })
           
    }
    function disData (data, type) {
        // console.log('disData'+type)
        console.log('disData'+data)
        if (data != '') {
            for (var i = 0; i < data.length; i++) {
                // single_list
                // both_list
                // friend_list
                // 去除空格
                data[i].nickname = $api.trimAll(data[i].nickname)
                data[i].litter = PinyinHelper.getShortPinyin(data[i].nickname).toUpperCase();
                data[i].title = data[i].nickname;
                data[i].img = data[i].head_img_url;
                data[i].titleSize = 15;
                if (data[i].current_position == null) {
                    data[i].current_position = '';
                } 
                if (data[i].current_company == null) {
                    data[i].current_company = '';
                }
            }
            // 模块数据格式
            litterSort(data, type)
            // sqlSyntax(initialData);
        }
    }
    // 排序
    function litterSort(data,type) {
        console.log(JSON.stringify(data))
        for (var i = 0; i < data.length; i++) {
            for (var j = 0; j < data.length; j++) {
                if (data[i].litter < data[j].litter) {
                    var temp = data[i];
                    data[i] = data[j];
                    data[j] = temp;
                }
            }
         }
         sqlSyntax(data, type);
        //  for (var i = 0; i < data.length; i++) {
        //     // console.log("letter+++:"+data[i].litter)
        //      data[0].flag = data[0].litter[0]
        //      // data[i].flag = data[i].litter[0]
             
        //     if (i>0) {
        //         if (data[i].litter[0] !== data[i-1].litter[0]) {
        //             // console.log("letter+++:"+data[i].litter)
        //             data[i].flag = data[i].litter[0];
        //             // console.log("flag+++:"+data[i].flag)
        //         }
        //     }
        //  }
        // // console.log('数据：'+JSON.stringify(data))
        // var arr = {}
        // var a;
        // for (var i = 0; i < data.length; i++) {
            
        //     if (data[i].flag) {
        //         arr[data[i].flag] = [];
        //         a = i;
        //     } 
        //     // if (data[a].flag ) {
                
        //     // }
        //     arr[data[a].flag].push (data[i])
        // }
        // console.log(JSON.stringify(arr))
        // return arr;
    }
    // 拼数据库语法字符串
    function sqlSyntax(data1, type) {
        // console.log('数据库'+ type)
        console.log('数据库'+ data1)
        for (var i = 0; i < data1.length; i++) {
            data1[i].flag = data1[i].litter[0];
        }

        // console.log('数据库语法字符串:'+data1);
        var SQLName = 'db_'+$api.getStorage('userToken');
        var SQL = 'INSERT OR REPLACE INTO addressList(user_id,nickname,head_img_url,current_company,current_position,titleSize,title,img,flag,litter,type) VALUES '
        for (var i = 0; i < data1.length; i++) {
            SQL += '("'+ data1[i].user_id +'","'+ data1[i].nickname +'","'+ data1[i].head_img_url +'","'+ data1[i].current_company +'","'+ data1[i].current_position+'","'+ data1[i].titleSize +'","'+ data1[i].title +'","'+ data1[i].img+'","'+ data1[i].flag +'","'+ data1[i].litter +'",'+ type +'),'
        }
        SQL = SQL.substring(0,SQL.length-1) + ';'
        // console.log(SQL)
        db.executeSql({
            name: SQLName,
            sql: SQL
        }, function(ret, err) {
            if (ret.status) {
                console.log('执行语句正确'+JSON.stringify(ret));
            } else {
                console.log('执行语句错误:' + JSON.stringify(err))
            }
        });
    }


</script>
</html>