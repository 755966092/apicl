<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <style>
   
    /* 加号 */
    
    header.header span.rightBtn {
        display: inline-block;
        /*width: .3rem;*/
        /*height: .39rem;*/
        background: url(../../image/icon_other/icon_datum.png)no-repeat;
        background-size: .3rem .3rem;
        background-position: right center;
    }
    
    #title {
        width: 3rem;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    </style>
</head>

<body>
    <header class="header">
        <div class="head">
            <span class="callback" tapmode onclick="api.closeWin()">返回</span>
            <span class="winTitle" id="title">
								
						</span>
            <span class="rightBtn" tapmode onclick="openMemberInfo()"></span>
        </div>
    </header>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript">
	var name, targetRongId, userId;
	apiready = function() {
    // 初始化模块
    moduleInit()
    targetRongId = api.pageParam.targetRongId;
    nickname = api.pageParam.nickname;
    clearState(targetRongId)
        // 获取参数
    var title = document.getElementById('title')
    $api.html(title, nickname);
    console.log(JSON.stringify(api.pageParam))
    // 初始化界面
    fnInit();

    api.setWinAttr({
        softInputMode: 'resize',
    });

    // 聊天内容
    api.openFrame({
        name: 'chattContent',
        url: './chatContent.html',
        softInputMode: 'resize',
        rect: {
            x: 0,
            y: headerH,
            w: 'auto',
            h: 'auto'
        },
        pageParam: {
            nickname: nickname,
            targetRongId: targetRongId,
            userHeadImg: api.pageParam.userHeadImg,
            supplyName: api.pageParam.supplyName,
            priceUint: api.pageParam.priceUint,
            type: api.pageParam.type,
            targetUserId: userId,   
            order_id: api.pageParam.order_id,
            userId: userId,
            headImg: api.pageParam.headImg

        },
        bounces: true
    });
    api.execScript({
        name: 'main',
        // frameName: 'fram0',
        script: 'getTotalCount();'
    });

    api.addEventListener({
        name: 'getUserId'
    }, function(ret, err) {
        if (ret) {
            // alert(JSON.stringify(ret));
            userId = ret.value.userId
        } else {
            alert(JSON.stringify(err));
        }
    });
};
function openMemberInfo() {
    api.openWin({
        name: 'txl_memberInfo_Win',
        url: '../addressList/txl_memberInfo_Win.html',
        pageParam: {
            userId: userId
        }
    });
}
function clearState(targetRongId) {
    rong.clearMessagesUnreadStatus({
        conversationType: 'PRIVATE',
        targetId: targetRongId
    }, function(ret, err) {

    })
}

</script>

</html>
