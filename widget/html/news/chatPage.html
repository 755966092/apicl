<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <style>
      body {}
      
      header {
          background-color: #3A393E;
          height: 1rem;
          color: #fff;
          line-height: 1rem;
          text-align: center;
          position: relative;
          font-size: .36rem;
          position: relative;
      }
      
      header span:nth-child(1) {
          position: absolute;
          left: 0;
          background: url(../../image/icon_fanh.png)no-repeat;
          background-size: .22rem .37rem;
          padding-left: .65rem;
          background-position: .3rem .34rem;
      }
      header span.datum {
        display: inline-block;
        background: url(../../image/icon_other/icon_datum.png)no-repeat;
        -webkit-background-size: .42rem .39rem;
        background-size: .42rem .39rem;
        background-position: 0 center;
        width: .42rem;
        height: 1rem;
        position: absolute;
        right: .3rem;
        /*top: .35rem;*/
      }
      #title {
        width: 3rem;
        overflow: hidden;
        text-overflow: ellipsis;
      }
    </style>
</head>

<body>
    <header>
        <span onclick="api.closeWin()">返回</span>
        <span id="title">titletitletitletitletitletitletitletitle</span>
        <span class="datum"></span>
    </header>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript">
var name, targetRongId;
  apiready = function() {
      // 初始化模块
      moduleInit()
      targetRongId = api.pageParam.targetRongId;
      nickname = api.pageParam.nickname;
      // 获取参数
      var title = document.getElementById('title')
      $api.html(title, nickname);
      
      // 初始化界面
      fnInit();

     
      
      // 聊天内容
      api.openFrame({
          name: 'chattContent',
          url: './chatContent.html',
          rect: {
              x: 0,
              y: headerH,
              w: 'auto',
              h: 'auto'
          },
          pageParam: {
            nickname: nickname,
            targetRongId: targetRongId
          },
          bounces: true
      });
       // 初始化聊天界面
      chatTools();
  };
  // 聊天界面
  function chatTools() {
  
    
        UIChatBox.open({
            placeholder: '请输入内容',
            maxRows: 6,
            autoFocus: true,
            emotionPath: 'widget://res/img/emotion',
            texts: {
                recordBtn: {
                    normalTitle: '按住说话',
                    activeTitle: '松开结束'
                },
                sendBtn: {
                    title: '发送'
                }
            },
            styles: {
                inputBar: {
                    borderColor: '#d9d9d9',
                    bgColor: '#f2f2f2'
                },
                inputBox: {
                    borderColor: '#B3B3B3',
                    bgColor: '#FFFFFF'
                },
                emotionBtn: {
                    normalImg: 'widget://image/chatPage/face1.png'
                },
                extrasBtn: {
                    normalImg: 'widget://image/chatPage/add1.png'
                },
                keyboardBtn: {
                    normalImg: 'widget://image/chatPage/key1.png'
                },
                speechBtn: {
                    normalImg: 'widget://image/chatPage/cam1.png'
                },
                recordBtn: {
                    normalBg: '#c4c4c4',
                    activeBg: '#999999',
                    color: '#000',
                    size: 14
                },
                indicator: {
                    target: 'both',
                    color: '#c4c4c4',
                    activeColor: '#9e9e9e'
                },
                sendBtn: {
                    titleColor: '#fff',
                    bg: '#4cc518',
                    activeBg: '#46a91e',
                    titleSize: 14
                }
            },
            extras: {
                titleSize: 10,
                titleColor: '#a3a3a3',
                btns: [{
                    title: '图片',
                    normalImg: 'widget://image/chatPage/album1.png',
                    activeImg: 'widget://image/chatPage/album2.png'
                }, {
                    title: '拍照',
                    normalImg: 'widget://image/chatPage/loc1.png',
                    activeImg: 'widget://image/chatPage/loc2.png'
                }, {
                    title: '位置',
                    normalImg: 'widget://image/chatPage/loc1.png',
                    activeImg: 'widget://image/chatPage/loc2.png'
                }]
            }
        }, function(ret, err) {
            if (ret) {

                  if (ret.eventType === 'send') {
                   
                    
                     // msg: 发送的消息
                     
                    sendMsg(ret.msg);
                    
                    // 发送消息后清空输入框
                    // UIChatTools.value({
                    //     msg: ''
                    // });
                    // 把聊天内容滑动到最下面
                  } 
                   if (ret.eventType === 'clickExtras') {
                      alert('点击了第'+ret.index+'个附加按钮')
                   }
            } else {
                alert(JSON.stringify(err));
            }
        });
  }

  /**
  * 发送消息 
  * sendMsg(msg)
  * msg: 发送的消息
  */
  function sendMsg(msg) {
    var sendMsg;
    rong.sendTextMessage({
        conversationType: 'PRIVATE',
        // 目标rongyun用户名
        targetId: targetRongId,
        // targetId: name,
        text: msg,
        extra: ''
    }, function(ret, err) {
        
        if (ret.status == 'prepare') {
          sendMsg = ret.result.message.content.text;
          // alert(JSON.stringify(ret));
        }
           
        else if (ret.status == 'success') {
          
            api.sendEvent({
                name: 'sendMsg',
                extra: {
                    msg: sendMsg
                }
            });
            
            
        }
           
        else if (ret.status == 'error') {
            api.alert({
                title: 'title',
                msg: '第三个message' + err.code,
            }, function(ret, err) {
                if (ret) {
                    alert(JSON.stringify(ret));
                } else {
                    alert(JSON.stringify(err));
                }
            });
        }
            
    });
  }

 
</script>

</html>
