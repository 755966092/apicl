
<!doctype html>
<html>

<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>底部导航</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <style>
        header {
            background-color: #3A393E;
        }
                
        header ul li {
            color: #fff;
            height: .8rem;
            line-height: .8rem;
            text-align: center;
            display: none;
            position: relative;
            font-size: .34rem;
            font-weight: 700;
        }
        
        header ul li.active {
            display: block;
        }
        
       
        header ul li span.rightBtn {
            font-size: .65rem;
             line-height: .7rem;
             position: absolute;
             right: .3rem;
             font-weight: 200;
             color: #fff;
        }
        .addWin {
            width: 2.24rem;
            height: 1.74rem;
            background: url(../image/bg_news.png)no-repeat;
            -webkit-background-size: 2.24rem 1.74rem;
            background-size: 2.24rem 1.74rem;
            position: absolute;
            right: .1rem;
            top: 1.1rem;
            padding-top: .1rem;
            display: block;
            z-index: 1000;
        }
        
        .addWin p {
            padding-left: .3rem;
            height: .82rem;
            line-height: .8rem;
            font-size: .28rem;
        }
        
        .addWin p:nth-child(1) {
            background: url(../image/icon_add.png)no-repeat;
            background-position: .15rem .22rem;
            -webkit-background-size: .41rem .41rem;
            background-size: .41rem .41rem;
            border-bottom: .01rem solid #959498;
        }
        
        .addWin p:nth-child(2) {
            background: url(../image/icon_sao.png)no-repeat;
            background-position: .15rem .22rem;
            -webkit-background-size: .41rem .41rem;
            background-size: .41rem .41rem;
        }
        
        #footer {
            /*background-color: rgba(242,242,242,0.2);      */
            background-color: #F5F5F7;
            position: fixed;
            bottom: 0;
            width: 7.5rem;      
            border-top: .6px solid #9D9DA1;
            height: .88rem;      
        }       
        #footer ul {
            /*background-color: rgba(242,242,242,0.2);          */
        }
        #footer ul li {

            padding-top: .64rem; 
            padding-bottom: .1rem;  
            background: url() no-repeat center .15rem;
            background-size: auto .4rem;
            text-align: center;
            position: relative; 
            color: #999;    
            font-size: .18rem;                     
        }   
        
        #footer ul li.active {
            color: #0ABB07;
        }
        
        #footer ul li:nth-child(1) {
            background-image: url(../image/icon_footer/bottombtn0101.png);
        }
        
        #footer ul li:nth-child(2) {
            background-image: url(../image/icon_footer/bottombtn0201.png);
        }
        
        #footer ul li:nth-child(3) {
            background-image: url(../image/icon_footer/bottombtn0301.png);
        }
        
        #footer ul li:nth-child(4) {
            background-image: url(../image/icon_footer/bottombtn0401.png);
        }
        
        #footer ul li:nth-child(5) {
            background-image: url(../image/icon_footer/bottombtn0501.png);
        }
        
        #footer ul li:nth-child(1).active {
            background-image: url(../image/icon_footer/bottombtn0102.png);
        }
        
        #footer ul li:nth-child(2).active {
            background-image: url(../image/icon_footer/bottombtn0202.png);
        }
        
        #footer ul li:nth-child(3).active {
            background-image: url(../image/icon_footer/bottombtn0302.png);
        }
        
        #footer ul li:nth-child(4).active {
            background-image: url(../image/icon_footer/bottombtn0402.png);
        }
        
        #footer ul li:nth-child(5).active {
            background-image: url(../image/icon_footer/bottombtn0502.png);
        }
        #footer ul li.news:before {
            content: "";
            display: inline-block;
            width: .18rem;
            height: .18rem;
            background-color: #f00;
            border-radius: .2rem;
            position: absolute;
            top: .12rem;
            right: .44rem;
        }
        .show {
            display: block;
        } 
        #newsCount {
            display: inline-block;
            position: absolute;
            right: .3rem;
            top: .05rem;
            font-size: .22rem;
            width: .32rem;
            height: .32rem;
            background-color: #f00;
            border-radius: 50%;
            color: #fff;
            text-align: center;
            line-height: .32rem;
        }
        .addF {
            display: inline-block;
            position: absolute;
            right: 0;
            width: .39rem;
            height: .8rem;
            background: url(../image/icon_addF.png)no-repeat;
            -webkit-background-size: .39rem .3rem;
            background-size: .39rem .3rem;
            background-position: 0 center;
            float: right;
            margin-right: .28rem;
        }

    </style>
</head>

<body>
    <div id="wrap" class="flex-wrap flex-vertical">
        <header>
            <ul>
                <li class="border-b active" id="title">
                    我在
                    <!-- <span id="addFellow"   tapmode   onclick="addFellow()"></span> -->
                    <span class="rightBtn"   ontouchstart="addFellow()">+</span> 
                </li>
                <li class="border-b">通讯录
                    <span class="addF" tapmode onclick="addF()"></span>
                </li>
                <li class="border-b supply">
                    供求
                    <span class="rightBtn"   tapmode   onclick="addPublish()">+</span> 
                </li>
                <li class="border-b">发现</li>
                <li class="border-b">我</li>
            </ul>
        </header>
        <div id="main" class="flex-con">
        </div>
        <div id="footer" class="border-t">
            <ul class="flex-wrap">
                <li ontouchstart="randomSwitchBtn( this );" class="flex-con active "><span id="newsCount"></span>首页</li>
                <li ontouchstart="randomSwitchBtn( this );" class="flex-con ">通讯录</li>
                <li ontouchstart="randomSwitchBtn( this );" data-val = '3' class="flex-con ">供求</li>
                <li ontouchstart="randomSwitchBtn( this );" class="flex-con">发现</li>
                <li ontouchstart="randomSwitchBtn( this );" class="flex-con">我</li>
            </ul>
        </div>
    </div>
</body>

</html>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript" src="../script/pinyin4js.js"></script>
<script type="text/javascript">
var userToken, rongToken,footerH;  
apiready = function() {
    alert('版本号:'+api.appVersion)
    footerH = $api.offset($api.byId('footer')).h;
    fnInit();
    // 获取传递参数
    moduleInit();
    $api.fixStatusBar($api.dom('header'));
    api.setStatusBarStyle({
        style: 'light',
        color: 'rbga(0,0,0,0)'
    });
    funIniGroup();
    // 退出app
    exitApp();
    api.addEventListener({
        name: 'viewappear'
    }, function(ret, err) {
        api.sendEvent({
            name: 'refurbish'
        });
    });
    api.addEventListener({
        name: 'searchSupply'
    }, function(ret, err) {
        $api.html($api.dom('.supply'), '找供求<span   tapmode   onclick="addPublish()"></span>');
    });
    api.addEventListener({
        name: 'clearSearchSupply'
    }, function(ret, err) {
        $api.html($api.dom('.supply'), '供求<span   tapmode   onclick="addPublish()"></span>');
    });

    getTotalCount();
    // 打开数据库
    db.openDatabase({
        name: 'db_'+$api.getStorage('userToken')
    }, function(ret, err) {
        if (ret.status) {
            // alert('打开成功');
            openRemarksDb()
        } else {
            alert('267:'+JSON.stringify(err.msg));
        }
    });
    // cacheData();
    api.setAppIconBadge({
        badge: 0
        // 清除角标
    });
    ajpush.init(function(ret) {
        if (ret && ret.status){
            console.log('300:::'+JSON.stringify(ret))
            
            //success
        }
    });
    ajpush.getRegistrationId(function(ret) {
        console.log('315:::'+JSON.stringify(ret))
    });
    ajpush.setListener(
        function(ret) {
             var id = ret.id;
             var title = ret.title;
             var content = ret.content;
             var extra = ret.extra;
             // alert('292'+JSON.stringify(ret))
             if (ret.extra.type == 1) {
                api.openWin({
                    name: 'txl_addFellow_friendRequest_win',
                    url: './addressList/txl_addFellow_friendRequest_win.html',
                });
             }else if (ret.extra.type === 2) {
                // 供应订单 订单id reference_id
                api.openWin({
                    name: 'winName',
                    url: './me/me_gdd.html',
                    pageParam: {
                        order_id: ret.extra.reference_id
                    }
                });
             }

        }
    );
    // 监听安卓
    api.addEventListener({
        name: 'appintent'
    }, function(ret, err) {
        if (ret && ret.appParam.ajpush) {
            var ajpush = ret.appParam.ajpush;
            var id = ajpush.id;
            var title = ajpush.title;
            var content = ajpush.content;
            var extra = ajpush.extra;
            console.log('307:::'+JSON.stringify(ret))
        }
    })
    // 监听ios信息
    api.addEventListener({
        name: 'noticeclicked'
    }, function(ret, err) {
        if (ret && ret.value) {
            var ajpush = ret.value;
            var content = ajpush.content;
            var extra = ajpush.extra;
            console.log('318::key: "value", '+JSON.stringify(ret))
        }
    })
    // 获得极光推送
    ajpush.getRegistrationId(function(ret) {
        var registrationId = ret.id;
        var appVersion = api.appVersion;
        // $api.setStorage('registration_id', registrationId);
        // $api.setStorage('appVersion', appVersion);
        api.ajax({
            url: apiSite + '/settings/registerDevice',
            method: 'post',
            headers: apiHeader,
            data: {
                   values: { 
                       token: $api.getStorage('userToken'),
                       registration_id: registrationId,
                       version: appVersion
                   }
            }
        }, function(ret, err) {
            if(ret) {
            } else {
                alert(JSON.stringify(err))
            }
        })
    });
}

// 通讯录添加好友
function addF() {
    api.openWin({
        name: 'txl_addFellow_win',
        url: './addressList/txl_addFellow_win.html',
        bounces: false
    });
}


// 获取所有未读消息数
function getTotalCount() {
    rong.getTotalUnreadCount(function(ret, err) {
        console.log('295:::'+JSON.stringify(ret))
        if (ret.result == 0 || !ret.result) {
            $api.html($api.byId('title'), '首页<span class="rightBtn"   tapmode   onclick="addFellow()">+</span> ');
                $api.css($api.byId('newsCount'), 'display: none');
            api.setAppIconBadge({
                badge: ret.result
                // 清除角标
            });
        } else {
            api.setAppIconBadge({
                badge: ret.result
                // 清除角标
            });
                $api.html($api.byId('title'), '首页(' +ret.result+ ')<span class="rightBtn"   tapmode   onclick="addFellow()">+</span> ');
                $api.css($api.byId('newsCount'), 'display: inline-block');
                $api.html($api.byId('newsCount'), ret.result);
        }
    })
}
function funIniGroup() {
    var eHeaderLis = $api.domAll('header li'),
        frames = [];
    for (var i = 0, len = eHeaderLis.length; i < len; i++) {
        // 个人中心页面不弹动
        if (i === 4 || i === 1 || i ===2 || i===0) {
            frames.push({
                name: 'frame' + i,
                url: './frame' + i + '.html',
                bgColor: 'rgba(0,0,0,.2)',
                pageParam: {
                    userToken: userToken,
                    rongToken: rongToken,
                    headerH: headerH,
                    footerH: footerH
                },
                bounces: false
            }) 
        } else {
            frames.push({
                name: 'frame' + i,
                url: './frame' + i + '.html',
                bgColor: 'rgba(0,0,0,.2)',
                pageParam: {
                    userToken: userToken,
                    rongToken: rongToken,
                    headerH: headerH,
                    footerH: footerH
                },
                bounces: true
            })
        }
    }
    api.openFrameGroup({
        name: 'group',
        scrollEnabled: false,
        preload: 0,
        rect: {
            x: 0,
            y: $api.dom('header').offsetHeight,
            w: api.winWidth,
            h: api.winHeight - $api.dom('header').offsetHeight - $api.dom('#footer').offsetHeight
        },
        index: 0,
        frames: frames
    }, function(ret, err) {

    });
}

// 随意切换按钮
function randomSwitchBtn(tag) {
    if (tag == $api.dom('#footer li.active')) return;
    var eFootLis = $api.domAll('#footer li'),
        eHeaderLis = $api.domAll('header li'),
        index = 0;
    for (var i = 0, len = eFootLis.length; i < len; i++) {
        if (tag == eFootLis[i]) {
            index = i;
        } else {
            $api.removeCls(eFootLis[i], 'active');
            $api.removeCls(eHeaderLis[i], 'active');
        }
    }
    $api.addCls(eFootLis[index], 'active');
    $api.addCls(eHeaderLis[index], 'active');
    api.setFrameGroupIndex({
        name: 'group',
        index: index
    });

    if ($api.attr(tag, 'data-val') !== '3'){
        api.closeFrameGroup({
            name: 'supply_publish'
        });
    } else {
        api.sendEvent({
            name: 'openSupplyPublishr'
        });
    }
}

// 添加好友按钮
function addFellow() {
    //添加时间，控制frame0页面的添加好友弹框的显示，如果在该页面写会被frame覆盖
    api.sendEvent({
        name: 'showNews',
    });
}
// 点击发布按钮
function addPublish() {
    // api.sendEvent({
    //     name: 'addPublish'
    // });
    api.openFrame({
        name: 'supply_addSupply',
        url: './supply/supply_addSupply.html',
        rect: {
            x: 0,
            y: headerH,
            w: 'auto',
            h: 'auto'
        },
        bounces: false
    });
}
function openRemarksDb() {
    var SQLName = 'db_'+$api.getStorage('userToken');
    // 备注电话
    db.executeSql({
        name: SQLName,
        sql: 'CREATE TABLE IF NOT EXISTS tb_remarks_contact(list_id varchar(255) PRIMARY KEY NOT NULL,user_id int, contact_id int, phone varchar(255), type int, sub_type int, is_default int)'    
    }, function(ret, err){        
       // alert('1main_ret:'+JSON.stringify(ret))
        console.log('表1')
    });
    
    // 备注其他联系方式
    db.executeSql({
        name: SQLName,
        sql: 'CREATE TABLE IF NOT EXISTS tb_remarks_other_contact(list_id varchar(255) PRIMARY KEY NOT NULL,user_id int, contact_id int, info varchar(255), type int, sub_type int)'    
    }, function(ret, err){        
       // alert('2main_ret:'+JSON.stringify(ret))
       console.log('表2')
    });
    // 备注地址
    db.executeSql({
        name: SQLName,
        sql: 'CREATE TABLE IF NOT EXISTS tb_remarks_address(list_id varchar(255) PRIMARY KEY NOT NULL,user_id int, address_id int, province varchar(255), city varchar(255), district varchar(255), address varchar(255), note varchar(255))'    
    }, function(ret, err){        
        console.log('表3')
       // alert('3main_ret:'+JSON.stringify(ret))
    });
    // 备注内容
    // 备注学习经历
    db.executeSql({
        name: SQLName,
        sql: 'CREATE TABLE IF NOT EXISTS tb_remarks_education(list_id varchar(255) PRIMARY KEY NOT NULL,user_id int, education_id int, type int, school varchar(255), major varchar(255), degree varchar(255), description varchar(255),start_date varchar(255),end_date varchar(255))'    
    }, function(ret, err){   
    console.log('表4')     
       // alert('4main_ret:'+JSON.stringify(ret))
    });
    // 备注工作经历
    db.executeSql({
        name: SQLName,
        sql: 'CREATE TABLE IF NOT EXISTS tb_remarks_work(list_id varchar(255) PRIMARY KEY NOT NULL,user_id int, work_id int, company_id int, company_name varchar(255), position varchar(255), description varchar(255), is_default int,start_date varchar(255),end_date varchar(255))'    
    }, function(ret, err){  
        console.log('表5')      
       // alert('5main_ret:'+JSON.stringify(ret))
    });
    // 备注项目经历
    db.executeSql({
        name: SQLName,
        sql: 'CREATE TABLE IF NOT EXISTS tb_remarks_project(list_id varchar(255) PRIMARY KEY NOT NULL,user_id int, project_id int, name varchar(255), url varchar(255), role varchar(255), description varchar(255), achievement varchar(255),start_date varchar(255),end_date varchar(255))'    
    }, function(ret, err){ 
        console.log('表6')       
       // alert('6main_ret:'+JSON.stringify(ret))
    });
    // 个人信息表
    db.executeSql({
        name: SQLName,
        sql: 'CREATE TABLE IF NOT EXISTS tb_remarks_user_info(remark_user_id int PRIMARY KEY NOT NULL, current_position varchar(255), current_degree varchar(255), current_company varchar(255), nickname varchar(255), real_name varchar(255), birthday varchar(255), hometown varchar(255), sex int, head_img_url varchar(255), extra_id int, extra_content varchar(255), extra_image_url varchar(255))'    
    }, function(ret, err){        
        if( ret.status ){
            console.log('表7')
            // alert( JSON.stringify( ret ) );
        }else{
            alert('473'+ JSON.stringify( err ) );
            console.log('473'+ JSON.stringify( err ) );
        }
    });
     // db.executeSql({
     //     name: SQLName,
     //     sql: 'DROP TABLE tb_remarks_status'    
     // }, function(ret, err){        
     //     if( ret.status ){
     //         alert('1'+ JSON.stringify( ret ) );
     //     }else{
     //         alert( JSON.stringify( err ) );
     //     }
     // });
    // 用户当前状态表格
    db.executeSql({
        name: SQLName,
        sql: 'CREATE TABLE IF NOT EXISTS tb_remarks_status(remark_user_id int , status_id int PRIMARY KEY NOT NULL, name varchar(255), position varchar(255), degree varchar(255), start_date varchar(255), is_default int, type int)'    
    }, function(ret, err){        
        if( ret.status ){
            console.log('表8')
            // alert('用户当前状态表格'+ JSON.stringify( ret ) );
        }else{
            alert('473'+ JSON.stringify( err ) );
        }
    });
     // db.executeSql({
     //     name: SQLName,
     //     sql: 'DROP TABLE tb_remarks_contact1'    
     // }, function(ret, err){        
     //     if( ret.status ){
     //         alert('2'+ JSON.stringify( ret ) );
     //     }else{
     //         alert( JSON.stringify( err ) );
     //     }
     // });
}  
 
</script>