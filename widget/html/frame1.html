<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>我在</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <style>
       

            .search {
            border-radius: .04rem;
            display: block;
            height: .5rem;
            line-height: .5rem;
            background-color: #fff;
            margin: 0 .15rem;
            text-align: center;
            font-size: 0.24rem;
            color: #96969B;
            
        }
        .search .searchIcon {
            display: inline-block;
            width: .26rem;
            height: .5rem;
            background: url(../image/icon_supply/icon_search.png)no-repeat;
            -webkit-background-size: .25rem .26rem;
            background-size: .25rem .26rem;
            background-position: 0 center;
            vertical-align: top;
        }
        .search .searchText {
            font-size: .24rem;
        }
       
        .news {
            display: flex;
            flex-flow: column nowrap;
        }
        
        ul {
            width: 100%;
            box-sizing: border-box;
        }
        
        ul li {
            width: 100%;
            height: 1.2rem;
            box-sizing: border-box;
            padding: .15rem .3rem;
            /*padding: .15rem 0;*/
            border-bottom: 1px solid #D6D6D6;
            position: relative;
        }
        
        ul li img {
            width: .9rem;
            height: .9rem;
            margin-right: .2rem;
        }
        
        ul li h3 {
            margin-top: .1rem;
            margin-bottom: .05rem;
            width: 3.5rem;
            float: left;
            overflow: hidden;
            text-overflow: ellipsis;
        }
       
        ul li.select:before {
            content: "";
            display: inline-block;
            width: .15rem;
            height: .15rem;
            background-color: #f00;
            border-radius: 50%;
            position: absolute;
            top: .1rem;
            left: .8rem;
        }
        
        ul li p {
            color: #9B9B9B;
            word-wrap: break-word;
            white-space: nowrap;
            text-overflow: ellipsis;
            height: .32rem;
            width:3.5rem;
            overflow: hidden;
            text-overflow: ellipsis;
        }


        .main_no1,
        .main_no2 {
            height: 1rem;
            border-bottom: 1px solid #EBEBEB;
            font-size: .3rem;
            line-height: 1rem;
            padding-left: 1.1rem;

        }
        .main_no1 {
            background: #fff url(../image/icon_txl/icon_yi.png)no-repeat;
            -webkit-background-size: .64rem .64rem;
            background-size: .64rem .64rem;
            background-position: .2rem center;
        }
        .main_no2 {
            background: #fff url(../image/icon_txl/icon_cs.png)no-repeat;
            -webkit-background-size: .64rem .64rem;
            background-size: .64rem .64rem;
            background-position: .2rem center;
            margin-bottom: .6rem;
        }
        .wrap {
            padding: .2rem 0;
        }
    </style>
</head>

<body>
    <div id="news_wrap" class=" clearfix">
       <div class="wrap clearfix">
            <div class="search"   tapmode="hover"   onclick="openS()">
                <span class="searchIcon"></span>
                <span class="searchText">搜索</span>
            </div>
       </div>
        <div class="main_no1"   tapmode="hover"   onclick="onceConnected()">
            一度人脉
        </div>
        <div class="main_no2"   tapmode="hover"   onclick="contactFriend()">
            初识好友（无通讯录）
        </div>
    </div>
    <script type="text/javascript" src="../script/common.js"></script>
    <script type="text/javascript" src="../script/api.js"></script>
    <script type="text/javascript" src="../script/doT.min.js"></script>
    <script type="text/javascript" src="../script/pinyin4js.js"></script>
    <script type="text/javascript">
    apiready = function() {
        moduleInit()
        // requestData();
        query();
        
    }
    function openS() {
        api.openWin({
            name: 'txl_fellowSearch',
            url: './addressList/txl_fellowSearch.html',
            pageParam: {
                userToken: api.pageParam.userToken,
                rongToken: api.pageParam.rongToken
            }
        });
    }
    // 打开一度人脉
    function onceConnected() {
        api.openWin({
            name: 'listWin',
            url: './addressList/txl_listWin.html',
            pageParam: {
                userToken: api.pageParam.userToken,
                headerH: headerH
            },
            slidBackEnabled: false,
            bounces: false
        });
    }
    // 打开初始好友
    function contactFriend () {
        api.openWin({
            name: 'txl_contactFriend_win',
            url: './addressList/txl_contactFriend_win.html',
            bounces: false,
            pageParam: {
                headerH: headerH
            }
       });   
    }

    function dakai(data1) {
        var hei = $api.offset($api.dom('.main_no1')).h * 2 + $api.offset($api.dom('.wrap')).h; 
         listContact.open({
            x: -1000,
            y: -1000,
            w: 5,
            h: 5,
            data: [],
            fixedOn: api.frameName
        },function(ret,err){
        })
        listContact.close();
        listContact.open({
                x : 0,
                y : hei,
                w : api.frameWidth,
                h : api.frameHeight - hei,
                bgColor: '#EFEFF4',
                // 分割线颜色
                borderColor: '#EDEDED',
                // rightBtn: [{
                //     color: '#000',
                //     title: '备注'
                // },{
                //     color: '#000',
                //     title: '删除'
                // }],
                imgHeight: 32,
                groupTitle: {
                    color: '#999',       
                    size: 14,   
                    bgColor: '#EFEFF4'
                },
                rightBg: '#fff',
                // 侧滑
                indicator: {
                    bgColor: 'rgba(0,0,0,0)',
                    color: '#5A5A5A'
                },
                cellBgColor: '#fff',
                // 搜索框
                // searchBar: {},
                data: data1,
                fixedOn: api.frameName
            }, function(ret, err) {
                if (ret) {
                    // alert(JSON.stringify(data1[ret.key][ret.index]));

                    addFriends(data1[ret.key][ret.index].user_id);
                } else {
                    // alert(JSON.stringify(err.msg));
                }
            });
    }
     // 打开人脉详情
    function addFriends(userId) {
        api.openWin({
            name: 'txl_memberInfo_Win',
            url: './addressList/txl_memberInfo_Win.html',
            pageParam: {
                userId: userId
            }
        });
    }
    function f_check_uppercase(obj)   {          
       if (/[A-Z]/.test(obj))    {   
          return true;   
       }    
       return false;   
    }
    // 查询数据库
    function query() {
        var SQLName = 'db_'+$api.getStorage('userToken');
        // 查询数据库
        db.selectSql({
            name: SQLName,
            sql: 'SELECT * FROM addressList'
        }, function(ret, err) {
            // console.log('查询到的数据:'+JSON.stringify(ret))
            if (ret.status) {
                // setTimeout(function(){
                //     if (ret.data=='') {
                //         query();
                //     }
                // },1)
                // 
                // console.log('frame1::::::'+JSON.stringify(ret))
                if (ret.data.length === 0) {
                    // console.log('暂无数据')
                    query();
                } else {
                    // console.log('有数据')
                    dakai(paixv(ret.data))
                }
            } else {
                console.log(JSON.stringify(err));
            }
        });
    }
    function paixv (data) {
        // console.log('未处理的数据:'+JSON.stringify(data))

        for (var i = 0; i < data.length; i++) {
            data[i].placeholderImg = "widget://html/image/";
                if (f_check_uppercase(data[0].flag)) {
                    data[0].initial = data[0].flag;
                } else {
                    data[0].initial = '#';
                }
                if (i>0) {
                    if (data[i].flag !== data[i-1].flag) {
                        if (f_check_uppercase(data[i].flag)) {
                            data[i].initial = data[i].flag;
                        } else {
                            data[i].initial = '#';
                        }
                    }
                }
             }
            var arr = {}
            var a;
            for (var i = 0; i < data.length; i++) {
                if (data[i].initial) {
                    if (data[i].initial == '#') {
                        if (arr[data[i].initial]) {
                            arr[data[i].initial].push (data[i])
                        } else {
                            arr[data[i].initial] = [];
                            arr[data[i].initial].push (data[i])
                        }
                    } else {
                        arr[data[i].initial] = [];
                        a = i;
                    }
                } 
                // if (data[a].initial ) {
                    
                // }
                arr[data[a].initial].push (data[i])
            }
            // console.log('处理完的数据:'+JSON.stringify(arr))
            return arr;
    }
    </script>
</body>

</html>
