<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>我在</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <link rel="stylesheet" type="text/css" href="../css/weui.css" />
    <style>
        html,body {
            height: auto;
        }
      
        .wrap {
            background-color: #EDECF3;
        }
        .search {
            width: 7.26rem;
            box-sizing: border-box;
            height: .5rem;
            line-height: .5rem;
            background-color: #fff;
            margin: .15rem 0;
            text-align: center;
            font-size: 0;
        }
        .search .searchIcon {
            display: inline-block;
            width: .26rem;
            height: .5rem;
            background: url(../image/icon_supply/icon_search.png)no-repeat;
            -webkit-background-size: .25rem .26rem;
            background-size: .25rem .26rem;
            background-position: 0 center;
            vertical-align: top;
            margin-right: .05rem;
        }
        .search .searchText {
            color: #999;
            font-size: .24rem;
        }


       
        .no_data {
            background-color: #fff;
            display: none;
        }
      
      


        .weui-cell__hd img {
            width:.62rem;
            margin-right:10px;
            display:block
        }
        .ml5 {
            margin-left: 0.5rem;
        }
        .hide {
            display: none;
        }
        .weui-cell__bd p {
            font-size: 0.29rem;
        }
        .weui-cell__right {
            font-size: 0.3rem;
            text-align: right;
            color: #999999;
        }
        .mt32 {
            margin-top: 0.32rem;
        }
    </style>
</head>
<body>

    <div class="loading"></div>
    

    <div id="news_wrap" class=" clearfix">
       <div class="wrap flex-def flex-cCenter flex-zCenter">
            <div class="search flex-def flex-cCenter flex-zCenter"   tapmode   onclick="openS()">
                <span class="searchIcon"></span>
                <span class="searchText">搜索</span>
            </div>
       </div>
        <div class="weui-cells">
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="openNewFri()">
                <div class="weui-cell__hd">
                    <img src="../image/icon_txl/icon-hyqq.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>新的朋友</p>
                </div>
                <div class="weui-cell__right"></div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="onceConnected(1,4)">
                <div class="weui-cell__hd">
                    <img tapmode onclick="hideWuiList(this,1)" src="../image/iocn_addressList/icon_chu.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>初识好友</p>
                </div>
                <div class="weui-cell__right" id="friend"></div>
            </a>
        </div>
        <!-- single_list1 single_list2 both_list unavailable_list list friend -->
        <div class="weui-cells mt32">
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="onceConnected(1)">
                <div class="weui-cell__hd">
                    <img tapmode onclick="hideWuiList(this,1);event.stopPropagation();" src="../image/iocn_addressList/icon_yi.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>一度人脉</p>
                </div>
                <div class="weui-cell__right" id="list"></div>
            </a>
            <a class="oneTime ml5 hide weui-cell weui-cell_access" href="javascript:;" tapmode onclick="onceConnected(4)">
                <div class="weui-cell__hd">
                    <img style="width:.4rem;" src="../image/iocn_addressList/icon_4icon.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>熟识圈</p>
                </div>
                <div class="weui-cell__right"></div>
            </a>
            <a class="oneTime ml5 hide weui-cell weui-cell_access" href="javascript:;" tapmode onclick="onceConnected(1,2)">
                <div class="weui-cell__hd">
                    <img style="width:.4rem;" src="../image/iocn_addressList/icon_1icon.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>熟识好友</p>
                </div>
                <div class="weui-cell__right" id="both_list"></div>
            </a>
            <a class="oneTime ml5 hide weui-cell weui-cell_access" href="javascript:;" tapmode onclick="onceConnected(1,1,'my')">
                <div class="weui-cell__hd">
                    <img style="width:.4rem;" src="../image/iocn_addressList/icon_acquaintance.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>相识好友</p>
                </div>
                <div class="weui-cell__right" id="single_list1"></div>
            </a>
            <a class="oneTime ml5 hide weui-cell weui-cell_access" href="javascript:;" tapmode onclick="onceConnected(1,1,'he')">
                <div class="weui-cell__hd">
                    <img style="width:.4rem;" src="../image/iocn_addressList/icon_acquaintance2.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>相识好友</p>
                </div>
                <div class="weui-cell__right" id="single_list2"></div>
            </a>
            <a class="oneTime ml5 hide weui-cell weui-cell_access" href="javascript:;" tapmode onclick="onceConnected(1,3)">
                <div class="weui-cell__hd">
                    <img style="width:.4rem;" src="../image/iocn_addressList/yidushang.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>尚未加入</p>
                </div>
                <div class="weui-cell__right" id="unavailable_list"></div>
            </a>
        
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="onceConnected(2)">
                <div class="weui-cell__hd">
                    <img tapmode onclick="hideWuiList(this,2);event.stopPropagation();" src="../image/iocn_addressList/icon_2.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>二度人脉</p>
                </div>
                <div class="weui-cell__right" id="lev2"></div>
            </a>
            <a class="twoTime ml5 hide weui-cell weui-cell_access" href="javascript:;" tapmode onclick="onceConnected(2,1)">
                <div class="weui-cell__hd">
                    <img style="width:.4rem;" src="../image/iocn_addressList/er.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>二度好友</p>
                </div>
                <div class="weui-cell__right" id="lev2_available"></div>
            </a>
            <a class="twoTime ml5 hide weui-cell weui-cell_access" href="javascript:;" tapmode onclick="onceConnected(2,2)">
                <div class="weui-cell__hd">
                    <img style="width:.4rem;" src="../image/iocn_addressList/er.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>尚未加入</p>
                </div>
                <div class="weui-cell__right" id="lev2_unavailable"></div>
            </a>
        
        
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="onceConnected(3)">
                <div class="weui-cell__hd">
                    <img tapmode onclick="hideWuiList(this,3);event.stopPropagation();" src="../image/iocn_addressList/icon_san.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>三度人脉</p>
                </div>
                <div class="weui-cell__right" id="lev3"></div>
            </a>
            <a class="threeTime ml5 hide weui-cell weui-cell_access" href="javascript:;" tapmode onclick="onceConnected(3,1)">
                <div class="weui-cell__hd">
                    <img style="width:.4rem;" src="../image/iocn_addressList/er.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>三度好友</p>
                </div>
                <div class="weui-cell__right" id="lev3_available"></div>
            </a>
            <a class="threeTime ml5 hide weui-cell weui-cell_access" href="javascript:;" tapmode onclick="onceConnected(3,2)">
                <div class="weui-cell__hd">
                    <img style="width:.4rem;" src="../image/iocn_addressList/er.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>尚未加入</p>
                </div>
                <div class="weui-cell__right" id="lev3_unavailable"></div>
            </a>
            <a class=" weui-cell weui-cell_access" href="javascript:;" tapmode onclick="openSchemaPage(1)">
                <div class="weui-cell__hd">
                    <img src="../image/iocn_addressList/icon_wen.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>人脉等级相关说明</p>
                </div>
                <div class="weui-cell__right"></div>
            </a>
        </div>
    </div>
    <p class="no_data">未获取通讯录权限<br>请获取通讯录权限后在设置里更新通讯录</p>
    <div class="slidePage flex-def flex-zTopBottom flex-zCenter flex-cEnd" ontouchmove="move()">
        <div ></div>
    </div>
    <script type="text/javascript" src="../script/common.js"></script>
    <script type="text/javascript" src="../script/jquery.min.js"></script>
    <script type="text/javascript" src="../script/api.js"></script>
    <script type="text/javascript" src="../script/doT.min.js"></script>
    <script type="text/javascript" src="../script/pinyin4js.js"></script>
    <script type="text/javascript">
    var letterArr = [],letterObj = [];
    var dataArr;
    var single_list1=0, single_list2=0, both_list=0, unavailable_list=0, list=0, friend=0;
    apiready = function() {
        // console.log(api.winHeight)
        $api.css($api.dom('.slidePage'),'height:60px')

        moduleInit();
        // 二三度人脉数量
        getContactCount();
        initPage();
        api.addEventListener({
            name: 'editUserInfoUpdateList'
        }, function(ret, err) {
            if (ret) {
                $api.rmStorage('contactCount');
                single_list1 = 0, single_list2 = 0, both_list = 0, unavailable_list = 0, list = 0, friend = 0, dataArr = '';
                initPage();
                getContactCount();
            } else {
                alert(JSON.stringify(err));
            }
        });
        api.addEventListener({
            name: 'updateAddressList'
        }, function(ret, err){
            console.log('监听到事件');
            
            dataArr = '';
            initPage()
        });
        if (!$api.getStorage('guidancePage')) {
            shadowPage();
        }
       
    }
    function hideWuiList(ele,flag) {
        var cls = '';
        if (flag == 1) {
            // 隐藏一度好友下的列表
           cls = 'oneTime';
        } else if (flag == 2) {
            cls = 'twoTime';
        } else {
            cls = 'threeTime';
        }
         for (var i = 0; i < $api.domAll('.'+ cls).length; i++) {
            var element = $api.domAll('.'+ cls)[i];
            if ($api.hasCls(element, 'hide')) {
                $api.removeCls(element, 'hide');
            } else {
                $api.addCls(element, 'hide');
            }
        }
        initPage();
    }
    // doT模版获取数据
    function getData(data, htmlStr) {
            $api.html($api.dom('.slidePage div'), $api.getStorage('frame1SlideBar'));
            var list = $api.dom('.resultList');
            var listTText = $api.byId('listT').text;
            var fnListT = doT.template(listTText);
            var html = fnListT(data);
            $api.html(list, html);
            $api.css($api.dom('.loading'), 'display:none');
    }
    // getContactCount()
    function getContactCount() {
        var contactC = $api.getStorage('contactCount');
        if (contactC) {
            // 缓存
            console.log('缓存:'+JSON.stringify(contactC));
            
            $api.text($api.byId('lev2'), contactC.lev2);
            $api.text($api.byId('lev2_available'), contactC.lev2_available);
            $api.text($api.byId('lev2_unavailable'), contactC.lev2_unavailable);
            $api.text($api.byId('lev3'), contactC.lev3);
            $api.text($api.byId('lev3_available'), contactC.lev3_available);
            $api.text($api.byId('lev3_unavailable'), contactC.lev3_unavailable); 
        } else {
            api.ajax({
                url: apiSite + '/contact/getContactCount',
                method: 'post',
                headers: apiHeader,
                data: {
                    values: {
                        token: $api.getStorage('userToken'),
                    }
                }
            }, function (ret, err) {
                if (ret) {
                    if (ret.code === 200) {
                        $api.text($api.byId('lev2'), ret.data.lev2);
                        $api.text($api.byId('lev2_available'), ret.data.lev2_available);
                        $api.text($api.byId('lev2_unavailable'), ret.data.lev2_unavailable);
                        $api.text($api.byId('lev3'), ret.data.lev3);
                        $api.text($api.byId('lev3_available'), ret.data.lev3_available);
                        $api.text($api.byId('lev3_unavailable'), ret.data.lev3_unavailable);
                        $api.setStorage('contactCount', ret.data);
                    } else {
                        alert(ret.msg)
                    }
                } else {
                    alert(JSON.stringify(err))
                }
            })
        }
        
    }
    function initPage() {
        if ($api.getStorage('noAccessToContacts') == 'true') {
            // 未获取通讯录权限
            $api.css($api.dom('.loading'), 'display: none');
            $api.css($api.dom('.no_data'), 'display: block');
        } else {
            if (dataArr) {
                dakai(dataArr);
            } else {
                db.selectSql({
                    name: 'db_' + $api.getStorage('userToken'),
                    sql: 'SELECT * FROM addressList_simplify WHERE type IN (1,2,3,4) order by flag asc',
                }, function (ret, err) {
                    // console.log(JSON.stringify(ret));
                    
                    if (ret.status) {
                        // 2 : 熟识好友
                        // 3 : 尚未加入
                        // 1 : 相识好友
                        // path_direction: 1 我认识的
                        // 2 认识我的
                        // 4 : 初始好友
                        if (ret.data.length != 0) {
                            dakai(paixv(ret.data));
                        } else {
                            // query();
                        }
                    } else {
                        alert('292' + JSON.stringify(err));
                    }
                });
            }
          
        }
    }
    
    // 数据排序
    function sortData(data) {
        // for (var i = 0; i < data.length; i++) {
        //     for (var j = 0; j < data.length; j++) {
        //         if (data[i].flag < data[j].flag) {
        //             var temp = data[i];
        //             data[i] = data[j];
        //             data[j] = temp;
        //         }
        //     }
        //  }
        for (var i = 0; i < data.length; i++) {
            if (i>0) {
                if (data[i].flag !== data[i-1].flag) {
                    if (f_check_uppercase(data[i].flag)) {
                        data[i].flagLetter = data[i].flag;
                        letterArr.push(data[i].flag)
                    } else {
                        // data[i].flagLetter = '#';
                        // letterArr.push('#')
                    }
                }
            } else {
                if (f_check_uppercase(data[0].flag)) {
                    letterArr.push(data[0].flag);
                    data[0].flagLetter = data[0].flag
                 } else {
                    letterArr.push('#')
                    data[0].flagLetter = '#'
                 }
            }
         }
         // 侧边栏
         var str = '' ;
         for (var i = 0; i < letterArr.length; i++) {
            str += '<span ontouchstart="anchorJump(this)"  >'+ letterArr[i] +'</span>'
         }
            $api.setStorage('frame1SlideBar', str);
            // getData(data)
            // dakai(data)
            //console.log('703:::'+data.length)
    }
    function insertOneSql(type,str) {
        str = $api.jsonToStr(str);
        db.executeSql({
            name: SQLName,
            sql: "INSERT OR REPLACE INTO addressList_one (type, str) VALUES ("+ type +",'"+ str +"')"
        }, function(ret, err){
            if( ret.status ){
                //console.log('缓存成功')
            }else{
                // alert('756:'+ JSON.stringify( err ) );
            }
        });
    }
    // 选中好友
    function selPerson(ele) {
        // var sel = ele.getElementsByClassName('sel')[0];
        // if ($api.hasCls(sel, 'pitchOn')) {
        //     $api.removeCls(sel, 'pitchOn');
        // } else {
        //     $api.addCls(sel, 'pitchOn');
        // }
        var userId = $api.attr(ele, 'data-id');
        api.openWin({
            name: 'txl_memberInfo_Win',
            url: './addressList/txl_memberInfo_Win.html',
            pageParam: {
                userId: userId
            }
        });
    }
    // 隐藏列表
    function hideList(ele,n) {
        $api.css($api.dom('.loading'), 'display:block');
        var name;
        if (n == 1) {
            name = '.itemList_one';
        } else if (n == 2) {
            name = '.itemList_two';
        } else {
            name = '.itemList_three';
        }
        var list = $api.domAll(name);
        var main_no1 = $api.domAll('.main_no1');
        for (var i = 0; i < list.length; i++) {
            if ($api.hasCls(list[i], 'hide')) {
                $api.removeCls(list[i], 'hide');
            } else {

                $api.addCls(list[i], 'hide');
            }
        }
        // var listH = $api.offset($api.byId('news_wrap')).h;
        // $api.css($api.dom('html'), 'height:' + (listH+550)/50 + 'rem');
        // $api.css($api.dom('body'), 'height:' + (listH+550)/50 + 'rem');
        initPage();
        // query();
    }
    // 打开人脉关系图
    function openSchemaPage(n) {
        if (n) {
            api.openWin({
                name: 'txl_relationSchema_win',
                url: './addressList/txl_relationSchema_win.html',
                // url: './addressList/relation/index_win.html',
                pageParam: {
                    name: 'value'
                }
            });
        }  else {
            api.openWin({
                name: 'aaaaaa',
                url: './addressList/aaaaaa.html',
                pageParam: {
                    name: 'value'
                }
            });
        }
    }
    function function_name() {
            api.openWin({
                name: 'txl_relationSchema_win',
                url: './frame1.html',
                pageParam: {
                    name: 'value'
                }
            });
    }
    function openS() {
        // 搜索本地页面

        // api.openWin({
        //     name: 'txl_fellowSearch',
        //     url: './addressList/txl_fellowSearch.html',
        //     pageParam: {
        //         userToken: api.pageParam.userToken,
        //         rongToken: api.pageParam.rongToken
        //     }
        // });

        // 搜索全部
        api.openWin({
            name: 'search_main_win',
            url: './search/search_main_win.html',
            bounces: false
        });
    }
    // 打开一度人脉
    function onceConnected(n,flag, str) {
        var url;
        if (n == 1) {
            // if (flag == 1) {
            //     url = "txl_listWin_danxiang"
            // } else if (flag == 2) {
            //     url = "txl_listWin_shuangxiang"
            // } else if (flag == 3) {
            //     url = "txl_listWin_you"
            // } else if (flag == 4) {
            //     url = "txl_listWin_chushi"
            // } else {
            //     url = 'txl_listWin'
            // }
                url = 'txl_listWin'
        } else if (n == 2) {
            url = 'txl_listWin_2'
        } else if (n == 3){
            url = 'txl_listWin_3'
        } else if (n == 4){
            url = 'txl_listWin_4'
        }
        api.openWin({
            name: 'listWin_' + url,
            url: './addressList/'+ url +'.html',
            pageParam: {
                userToken: api.pageParam.userToken,
                headerH: headerH,
                flag: flag,
                // 区分相识好友方向的字段
                path_direction: str
            },
            slidBackEnabled: false,
            bounces: false
        });
    }
    // 打开初始好友
    function contactFriend () {
        api.openWin({
            name: 'txl_contactFriend_win',
            url: './addressList/txl_contactFriend_win.html',
            bounces: false,
            pageParam: {
                headerH: headerH
            }
       });
    }

    function dakai(data1) {
       
             var btm = 440 / (100 * (api.frameWidth / 750));
        $api.css($api.dom('body'), 'padding-bottom:'+ btm +'rem');
        var dataArr = [];
        var dataKeyArr = [];
        for(key in data1) {
            // console.log(data1[key])
            dataArr = dataArr.concat(data1[key]);
            dataKeyArr.push(key)
        }
        listContact.open({
            x: -1000,
            y: -1000,
            w: 5,
            h: 5,
            data: [],
            fixedOn: api.frameName
        },function(ret,err){
        })
        listContact.close();
        listContact.open({
                x : 0,
                y : $api.offset($api.byId('news_wrap')).h,
                w : api.frameWidth,
                h : 500,
                bgColor: '#EFEFF4',
                // 分割线颜色
                borderColor: '#EDEDED',
                // rightBtn: [{
                //     color: '#000',
                //     title: '备注'
                // },{
                //     color: '#000',
                //     title: '删除'
                // }],
                rightBtn: [{
                    color: '#20AC19',
                    title: '呼叫'
                }],
                imgHeight: 32,
                imgWidth: 32,
                groupTitle: {
                    color: '#999',
                    size: 14,
                    bgColor: '#EFEFF4'
                },
                cellHeight: 50,
                rightBg: '#fff',
                // 侧滑
                indicator: {
                    bgColor: 'rgba(0,0,0,0)',
                    color: '#5A5A5A'
                },
                cellBgColor: '#fff',
                data: data1,
                fixedOn: 'frame1',
                fixed: false
            }, function(ret, err) {
                if (ret) {
                     if (ret.clickType == 0) {
                        // 获取点击联系人信息
                        addFriends(data1[ret.key][ret.index].user_id, data1[ret.key][ret.index].title, data1[ret.key][ret.index].img);
                    }
                    if (ret.clickType == 1) {
                        // 获取点击联系人信息
                        // 安卓全局索引
                        // ios+1
                        if (api.systemType == 'ios') {
                            var tel;
                            if (dataKeyArr.indexOf(ret.key)==-1) {
                                // 查找不到
                                if (data1[dataKeyArr[0]][ret.index].remark_current_contact) {
                                        tel = data1[dataKeyArr[0]][ret.index].remark_current_contact
                                } else if (data1[dataKeyArr[0]][ret.index].current_contact){
                                        tel = data1[dataKeyArr[0]][ret.index].current_contact
                                }
                            } else {

                                if (data1[dataKeyArr[dataKeyArr.indexOf(ret.key)+1]][ret.index].current_contact) {
                                        tel = data1[dataKeyArr[dataKeyArr.indexOf(ret.key)+1]][ret.index].current_contact
                                } else if (data1[dataKeyArr[dataKeyArr.indexOf(ret.key)+1]][ret.index].current_contact) {
                                        tel = data1[dataKeyArr[dataKeyArr.indexOf(ret.key)+1]][ret.index].current_contact
                                }
                            }
                            if (tel) {
                                api.call({
                                    type: 'tel_prompt',
                                    number: tel
                                });
                            } else {
                                alert('您没有对方的手机号码')
                            }
                        } else {
                            if (dataArr[ret.index].current_contact) {
                                api.call({
                                    type: 'tel_prompt',
                                    number: dataArr[ret.index].current_contact
                                });
                            } else {
                                alert('您没有对方的手机号码')
                            }

                        }
                    }
                } else {
                    // alert(JSON.stringify(err.msg));
                }
            });

        $api.css($api.dom('.loading'), 'display: none');
    }
    // 打开人脉详情
    function addFriends(userId,name,headImg) {
        api.openWin({
            name: 'txl_memberInfo_Win',
            url: './addressList/txl_memberInfo_Win.html',
            pageParam: {
                userId: userId,
                name: name,
                headImg: headImg
            }
        });
    }
    function f_check_uppercase(obj)   {
       if (/[A-Z]/.test(obj))    {
          return true;
       }
       return false;
    }
    // 查询数据库
    function query() {
        var SQLName = 'db_'+$api.getStorage('userToken');
        // 查询数据库
        db.selectSql({
            name: SQLName,
            sql: 'SELECT * FROM addressList_simplify order by flag asc'
        }, function(ret, err) {
            // console.log('查询到的数据:' + JSON.stringify(ret))
            if (ret.status) {
                // setTimeout(function(){
                //     if (ret.data=='') {
                //         query();
                //     }
                // },1)
                //
                // console.log('frame1::::::'+JSON.stringify(ret))
                // if (ret.data.length === 0) {
                //     // console.log('暂无数据')
                //     query();
                // } else {
                    // console.log('有数据')
                    // dakai(paixv(ret.data))
                    setTimeout(function () {
                        sortData(ret.data);
                    },1)
                // }
            } else {
                // console.log(JSON.stringify(err));
            }
        });
    }
    function paixv (data) {
        // for (var i = 0; i < data.length; i++) {
        //     for (var j = 0; j < data.length; j++) {
        //         if (data[i].litter < data[j].litter) {
        //             var temp = data[i];
        //             data[i] = data[j];
        //             data[j] = temp;
        //         }
        //     }
        // }
        // 2 : 熟识好友 both_list
        // 3 : 尚未加入 unavailable_list
        // 1 : 相识好友 
            // path_direction: 1 我认识的 single_list1
            // 2 认识我的 single_list2
        // 4 : 初始好友 friend
        // 所有一度 list
        
        
        
        // console.log(JSON.stringify(data));
        
        if(api.systemType == 'ios') {
            list = data.length
            for (var i = 0; i < list; i++) {
                if (data[i].type == 2) {
                    both_list++;
                } else if (data[i].type == 3) {
                    unavailable_list++;
                } else if (data[i].type == 4) {
                    friend++;
                } else {
                    if (data[i].path_direction == 1) {
                        single_list1++;
                    } else {
                        single_list2++;
                    }
                }
                data[i].placeholderImg = "widget://image/icon_defaultHead.png";
                if (f_check_uppercase(data[0].flag)) {
                    data[0].initial = data[0].flag;
                } else {
                    data[0].initial = '#';
                }
                if (i>0) {
                    if (data[i].flag !== data[i-1].flag) {
                        if (f_check_uppercase(data[i].flag)) {
                            data[i].initial = data[i].flag;
                        } else {
                            data[i].initial = '#';
                        }
                    }
                }
            }
        } else {
            
             list = data.length
            for (var i = 0; i < list; i++) {
                if (data[i].type == 2) {
                    both_list++;
                } else if (data[i].type == 3) {
                    unavailable_list++;
                } else if (data[i].type == 4) {
                    
                    friend++;
                } else {
                    if (data[i].path_direction == 1) {
                        single_list1++;
                    } else {
                        single_list2++;
                    }
                }
                    // data[i].placeholderImg = "widget://image/icon_defaultHead.png";
                if (f_check_uppercase(data[0].flag)) {
                    data[0].initial = data[0].flag;
                } else {
                    data[0].initial = '#';
                }
                if (i>0) {
                    if (data[i].flag !== data[i-1].flag) {
                        if (f_check_uppercase(data[i].flag)) {
                            data[i].initial = data[i].flag;
                        } else {
                            data[i].initial = '#';
                        }
                    }
                }
            }
        }
        var arr = {}
        var a;
        // delete data.subTitle;

        for (var i = 0; i < data.length; i++) {
            delete data[i].flag;
            delete data[i].type;
            // data[i].subTitle = (data[i].current_company || ""+ data[i].current_position || ""+data[i].current_degree||"") ? (data[i].current_company || ""+" "+ data[i].current_position || ""+" "+data[i].current_degree||"") : ""
            data[i].subTitleColor = '#999'
            data[i].titleSize = 15;

            if (data[i].initial) {
                if (data[i].initial == '#') {
                    if (arr[data[i].initial]) {
                    } else {
                        arr[data[i].initial] = [];
                    }
                    a = i;
                } else {
                    arr[data[i].initial] = [];
                    a = i;
                }
            }

            arr[data[a].initial].push (data[i])
        }
        dataArr = arr;
        $api.text($api.byId('both_list'), both_list);
        $api.text($api.byId('unavailable_list'), unavailable_list);
        $api.text($api.byId('single_list1'), single_list1);
        $api.text($api.byId('single_list2'), single_list2);
        $api.text($api.byId('friend'), friend);
        $api.text($api.byId('list'), list- friend);
        // console.log(JSON.stringify(arr));
        
        return arr;
    }
    // 打开遮罩层
    function shadowPage() {
        api.openFrame({
            name: 'txl_guidance',
            url: './addressList/txl_guidance.html',
            bounces: false,
            rect: {
                x: 0,
                y: 0,
                w: api.winWidth,
                h: api.winHeight
            }
        });
    }
    function openNewFri() {
         api.openWin({
            name: 'txl_addFellow_win',
            url: './addressList/txl_addFellow_win.html',
            bounces: false
        });
    }
    </script>
</body>

</html>
