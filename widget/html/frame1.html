<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>我在</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <style>
        html,body {
            /*height: 16rem;*/
            background-color: #fff;
            /* padding-bottom: 250px; */
            /* font-size: 50px; */
        }
        /*.search {
            border-radius: .04rem;
            display: block;
            height: .5rem;
            line-height: .5rem;
            background-color: #fff;
            margin: 0 .15rem;
            text-align: center;
            font-size: 0.24rem;
            color: #96969B;
        }
        .search .searchIcon {
            margin-right: .1rem;
            display: inline-block;
            width: .26rem;
            height: .5rem;
            background: url(../image/icon_supply/icon_search.png)no-repeat;
            -webkit-background-size: .25rem .26rem;
            background-size: .25rem .26rem;
            background-position: 0 center;
            vertical-align: top;
        }
        .search .searchText {
            font-size: .24rem;
        }*/

        .news {
            display: flex;
            flex-flow: column nowrap;
        }

        ul {
            width: 100%;
            box-sizing: border-box;
        }

        ul li {
            width: 100%;
            height: 1.2rem;
            box-sizing: border-box;
            padding: .15rem .3rem;
            /*padding: .15rem 0;*/
            border-bottom: .01rem solid #D6D6D6;
            position: relative;
        }

        ul li img {
            width: .9rem;
            height: .9rem;
            margin-right: .2rem;
        }

        ul li h3 {
            margin-top: .1rem;
            margin-bottom: .05rem;
            width: 3.5rem;
            float: left;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        ul li.select:before {
            content: "";
            display: inline-block;
            width: .15rem;
            height: .15rem;
            background-color: #f00;
            border-radius: 50%;
            position: absolute;
            top: .1rem;
            left: .8rem;
        }

        ul li p {
            color: #9B9B9B;
            word-wrap: break-word;
            white-space: nowrap;
            text-overflow: ellipsis;
            height: .32rem;
            width:3.5rem;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .main_no1,
        .main_no2 {
            font-size: .29rem;
            line-height: 1rem;
            padding-left: .16rem;
            background-color: #fff;

        }

        .main_no1 {
           background-color: #fff;
        }

        .wrap {
            /*padding: .rem 0;*/
            padding: 0 .12rem;

        }
        .main_no2 .mainP {
             /*border-bottom: .01rem solid #d9d9d9;*/
             padding-left: .84rem;
             background: #fff url(../image/iocn_addressList/icon_chu.png)no-repeat;
             -webkit-background-size: .62rem .62rem;
             background-size: .62rem .62rem;
             background-position: 0 .2rem;
             /*margin-bottom: -.005rem;*/
             /*box-sizing: border-box;*/
         }
          .main_no2 .bb {
               border-bottom: .01rem solid #d9d9d9;
               background: #fff url(../image/icon_txl/icon-hyqq.png)no-repeat;
             -webkit-background-size: .62rem .62rem;
             background-size: .62rem .62rem;
             background-position: 0 .2rem;
          }
         .main_no2 .friendsCircle {
             border-bottom: .01rem solid #d9d9d9;
             padding-left: .84rem;
             background: #fff url(../image/iocn_addressList/icon_friendsCircle.png)no-repeat;
             -webkit-background-size: .62rem .62rem;
             background-size: .62rem .62rem;
             background-position: 0 .2rem;
             /*margin-bottom: -.005rem;*/
             /*box-sizing: border-box;*/
         }
         .main_no1 p{
             /*box-sizing: border-box;*/
             height: 1rem;
             line-height: 1rem;
             font-size: .29rem;
             border-bottom: .01rem solid #d9d9d9;
         }
         .main_no1 .icon {
             background: #fff url(../image/iocn_addressList/icon_yi.png)no-repeat;
             -webkit-background-size: .62rem .62rem;
             background-size: .62rem .62rem;
             /*background-position: 0 .2rem;*/
             box-sizing: border-box;
             /*padding-left: .9rem;*/
             width: .62rem;
             height: .62rem;
             float: left;
             display: inline-block;
             margin-right: .2rem;
             /*border-bottom: .01rem solid #d9d9d9;*/
         }
          .main_no1 .san {
              background: #fff url(../image/iocn_addressList/icon_san.png)no-repeat;
             -webkit-background-size: .62rem .62rem;
             background-size: .62rem .62rem;
         }.main_no1 .er {
              background: #fff url(../image/iocn_addressList/icon_2.png)no-repeat;
             -webkit-background-size: .62rem .62rem;
             background-size: .62rem .62rem;
         }
         .itemList1 {
             padding-left: .9rem;
             background: url(../image/iocn_addressList/icon_1icon.png)no-repeat;
             -webkit-background-size: .4rem .13rem;
             background-size: .4rem .13rem;
             background-position: .37rem center;
         }
         .itemList2 {
             padding-left: .9rem;
             background: url(../image/iocn_addressList/icon_acquaintance.png)no-repeat;
             -webkit-background-size: .4rem .08rem;
             background-size: .4rem .08rem;
             background-position: .37rem center;
         }
         .itemList5 {
            padding-left: .9rem;
             background: url(../image/iocn_addressList/icon_acquaintance2.png)no-repeat;
             -webkit-background-size: .4rem .08rem;
             background-size: .4rem .08rem;
             background-position: .37rem center;
         }
         .itemList33 {
             padding-left: .9rem;
             background: url(../image/iocn_addressList/er.png)no-repeat;
             -webkit-background-size: .4rem .23rem;
             background-size: .4rem .23rem;
             background-position: .37rem center;
         }.itemList3 {
             padding-left: .9rem;
             background: url(../image/iocn_addressList/san.png)no-repeat;
             -webkit-background-size: .4rem .23rem;
             background-size: .4rem .23rem;
             background-position: .37rem center;
         }
         .yishang {
            background: url(../image/iocn_addressList/yidushang.png)no-repeat;
             -webkit-background-size: .4rem .28rem;
             background-size: .4rem .28rem;
             background-position: .37rem center;
         }
         .itemList4 {
             padding-left: .9rem;
             background: url(../image/iocn_addressList/icon_4icon.png)no-repeat;
             -webkit-background-size: .43rem .4rem;
             background-size: .43rem .4rem;
             background-position: .37rem center;
         }
         .main_no3 {
             line-height: 1rem;
             box-sizing: border-box;
             background-color: #fff;
             height: 1rem;
             padding: 0 .18rem;
             font-size: 0;
         }
         .main_no3 .icon {
             display: inline-block;
             width: .62rem;
             height: .62rem;
             text-align: center;
             line-height: .7rem;
             background: url(../image/iocn_addressList/icon_wen.png)no-repeat;
             -webkit-background-size: .62rem .62rem;
             background-size: .62rem .62rem;
             font-size: .45rem;
             color: #fff;
         }
         .main_no3 .text {
             margin-left: .26rem;
             line-height: 1rem;
             font-size: .29rem;
         }
        /* .itemList {
            display: none;
         }*/
         .itemList .bb0 {
             border-bottom: 0;
         }
         .hide {
             display: none;
        }
        .wrap {
            background-color: #EDECF3;
        }
        .search {
            width: 7.26rem;
            box-sizing: border-box;
            height: .5rem;
            line-height: .5rem;
            background-color: #fff;
            margin: .15rem 0;
            text-align: center;
            font-size: 0;
        }
        .search .searchIcon {
            display: inline-block;
            width: .26rem;
            height: .5rem;
            background: url(../image/icon_supply/icon_search.png)no-repeat;
            -webkit-background-size: .25rem .26rem;
            background-size: .25rem .26rem;
            background-position: 0 center;
            vertical-align: top;
            margin-right: .05rem;
        }
        .search .searchText {
            color: #999;
            font-size: .24rem;
        }


        .list {
            background-color: #fff;
        }
        .list .item {
            font-size: 0;
            height: 1.1rem;
            box-sizing: border-box;
            padding: 0 .16rem 0 .16rem;
            overflow: hidden;
            border-bottom: .01rem solid #d9d9d9;


        }
        .list .item img {
            margin-right: .1rem;
            width: .62rem;
            height: .62rem;
        }
        .list .item .title {
            width: 5rem;
        }
        .list .item .title .name {
            font-size: .29rem;
            font-weight: 400;
            white-space:nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .list .item .title .position {
            display: inline-block;
            font-size: .24rem;
            max-width: 1.8rem;
            white-space:nowrap;
            color: #999;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .sel {
            display: inline-block;
            width: .44rem;
            height: .44rem;
            background: url(../image/icon_member/icon_cz01.png)no-repeat;
            -webkit-background-size: .44rem .44rem;
            background-size: .44rem .44rem;
            background-position: 0 center;
        }
        .pitchOn {
            background: url(../image/icon_member/icon_cz02.png)no-repeat;
            -webkit-background-size: .44rem .44rem;
            background-size: .44rem .44rem;
            background-position: 0 center;
        }
        .slidePage {
            width: .6rem;
            text-align: right;
            /*background-color: rgba(255,0,0,.5);*/
            position: fixed;
            right: 0;
            top: 0;
            /* height: 100%; */
            font-size: .18rem;
            box-sizing: border-box;
            padding-right: .1rem;
        }
        .slidePage span{
           /* text-align: right;
            box-sizing: border-box;
            display: block;
            padding-right: .1rem;*/
            width: .2rem;
            font-weight: 550;
            margin: .02rem 0;
            text-align: center;
            color: #555;
        }
        .slidePage div {
            width: .2rem;
        }
        .groupTitle {
            font-size: .24rem;
            padding: .08rem .16rem;
            background-color: #F0F0F6;
        }
        .letter {
            position: fixed;
            top: 0;bottom: 0;
            right: 0;left: 0;
            margin: auto;
            border-radius: 50%;
            width: .8rem;
            height: .8rem;
            line-height: .8rem;
            text-align: center;
            font-size: .3rem;
            background-color: rgba(0,0,0,.3);
            display: none;
            /*opacity: 0;*/
        }
        .contactCount {
            text-align: center;
            color: #999;
            font-size: .34rem;
            line-height: 1.1rem
        }
        .mb16 {
            height: .15rem;
            background-color: #EDECF3;
        }
        .no_data {
            background-color: #fff;
            display: none;
        }

    </style>
</head>
<body>

    <div class="loading"></div>
    <div id="news_wrap" class=" clearfix">
       <div class="wrap flex-def flex-cCenter flex-zCenter">
            <div class="search flex-def flex-cCenter flex-zCenter"   tapmode   onclick="openS()">
                <span class="searchIcon"></span>
                <span class="searchText">搜索</span>
            </div>
       </div>
        <!-- <div class="main_no2"   tapmode   onclick="onceConnected(1,4)">
            <div class="friendsCircle">
                熟识圈
            </div>
        </div> -->
        <div class="main_no2" tapmode onclick="openNewFri()">
            <div class="mainP bb">
                新的朋友
            </div>
        </div>
         <div class="main_no2"   tapmode   onclick="onceConnected(1,4)">
            <div class="mainP">
                初识好友
            </div>
        </div>
        <div class="mb16"></div>
        <div class="main_no1"  >
            <p class="mainP flex-def flex-cCenter" >
                <span class="icon" tapmode onclick="hideList(this,1)"></span>
                <span class="flex-item" tapmode onclick="onceConnected(1)">一度人脉</span>
            </p>
            <div class="itemList hide itemList_one itemList4"  tapmode   onclick="onceConnected(4)">
                <p>熟识圈</p>
            </div>
            <div class="itemList hide itemList_one itemList1"  tapmode   onclick="onceConnected(1,2)">
                <p>熟识好友</p>
            </div>
            <div class="itemList hide itemList_one itemList2"  tapmode   onclick="onceConnected(1,1,'my')">
                <p>相识好友</p>
                <!-- <p>相识好友1我认识</p> -->
            </div>
            <div class="itemList hide itemList_one itemList5" tapmode onclick="onceConnected(1,1,'he')">
                <p>相识好友</p>
            </div>
            <div class="itemList hide itemList_one itemList3 yishang"  tapmode   onclick="onceConnected(1,3)">
                <p class="">尚未加入</p>
            </div>
        </div>


        <div class="main_no1"   >
            <p class="mainP flex-def flex-cCenter" >
                <span class="icon er" tapmode onclick="hideList(this,2)"></span>
                <span tapmode   onclick="onceConnected(2)" class="flex-item">二度人脉</span>
            </p>
            <div class="itemList hide itemList_two itemList33" tapmode   onclick="onceConnected(2,1)">
                <p>二度好友</p>
                 </div>
            <div class="itemList hide itemList_two itemList33" tapmode   onclick="onceConnected(2,2)">
                <p class="">尚未加入</p>

            </div>
        </div>
        <div class="main_no1 mt36r "   >
            <p class="mainP flex-def flex-cCenter" >
                <span class="icon san" tapmode onclick="hideList(this,3)"></span>
                <span class="flex-item" tapmode  onclick="onceConnected(3)">三度人脉</span>
            </p>
            <div class="itemList hide itemList_three itemList3" tapmode   onclick="onceConnected(3,1)">
                <p>三度好友</p>
            </div>
            <div class="itemList hide itemList_three itemList3" tapmode   onclick="onceConnected(3,2)">
                <p class="">尚未加入</p>
            </div>
        </div>

        <div class="main_no3 flex-def flex-cCenter" tapmode onclick="openSchemaPage(1)">
            <span class="icon"></span>
            <span class="text">人脉等级相关说明</span>
        </div>
         <!-- <div class="main_no3 flex-def flex-cCenter" tapmode onclick="openSchemaPage(0)">
            <span class="icon"></span>
            <span class="text">通讯录测试</span>
        </div> -->
        <!-- <div class="main_no3 flex-def flex-cCenter" tapmode onclick="function_name(6)">
            <span class="icon"></span>
            <span class="text">通讯录测22试</span>
        </div> -->
    </div>
    <p class="no_data">未获取通讯录权限<br>请获取通讯录权限后在设置里更新通讯录</p>
   <!--  <div class="main">
        <div class=" list resultList"></div>
        <script type="text/x-dot-template" id="listT">
        {{ for (var i = 0; i < it.length; i++) { }}
            {{?it[i].flagLetter}}
                <p id="{{=it[i].flagLetter}}" class="groupTitle">{{=it[i].flagLetter}}</p>
            {{? }}
            <div class="item flex-def flex-cCenter"  data-id="{{=it[i].user_id}}" tapmode   onclick="selPerson(this)" data-val='no1'>
                <img src="{{=it[i].head_img_url}}">
                <div class="title">
                    <h3 class="name">{{=it[i].title}}</h3>

                    {{?it[i].current_company}}
                    <p class="position">{{=it[i].current_company}}&nbsp;</p>
                    {{??}}
                    {{?}}

                    {{?it[i].current_position}}
                    <p class="position">{{=it[i].current_position}}&nbsp;</p>
                    {{??}}
                    {{?}}

                    {{?it[i].current_degree}}
                    <p class="position">{{=it[i].current_degree}}</p>
                    {{??}}
                    {{?}}
                </div>
            </div>
        {{ }; }}
        <p class="contactCount">{{=it.length}}位联系人</p>
        </script>
    </div> -->
    <div class="slidePage flex-def flex-zTopBottom flex-zCenter flex-cEnd" ontouchmove="move()">
        <div ></div>
    </div>
    <div class="letter"></div>
    <!-- <p class="contactCount">位联系人</p> -->
    <script type="text/javascript" src="../script/common.js"></script>
    <script type="text/javascript" src="../script/jquery.min.js"></script>
    <script type="text/javascript" src="../script/api.js"></script>
    <script type="text/javascript" src="../script/doT.min.js"></script>
    <script type="text/javascript" src="../script/pinyin4js.js"></script>
    <script type="text/javascript">
    var letterArr = [],letterObj = [];
    
    apiready = function() {
        // console.log(api.winHeight)
        $api.css($api.dom('.slidePage'),'height:60px')
        if (api.systemType == 'andioid') {
            // $api.css($api.dom('html'), 'padding-bottom: 1rem');
        }

        moduleInit();
        initPage();
        api.addEventListener({
            name: 'editUserInfoUpdateList'
        }, function(ret, err) {
            if (ret) {
                console.log('监听到书剑')
                initPage();
            } else {
                alert(JSON.stringify(err));
            }
        });
        if (!$api.getStorage('guidancePage')) {
            shadowPage();
        }
    }
    // doT模版获取数据
    function getData(data, htmlStr) {
            $api.html($api.dom('.slidePage div'), $api.getStorage('frame1SlideBar'));
            var list = $api.dom('.resultList');
            var listTText = $api.byId('listT').text;
            var fnListT = doT.template(listTText);
            var html = fnListT(data);
            $api.html(list, html);
            $api.css($api.dom('.loading'), 'display:none');
    }
    function createFile() {
        fs.exist({
            path: 'widget://html/frame1.html'
        }, function(ret, err) {
            if (ret.exist) {
                    //console.log(JSON.stringify(ret))
                    // 存在打开
                    openFile();
            } else {
                // 不纯在新建
                createFile_1();
            }
        });
    }
    function createFile_1() {
        fs.createFile({
            path: 'widget://html/frame1.html'
        }, function(ret, err) {
            if (ret.status) {
                //console.log('518:::'+JSON.stringify(ret));
                openFile();
            } else {
                //console.log('541:::'+JSON.stringify(err));
            }
        });
    }
    function openFile() {
         fs.open({
                path: 'widget://html/frame1.html',
                flags: 'read_write'
            }, function(ret, err) {
                if (ret.status) {
                    var htmlStr = $api.html($api.dom('html'));
                    htmlStr = htmlStr.replace('initPage();','')
                    fs.write({
                        fd: ret.fd,
                        data: '<html>'+ htmlStr +'</html>',
                    }, function(ret, err){
                        if( ret.status ){
                            //console.log('531:::'+ JSON.stringify( ret ) );
                        }else{
                            //console.log('533:::'+ JSON.stringify( err ) );
                        }
                    });
                } else {
                    //console.log('537:::'+JSON.stringify(err));
                }
            });
    }
    function initPage() {
        if ($api.getStorage('noAccessToContacts') == 'true') {
            // 未获取通讯录权限
            $api.css($api.dom('.loading'), 'display: none');
            $api.css($api.dom('.no_data'), 'display: block');
        } else {
            db.selectSql({
                name: 'db_'+$api.getStorage('userToken'),
                sql: 'SELECT * FROM addressList_simplify WHERE type IN (1,2,3,4) order by flag asc',
            }, function(ret, err){
                if( ret.status ){

                    if (ret.data.length != 0) {
                        dakai(paixv(ret.data));
                    } else {
                        // query();
                    }
                }else{
                    alert('292'+ JSON.stringify( err ) );
                }
            });
        }
    }
    function move() {
        event.preventDefault();
        //  获取开始点击的位置
        //  每滑动一个a标签的高度切换一个锚点
        anchorJump(document.elementFromPoint(event.changedTouches[0].clientX,event.changedTouches[0].clientY))
    }
    function anchorJump(n) {
        event.stopPropagation();
        event.preventDefault();
        var text = $api.text(n);
        if (text.length < 2) {
            // $api.css($api.dom('.letter'), 'display: block');
            // $api.css($api.dom('.letter'), 'opacity: 1');
            // $api.text($api.dom('.letter'), text);
            // location.hash = '#' + text;
            $("html,body").animate({scrollTop:$("#"+text).offset().top}, 1);
            return false;
            // setTimeout(function () {
            //     $api.css($api.dom('.letter'), 'display: none');
            // },1500)

        }
    }
    function anchorJump1(n) {
        // location.hash = '#' + n
        $("#"+n).animate({scrollTop:$("#"+n).offset().top}, 500);
    }
    // 数据排序
    function sortData(data) {
        // for (var i = 0; i < data.length; i++) {
        //     for (var j = 0; j < data.length; j++) {
        //         if (data[i].flag < data[j].flag) {
        //             var temp = data[i];
        //             data[i] = data[j];
        //             data[j] = temp;
        //         }
        //     }
        //  }
        for (var i = 0; i < data.length; i++) {
            if (i>0) {
                if (data[i].flag !== data[i-1].flag) {
                    if (f_check_uppercase(data[i].flag)) {
                        data[i].flagLetter = data[i].flag;
                        letterArr.push(data[i].flag)
                    } else {
                        // data[i].flagLetter = '#';
                        // letterArr.push('#')
                    }
                }
            } else {
                if (f_check_uppercase(data[0].flag)) {
                    letterArr.push(data[0].flag);
                    data[0].flagLetter = data[0].flag
                 } else {
                    letterArr.push('#')
                    data[0].flagLetter = '#'
                 }
            }
         }
         // 侧边栏
         var str = '' ;
         for (var i = 0; i < letterArr.length; i++) {
            str += '<span ontouchstart="anchorJump(this)"  >'+ letterArr[i] +'</span>'
         }
            $api.setStorage('frame1SlideBar', str);
            // getData(data)
            // dakai(data)
            //console.log('703:::'+data.length)
    }
    function insertOneSql(type,str) {
        str = $api.jsonToStr(str);
        db.executeSql({
            name: SQLName,
            sql: "INSERT OR REPLACE INTO addressList_one (type, str) VALUES ("+ type +",'"+ str +"')"
        }, function(ret, err){
            if( ret.status ){
                //console.log('缓存成功')
            }else{
                // alert('756:'+ JSON.stringify( err ) );
            }
        });
    }
    // 选中好友
    function selPerson(ele) {
        // var sel = ele.getElementsByClassName('sel')[0];
        // if ($api.hasCls(sel, 'pitchOn')) {
        //     $api.removeCls(sel, 'pitchOn');
        // } else {
        //     $api.addCls(sel, 'pitchOn');
        // }
        var userId = $api.attr(ele, 'data-id');
        api.openWin({
            name: 'txl_memberInfo_Win',
            url: './addressList/txl_memberInfo_Win.html',
            pageParam: {
                userId: userId
            }
        });
    }
    // 隐藏列表
    function hideList(ele,n) {
        $api.css($api.dom('.loading'), 'display:block');
        var name;
        if (n == 1) {
            name = '.itemList_one';
        } else if (n == 2) {
            name = '.itemList_two';
        } else {
            name = '.itemList_three';
        }
        var list = $api.domAll(name);
        var main_no1 = $api.domAll('.main_no1');
        for (var i = 0; i < list.length; i++) {
            if ($api.hasCls(list[i], 'hide')) {
                $api.removeCls(list[i], 'hide');
            } else {

                $api.addCls(list[i], 'hide');
            }
        }
        // var listH = $api.offset($api.byId('news_wrap')).h;
        // $api.css($api.dom('html'), 'height:' + (listH+550)/50 + 'rem');
        // $api.css($api.dom('body'), 'height:' + (listH+550)/50 + 'rem');
        initPage();
        // query();
    }
    // 打开人脉关系图
    function openSchemaPage(n) {
        if (n) {
            api.openWin({
                name: 'txl_relationSchema_win',
                url: './addressList/txl_relationSchema_win.html',
                // url: './addressList/relation/index_win.html',
                pageParam: {
                    name: 'value'
                }
            });
        }  else {
            api.openWin({
                name: 'aaaaaa',
                url: './addressList/aaaaaa.html',
                pageParam: {
                    name: 'value'
                }
            });
        }
    }
    function function_name() {
            api.openWin({
                name: 'txl_relationSchema_win',
                url: './frame1.html',
                pageParam: {
                    name: 'value'
                }
            });
    }
    function openS() {
        // 搜索本地页面

        // api.openWin({
        //     name: 'txl_fellowSearch',
        //     url: './addressList/txl_fellowSearch.html',
        //     pageParam: {
        //         userToken: api.pageParam.userToken,
        //         rongToken: api.pageParam.rongToken
        //     }
        // });

        // 搜索全部
        api.openWin({
            name: 'search_main_win',
            url: './search/search_main_win.html',
            bounces: false
        });
    }
    // 打开一度人脉
    function onceConnected(n,flag, str) {
        var url;
        if (n == 1) {
            // if (flag == 1) {
            //     url = "txl_listWin_danxiang"
            // } else if (flag == 2) {
            //     url = "txl_listWin_shuangxiang"
            // } else if (flag == 3) {
            //     url = "txl_listWin_you"
            // } else if (flag == 4) {
            //     url = "txl_listWin_chushi"
            // } else {
            //     url = 'txl_listWin'
            // }
                url = 'txl_listWin'
        } else if (n == 2) {
            url = 'txl_listWin_2'
        } else if (n == 3){
            url = 'txl_listWin_3'
        } else if (n == 4){
            url = 'txl_listWin_4'
        }
        api.openWin({
            name: 'listWin_' + url,
            url: './addressList/'+ url +'.html',
            pageParam: {
                userToken: api.pageParam.userToken,
                headerH: headerH,
                flag: flag,
                // 区分相识好友方向的字段
                path_direction: str
            },
            slidBackEnabled: false,
            bounces: false
        });
    }
    // 打开初始好友
    function contactFriend () {
        api.openWin({
            name: 'txl_contactFriend_win',
            url: './addressList/txl_contactFriend_win.html',
            bounces: false,
            pageParam: {
                headerH: headerH
            }
       });
    }

    function dakai(data1) {
        // console.log(JSON.stringify(data1))
        console.log(api.winHeight)
        // 华为  604    604 * 0.7 / 75
        // 小米  640    640 * 0.7 / 95
        // var listContactHeight = 455;
        var listContactHeight = api.winHeight * 0.7;
        var divisor;
        var winH = api.winHeight;
        
        if (api.systemType=='ios') {
            // listContactHeight = 505;
            console.log(listContactHeight)
            $api.css($api.dom('html'), 'padding-bottom:' + (listContactHeight / 100) + 'rem');
            $api.css($api.dom('body'), 'padding-bottom:' + (listContactHeight / 100) + 'rem');
        } else {
            if (winH==640) {
                divisor = 85;
            } else if (winH == 604) {
                divisor = 75
            }
            console.log(listContactHeight)
            $api.css($api.dom('html'), 'padding-bottom:' + (listContactHeight / divisor) + 'rem');
            $api.css($api.dom('body'), 'padding-bottom:' + (listContactHeight / divisor) + 'rem');
        }
        
        
        var dataArr = [];
        var dataKeyArr = [];
        for(key in data1) {
            // console.log(data1[key])
            dataArr = dataArr.concat(data1[key]);
            dataKeyArr.push(key)
        }
        listContact.open({
            x: -1000,
            y: -1000,
            w: 5,
            h: 5,
            data: [],
            fixedOn: api.frameName
        },function(ret,err){
        })
        listContact.close();
        listContact.open({
                x : 0,
                y : $api.offset($api.byId('news_wrap')).h,
                w : api.frameWidth,
                h : listContactHeight,
                bgColor: '#EFEFF4',
                // 分割线颜色
                borderColor: '#EDEDED',
                // rightBtn: [{
                //     color: '#000',
                //     title: '备注'
                // },{
                //     color: '#000',
                //     title: '删除'
                // }],
                rightBtn: [{
                    color: '#20AC19',
                    title: '呼叫'
                }],
                imgHeight: 32,
                imgWidth: 32,
                groupTitle: {
                    color: '#999',
                    size: 14,
                    bgColor: '#EFEFF4'
                },
                cellHeight: 50,
                rightBg: '#fff',
                // 侧滑
                indicator: {
                    bgColor: 'rgba(0,0,0,0)',
                    color: '#5A5A5A'
                },
                cellBgColor: '#fff',
                data: data1,
                fixedOn: 'frame1',
                fixed: false
            }, function(ret, err) {
                if (ret) {
                     if (ret.clickType == 0) {
                        // 获取点击联系人信息
                        addFriends(data1[ret.key][ret.index].user_id, data1[ret.key][ret.index].title, data1[ret.key][ret.index].img);
                    }
                    if (ret.clickType == 1) {
                        // 获取点击联系人信息
                        // 安卓全局索引
                        // ios+1
                        if (api.systemType == 'ios') {
                            var tel;
                            if (dataKeyArr.indexOf(ret.key)==-1) {
                                // 查找不到
                                if (data1[dataKeyArr[0]][ret.index].remark_current_contact) {
                                        tel = data1[dataKeyArr[0]][ret.index].remark_current_contact
                                } else if (data1[dataKeyArr[0]][ret.index].current_contact){
                                        tel = data1[dataKeyArr[0]][ret.index].current_contact
                                }
                            } else {

                                if (data1[dataKeyArr[dataKeyArr.indexOf(ret.key)+1]][ret.index].current_contact) {
                                        tel = data1[dataKeyArr[dataKeyArr.indexOf(ret.key)+1]][ret.index].current_contact
                                } else if (data1[dataKeyArr[dataKeyArr.indexOf(ret.key)+1]][ret.index].current_contact) {
                                        tel = data1[dataKeyArr[dataKeyArr.indexOf(ret.key)+1]][ret.index].current_contact
                                }
                            }
                            if (tel) {
                                api.call({
                                    type: 'tel_prompt',
                                    number: tel
                                });
                            } else {
                                alert('您没有对方的手机号码')
                            }
                        } else {
                            if (dataArr[ret.index].current_contact) {
                                api.call({
                                    type: 'tel_prompt',
                                    number: dataArr[ret.index].current_contact
                                });
                            } else {
                                alert('您没有对方的手机号码')
                            }

                        }
                    }
                } else {
                    // alert(JSON.stringify(err.msg));
                }
            });

        $api.css($api.dom('.loading'), 'display: none');
    }
    // 打开人脉详情
    function addFriends(userId,name,headImg) {
        api.openWin({
            name: 'txl_memberInfo_Win',
            url: './addressList/txl_memberInfo_Win.html',
            pageParam: {
                userId: userId,
                name: name,
                headImg: headImg
            }
        });
    }
    function f_check_uppercase(obj)   {
       if (/[A-Z]/.test(obj))    {
          return true;
       }
       return false;
    }
    // 查询数据库
    function query() {
        var SQLName = 'db_'+$api.getStorage('userToken');
        // 查询数据库
        db.selectSql({
            name: SQLName,
            sql: 'SELECT * FROM addressList_simplify order by flag asc'
        }, function(ret, err) {
            // console.log('查询到的数据:' + JSON.stringify(ret))
            if (ret.status) {
                // setTimeout(function(){
                //     if (ret.data=='') {
                //         query();
                //     }
                // },1)
                //
                // console.log('frame1::::::'+JSON.stringify(ret))
                // if (ret.data.length === 0) {
                //     // console.log('暂无数据')
                //     query();
                // } else {
                    // console.log('有数据')
                    // dakai(paixv(ret.data))
                    setTimeout(function () {
                        sortData(ret.data);
                    },1)
                // }
            } else {
                // console.log(JSON.stringify(err));
            }
        });
    }
    function paixv (data) {
        // for (var i = 0; i < data.length; i++) {
        //     for (var j = 0; j < data.length; j++) {
        //         if (data[i].litter < data[j].litter) {
        //             var temp = data[i];
        //             data[i] = data[j];
        //             data[j] = temp;
        //         }
        //     }
        // }
        if(api.systemType == 'ios') {
            for (var i = 0; i < data.length; i++) {
                    data[i].placeholderImg = "widget://image/icon_defaultHead.png";
                if (f_check_uppercase(data[0].flag)) {
                    data[0].initial = data[0].flag;
                } else {
                    data[0].initial = '#';
                }
                if (i>0) {
                    if (data[i].flag !== data[i-1].flag) {
                        if (f_check_uppercase(data[i].flag)) {
                            data[i].initial = data[i].flag;
                        } else {
                            data[i].initial = '#';
                        }
                    }
                }
            }
        } else {
            for (var i = 0; i < data.length; i++) {
                    // data[i].placeholderImg = "widget://image/icon_defaultHead.png";
                if (f_check_uppercase(data[0].flag)) {
                    data[0].initial = data[0].flag;
                } else {
                    data[0].initial = '#';
                }
                if (i>0) {
                    if (data[i].flag !== data[i-1].flag) {
                        if (f_check_uppercase(data[i].flag)) {
                            data[i].initial = data[i].flag;
                        } else {
                            data[i].initial = '#';
                        }
                    }
                }
            }
        }
        var arr = {}
        var a;
        // delete data.subTitle;

        for (var i = 0; i < data.length; i++) {
            delete data[i].flag;
            delete data[i].type;
            // data[i].subTitle = (data[i].current_company || ""+ data[i].current_position || ""+data[i].current_degree||"") ? (data[i].current_company || ""+" "+ data[i].current_position || ""+" "+data[i].current_degree||"") : ""
            data[i].subTitleColor = '#999'
            data[i].titleSize = 15;

            if (data[i].initial) {
                if (data[i].initial == '#') {
                    if (arr[data[i].initial]) {
                    } else {
                        arr[data[i].initial] = [];
                    }
                    a = i;
                } else {
                    arr[data[i].initial] = [];
                    a = i;
                }
            }

            arr[data[a].initial].push (data[i])
        }
        return arr;
    }
    // 打开遮罩层
    function shadowPage() {
        api.openFrame({
            name: 'txl_guidance',
            url: './addressList/txl_guidance.html',
            bounces: false,
            rect: {
                x: 0,
                y: 0,
                w: api.winWidth,
                h: api.winHeight
            }
        });
    }
    function openNewFri() {
         api.openWin({
            name: 'txl_addFellow_win',
            url: './addressList/txl_addFellow_win.html',
            bounces: false
        });
    }
    </script>
</body>

</html>
