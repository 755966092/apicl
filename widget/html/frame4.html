<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>我</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <style>
        .empty{ text-align: center; padding: 120px 0; }
        body,html {
            background-color: #EFEFF4;
        }
        .main {
            margin-top: .29rem;     
        }
        .userInfo {
            height: 1.6rem;
            display: -webkit-box; 
            display: flex; 
            -webkit-box-align:  center;
            align-items: center;
            margin-bottom: .37rem;  
        }
        .userInfo .headImg {
            width: 1.15rem;
            height: 1.15rem;
            border-radius: .08rem
        }
        ul li {
            height: .8rem;
            border-bottom: 1px solid #E4E4E4;
            padding: 0 .3rem;
            width: 100%;        
            box-sizing: border-box;
            position: relative; 
            background-color: #fff;
            font-size: .3rem;   
            color: #333;
        }
         ul li:not(.userInfo) span {
            position: relative; 
         }
        ul li:not(.userInfo) span.select:before {
             content: "";
            display: inline-block;
            width: .1rem;
            height: .1rem;
            background-color: #f00;
            border-radius: .2rem;
            position: absolute;
            top: .2rem;
            right: 0;
        }
        ul li:not(.userInfo) {
            line-height: .8rem;
            padding-left:  1.1rem;  
            background: #fff url(../image/icon_my/icon_fb.png)no-repeat;
            -webkit-background-size: .42rem .26rem;
            background-size: .42rem .26rem;
             background-position: .3rem center;  
        }
        ul li:nth-child(2) {
            background: #fff url(../image/icon_my/icon_hy.png)no-repeat;
            background-size: .42rem .38rem;
            background-position: .3rem center;  
        }
        ul li:nth-child(3) {
            background: #fff url(../image/icon_my/icon_tg.png)no-repeat;
            background-size: .42rem .41rem;
            background-position: .3rem center;  
        }
        ul li:nth-child(4) {
            background: #fff url(../image/icon_my/icon_gs.png)no-repeat;
            background-size: .42rem .42rem;
            background-position: .3rem center;  
        }
        ul li:nth-child(5) {
            background: #fff url(../image/icon_my/icon_gdd.png)no-repeat;
            background-size: .42rem .41rem;
            background-position: .3rem center;  
        }
        ul li:nth-child(6) {
            background: #fff url(../image/icon_my/icon_qdd.png)no-repeat;
            background-size: .42rem .31rem;
            background-position: .3rem center;  
        }
        /*ul li:nth-child(7) {
            background: #fff url(../image/icon_my/icon_fb.png)no-repeat;
            background-size: .42rem .31rem;
            background-position: .3rem center;  
        }*/
        ul li:nth-child(8) {
            background: #fff url(../image/icon_my/icon_wdq.png)no-repeat;
            background-size: .42rem .42rem;
            background-position: .3rem center;  
        }
        ul li:nth-child(9) {
            background: #fff url(../image/icon_my/icon_sc.png)no-repeat;
            background-size: .42rem .37rem;
            background-position: .3rem center;  
        }
        ul li:nth-child(10) {
            background: #fff url(../image/icon_my/icon_gz.png)no-repeat;
            background-size: .42rem .46rem;
            background-position: .3rem center;  
        }
        ul li:nth-child(11) {
            background: #fff url(../image/icon_my/icon_sz.png)no-repeat;
            background-size: .42rem .46rem;
            background-position: .3rem center;  
        }
        .userInfo span:last-child {
            height: 1.6rem;  
           float: right;
           position: absolute;  
           right: .3rem;        
        }
        ul li span:last-child {
            width: .15rem;  
            height: .8rem;  
            background: url(../image/icon_zk.png)no-repeat;
            -webkit-background-size: .15rem .25rem;
            background-size: .15rem .25rem;
            background-position: 0  center;
            float: right;   

        }
        .uaseName {
            margin-left: .2rem; 
            font-size: 0;
        }
        .uaseName .sexImg {
            width: .3rem;
            height: .3rem;
            margin-left: .15rem;    
        }
        .uaseName .userNameText {
            font-size: .34rem;
            line-height: .48rem;
        }
        .uaseName .personalInfo {
            font-size: .24rem;
            color: #333;

            margin-top: .15rem;  
            letter-spacing: -.025rem;
            line-height: .33rem;    
        }
        .mb37 {
            margin-bottom: .37rem;  
        }
    </style>
</head>
<body>
    <div class="main">
        <ul>
            <li onclick="login(this)" data-val="info" class="userInfo">
                <div class="headDiv">
                    <img class="headImg"  src="../image/tx_2.jpg">
                </div>
                <div class="uaseName">
                    <p>
                        <span class="userNameText">啊</span>
                        <img  class="sexImg" src="../image/icon_my/icon_my01.png">
                    </p>
                    <p class="personalInfo">个人说明</p>
                </div>
                <span></span>
            </li>
            <li class="select" onclick="login(this)" data-val="hy"><span>会员中心</span><span></span></li>
            <li class="select" onclick="login(this)" data-val="tg"><span>推广</span><span></span></li>
            <li onclick="login(this)" data-val="gs " class="mb37"           ><span class="select">公司主页</span><span></span></li>
            <li onclick="login(this)" data-val="gdd"><span>供订单</span><span></span></li>
            <li onclick="login(this)" data-val="qdd"><span>求订单</span><span></span></li>
            <li onclick="login(this)" data-val="yfb"><span>已发布</span><span></span></li>
            <li onclick="login(this)" data-val="wdq" class="mb37"><span class="select">我的圈</span><span></span></li>
            <li onclick="login(this)" data-val="sc"><span>收藏</span><span></span></li>
            <li onclick="login(this)" data-val="gz" class="mb37"><span>关注的人</span><span></span></li>
            <li onclick="login(this)" data-val="sz" class="mb37"><span>设置</span><span></span></li>
        </ul>
    </div>
    <script type="text/javascript" src="../script/api.js"></script>
    <script type="text/javascript" src="../script/common.js"></script>
    <script type="text/javascript">
    var  userName, headImg, sex, currentCompany, currentPosition,imgChche, userToken, rongToken;
    	apiready = function(){
            userToken = api.pageParam.userToken || userTokenAll;
            rongToken = api.pageParam.rongToken || rongTokenAll;
            userInfo(userToken);
            api.addEventListener({
                name:'viewappear'
            }, function(ret, err){        
                userInfo(userToken);
            });
    	}

        
        // 获取用户信息
        function userInfo(userToken) {
            // 如果没有本地缓存，就从网络获取，有就使用本地缓存
            // if ($api.getStorage('userName')) {
            // // if ($api.getStorage('userName')) {
            // // if (0) {
            //     // 本地数据设置页面内容
            //     userName =   $api.getStorage('userName'); 
            //     headImg =   $api.getStorage('headImg'); 
            //     // headImg =   imgChche; 
            //     // alert(headImg)
            //     sex =   $api.getStorage('sex'); 
            //     currentCompany =   $api.getStorage('currentCompany'); 
            //     currentPosition =   $api.getStorage('currentPosition');
            //     reviseContent(userName, headImg, sex, currentCompany, currentPosition);
            // } else {
                 api.ajax({
                    url: apiSite + '/api/user_center/index',
                    method: 'post',
                    headers: apiHeader,
                    data: {
                        values: { 
                            token: userToken
                        }
                    }
                }, function(ret, err) {
                    if (ret) {
                            
                            userName = ret.data.info.nickname,
                            headImg = ret.data.info.head_img_url,
                            sex = ret.data.info.sex,
                            // sex = (ret.data.info.sex === 1)?'男':'女',
                            // 当前公司
                            currentCompany = ret.data.info.current_company, 
                            // 当前职位
                            currentPosition = ret.data.info.current_position;
                            // 设置本地缓存
                            $api.setStorage('userName', userName); 
                            
                            $api.setStorage('sex', sex); 
                            $api.setStorage('currentCompany', currentCompany); 
                            $api.setStorage('currentPosition', currentPosition);
                            
                            // 初始化页面内容   
                            reviseContent(userName, headImg, sex, currentCompany, currentPosition);
                            // 图片缓存
                            api.imageCache({
                                url: headImg,
                                policy: 'cache_else_network'
                            }, function(ret, err) {
                                if (ret) {
                                    $api.setStorage('headImg', ret.url); 
                                } else {
                                    alert(JSON.stringify(err));
                                }
                            });
                    } else {
                        alert(JSON.stringify(err));
                    }
                });
            // }
        }
        //
    	function login(ele) {
           // 根据点击的按钮进入不同的页面
            var val = $api.attr(ele, 'data-val');
            api.openWin({
                name: 'winName',
                url: './me/me_' + val + '.html',
                pageParam: {
                    userToken: userToken,
                    rongToken: rongToken
                }
            });
        }

        // 修改文本内容
        function reviseContent(userName, headImg, sex, currentCompany, currentPosition) {
            var name = $api.dom('.userName'),
                head = $api.dom('.headImg'),
                sexImg = $api.dom('.sexImg');
            // 设置用户昵称
            $api.text(name, userName);
            // 设置用户头像
            $api.attr(head, 'src', headImg);
            // 设置用户性别
            if (sex == 1 ) {
                $api.attr(sexImg, 'src', '../image/icon_my/icon_my01.png');
            } else {
                $api.attr(sexImg, 'src', '../image/icon_my/icon_my02.png');
            }
            
        }
    </script>
</body>
</html>