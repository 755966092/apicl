<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>我</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="../css/weui.css"/>
    <!-- <style>
        .empty{ text-align: center; padding: 120px 0; }
        body,html {
            background-color: #EFEFF4;
            margin: 0;
            padding: 0;
        }
        body {
            font-size: 0;
        }
        .main {

            padding-bottom: .27rem;
        }
        .userInfo {
            height: 1.58rem;
            display: -webkit-box;
            display: flex;
            -webkit-box-align:  center;
            align-items: center;
            /*margin-bottom: .37rem;  */
        }
        .userInfo .headImg {
            width: 1.14rem;
            height: 1.14rem;
            border-radius: .12rem
        }
        ul {
            margin-top: .37rem;
            background-color: #fff;
            padding: 0 0 0 .27rem;
            border-bottom: .6px solid #D9D9D9;
            /*border-top: .6px solid #D9D9D9;   */
        }
        ul:first-child {
            margin-top: .27rem;
            padding-left: .3rem;
        }
        ul li:last-child {
            border: 0;
        }
        ul li {
            height: .8rem;
            width: 100%;
            box-sizing: border-box;
            position: relative;
            background-color: #fff;
            font-size: .3rem;
            color: #000;
            border-bottom: .6px solid #D9D9D9;
            /*margin-top: .01rem;*/
            padding-bottom: .02rem;
            padding-right: .36rem;
            /*padding-left: .rem;*/

        }

        ul li:not(.userInfo) span {
            position: relative;
        }
       /* ul li:not(.userInfo) span.select:before {
             content: "";
            display: inline-block;
            width: .16rem;
            height: .16rem;
            background-color: #f00;
            border-radius: .2rem;
            position: absolute;
            top: .17rem;
            right: -.09rem;
        }*/
        ul li:not(.userInfo) span:first-child {
            margin-left: .83rem;
        }
        ul li:not(.userInfo) {
            line-height: .8rem;
            /*padding-left:  .3rem;  */
            background: #fff url(../image/icon_my/icon_fb.png)no-repeat;
            -webkit-background-size: .42rem .26rem;
            background-size: .42rem .26rem;
             background-position: .11rem center;
         }
         ul:nth-child(2) li:nth-child(1) {
             background: #fff url(../image/icon_my/icon_hy_frame_4.png)no-repeat;
             background-size: .42rem .38rem;
             background-position: .11rem center;
         }
         ul:nth-child(2) li:nth-child(2) {
             background: #fff url(../image/icon_my/icon_tg.png)no-repeat;
             background-size: .40rem .38rem;
             background-position: .11rem center;
         }
         ul:nth-child(2) li:nth-child(3) {
             background: #fff url(../image/icon_my/icon_gs.png)no-repeat;
             background-size: .42rem .42rem;
             background-position: .11rem center;
         }

         ul:nth-child(3) li:nth-child(1) {
             background: #fff url(../image/icon_my/icon_gdd_frame_4.png)no-repeat;
             background-size: .44rem .43rem;
             background-position: .11rem center;
         }
         ul:nth-child(3) li:nth-child(2) {
             background: #fff url(../image/icon_my/icon_qdd_frame_4.png)no-repeat;
             background-size: .44rem .32rem;
             background-position: .11rem center;
         }
         ul:nth-child(3) li:nth-child(3) {
             background: #fff url(../image/icon_my/icon_fb.png)no-repeat;
             background-size: .42rem .31rem;
             background-position: .11rem center;
         }


         ul:nth-child(3) li:nth-child(4) {
             background: #fff url(../image/icon_my/icon_wdq_frame_4.png)no-repeat;
             background-size: .42rem .42rem;
             background-position: .11rem center;
         }

         ul:nth-child(4) li:nth-child(1) {
             background: #fff url(../image/icon_my/icon_sc.png)no-repeat;
             background-size: .42rem .37rem;
             background-position: .11rem center;
         }
         ul:nth-child(4) li:nth-child(2) {
             background: #fff url(../image/icon_my/icon_gz.png)no-repeat;
             background-size: .42rem .46rem;
             background-position: .11rem center;
         }
         ul:nth-child(5) li {
            background: #fff url(../image/icon_my/icon_sz.png)no-repeat;
            background-size: .42rem 0.4rem;
            background-position: .11rem center;
        }
        .userInfo span:last-child {
            height: 1.58rem;
            float: right;
            position: absolute;
            right: .36rem;
        }
        ul li span:last-child {
            width: .15rem;
            height: .8rem;
            background: url(../image/icon_zk.png)no-repeat;
            -webkit-background-size: .15rem .25rem;
            background-size: .15rem .25rem;
            background-position: 0  center;
            float: right;

        }
        .uaseName {
            margin-left: .2rem;
            font-size: 0;
        }
        .uaseName .sexImg {
            width: .26rem;
            height: .26rem;
            margin-left: .15rem;
        }
        .uaseName .userNameText {
            font-size: .34rem;
            line-height: .4rem;
        }
         .personalInfo {
            font-size: .24rem;
            color: #333;
        }
        .headDiv {
            width: 1.15rem;
            height: 1.15rem;
        }
        #vipList {
            display: none;
        }
        
    </style> -->
    <style>
        /* 隐藏公司 */
        #vipList {
            display: none;
        }
        /* 字体位置 */
        .weui-cell {
            padding: .2rem  .5rem;
            padding-right: 0.3rem;
        }
        /* 下边框 */
        .weui-cell:before {
            left: .4rem;
        }
        .mt30 {
            margin-top: 0.3rem;
        }
        /* 图标 */
        .weui-cell__hd img {
            width:.42rem;margin-right:.3rem;display:block
        }
        /* 头像 */
        .weui-cell__hd img.headImg {
            width: 1.14rem;
            height: 1.14rem;
            margin-right:.3rem;
            display:block;
            border-radius: .1rem;
        }
        /* 职位公司 */
        .personalInfo {
            font-size: .24rem;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="main">
        <!-- <ul>
            <li   tapmode onclick="login(this)" data-val="info" class="userInfo">
                <div class="headDiv">
                    <img class="headImg"  src="../image/icon_defaultHead.png">
                </div>
                <div class="uaseName">
                        <span class="userNameText userName"></span>
                    <p class="personalInfo"></p>
                </div>
                <span></span>
            </li>
        </ul> -->
        <div class="weui-cells mt30">
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="info">
                <div class="weui-cell__hd">
                    <img class="headImg" src="../image/icon_defaultHead.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p class="userName"></p>
                    <p class="personalInfo"></p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
        </div>
        
        <div class="weui-cells mt30">
            <a class="weui-cell weui-cell_access" href="javascript:;" id="vipList" tapmode onclick="login(this)" data-val="hy">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_pricebox.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>钱包</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="tg">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_tg.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>推广</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="gs">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_gs.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>公司</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
        </div>
        <div class="weui-cells mt30">
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="gdd">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_gdd_frame_4.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>供订单</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="qdd">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_qdd_frame_4.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>求订单</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="yfb">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_fb.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>已发布</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="wdq">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_wdq_frame_4.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>圈子</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
        </div>
        <div class="weui-cells mt30">

            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="sc">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_sc.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>收藏</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
        </div>
        <div class="weui-cells mt30">

            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="sz">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_sz.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>设置</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
           
        </div>
        <!-- <ul>
            <li class="select"  id="vipList" tapmode onclick="login(this)" data-val="hy">
                <div class="border_b">
                    <span>会员</span>
                    <span></span>
                </div>
            </li>
            <li class="select"   tapmode onclick="login(this)" data-val="tg">
                <div class="border_b">
                    <span>推广</span>
                    <span></span>
                </div>
            </li>
            <li   tapmode onclick="login(this)" data-val="gs" class="mb37 bdm">
                <div class="border_b">
                    <span class="select">公司</span><span></span>
                </div>
            </li>
        </ul>
        <ul>
            <li   tapmode onclick="login(this)" data-val="gdd">
                <div class="border_b">
                    <span>供订单</span>
                    <span></span>
                </div>
            </li>
            <li data-val="qdd" onclick="login(this)" tapmode>
                <div class="border_b">
                    <span>求订单</span>
                    <span></span>
                </div>
            </li>
            <li  data-val="yfb" tapmode onclick="login(this)">
                <div class="border_b">
                    <span>已发布</span>
                    <span></span>
                </div>
            </li>
            <li  data-val="wdq" class="mb37 bdm" tapmode   onclick="login(this)">
                <div class="border_b">
                    <span class="select">圈子</span>
                    <span></span>
                </div>
            </li>
        </ul>
        <ul>
            <li  data-val="sc" tapmode   onclick="login(this)">
                <div class="border_b">
                    <span>收藏</span>
                    <span></span>
                </div>
            </li>
        </ul>
        <ul>
            <li   tapmode   onclick="login(this)" data-val="sz" class="mb37 bdm">
                <div class="border_b">
                    <span>设置</span>
                    <span></span>
                </div>
            </li>
        </ul> -->
    </div>
    <script type="text/javascript" src="../script/api.js"></script>
    <script type="text/javascript" src="../script/common.js"></script>
    <script type="text/javascript">
        var  userName, headImg, sex, currentCompany, currentPosition,imgChche, userToken, rongToken;
    	apiready = function(){
            userInfo();
            api.addEventListener({
                name:'viewappear'
            }, function(ret, err){
                userInfo();
            });
            api.setFrameAttr({
                vScrollBarEnabled: false
            });
    	}
        // 获取用户信息
        function userInfo() {

            // ----------------------------------------------------

            api.ajax({
                url: apiSite + '/common/checkVersion',
                method: 'post',
                headers: apiHeader,
            }, function(ret, err) {
                if(ret) {
                    if (ret.data.current_version >= api.appVersion) {
                        $api.css($api.byId('vipList'), 'display: -webkit-box;display: -webkit-flex;display: flex;');
                    }
                    
                } else {
                    alert(err.msg)
                }
            })



            // ----------------------------------------------------
                var userCenterData = $api.getStorage('UserCenter');
                if (userCenterData) {
                    // 缓存
                    reviseContent(userCenterData.info.nickname, $api.getStorage('imgCache'), userCenterData.info.sex, userCenterData.info.current_company, userCenterData.info.current_position, userCenterData.info.current_degree);
                    requireData();
                } else {
                    // 无缓冲
                    requireData();
                }

            // }
        }
        function requireData() {
            api.ajax({
                url: apiSite + '/user_center/index',
                method: 'post',
                headers: apiHeader,
                data: {
                    values: {
                        token: $api.getStorage('userToken')
                    }
                }
            }, function(ret, err) {
                if (ret) {
                    if ( $api.getStorage('UserCenter') != ret.data) {
                        $api.setStorage('UserCenter', ret.data);
                        userName = ret.data.info.nickname,
                        headImg = ret.data.info.head_img_url,
                        sex = ret.data.info.sex,
                        // sex = (ret.data.info.sex === 1)?'男':'女',
                        // 当前公司
                        currentCompany = ret.data.info.current_company,
                        // 当前职位
                        currentPosition = ret.data.info.current_position;
                        currentDegree = ret.data.info.current_degree;
                        // 设置本地缓存
                        $api.setStorage('userName', userName);
                        $api.setStorage('userSex', sex);
                        if (currentCompany != 'null') {
                            $api.setStorage('currentCompany', currentCompany);
                        }
                        if (currentPosition != 'null') {
                            $api.setStorage('currentPosition', currentPosition);
                        }

                        // 初始化页面内容
                        reviseContent(userName, headImg, sex, currentCompany, currentPosition,currentDegree);
                        // 图片缓存
                        api.imageCache({
                            url: headImg,
                            policy: 'cache_else_network'
                        }, function(ret, err) {
                            if (ret) {
                                $api.setStorage('imgCache', ret.url);
                            } else {
                                alert(JSON.stringify(err.msg));
                            }
                        });
                    }
                } else {
                    alert(err.msg);
                }
            });
        }
    	function login(ele) {
           // 根据点击的按钮进入不同的页面
            var val = $api.attr(ele, 'data-val');
            api.openWin({
                name: 'winName_'+val,
                url: './me/me_' + val + '.html',
                // pageParam: {
                //     userToken: userToken,
                //     rongToken: rongToken
                // },
                vScrollBarEnabled: false
            });
        }

        // 修改文本内容
        function reviseContent(userName, headImg, sex, currentCompany, currentPosition, currentDegree) {
            var name = $api.dom('.userName'),
                head = $api.dom('.headImg'),
                // sexImg = $api.dom('.sexImg'),
                personalInfo = $api.dom('.personalInfo');
            // 设置用户昵称
            $api.text(name, userName);
            // 设置用户头像
            $api.attr(head, 'src', headImg);
            // 设置当前状态
            var posStr = currentCompany + ' '+currentPosition+' '+currentDegree
            $api.text(personalInfo, posStr);

            // 设置用户性别
            if (sex == 1 ) {
                // $api.attr(sexImg, 'src', '../image/icon_my/icon_my01.png');
            } else {
                // $api.attr(sexImg, 'src', '../image/icon_my/icon_my02.png');
            }

        }
    </script>
</body>
</html>