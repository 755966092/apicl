<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>我</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="../css/weui.css"/>
    <link rel="stylesheet" type="text/css" href="../css/swiper.min.css"/>
    <style>
        /* 隐藏公司 */
        #vipList {
            display: none;
        }
        /* 字体位置 */
        .weui-cell {
            padding: .2rem  .5rem;
            padding-right: 0.3rem;
        }
        /* 下边框 */
        .weui-cell:before {
            left: .4rem;
        }
        .mt30 {
            margin-top: 0.3rem;
        }
        /* 图标 */
        .weui-cell__hd img {
            width:.42rem;margin-right:.3rem;display:block
        }
        /* 头像 */
        .weui-cell__hd img.headImg {
            width: 1.14rem;
            height: 1.14rem;
            margin-right:.3rem;
            display:block;
            border-radius: .1rem;
        }
        /* 职位公司 */
        .personalInfo {
            font-size: .24rem;
            color: #333;
        }

        .swiper-wrapper img {
            height: 7.5rem;
        }
    </style>
</head>
<body>
    <div class="swiper-container">
        <div class="swiper-wrapper">
            <img src="../image/iocn_addressList/IMG_0559.PNG" tabmode onclick="openAlbum(this)" class="swiper-slide blue-slide">
            <!-- <img src="http://imgsrc.baidu.com/imgad/pic/item/83025aafa40f4bfb281dbe70094f78f0f63618c0.jpg" class="swiper-slide blue-slide">
                <img src="http://imgsrc.baidu.com/imgad/pic/item/5366d0160924ab18cb0aad123ffae6cd7b890bf2.jpg" class="swiper-slide red-slide">
                <img src="http://img.taopic.com/uploads/allimg/140826/267848-140R60T34860.jpg" class="swiper-slide orange-slide">  -->
        </div>
        <div class="swiper-pagination" style="font-size:0">
        </div>
    </div>
    <div class="main">
        <!-- <ul>
            <li   tapmode onclick="login(this)" data-val="info" class="userInfo">
                <div class="headDiv">
                    <img class="headImg"  src="../image/icon_defaultHead.png">
                </div>
                <div class="uaseName">
                        <span class="userNameText userName"></span>
                    <p class="personalInfo"></p>
                </div>
                <span></span>
            </li>
        </ul> -->
        <div class="weui-cells">
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="info">
                <div class="weui-cell__hd">
                    <img class="headImg" src="../image/icon_defaultHead.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p class="userName"></p>
                    <p class="personalInfo"></p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
        </div>
        
        <div class="weui-cells mt30">
            <a class="weui-cell weui-cell_access" href="javascript:;" id="vipList" tapmode onclick="login(this)" data-val="hy">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_pricebox.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>钱包</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="tg">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_tg2.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>我的二维码</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="gs">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_gs.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>公司</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
        </div>
        <div class="weui-cells mt30">
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="gdd">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_gdd_frame_4.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>供订单</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="qdd">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_qdd_frame_4.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>求订单</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="yfb">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_fb.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>供求发布</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="wdq">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_wdq_frame_4.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>圈子</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
        </div>
        <div class="weui-cells mt30">
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="sc">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_sc.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>收藏</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="photo">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_photo.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>相册</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
        </div>
        <div class="weui-cells mt30">

            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="login(this)" data-val="sz">
                <div class="weui-cell__hd">
                    <img src="../image/icon_my/icon_sz.png" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p>设置</p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
           
        </div>
    </div>
    <script type="text/javascript" src="../script/api.js"></script>
    <script type="text/javascript" src="../script/common.js"></script>
    <script type="text/javascript" src="../script/swiper.min.js"></script>
    <script type="text/javascript">
        var  userName, headImg, sex, currentCompany, currentPosition,imgChche, userToken, rongToken, imgJson;
    	apiready = function(){
            userInfo();
            api.addEventListener({
                name:'viewappear'
            }, function(ret, err){
                userInfo();
            });
            api.addEventListener({
                name:'showSelIcon2'
            }, function(ret, err){
                $api.html($api.dom('.swiper-wrapper'), '<img src="../image/iocn_addressList/IMG_0559.PNG" tabmode onclick="openAlbum(this)" class="swiper-slide blue-slide">');
                userInfo();
            });
            api.setFrameAttr({
                vScrollBarEnabled: false
            });
        }
       
        // 获取用户信息
        function userInfo() {
            api.ajax({
                url: apiSite + '/common/checkVersion',
                method: 'post',
                headers: apiHeader,
            }, function(ret, err) {
                if(ret) {
                    if (ret.data.current_version >= api.appVersion) {
                        $api.css($api.byId('vipList'), 'display: -webkit-box;display: -webkit-flex;display: flex;');
                    }
                    
                } else {
                    alert(err.msg)
                }
            })
            var userCenterData = $api.getStorage('UserCenter');
            if (userCenterData) {

                // 缓存
                reviseContent(userCenterData.info.nickname, $api.getStorage('imgCache'), userCenterData.info.sex, userCenterData.info.current_company, userCenterData.info.current_position, userCenterData.info.current_degree);
                requireData();
            } else {
                // 无缓冲
                requireData();
            }

            // }
        }
        function openAlbum(ele) {
            // alert('打开相册')
            api.openWin({
                name: 'me_photo',
                url: './me/me_photo.html',
                bounces: false,
                // pageParam: { imgJson: imgJson }
            });
            }
        function requireData() {
            api.ajax({
                url: apiSite + '/user_center/index',
                method: 'post',
                headers: apiHeader,
                data: {
                    values: {
                        token: $api.getStorage('userToken')
                    }
                }
            }, function(ret, err) {
                if (ret) {
                    if ( $api.getStorage('UserCenter') != ret.data) {
                        imgJson = eval(ret.data.info.image_json);
                        // console.log(JSON.stringify(ret.data.info.image_json));
                        
                        if (imgJson.length > 0) {
                            var str = '';
                            for (var i = 0; i < imgJson.length; i++) {
                                var element = imgJson[i];
                                if (i < 5) {
                                    str += '<img src="' + element + '?imageMogr2/auto-orient/thumbnail/!750x750r/gravity/Center/crop/750x750/format/jpg/interlace/1/blur/1x0/quality/100|imageslim" class="swiper-slide blue-slide" tapmode onclick="openAlbum(this)">'
                                } else {
                                    break;
                                }
                            }
                            $api.html($api.dom('.swiper-wrapper'), str);
                            if (imgJson.length > 1) {
                                swiperFun();
                            }
                        }
                      
                        $api.setStorage('UserCenter', ret.data);
                        userName = ret.data.info.nickname,
                        headImg = ret.data.info.head_img_url,
                        sex = ret.data.info.sex,
                        // sex = (ret.data.info.sex === 1)?'男':'女',
                        // 当前公司
                        currentCompany = ret.data.info.current_company,
                        // 当前职位
                        currentPosition = ret.data.info.current_position;
                        currentDegree = ret.data.info.current_degree;
                        // 设置本地缓存
                        $api.setStorage('userName', userName);
                        $api.setStorage('userSex', sex);
                        if (currentCompany != 'null') {
                            $api.setStorage('currentCompany', currentCompany);
                        }
                        if (currentPosition != 'null') {
                            $api.setStorage('currentPosition', currentPosition);
                        }

                        // 初始化页面内容
                        reviseContent(userName, headImg, sex, currentCompany, currentPosition,currentDegree);
                        // 图片缓存
                        api.imageCache({
                            url: headImg,
                            policy: 'cache_else_network'
                        }, function(ret, err) {
                            if (ret) {
                                $api.setStorage('imgCache', ret.url);
                            } else {
                                alert(JSON.stringify(err.msg));
                            }
                        });
                    }
                } else {
                    alert(err.msg);
                }
            });
        }
    	function login(ele) {
           // 根据点击的按钮进入不同的页面
            var val = $api.attr(ele, 'data-val');
            api.openWin({
                name: 'winName_'+val,
                url: './me/me_' + val + '.html',
                // pageParam: {
                //     userToken: userToken,
                //     rongToken: rongToken
                // },
                vScrollBarEnabled: false
            });
        }

        // 修改文本内容
        function reviseContent(userName, headImg, sex, currentCompany, currentPosition, currentDegree) {
            var name = $api.dom('.userName'),
                head = $api.dom('.headImg'),
                // sexImg = $api.dom('.sexImg'),
                personalInfo = $api.dom('.personalInfo');
            // 设置用户昵称
            $api.text(name, userName);
            // 设置用户头像
            $api.attr(head, 'src', headImg);
            // 设置当前状态
            var posStr = currentCompany + ' '+currentPosition+' '+currentDegree
            $api.text(personalInfo, posStr);

            // 设置用户性别
            if (sex == 1 ) {
                // $api.attr(sexImg, 'src', '../image/icon_my/icon_my01.png');
            } else {
                // $api.attr(sexImg, 'src', '../image/icon_my/icon_my02.png');
            }

        }
    </script>
</body>
</html>