<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>我</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <style>
        .empty{ text-align: center; padding: 120px 0; }
        body,html {
            background-color: #EDECF3;
        }
        .main ul {
            margin-top: .2rem;
        }
        .main ul li {
            height: .82rem;
            line-height: .82rem;
            padding: 0 .3rem 0 .75rem;
            font-size: .28rem;
            border-bottom: 1px solid #EDEDED;
            background: #fff url(../image/icon_member/icon_cz.png)no-repeat;
            -webkit-background-size: .34rem .34rem;
            background-size: .34rem .34rem;
            background-position: .25rem center;
            position: relative;
            
        }
        .main ul li:nth-child(3),
        .main ul li:nth-child(4),
        .main ul li:nth-child(6),
        .main ul li:nth-child(8),
        .main ul li:nth-child(10)
         {
            margin-bottom: .2rem;
        }
       /* .main ul li:nth-child(11) {
            margin-top: 1rem;
        }*/
        .main ul li:nth-child(1) {
            padding-left: .3rem;
            height: 1.6rem;
            background: #fff;
            line-height: 1.6rem;
            display: -webkit-flex;
            display: flex;
            align-items: center;
            margin-bottom: .2rem;
        }

        .main ul li:nth-child(1) img {
            width: 1.18rem;
            height: 1.18rem;
            vertical-align:middle;
        }
        .main ul li:nth-child(1) p {
            line-height: .5rem;
            margin-left: .2rem;
            font-size: .34rem;
        }
        .main ul li:nth-child(1) p img {
            vertical-align:baseline;
            width: .3rem;
            height: .3rem;
        }
        .main ul li:nth-child(1) p:nth-child(2) {
            font-size: .24rem;
        }
        .uaseName {
            display: inline-block;
            vertical-align:middle;
        }
        .main ul li span:first-child {
            position: relative;
        }
        .main ul li span:last-child {
            display: inline-block;
            width: .15rem;
            height: .8rem;
            background: url(../image/icon_member/icon_zk.png)no-repeat;
            -webkit-background-size: .15rem .25rem;
            background-size: .15rem .25rem;
            background-position: 0 .3rem;
            float: right;
            /*margin-right: .2rem;*/
        }
        .main ul li:nth-child(1) span:last-child{
            display: inline-block;
            height: 1.8rem;
            width: .15rem;
            position: absolute;
            right: .28rem;
            background-position: center center;
        }
        .main ul li:nth-child(2) {
            background: #fff url(../image/icon_my/icon_hy.png)no-repeat;
            -webkit-background-size: .34rem .34rem;
            background-size: .34rem .34rem;
            background-position: .3rem center;
        }
        .main ul li:nth-child(3) {
            background: #fff url(../image/icon_my/icon_tg.png)no-repeat;
            -webkit-background-size: .34rem .34rem;
            background-size: .34rem .34rem;
            background-position: .3rem center;
        }
        .main ul li:nth-child(4) {
            background: #fff url(../image/icon_my/icon_gs.png)no-repeat;
            -webkit-background-size: .34rem .34rem;
            background-size: .34rem .34rem;
            background-position: .3rem center;
        }
        .main ul li:nth-child(5) {
            background: #fff url(../image/icon_my/icon_gdd.png)no-repeat;
            -webkit-background-size: .34rem .34rem;
            background-size: .34rem .34rem;
            background-position: .3rem center;
        }
        .main ul li:nth-child(6) {
            background: #fff url(../image/icon_my/icon_qdd.png)no-repeat;
            -webkit-background-size: .34rem .34rem;
            background-size: .34rem .34rem;
            background-position: .3rem center;
        }
        .main ul li:nth-child(7) {
            background: #fff url(../image/icon_my/icon_fb.png)no-repeat;
            -webkit-background-size: .34rem .34rem;
            background-size: .34rem .34rem;
            background-position: .3rem center;
        }
        .main ul li:nth-child(8) {
            background: #fff url(../image/icon_my/icon_wdq.png)no-repeat;
            -webkit-background-size: .34rem .34rem;
            background-size: .34rem .34rem;
            background-position: .3rem center;
        }
        .main ul li:nth-child(9) {
            background: #fff url(../image/icon_my/icon_sc.png)no-repeat;
            -webkit-background-size: .34rem .34rem;
            background-size: .34rem .34rem;
            background-position: .3rem center;
        }
        .main ul li:nth-child(10) {
            background: #fff url(../image/icon_my/icon_gz.png)no-repeat;
            -webkit-background-size: .34rem .34rem;
            background-size: .34rem .34rem;
            background-position: .3rem center;
        }
        .main ul li:nth-child(11) {
            background: #fff url(../image/icon_my/icon_sz.png)no-repeat;
            -webkit-background-size: .34rem .34rem;
            background-size: .34rem .34rem;
            background-position: .3rem center;
        }
        li.select span:first-child:before {
            content: "";
            display: inline-block;
            width: .1rem;
            height: .1rem;
            background-color: #f00;
            border-radius: .2rem;
            position: absolute;
            top: .2rem;
            right: -.1rem;
        }
    </style>
</head>
<body>
    <div class="main">
        <ul>
            <li onclick="login(this)" data-val="info">
                <img class="headImg"  src="../image/tx_2.jpg">
                <div class="uaseName">
                    <p>
                        <span class="userName">啊</span>
                        <img  class="sexImg" src="../image/icon_my/icon_my01.png">
                    </p>
                    <p>个人说明</p>
                </div>
                <span></span>
            </li>
            <li class="select" onclick="login(this)" data-val="hy"><span>会员中心</span><span></span></li>
            <li class="select" onclick="login(this)" data-val="tg"><span>推广</span><span></span></li>
            <li onclick="login(this)" data-val="gs"><span>公司主页</span><span></span></li>
            <li onclick="login(this)" data-val="gdd"><span>供订单</span><span></span></li>
            <li onclick="login(this)" data-val="qdd"><span>求订单</span><span></span></li>
            <li onclick="login(this)" data-val="yfb"><span>已发布</span><span></span></li>
            <li onclick="login(this)" data-val="wdq"><span>我的圈</span><span></span></li>
            <li onclick="login(this)" data-val="sc"><span>收藏</span><span></span></li>
            <li onclick="login(this)" data-val="gz"><span>关注的人</span><span></span></li>
            <li onclick="login(this)" data-val="sz"><span>设置</span><span></span></li>
        </ul>
    </div>
    <script type="text/javascript" src="../script/api.js"></script>
    <script type="text/javascript" src="../script/common.js"></script>
    <script type="text/javascript">
    var  userName, headImg, sex, currentCompany, currentPosition,imgChche, userToken, rongToken;
    	apiready = function(){
            userToken = api.pageParam.userToken || userTokenAll;
            rongToken = api.pageParam.rongToken || rongTokenAll;
            userInfo(userToken);
            api.addEventListener({
                name:'viewappear'
            }, function(ret, err){        
                userInfo(userToken);
            });
    	}
        // 获取用户信息
        function userInfo(userToken) {
            // 如果没有本地缓存，就从网络获取，有就使用本地缓存
            // if ($api.getStorage('userName')) {
            // // if ($api.getStorage('userName')) {
            // // if (0) {
            //     // 本地数据设置页面内容
            //     userName =   $api.getStorage('userName'); 
            //     headImg =   $api.getStorage('headImg'); 
            //     // headImg =   imgChche; 
            //     // alert(headImg)
            //     sex =   $api.getStorage('sex'); 
            //     currentCompany =   $api.getStorage('currentCompany'); 
            //     currentPosition =   $api.getStorage('currentPosition');
            //     reviseContent(userName, headImg, sex, currentCompany, currentPosition);
            // } else {
                 api.ajax({
                    url: apiSite + '/api/user_center/index',
                    method: 'post',
                    headers: apiHeader,
                    data: {
                        values: { 
                            token: userToken
                        }
                    }
                }, function(ret, err) {
                    if (ret) {
                            
                            userName = ret.data.info.nickname,
                            headImg = ret.data.info.head_img_url,
                            sex = ret.data.info.sex,
                            // sex = (ret.data.info.sex === 1)?'男':'女',
                            // 当前公司
                            currentCompany = ret.data.info.current_company, 
                            // 当前职位
                            currentPosition = ret.data.info.current_position;
                            // 设置本地缓存
                            $api.setStorage('userName', userName); 
                            
                            $api.setStorage('sex', sex); 
                            $api.setStorage('currentCompany', currentCompany); 
                            $api.setStorage('currentPosition', currentPosition);
                            
                            // 初始化页面内容   
                            reviseContent(userName, headImg, sex, currentCompany, currentPosition);
                            // 图片缓存
                            api.imageCache({
                                url: headImg,
                                policy: 'cache_else_network'
                            }, function(ret, err) {
                                if (ret) {
                                    $api.setStorage('headImg', ret.url); 
                                } else {
                                    alert(JSON.stringify(err));
                                }
                            });
                    } else {
                        alert(JSON.stringify(err));
                    }
                });
            // }
        }
        //
    	function login(ele) {
           // 根据点击的按钮进入不同的页面
            var val = $api.attr(ele, 'data-val');
            api.openWin({
                name: 'winName',
                url: './me/me_' + val + '.html',
                pageParam: {
                    userToken: userToken,
                    rongToken: rongToken
                }
            });
        }

        // 修改文本内容
        function reviseContent(userName, headImg, sex, currentCompany, currentPosition) {
            var name = $api.dom('.userName'),
                head = $api.dom('.headImg'),
                sexImg = $api.dom('.sexImg');
            // 设置用户昵称
            $api.text(name, userName);
            // 设置用户头像
            $api.attr(head, 'src', headImg);
            // 设置用户性别
            if (sex == 1 ) {
                $api.attr(sexImg, 'src', '../image/icon_my/icon_my01.png');
            } else {
                $api.attr(sexImg, 'src', '../image/icon_my/icon_my02.png');
            }
            
        }
    </script>
</body>
</html>