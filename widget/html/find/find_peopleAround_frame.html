<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <style>
        li {
            width: 7.5rem;
            box-sizing: border-box;
            padding: .1rem .17rem .16rem;
            border-bottom: .01rem solid #d9d9d9;
            background-color: #fff;
        }
        li img {
            width: .83rem;
            height: .83rem;
            border-radius: .1rem;
            margin-right: .26rem;
        }
        li h3 {
            font-size: .3rem;
            margin-right: .1rem;
            max-width: 3.8rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        li p {
            margin-top: .1rem;
            font-size: .24rem;
            color: #999;
            max-width: 3.8rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /*// 行高 = 24
        // 边距 = 8*/
        li .content span{
            border-top: .08rem solid #f2f2f2;
            border-bottom: .08rem solid #f2f2f2;
            max-width: 1.6rem;
            max-height: .64rem;
            padding: 0 .1rem;
            border-radius: .08rem;
            font-size: .2rem;
            color: #999;
            background-color: #F2F2F2;

            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
            overflow: hidden;
        }
        li .icon {
            width: .26rem;
            height: .26rem;
            background: url(../../image/icon_my/icon_my01.png)no-repeat;
            -webkit-background-size: .26rem .26rem;
            background-size: .26rem .26rem;

        }
        li .icon2 {
            width: .26rem;
            height: .26rem;
            background: url(../../image/icon_my/icon_my02.png)no-repeat;
            -webkit-background-size: .22rem .26rem;
            background-size: .22rem .26rem;

        }
    </style>
</head>
<body>
    <div class="main">
        <ul class="resultList">
            <!-- <li class="flex-def flex-cCenter">
                <img src="../../image/tx_1.jpg">
                <div class="info flex-item flex-zLeftRight flex-def flex-zBetween">
                    <div class="title">
                        <div class="name flex-item flex-def flex-cCenter">
                            <h3>姓名</h3>
                            <span class="icon"></span>
                        </div>
                        <p>100米以内</p>
                    </div>
                    <span class="content flex-def flex-cCenter">
                        <span>个性签性签</span>
                    </span>
                </div>
            </li>
            <li class="flex-def flex-cCenter">
                <img src="../../image/tx_1.jpg">
                <div class="info flex-item flex-zLeftRight flex-def flex-zBetween">
                    <div class="title">
                        <div class="name flex-item flex-def flex-cCenter">
                            <h3>姓名姓名姓名姓名姓名姓名姓</h3>
                            <span class="icon2"></span>
                        </div>
                        <p>1km以内</p>
                    </div>
                    <span class="content flex-def flex-cCenter">
                        <span>个性签名个性签个性签名个性签个性签名个性签个性签名个性签</span>
                    </span>
                </div>
            </li> -->
        </ul>
        <script type="text/x-dot-template" id="listT">
            {{?it.length==0}}
                <p class="no_data">暂无附近的人</p>
            {{??}}
                {{~it:value:index}}
                    <li class="flex-def flex-cCenter" taomode onclick="openInfoPafe(this)" data-id="{{=value.user_id}}">
                        <img src="{{=value.head_img_url}}">
                        <div class="info flex-item flex-zLeftRight flex-def flex-zBetween">
                            <div class="title">
                                <div class="name flex-item flex-def flex-cCenter">
                                    <h3>{{=value.nickname}}</h3>
                                    {{?value.sex==1}}
                                        <span class="icon"></span>
                                    {{??}}
                                        <span class="icon2"></span>
                                    {{?}}
                                </div>
                                {{?value.distance<1}}
                                <p>1km以内</p>
                                {{??}}
                                <p>{{=value.distance}}km</p>
                                {{?}}
                            </div>
                            <!-- <span class="content flex-def flex-cCenter">
                                <span>{{=value.current_company}}{{=value.current_position}}</span>
                            </span> -->
                        </div>
                    </li>
                {{~}}
            {{?}}
        </script>

    </div>
    <div class="loading"></div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript">
    var paramFlitrate;
    apiready = function(){

        eventMonitoring('ScreeningIsComplete');
        requireData()
    };

    // 事件监听
    function eventMonitoring(eventName) {
        api.addEventListener({
            name: eventName
        }, function(ret, err) {
            if (ret) {
                $api.css($api.dom('.loading'), 'display: block');
                requireData(ret);

                paramFlitrate = ret;
            } else {
                alert(JSON.stringify(err));
            }
        });
    }
    // 进入个人详情页
    function openInfoPafe(ele) {
        api.openWin({
            name: 'txl_memberInfo_Win',
            url: '../addressList/txl_memberInfo_Win.html',
            bounces: false,
            pageParam: {userId : $api.attr(ele, 'data-id')}
        });
    }
    // 请求数据
    function requireData(ret) {
        var obj;
        // 参数
        if(ret) {
            var param = ret.value.filterParameters;
            if (param.hometown == '不限-不限') {
                param.hometown = ''
            }
            if (param.start_age == null) {
                param.start_age = ''
            }
            if (param.end_age == null) {
                param.end_age = ''
            }
            obj = {
                token: $api.getStorage('userToken'),
                latitude: api.pageParam.lat,
                longitude: api.pageParam.lon,
                sex:param.sex,
                hometown:param.hometown,
                start_age:param.start_age,
                end_age:param.end_age,
            }
        } else {
            obj = {
                token: $api.getStorage('userToken'),
                latitude: api.pageParam.lat,
                longitude: api.pageParam.lon
            }
        }
        api.ajax({
            url: apiSite + '/location/nearByUserList',
            method: 'post',
            headers: apiHeader,
            data: {
                values: obj
            }
        }, function(ret, err) {
            if(ret) {
                if (ret.code === 200) {
                    getData(ret.data.list);
                    $api.css($api.dom('.loading'), 'display: none');
                    api.sendEvent({
                        name: 'hideLoading'
                    });
                } else {
                    alert(ret.msg)
                }
            } else {
                // console.log(JSON.stringify(err))
            }
        })
    }

</script>
</html>