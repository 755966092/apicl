<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <style>
        .nomain .icon {
            width: 2.2rem;
            height: 2.2rem;
            background: url(../../image/iocn_addressList/icon_noInfo.png)no-repeat;
            -webkit-background-size: 2.2rem 2.2rem;
            background-size: 2.2rem 2.2rem;
            margin: 0 auto;
        }

        .nomain {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            margin: auto;
        }

        .nomain p {
            font-size: .3rem;
            color: #999;
            /*width: 3.9rem;*/
            margin: .36rem auto 0;
            text-align: center;
        }

        .nomain .jump {
            color: #89B2EF;
            font-size: 0.34rem;
        }

        .nomain .wrap {
            background-color: rgba(0, 0, 0, 0)
        }

        body,html{
            height: 100%;
        }
        body {
            padding-top: .2rem;
            box-sizing: border-box;
        }
       .search {
            height: .5rem;
            line-height: .5rem;
            background-color: #fff;
            margin: 0 .3rem .2rem;
            text-align: center;
            font-size: 0;
            color: #96969B;

        }
        .search .searchIcon {
            display: inline-block;
            width: .26rem;
            height: .5rem;
            background: url(../../image/icon_supply/icon_search.png)no-repeat;
            -webkit-background-size: .25rem .26rem;
            background-size: .25rem .26rem;
            background-position: 0 center;
            vertical-align: top;
        }
        .search .searchText {
            font-size: .24rem;
        }

        .list {
            box-sizing: border-box;
            width: 100%;
            font-size: 0;
            background-color: #fff;
            padding: .2rem .3rem;
            border-bottom: .01rem solid #e7e7e7;
            /*margin-bottom: .2rem;*/

            /* 定义flex */
            display: -webkit-box;
            display: flex;

             /*侧轴对齐方式 */
            -webkit-box-align: start ;
            align-items: flex-start;

             /*主轴对齐方式 */


             /*主轴方向 */
            -webkit-box-direction: normal;
            flex-direction: row;

        }
        .list .img img {
            width: .78rem;
            height: .78rem;

        }
        .list .text {
            /* 子元素是否伸缩 */
            -webkit-box-flex: 1.0;
            flex-grow: 1;
            box-sizing: border-box;
            margin-left: .2rem;

        }
        .list .text .title {


            box-sizing: border-box;
            position: relative;

            display: -webkit-box;
            display: flex;
            box-sizing: border-box;
            /*主轴方向 */
            -webkit-box-direction: normal;
            flex-direction: row;

            -webkit-box-align: center ;
            -webkit-align-items: center;
            align-items: center;
        }
        .list .text .title h3 {
            font-weight: 700;
            font-size: .26rem;
            color: #333;
            margin-bottom: .05rem;
            /*line-height: .24rem;*/
            margin-right: .1rem;
        }
        .list .text .title .state {
            font-size: .24rem;
            color: #0ABB07;
            position: absolute;
            right: 0;
            top: 0;
        }
        .list .text .title .titleLable {
            /* font-size: .2rem;
            color: #5D7099;
            text-align: center;
            border: .01rem solid #5D7099;
            border-radius: .06rem; */
            font-size: 0.2rem;
            color: #CC0019;
            margin-left: .02rem;
        }
        .list .text .stateContent {
            font-size: .26rem;
            color: #333;
            /*margin-top: .2rem;*/
            display: -webkit-box;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .hideAll {
            -webkit-line-clamp: 6;
        }
        .hideAllBtn {
            font-size: 0.26rem;
            color: #5d7099;
        }
        .discussInfo .hideAllBtn {
            font-size: 0.24rem;
            color: #5d7099;
        }
        .list .text .stateTime {
            margin-top: .1rem;
        }
        .list .text .stateTime .timeInfo {
            font-size: .2rem;
            color: #999;
        }
        .list .text .stateTime .discussIcon {
            width: .34rem;
            height: .32rem;
            background:url(../../image/icon_supply/icon_comment.png)no-repeat;
            background-size: .34rem .26rem;
            background-position: 0 center;
            float: right;
        }
        .list .text .discussInfo {
            background-color: #F3F3F5;
            padding: .1rem;
            position: relative;
            margin-top: .15rem;
        }

        .list .text .discussInfo::before {
            content: "";
            display: inline-block;
            width: 0;
            height: 0;
            /*border-top: .5rem solid transparent;*/
            border-left: .1rem solid transparent;
            border-bottom: .15rem solid #F3F3F5;
            border-right: .1rem solid transparent;
            position: absolute;
            top: -.13rem;
            left: .2rem;
        }
        .list .text .discussInfo .discussName {
            font-size: .24rem;
            font-weight: 700;
            color: #5D7098;
        }
        .list .text .discussInfo .text1 {
            font-size: .24rem;
            color: #000;
        }
        .list .text .discussInfo .discussContent {
            font-size: .24rem;
            /* display: -webkit-box;
            -webkit-box-orient: vertical;
            overflow: hidden; */

        }
        .list .text .imgContent {
            margin-top: .1rem;
            max-height: 6rem;
            overflow: hidden;
        }
        .list .text .imgContent img {
            margin-right: .1rem;
            margin-top: .1rem;
        }
    </style>
</head>
<body >
    <!-- <div class="search clearfix"   tapmode   onclick="open1();event.stopPropagation();">
        <span class="searchIcon"></span>
        <span class="searchText" >搜索</span>
    </div> -->
    <div class="main clearfix">
         <!-- <div class="resultList">
            <div class="list" tapmode data-id='31' onclick="openStateInfo(this)">
                <div class="img">
                    <img tapmode onclick="openUserInfoPage(this);event.stopPropagation();" src="http://img.iinnet.com/FvZfKY3unCYn9_3cr3vdkHmZvdWX?imageView2/1/w/150/h/150/interlace/1/q/100|imageslim"
                        data-id="1025"> </div>
                <div class="text">
                    <div class="title">
                        <h3>我是老大</h3>
                        <span class="titleLable">[知情人]</span>
                        <span class="state">2017-12-04</span>
                    </div>
                    <p class="stateContent hideAll">人生的终点不是死亡，而是遗忘。在爱的记忆消失前，请记得我[心][心][心]——《寻梦环游记》 ​ 熟悉的皮克斯风格，熟悉的迪士尼配乐~ 电影有关梦想，有关亲情，有关生死， 快来感受来自冬日里的温暖和感动！愿我们永远都能记住彼此爱的回忆~ ​</p>
            <div class="imgContent">
                <img class="imgCon" src="http://img.iinnet.com/Fn1chvOGqcLwf2pguak9nZVzG9dh?imageView2/1/w/750/h/750/interlace/1/q/100|imageslim"
                    alt="">
                <img class="imgCon" src="http://img.iinnet.com/FhrSfQVjE1g9mIjtiDtpWm72jsaI?imageView2/1/w/750/h/750/interlace/1/q/100|imageslim"
                    alt="">
                <img class="imgCon" src="http://img.iinnet.com/FrBD3eajGVOcaIYkr2BHkY0wtzQm?imageView2/1/w/750/h/750/interlace/1/q/100|imageslim"
                    alt="">
            </div>
            <div class="stateTime" onclick="event.stopPropagation();">
                <span class="timeInfo">2017-12-04 18:15:57</span>
                <span class="discussIcon" tapmode onclick='commentBtn(this)' data-id='31'></span>
            </div>
            <div class="discussInfo claerfix" onclick="event.stopPropagation();">
                <div data-usrId='52' data-id='31' tapmode onclick='addComment(this);event.stopPropagation();'>
                    <span class="discussName">大中小18765：</span>
                    好喜欢这部电影，场景好漂亮的。情节也很感人泪目
                </div>
                <div data-usrId='54' data-id='31' tapmode onclick='addComment(this);event.stopPropagation();'>
                    <span class="discussName">大中小18765：</span>
                    <span class="discussContent hideAll">
                        <img src="../../image/chatPage/emotion/Expression_5.png" width="20" height="20">
                        <img src="../../image/chatPage/emotion/Expression_5.png" width="20" height="20">
                    </span>
                </div>
                <div data-usrId='57' data-id='31' tapmode onclick='addComment(this);event.stopPropagation();'>
                    <span class="discussName">大中小18765：</span>
                    <span class="discussContent hideAll">
                        <img src="../../image/chatPage/emotion/Expression_17.png" width="20" height="20">
                        <img src="../../image/chatPage/emotion/Expression_17.png" width="20" height="20">
                        <img src="../../image/chatPage/emotion/Expression_17.png" width="20" height="20">
                    </span>
                </div>
            </div>
            </div>
            </div>
            <div class="list" tapmode data-id='30' onclick="openStateInfo(this)">
                <div class="img">
                    <img tapmode onclick="openUserInfoPage(this);event.stopPropagation();" src="http://img.iinnet.com/FlcfxZr8WXKbW73wfy4tn7LNU-2Z?imageView2/1/w/150/h/150/interlace/1/q/100|imageslim"
                        data-id="909"> </div>
                <div class="text">
                    <div class="title">
                        <h3>成府路13260</h3>
                        <span class="titleLable">[知情人]</span>
                    </div>
                    <p class="stateContent hideAll">Game of Thrones</p>
                    <div class="imgContent">
                        <img class="imgCon" src="http://img.iinnet.com/FrGp_E4AHgVjVaE-6mDp2S2I7leJ?imageView2/1/w/750/h/750/interlace/1/q/100|imageslim"
                            alt="">
                        <img class="imgCon" src="http://img.iinnet.com/FnCKA4xlHZum0kQhbzTL6Ic3glq0?imageView2/1/w/750/h/750/interlace/1/q/100|imageslim"
                            alt="">
                        <img class="imgCon" src="http://img.iinnet.com/Fv3f57xqDHpxN7RZMnKvZg8RjPYB?imageView2/1/w/750/h/750/interlace/1/q/100|imageslim"
                            alt="">
                    </div>
                    <div class="stateTime" onclick="event.stopPropagation();">
                        <span class="timeInfo">2017-12-04 14:32:09</span>
                        <span class="discussIcon" tapmode onclick='commentBtn(this)' data-id='30'></span>
                    </div>
                </div>
            </div>
            <div class="list" tapmode data-id='28' onclick="openStateInfo(this)">
                <div class="img">
                    <img tapmode onclick="openUserInfoPage(this);event.stopPropagation();" src="http://img.iinnet.com/FvZfKY3unCYn9_3cr3vdkHmZvdWX?imageView2/1/w/150/h/150/interlace/1/q/100|imageslim"
                        data-id="1025"> </div>
                <div class="text">
                    <div class="title">
                        <h3>我是老大</h3>
                        <span class="titleLable">[知情人]</span>
                        <span class="state">2017-11-27</span>
                    </div>
                    <p class="stateContent hideAll">台词是句句戳心，又温暖治愈❤️❤️❤️</p>
                    <div class="imgContent">
                        <img class="imgCon" src="http://img.iinnet.com/Fm3niY-njtWXhbOi7QcTVuEd5dSJ?imageView2/1/w/750/h/750/interlace/1/q/100|imageslim"
                            alt="">
                        <img class="imgCon" src="http://img.iinnet.com/FkT-rN9SemwfVK91k9UIjHNFCH0y?imageView2/1/w/750/h/750/interlace/1/q/100|imageslim"
                            alt="">
                        <img class="imgCon" src="http://img.iinnet.com/Fi4yaAMupHdkmRJRIDFTx8Ub9fhE?imageView2/1/w/750/h/750/interlace/1/q/100|imageslim"
                            alt="">
                        <img class="imgCon" src="http://img.iinnet.com/FmUASyBZET6bgf1AeRPN60L3NM7y?imageView2/1/w/750/h/750/interlace/1/q/100|imageslim"
                            alt="">
                        <img class="imgCon" src="http://img.iinnet.com/FgP2nCfTu-hJTcNaW0PXZU_ku24K?imageView2/1/w/750/h/750/interlace/1/q/100|imageslim"
                            alt="">
                    </div>
                    <div class="stateTime" onclick="event.stopPropagation();">
                        <span class="timeInfo">2017-11-27 14:56:31</span>
                        <span class="discussIcon" tapmode onclick='commentBtn(this)' data-id='28'></span>
                    </div>
                    <div class="discussInfo claerfix" onclick="event.stopPropagation();">
                        <div data-usrId='20' data-id='28' tapmode onclick='addComment(this);event.stopPropagation();'>
                            <span class="discussName">大中小18765：</span>
                            <span class="discussContent hideAll">评论</span>
                        </div>
                        <div data-usrId='29' data-id='28' tapmode onclick='addComment(this);event.stopPropagation();'>
                            <span class="discussName">成府路13260：</span>
                            <span class="discussContent hideAll">可以</span>
                        </div>
                        <div data-usrId='30' data-id='28' tapmode onclick='addComment(this);event.stopPropagation();'>
                            <span class="discussName">成府路13260：</span>
                            <span class="discussContent hideAll">不错</span>
                        </div>
                        <div data-usrId='32' data-id='28' tapmode onclick='addComment(this);event.stopPropagation();'>
                            <span class="discussName">成府路13260：</span>
                            <span class="discussContent hideAll">可以</span>
                        </div>
                        <div data-usrId='45' data-id='28' tapmode onclick='addComment(this);event.stopPropagation();'>
                            <span class="discussName">大中小18765</span>
                            <span class="text1">回复</span>
                            <span class="discussName">测试13260：</span>
                            <span class="discussContent"> 测试</span>
                        </div>
                    </div>
                </div>
            </div> 

         </div> -->
         <div class="resultList"></div>
         <script type="text/x-dot-template" id="listT">
            {{?it.length > 0}}
                {{ for (var i = 0; i < it.length; i++) { }}
                    <div class="list"   tapmode data-id='{{=it[i].topic_id}}' onclick="openStateInfo(this)">
                        <div class="img">
                            <img tapmode onclick="openUserInfoPage(this);event.stopPropagation();" src="{{=it[i].head_img_url}}?imageView2/1/w/150/h/150/interlace/1/q/100|imageslim" data-id="{{=it[i].user_id}}">
                        </div>
                        <div class="text" >
                            <div class="title">
                                {{?it[i].member_note}}
                                <h3>{{=it[i].member_note}}</h3>
                                {{??}}
                                <h3>{{=it[i].nickname}}</h3>
                                {{?}}

                                {{?it[i].role_name}}
                                <span class="titleLable" >[{{=it[i].role_name}}]</span>
                                <!-- <span class="titleLable" style="padding: 0 .06rem;line-height: .28rem;height: .28rem;">[{{=it[i].role_name}}]</span> -->
                                {{?}}
                                {{?it[i].start_time}}
                                <span class="state">{{=it[i].start_time.substring(0,10)}}</span>
                                {{?}}
                            </div>
                            <p class="stateContent hideAll">{{=it[i].content}}</p>
                            {{?it[i].content.length>150}}
                                <span class="hideAllBtn" tapmode onclick="hideAll(this);event.stopPropagation()">全文</span>
                            {{??}}
                            {{?}}
                            {{?it[i].image_json!=null}}
                                <div class="imgContent">
                                    {{ for (var j = 0; j < it[i].image_json.length; j++) { }}
                                        <img class="imgCon" src="{{=it[i].image_json[j]}}?imageView2/1/w/750/h/750/interlace/1/q/100|imageslim" alt="">
                                        <!-- <img class="imgCon" src="../../image/icon_defaultHead.png" alt=""> -->
                                    {{ }; }}
                                </div>
                            {{?}}
                            <div class="stateTime" onclick="event.stopPropagation();">
                                <span class="timeInfo">{{=it[i].create_time}}</span>
                                <span class="discussIcon" tapmode onclick='commentBtn(this)' data-id='{{=it[i].topic_id}}'></span>
                            </div>
                            {{?it[i].comment_list.length!=0}}
                            <div class="discussInfo claerfix" onclick="event.stopPropagation();">
                                    {{ for (var j = 0; j < it[i].comment_list.length; j++) { }}
                                        {{?it[i].comment_list[j].root==2}}
                                            <div style="font-size:.24rem" data-usrId='{{=it[i].comment_list[j].comment_id}}' data-id='{{=it[i].topic_id}}' tapmode onclick='addComment(this);event.stopPropagation();'>
                                                <span class="discussName">{{=it[i].comment_list[j].nickname}}</span>
                                                <span class="text1">回复</span>
                                                <span class="discussName">{{=it[i].comment_list[j].comment_nickname}}：</span>
                                                {{=it[i].comment_list[j].content}}
                                            </div>
                                        {{??}}
                                            <div style="font-size:.24rem" data-usrId='{{=it[i].comment_list[j].comment_id}}' data-id='{{=it[i].topic_id}}' tapmode onclick='addComment(this);event.stopPropagation();'>
                                                <span class="discussName">{{=it[i].comment_list[j].nickname}}：</span>
                                               {{=it[i].comment_list[j].content}}
                                                    {{?it[i].comment_list[j].content.length>150}}
                                                        <span class="hideAllBtn" tapmode onclick="hideAll(this);event.stopPropagation()">全文</span>
                                                    {{??}}
                                                    {{?}}
                                            </div>
                                        {{?}}
                                    {{ }; }}
                            </div>
                            {{?}}
                        </div>
                    </div>
                {{ }; }}
            {{??}}
               <div class="nomain flex-def flex-cCenter flex-zCenter">
                    <div class="wrap">
                            <div class="icon">
                        </div>
                            <p>空空如也</p>
                    </div>
                </div>
            {{?}}
        </script>
    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript" src="../../script/jquery.min.js"></script>
<script type="text/javascript">
    var role = ['关系人','知情人','甲方','总包单位','分包单位','设计院','销售'],isMenber='', listData;
    apiready = function(){
        moduleInit();
        // 替换表情
        updatePage();
        requestData();
        api.addEventListener({
           name: 'circleTopicComment'
        }, function(ret, err) {
           if (ret) {
               requestData();
           } else {
               alert(JSON.stringify(err));
           }
       });
        // 下拉刷新
        // 下拉刷新
        api.setCustomRefreshHeaderInfo({
            bgColor: '#EFEFF4',
        }, function(ret, err) {
            //在这里从服务器加载数据，加载完成后调用api.refreshHeaderLoadDone()方法恢复组件到默认状态
             requestData();
        });
        // 上啦加载
        api.addEventListener({
            name: 'scrolltobottom',
        }, function(ret, err) {
            if (isMenber) {
                // alert('下拉加载')
                requestData();
            } else {
                // 不是圈子成员
                api.confirm({
                    title: '您尚未加入' + api.pageParam.circle_name,
                    msg: '普通用户只能查看5条内容，会员可查看10条，如果您想看到全部内容，请点击立即加入',
                    buttons:['立即加入', '再逛逛']
                },function(ret,err){
                    if(ret.buttonIndex == 1){
                        // 立即加入
                        api.openWin({
                            name: 'find_payAddCricle_win',
                            url: './find_payAddCricle_win.html',
                            pageParam: {
                                circle_id: api.pageParam.circle_id
                            }
                        });
                    }
                });
                // api.openFrame({
                //     name: 'find_joinCircle',
                //     url: './find_joinCircle.html',
                //     rect: {
                //         x: 0,
                //         y: 0,
                //         w: 'auto',
                //         h: 'auto'
                //     },
                //     pageParam: {
                //         circle_id: api.pageParam.circle_id,
                //         circle_name: api.pageParam.circle_name
                //     },
                //     bounces: false
                // });
            }
        });
    };
    // 全文
    function hideAll(ele) {
        if ($api.text(ele) == '全文') {
            $api.text(ele, '收起');
            $api.removeCls($(ele).prev()[0], 'hideAll');
        } else {
            $api.text(ele, '全文');
            $api.addCls($(ele).prev()[0], 'hideAll');
        }
    }
    // 用户详情页面
    function openUserInfoPage(ele){
        api.openWin({
            name: 'winName',
            url: '../addressList/txl_memberInfo_Win.html',
            pageParam: {
                userId: $api.attr(ele, 'data-id')
            }
        });
    }
    function requestData() {
        api.ajax({
            url: apiSite + '/circle_topic/index',
            method: 'post',
            headers: apiHeader,
            data: {
                   values: {
                       token: $api.getStorage('userToken'),
                       circle_id: api.pageParam.circle_id
                   }
            }
        }, function(ret, err) {
            if(ret) {

                for (var i = 0; i < ret.data.list.length; i++) {
                    ret.data.list[i].role = role[ret.data.list[i].role];
                    ret.data.list[i].create_time = initTime(ret.data.list[i].create_time);
                    if (ret.data.list[i].image_json != null) {
                        ret.data.list[i].image_json = eval(ret.data.list[i].image_json)
                        // ret.data.list[i].image_json += '?imageView2/1/w/750/h/750/interlace/1/q/100|imageslim'
                    }
                }
                isMenber = ret.data.is_member;
                // 停止下拉刷新
                api.refreshHeaderLoadDone();
                getData(ret.data.list);
                selfAdaption()
                if (listData == ret.data.list.length) {
                    // 第一次和第二次请求的动态条数相等不刷新页面
                } else {
                    listData = ret.data.list.length;
                    getData(ret.data.list);
                    selfAdaption()
                }
            } else {
                alert(JSON.stringify(err.msg))
            }
        })
    }

    // 评论
    function commentBtn(ele) {
        var topic_id = $api.attr(ele, 'data-id');
        // alert(id)
        api.ajax({
            url: apiSite + '/circle_topic/detail',
            method: 'post',
            headers: apiHeader,
            data: {
                   values: {
                       token: $api.getStorage('userToken'),
                       topic_id: topic_id
                   }
            }
        }, function(ret, err) {
            if(ret) {
                //console.log(JSON.stringify(ret))
                if(ret.code == 200) {
                    if (ret.data.is_collect) {
                        openInputBox(topic_id, 1)
                    } else {
                        alert('先收藏话题才可以评论')
                        api.openWin({
                            name: 'find_stateInfo_win',
                            url: './find_stateInfo_win.html',
                            bounces: false,
                            pageParam: {topic_id : topic_id}
                        });
                    }
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })

        // 圈子话题ID api.pageParam.circle_id
        // 评价内容
        // 评论级别（1-话题，2-用户） 1
        // 评论权限
        // 被评论用户ID（评论级别为用户时必传）

    }
    // 评论用户
    function addComment(ele) {
        var comment_customer_id = $api.attr(ele, 'data-usrId');
        var topic_id = $api.attr(ele, 'data-id');
        api.ajax({
            url: apiSite + '/circle_topic/detail',
            method: 'post',
            headers: apiHeader,
            data: {
                   values: {
                       token: $api.getStorage('userToken'),
                       topic_id: topic_id
                   }
            }
        }, function(ret, err) {
            if(ret) {
                //console.log(JSON.stringify(ret))
                if(ret.code == 200) {
                    if (ret.data.is_collect) {
                        openInputBox(topic_id, 2, comment_customer_id)
                    } else {
                        api.toast({
                            msg: '先收藏话题才可以评论'
                        });
                        api.openWin({
                            name: 'find_stateInfo_win',
                            url: './find_stateInfo_win.html',
                            bounces: false,
                            pageParam: {topic_id : topic_id}
                        });
                    }
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
        // alert(comment_customer_id   )
    }
    function openInputBox(topic_id, rootCount, comment_customer_id) {
        var obj = {};
        if (rootCount == 1) {
            obj = {
                topic_id: topic_id,
                rootCount: rootCount,
            }
        } else {
            obj = {
                topic_id: topic_id,
                rootCount: rootCount,
                comment_customer_id: comment_customer_id
            }
        }

        api.openFrame({
            name: 'find_inputBox',
            url: './find_inputBox.html',
            rect: {
                x: 0,
                y: 0,
                w: 'auto',
                h: 'auto'
            },
            pageParam: obj,
            bounces: false
        });
    }
    selfAdaption()
    // 根据上传图片的多少自适应图片的大小
    function selfAdaption() {

        var listContent = $api.domAll('.list');

        for (var i = 0; i < listContent.length; i++) {
            var imgArr = listContent[i].getElementsByClassName('imgCon');
            // var imgArr = $api.dom(listContent[i], '.imgCon');
            var imgCount = imgArr.length
            //console.log('::::'+imgCount)
            if (imgCount == 1) {
                    $api.css(listContent[i].getElementsByClassName('imgCon')[0], 'width:3.26rem;height:3.26rem;margin:0');
                    //console.log('1111')

            }else if (imgCount == 0) {
                    //console.log('0000')

            } else {
                    //console.log('2222')
                for (var j = 0; j < imgCount; j++) {
                    $api.css(listContent[i].getElementsByClassName('imgCon')[j], 'height:1.56rem;width:1.56rem');
                }
            }
        }
    }
    // doT模版获取数据
    function getData(data) {

        var listTText = $api.byId('listT').text;

        var fnListT = doT.template(listTText);

        var html = fnListT(data);
        html = transText(html)
        var list = $api.dom('.resultList');
        // 替换resultList所有内容
        $api.html(list, html);
        // alert('getData:' + JSON.stringify(data))
    }


    function openStateInfo(ele) {
        var topic_id = $api.attr(ele, 'data-id');
        api.openWin({
            name: 'find_stateInfo_win',
            url: './find_stateInfo_win.html',
            bounces: false,
            pageParam: {
                topic_id : topic_id,
                circle_id: api.pageParam.circle_id,
            }
        });
    }

    function updatePage() {
            var sourcePath = 'widget://image/chatPage/emotion'; // 表情存放目录
            getImgsPaths(sourcePath, function (emotion) {
                emotionData = emotion;
            });
        }
    // 表情转换
    function getImgsPaths(sourcePathOfChatBox, callback) {
        var jsonPath = 'widget://image/chatPage/emotion/emotion.json'; // 表情的JSON数组
        api.readFile({
            path: jsonPath
        }, function (ret, err) {
            if (ret.status) {
                var emotionArray = JSON.parse(ret.data);
                var emotion = {};
                for (var idx in emotionArray) {
                    var emotionItem = emotionArray[idx];
                    var emotionText = emotionItem.text;
                    var emotionUrl = '../../image/chatPage/emotion/' + emotionItem.name + '.png';
                    emotion[emotionText] = emotionUrl;
                }

                /*把emotion对象 回调出去*/
                if ('function' === typeof (callback)) {
                    callback(emotion);
                }
            }

        });
    }
    // 表情转换
    function transText(text, imgWidth, imgHeight) {
        var imgWidth = imgWidth || 20;
        var imgHeight = imgHeight || 20;
        var regx = /\[(.*?)\]/gm;
        var textTransed = text.replace(regx, function (match) {
            var imgSrc = emotionData[match];
            if (!imgSrc) {
                // 说明不对应任何表情，直接返回
                return match;
            }
            var img = '<img style="vertical-align: middle;" src="' + imgSrc + '" width="' + imgWidth + '" height="' + imgHeight + '">';
            return img;
        });
        return textTransed;
    }
</script>
</html>