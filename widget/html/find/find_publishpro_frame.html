



<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <style>
        body,html {
            background-color: #EDECF3;
        }
        .contentText {
            background-color: #fff;
            font-size: .24rem;
            padding: 0 .3rem
        }
        .title {
            height: .9rem;
            border-bottom: 1px solid #CBCBCB;
            line-height: .9rem;
        }
        .smallTitle {
            color: #0ABB07;
        }
        .title input {
            height: .9rem;
            outline: none;
        }
        textarea {
            width: 100%;
            padding: .2rem 0;
            outline: none;
        }

        .addMedia {
            width: 1.6rem;
            height: 1.6rem;
            background: #F8F8F8;
            text-align: center;
            color: #999;
            margin-right: .2rem;
        }   
        .addMedia span{
            display: inline-block;
            height: .9rem;
            width: 100%;
            background: url(../../image/icon_supply/icon_addMedia_01.png)no-repeat;
            -webkit-background-size: .62rem .62rem;
            background-size: .62rem .62rem;
            background-position: bottom center;
            
            margin-bottom: .1rem;
        }
        .addMedia:last-child span {
            background: url(../../image/icon_supply/icon_addMedia_02.png)no-repeat;
            background-size: .6rem .45rem;
            background-position: bottom center;
        }
        .position {
            background: url(../../image/icon_supply/icon_pos.png)no-repeat;
            -webkit-background-size: .26rem .35rem;
            background-size: .26rem .35rem;
            background-position: 0 center;
            height: 1rem;
            line-height: 1rem;
            padding-left: .35rem;
        }



        .classify {
            background-color: #EDECF3;
            font-size: 0;
            
        }
        .classify ul li {
            /*background-color: #fff;*/
            font-size: .3rem;
            height: .8rem;
            line-height: .8rem; 
            width: 100%;
            padding: 0 .3rem 0 .8rem;
            background: #fff url(../../image/icon_my/icon_fb.png)no-repeat;
            -webkit-background-size: .44rem .44rem;
            background-size: .44rem .44rem;
            background-position: .3rem center;
            box-sizing: border-box;
        }
        
        .spanno2 {
            margin-right: .2rem;
            display: inline-block;
            height: .8rem;
            background: url(../../image/icon_zk.png)no-repeat;
            -webkit-background-size: .15rem .25rem;
            background-size: .15rem .25rem;
            background-position: right center;
            float: right;
            color: #BEBEBE;
            padding-right: .3rem;
        }
        li input {
            float: right;
            line-height: .8rem;
            text-align: right;
            padding-right: .5rem;
            font-size: .3rem;
            outline: none;
        }
        .mt20 {
            margin-top: .2rem;
        }
        .mb20 {
            margin-bottom: .2rem;
        }
        

        .btn {
            width: 6.32rem;
            height: .83rem;
            margin: 0 auto;
            border-radius: .1rem;
            background-color: #08BB08;
            font-size: .34rem;
            color: #fff;
            text-align: center; 
            line-height: .83rem;
            margin-top: 1rem;
        }


        ul li:nth-child(1) {
            background: #fff url(../../image/icon_supply/icon_00.png)no-repeat;
            background-size: .28rem .34rem;
            background-position: .3rem center;
        }
        ul li:nth-child(2) {
            background: #fff url(../../image/icon_supply/icon_06.png)no-repeat;
            background-size: .33rem .34rem;
            background-position: .3rem center;
        }
        ul li:nth-child(3) {
            background: #fff url(../../image/icon_supply/icon_12.png)no-repeat;
            background-size: .34rem .33rem;
            background-position: .3rem center;
        }
        .status {
            height: .8rem;
            margin: .2rem 0 0 0;
            background-color: #fff;
            font-size: .3rem;
            color: #333;
            line-height: .8rem;
            padding: 0 .3rem 0 .8rem;
            background: #fff url(../../image/icon_supply/icon_13.png)no-repeat;
            background-size: .28rem .31rem;
            background-position: .3rem center;
        }
        .time {
            font-size: .3rem;
            color: #9b9b9b;
        }  

        .mult {
            -webkit-box-lines: multiple; 
            box-lines: multiple;
            flex-wrap:wrap;
            width: 100%;
            font-size: 0;
            -webkit-box-flex: 1.0;
            -moz-flex-shrink: 1;
            -webkit-flex-shrink: 1;
            flex-shrink: 1;
        }
        .clearfix img{
            margin-right: .1rem;
            width: 1.6rem;
            height: 1.6rem;
            margin-bottom: .1rem;
        }
    </style>
</head>
<body>
    
    <div class="contentText clearfix">
        
        <div class="title">
            <span class="smallTitle">#我提供#</span>
            <input type="text" placeholder="输入您发布的标题" name="">
        </div>
        <textarea placeholder="描述一下您发布的内容" rows="5"></textarea>
        <!-- <div class="clearfix">
            <div class="fl addMedia">
                <span></span>
                添加图片
            </div>
            <div class="fl addMedia">
                <span></span>
                添加视频
            </div>
        </div> -->
         <div class="mult clearfix flex-def resultList">
           <!--  <img class="fl imgpage" tapmode="hover"  src="">
            <img  src="../../image/icon_supply/icon_addMedia_1.png" class="addImg" onclick="openImg()" tapmode="hover">
            <img  src="../../image/icon_supply/icon_addMedia_2.png"> -->
           

            <!-- <div class="addMedia" onclick="openImg()" tapmode="hover">
                <span class="icon"></span>
                <span>添加图片</span>
            </div>
            <div class="addMedia">
                <span class="icon"></span>
                <span>添加视频</span>
            </div> -->
        </div>

        <script type="text/x-dot-template" id="listT">
            {{ for (var i = 0; i < it.length; i++) { }} 
                <img class="fl imgpage" tapmode="hover" onclick="openImgPage(this)" data-id = '{{=i}}' src="{{=it[i]}}">
            {{ }; }}
                <img  src="../../image/icon_supply/icon_addMedia_1.png" class="addImg" onclick="openImg()" tapmode="hover">
                <img  src="../../image/icon_supply/icon_addMedia_2.png">
        </script>
        <p class="position"   tapmode="hover"   onclick="getPos(this)">北京 北京 海淀区</p>
    </div>
    <div class="classify clearfix">
        <div class="status" tapmode='hover' onclick="selectType(this)" data-val='_status' >
            <span>您的身份</span>
            <span class="_status spanno2">知情者</span>
        </div>
        <ul>
            <li>
                <span>截至时间</span>
                <span class="spanno2"></span>
                <span class="fr">
                     <span class="time" tapmode="hover" onclick="openTime(this)" data-val='start'>请选择</span>
                     --
                    <span class="time" tapmode="hover" onclick="openTime(this)" data-val='end'>请选择</span>
                </span>
                
            </li>
            <li class="mt20"   tapmode="hover"   onclick="remindWho()">
                <span>提醒谁看</span>
                <span class="spanno2"></span>
            </li>
            <li >
                <span>定向投递</span>
                <span class="spanno2"></span>
            </li>
        </ul>        
    </div>
    <div class="btn">发布</div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript">
var base64Data = [];
    apiready = function(){
        moduleInit();
        getPos();
        getData(base64Data);
        // 选择类别
        monitorEvent('_status','_status');
        // 删除图片
        delImg()
    };

    // 提现谁看
    function remindWho() {
        api.openWin({
            name: 'supply_info_ask_remindWho',
            url: '../supply/supply_info_ask_remindWho.html'
            
        });
    }
    function monitorEvent(eventName, calssName) {
        api.addEventListener({
           name: eventName
        }, function(ret, err) {
           if (ret) {
            $api.text($api.dom('.'+ calssName +''), ret.value.selDate);
           } else {
               alert(JSON.stringify(err));
           }
        });
    }
    // 选择类型  公司 | 个人
    function selectType(ele) {
        var person =  $api.text(ele.getElementsByClassName('spanno2')[0]);

        var _data = $api.attr(ele, 'data-val');
        var flag;
        var _dataSource = [];
        if (_data == '_status') {
            _dataSource = ['知情者1','知情者2','知情者3'];
            flag = 0;
        } 
        api.openFrame({
                name: 'supply_selectType2',
                url: 'supply_selectType.html',
                rect: {
                    x: 0,
                    y: 0,
                    w: 'auto',
                    h: 'auto'
                },
                pageParam: {
                    dataSource: _dataSource,
                    flag: flag,
                    defaultVal: person
                },
                bounces: false
            });

   }

   // 打开时间选择器
   function openTime(ele) {
        var data = $api.attr(ele, 'data-val');
        var text;
        if (data == 'start') {
            text = '选择开始时间'
        } else {
            text = '选择结束时间'
        }
        var date = new Date().getFullYear();
        var date1 = new Date().getMonth();
        var date2 = new Date().getDate();
        api.openPicker({
            type: 'date',
            date: date+'-'+date1+'-'+date2,
            title: text
        }, function(ret, err) {
            if (ret) {
                $api.text(ele, ret.year+'-'+ret.month+'-'+ret.day);
            } else {
                alert(JSON.stringify(err));
            }
        });
   }

   // 获取位置
   function getPos() {
        if (api.systemType == 'ios') {
            bMap.initMapSDK(function(ret,err) {
                console.log(JSON.stringify(err))
                console.log(JSON.stringify(ret))
                if (ret.status) {
                   getLocation();
                   console.log(2)
                } else {
                    alert(JSON.stringify(err))
                }
            });
        } else {
            console.log(22)
            getLocation();
        }
        
   }
   // 获取经纬度
    function getLocation() {
        console.log(3)
        bMap.getLocation({
            accuracy: '100m',
            autoStop: true,
            filter: 1
        }, function(ret, err) {
            if (ret.status) {
                console.log(4)
                alert(JSON.stringify(ret));
                getCoords(ret.lon, ret.lat)
            } else {
                alert(err.code);
            }
        });
    }
    // 根据经纬度获取地址
    function getCoords(lon,lat) {
        bMap.getNameFromCoords({
            lon: lon,
            lat: lat
        }, function(ret, err) {
            if (ret.status) {
                alert(JSON.stringify(ret));
            }
        });
    }

    // 监听删除图片
    function delImg() {
        api.addEventListener({
            name: 'delImg'
        }, function(ret, err) {
            if (ret) {
                for (var i = 0; i < $api.domAll('.imgpage').length; i++) {
                    if (i == (ret.value.imgId-1)) {
                        $api.remove($api.domAll('.imgpage')[i]);
                    }
                }
                base64Data = base64Data.filter(function(item, index) {
                    if (index != ret.value.imgId-1) {
                        return item
                    }
                })
            } else {
                alert(JSON.stringify(err));
            }
        });
    }
    // 打开相册
    function openImg() {

        api.getPicture({
            sourceType: 'album',
            encodingType: 'png',
            mediaValue: 'pic',
            destinationType: 'base64',
            allowEdit: false,
            quality: 70,
            // targetWidth: 100,
            // targetHeight: 100,
            saveToPhotoAlbum: false
        }, function(ret, err) {
            if (ret) {
                base64Data.push(ret.base64Data);
                getData(base64Data);
            } else {
                alert(JSON.stringify(err));
            }
        });
    }
    function openImgPage(ele) {
       var data = $api.attr(ele, 'src'),
            n = parseInt($api.attr(ele, 'data-id'));
        api.openWin({
            name: 'supply_releaseSupply_imgPage_win1',
            url: './supply_releaseSupply_imgPage_win.html',
            bounces: false,
            pageParam: {
                data: data,
                count:  base64Data.length,
                n: n+1
            }
        });
    }
</script>
</html>