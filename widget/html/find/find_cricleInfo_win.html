<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"
    />
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <style type="text/css"></style>
      <style>
        body,
        html {
            position: relative;
        }
        header.header {
            background-color: transparent;
            position: fixed;
            width: 100%;
            z-index: 999;
        }
        header.header .head {
            background-color: transparent;
        }

        header.header span.rightBtn {
            width: .27rem;
              height: .8rem;
            background: url(../../image/icon_find/icon_Share.png)no-repeat;
            background-size: .27rem .37rem;
            background-position: 0 center;
        }

        
    </style>
</head>

<body>
    <header class="header">
        <div class="head">
            <span class="callback"   tapmode   onclick="api.closeWin()">
                返回
            </span>
            <span class="winTitle">
                圈子信息
            </span>
            <!-- <span class="rightBtn"   tapmode   onclick="openPhoto()"></span> -->
        </div>
    </header>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript">
    apiready = function () {
        fnInit();
        api.openFrame({
            name: 'frameName',
            url: './find_cricleInfo_frame.html',
            rect: {
                x: 0,
                y: headerH,
                w: 'auto',
                h: 'auto'
            },
            pageParam: {
                circle_id: api.pageParam.circle_id
            },
            bounces: false
        });
    };
    // 更多联系人
    function openmoreUserInfo() {
        api.openWin({
            name: 'page1',
            url: './page1.html',
            pageParam: {
                name: 'test'
            }
        });
    }
    // 退出圈子
    function quitCircle() {
        api.ajax({
            url: apiSite + '/circle/quit',
            method: 'post',
            headers: apiHeader,
            data: {
                   values: { 
                       token: $api.getStorage('userToken'),
                       circle_id: api.pageParam.circle_id
                   }
            }
        }, function(ret, err) {
            if(ret) {
                if (ret.code == 200) {
                    console.log(JSON.stringify(ret))
                    api.sendEvent({
                        name: 'circleTopicComment'
                    });
                    api.execScript({
                        frameName: 'find_frame',
                        script: 'requestData();'
                    });
                    api.execScript({
                        name: 'find_cricleInfo_win',
                        script: 'requestData();'
                    });
                    api.execScript({
                        name: 'find_dynamicState_win',
                        frameName: 'find_dynamicState_frame',
                        script: 'requestData();'
                    });
                    requestData()
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
    // 进入用户详情
    function openUserInfo(ele) {
        api.openWin({
            name: 'txl_memberInfo_Win',
            url: '../addressList/txl_memberInfo_Win.html',
            pageParam: {
                userId: $api.attr(ele, 'data-id')
            }
        });
    }
    // 编辑名片
    function editNote() {
        api.openWin({
            name: 'find_editNode',
            url: './find_editNode.html',
            pageParam: {
                circle_id: api.pageParam.circle_id,
                note: $api.text($api.byId('note'))

            }
        });
    }
    function openPay() {
        api.openWin({
            name: 'find_payAddCricle_win2',
            url: './find_payAddCricle_win.html',
            pageParam: {
                circle_id: api.pageParam.circle_id
            }
        });
    }
    function requestData() {
        api.ajax({
            url: apiSite + '/circle/detail',
            method: 'post',
            headers: apiHeader,
            data: {
               values: { 
                   token: $api.getStorage('userToken'),
                   circle_id: api.pageParam.circle_id
               }
            }
        }, function(ret, err) {
            console.log(JSON.stringify(ret))
            if(ret) {
                if(ret.code == 200) {
                    if (ret.data.is_member) {
                        $api.css($api.dom('.notJoin'), 'display:none');
                        $api.css($api.dom('.haveJoin'), 'display:block');
                    } else {
                        $api.css($api.dom('.haveJoin'), 'display:none');
                        $api.css($api.dom('.notJoin'), 'display:block');
                    }
                    $api.text($api.byId('circle_name'), ret.data.info.title);
                    $api.text($api.byId('description'), ret.data.info.description);
                    $api.text($api.byId('member_count'), '成员：'+ret.data.info.member_count);
                    $api.text($api.byId('topic_count'), '发布：'+ret.data.info.topic_count);
                    $api.text($api.byId('note'), ret.data.note);
                    $api.attr($api.dom('.imgHead'), 'src', ret.data.info.image_url);
                    $api.attr($api.dom('.imgBg'), 'src', ret.data.info.image_url);
                    console.log("342:::"+JSON.stringify(ret))
                    // for (var i = 0; i < ret.data.member_list.length; i++) {
                    //     ret.data.member_list[i].head_img_url = eval(ret.data.member_list[i].head_img_url)
                    // }
                    getData(ret.data.member_list)
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err.msg))
            }
        })
    }
</script>

</html>