<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"
    />
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <style type="text/css"></style>
      <style>
        body,
        html {
            position: relative;
        }
        header.header {
            background-color: transparent;
            position: fixed;
            width: 100%;
            z-index: 999;
        }
        header.header .head {
            background-color: transparent;
        }

        header.header span.rightBtn {
            width: .27rem;
              height: .8rem;
            background: url(../../image/icon_find/icon_Share.png)no-repeat;
            background-size: .27rem .37rem;
            background-position: 0 center;
        }

        .main {
            background: transparent;
            font-size: 0;
        }

        .main .imgBg {
            width: 7.5rem;
            height: 4.6rem;
        }

        .main .header {
            text-align: center;
            position: relative;
            font-size: 0;
        }

        .main .header .wrap {
            position: absolute;
            top: -1.25rem;
            width: 100%;
            padding: 0 .3rem;
            box-sizing: border-box;
        }

        .main .header span {
            font-size: .24rem;
            position: absolute;
            top: .85rem;
            color: #fff;
        }

        .main .header span:first-child {
            left: .3rem;
        }

        .main .header span:last-child {
            right: .3rem;
        }
        .main .header .imgHead {
            width: 1.72rem;
            height: 1.72rem;
            vertical-align: middle;
        }

        .shadow {
            width: 100%;
            height: 4.6rem;
            background-color: rgba(0, 0, 0, 0.5);
            position: absolute;
            top: 0;
            right: 0;
        }

        .main .title {
            height: 1.8rem;
            background-color: #fff;
            padding: .8rem .3rem .2rem;
            box-sizing: border-box;
            /*margin-bottom: .2rem;*/
            border-bottom: .01rem solid #d9d9d9;
        }

        .title h3 {
            font-weight: 700;
            font-size: .34rem;
            color: #4a4a4a;
            text-align: center;
        }

        .title .circleInfo {
            margin-top: .05rem;
            font-size: .28rem;
            color: #9b9b9b;
        }

        .main .orCode {
            height: .8rem;
            background-color: #fff;
            padding: 0 .3rem;
            border-bottom: .01rem solid #d9d9d9;
        }

        .main .orCode:last-child {
            margin-bottom: .2rem;
            border-bottom: 0;
        }

        .orCode .text {
            font-size: .28rem;
            color: #4a4a4a;
            line-height: .8rem;
            float: left;
        }

        .orCode .iconArrow {
            font-size: .28rem;
            line-height: .8rem;
            padding-right: .4rem;
            color: #4a4a4a;
            float: right;
            display: inline-block;
            width: auto;
            height: .8rem;
            background: url(../../image/icon_zk.png)no-repeat;
            background-position: right center;
            background-size: .15rem .25rem;
        }

        .circleMember {
            font-size: 0;
            padding: .2rem .3rem;
            background-color: #fff;
            margin-top: .2rem;
        }

       

        .circleMember .member .memberInfo {
            margin-right: .55rem;
            margin-bottom: .1rem;
        }

        .circleMember .member .memberInfo:nth-child(5n) {
            margin: 0;
        }

        .circleMember .member img {
            width: .9rem;
            height: .9rem;
            border-radius: 50%
        }

        .circleMember .member .memberName {
            font-size: .24rem;
            margin-top: .1rem;
            text-align: center;
            max-width: .9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .viewMore {
            color: #08BB08;
            font-size: .28rem;
            text-align: center;
            margin-top: .45rem;
        }

        .btn {
            background-color: #D0021B;
            font-size: .36rem;
            text-align: center;
            line-height: .98rem;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            color: #fff;
        }
        .notJoin .warn {
            margin-top: .2rem;
            font-size: .28rem;
            color: #D0021B;
            background-color: #fff;
            height: 1.6rem;
            padding: 0 .3rem;
            text-align: center;
            line-height: 1.6rem;
        }
        .notJoin .btn {
            background: #08B508;
        }
        .haveJoin {
            display: none;
        }
        .notJoin{
            display: none;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="head">
            <span class="callback"   tapmode   onclick="api.closeWin()">
                返回
            </span>
            <span class="winTitle">
                圈子信息
            </span>
            <!-- <span class="rightBtn"   tapmode   onclick="openPhoto()"></span> -->
        </div>
    </header>
     <div class="main">
        <img class="imgBg" src="../../image/tx_4.jpg" alt="">
        <!-- 遮罩 -->
        <div class="shadow"></div>
        <div class="header">
            <div class="wrap">
                <span class="fl" class="" id="member_count" >成员：----</span>
                <img class="imgHead" src="../../image/tx_4.jpg" alt="">
                <span class="fr" id="topic_count" >发布：----</span>
            </div>
        </div>
        <div class="title">
            <h3 id="circle_name">UI设计交流圈</h3>
            <p class="circleInfo">圈介绍：<span id="description">大家都到碗里来</span></p>
        </div>
        <div class="haveJoin">
            <div class="orCode" ontouchstart="editNote()">
                <span class="text" >圈名片</span>
                <span class="iconArrow" id="note" >未设置</span>
            </div>
            <!--<div class="orCode">
                <span class="text">圈二维码</span>
                <span class="iconArrow"></span>
            </div>-->
            <div class="circleMember resultList">
               <!--  <div class="member flex-def flex-wrap">
                        <div class="memberInfo" data-id="{{=it[i].user_id}}" tapmode onclick="openUserInfo(this)">
                            <img src="../../image/tx_1.jpg" alt="">
                            <p class="memberName">{{=it[i].note}}</p>
                        </div>
                </div> -->
            </div>
            <script type="text/x-dot-template" id="listT">
                <div class="member flex-def flex-wrap">
                    {{ for (var i = 0; i < it.length; i++) { }} 
                        <div class="memberInfo" data-id="{{=it[i].user_id}}" tapmode onclick="openUserInfo(this)">
                            <img src="{{=it[i].head_img_url}}" alt="">
                            {{?it[i].note}}
                            <p class="memberName">{{=it[i].note}}</p>
                            {{??}}
                            <p class="memberName">{{=it[i].nickname}}</p>
                            {{?}}
                        </div>
                    {{ }; }}
                </div>
                <!-- <p tapmode onclick="openmoreUserInfo()" class="viewMore">查看更多圈联系人</p> -->
                </script>
            <div class="btn" tapmode onclick="quitCircle()">
                退出圈子
            </div>
        </div>
        <div class="notJoin">
            <!--<div class="orCode">
                <span class="text">圈二维码</span>
                <span class="iconArrow"></span>
            </div>-->
            <div class="warn">
                只有该圈联系人才能查看圈内成员信息
            </div>
            <div class="btn" tapmode onclick="openPay()">
                立即加入
            </div>
        </div>
    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript">
    apiready = function () {
        fnInit();
        // api.openFrame({
        //     name: 'frameName',
        //     url: './find_cricleInfo_frame.html',
        //     rect: {
        //         x: 0,
        //         y: headerH,
        //         w: 'auto',
        //         h: 'auto'
        //     },
        //     pageParam: {
        //         circle_id: api.pageParam.circle_id
        //     },
        //     bounces: false
        // });
        requestData();
    };
    // 更多联系人
    function openmoreUserInfo() {
        api.openWin({
            name: 'page1',
            url: './page1.html',
            pageParam: {
                name: 'test'
            }
        });
    }
    // 退出圈子
    function quitCircle() {
        api.ajax({
            url: apiSite + '/circle/quit',
            method: 'post',
            headers: apiHeader,
            data: {
                   values: { 
                       token: $api.getStorage('userToken'),
                       circle_id: api.pageParam.circle_id
                   }
            }
        }, function(ret, err) {
            if(ret) {
                if (ret.code == 200) {
                    console.log(JSON.stringify(ret))
                    api.sendEvent({
                        name: 'circleTopicComment'
                    });
                    api.execScript({
                        frameName: 'find_frame',
                        script: 'requestData();'
                    });
                    api.execScript({
                        name: 'find_cricleInfo_win',
                        script: 'requestData();'
                    });
                    api.execScript({
                        name: 'find_dynamicState_win',
                        frameName: 'find_dynamicState_frame',
                        script: 'requestData();'
                    });
                    requestData()
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
    // 进入用户详情
    function openUserInfo(ele) {
        api.openWin({
            name: 'txl_memberInfo_Win',
            url: '../addressList/txl_memberInfo_Win.html',
            pageParam: {
                userId: $api.attr(ele, 'data-id')
            }
        });
    }
    // 编辑名片
    function editNote() {
        api.openWin({
            name: 'find_editNode',
            url: './find_editNode.html',
            pageParam: {
                circle_id: api.pageParam.circle_id,
                note: $api.text($api.byId('note'))

            }
        });
    }
    function openPay() {
        api.openWin({
            name: 'find_payAddCricle_win2',
            url: './find_payAddCricle_win.html',
            pageParam: {
                circle_id: api.pageParam.circle_id
            }
        });
    }
    function requestData() {
        api.ajax({
            url: apiSite + '/circle/detail',
            method: 'post',
            headers: apiHeader,
            data: {
               values: { 
                   token: $api.getStorage('userToken'),
                   circle_id: api.pageParam.circle_id
               }
            }
        }, function(ret, err) {
            console.log(JSON.stringify(ret))
            if(ret) {
                if(ret.code == 200) {
                    if (ret.data.is_member) {
                        $api.css($api.dom('.notJoin'), 'display:none');
                        $api.css($api.dom('.haveJoin'), 'display:block');
                    } else {
                        $api.css($api.dom('.haveJoin'), 'display:none');
                        $api.css($api.dom('.notJoin'), 'display:block');
                    }
                    $api.text($api.byId('circle_name'), ret.data.info.title);
                    $api.text($api.byId('description'), ret.data.info.description);
                    $api.text($api.byId('member_count'), '成员：'+ret.data.info.member_count);
                    $api.text($api.byId('topic_count'), '发布：'+ret.data.info.topic_count);
                    $api.text($api.byId('note'), ret.data.note);
                    $api.attr($api.dom('.imgHead'), 'src', ret.data.info.image_url);
                    $api.attr($api.dom('.imgBg'), 'src', ret.data.info.image_url);
                    // for (var i = 0; i < ret.data.member_list.length; i++) {
                    //     ret.data.member_list[i].head_img_url = eval(ret.data.member_list[i].head_img_url)
                    // }
                    getData(ret.data.member_list)
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err.msg))
            }
        })
    }
</script>

</html>