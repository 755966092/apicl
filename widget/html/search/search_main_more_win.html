
<!doctype html>
<html>
    <head>
        <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
        <title>搜索</title>
        <link rel="stylesheet" type="text/css" href="../../css/api.css" />
        <link rel="stylesheet" type="text/css" href="../../css/style.css" />
        <style>
            .top {
                height: 0.8rem;
                width: 7.5rem;
                background-color: #EDECF3;
            }
            .wrap {
                height: 0.8rem;
                width: 7.5rem;
                box-sizing: border-box;
                padding: 0 0.15rem;
            }
            input {
                /* width: 6.35rem; */
                height: 0.5rem;
                margin: 0 .15rem;
                border-radius: .05rem;
                background: #fff url(../../image/icon_supply/icon_search.png)no-repeat;
                background-size: .24rem .24rem;
                background-position: .13rem center;
                box-sizing: border-box;
                padding-left: 0.5rem;
            }
            span {
                color: #0ABB07;
                font-size: 0.3rem;
            }
            .callbackBtn {
                display: inline-block;
                width: 0.22rem;
                height: 0.37rem;
                background: url(../../image/icon_fanh02.png)no-repeat;
                background-size: .22rem .37rem;

            }
        </style>
    </head>
    <body>
        <div class="top ">
            <div class="wrap flex-def flex-cCenter">
                <span tapmode onclick="api.closeWin()" class="callbackBtn"></span>
                <input class="flex-item" type="text" oninput="changeInput(this)">
                <span class="flagText" tapmodu onclick="search(this)">取消</span>
            </div>
        </div>
        <script type="text/javascript" src="../../script/api.js"></script>
        <script type="text/javascript" src="../../script/common.js"></script>
        <script type="text/javascript" src="../../script/pinyin4js.js"></script>
        <script type="text/javascript">
            var headerH;
            apiready = function(){
                $api.val($api.dom('input'), api.pageParam.ret.value.keyword );
                console.log(JSON.stringify(api.pageParam));
                
                moduleInit();
                // 设置状态栏文字颜色
                api.setStatusBarStyle({
                    style: 'dark',
                });
                pageInit();
                api.openFrame({
                    name: 'search_main_more_frame',
                    url: './search_main_more_frame.html',
                    bounces: false,
                    rect: {
                        x: 0,
                        y: headerH,
                        w: 'auto',
                        h: 'auto'
                    },
                    pageParam: {
                        ret: api.pageParam.ret
                    }
                });
            }
            function pageInit() {
                $api.fixStatusBar($api.dom('.top'));
                headerH = $api.offset($api.dom('.top')).h;
            }
            function changeInput(ele) {
                var val = $api.val(ele);
                searchSql(val)
            }
            function searchSql(keyword) {
                if (keyword) {
                    db.selectSql({
                        name: 'db_' + $api.getStorage('userToken'),
                        sql: 'SELECT * FROM addressList WHERE (nickname LIKE "%'+keyword+'%") or (remark_nickname LIKE "%'+keyword+'%") or (remark_current_contact LIKE "%'+keyword+'%") or (current_contact LIKE "%'+keyword+'%")'      
                    },function(retSql,err){
                        if (retSql.status) {
                            if (retSql.data.length > 0) {
                                api.sendEvent({
                                    name: 'searchSqlMore',
                                    extra: {
                                        user: retSql.data,
                                        keyword: keyword
                                    }
                                });
                            }
                        } else {
                            alert(JSON.stringify(ret))
                        }
                    })
                } else {
                    api.sendEvent({
                        name: 'searchSqlMore'
                    });
                }
                
            }
            function search(ele) {
                var text = $api.text(ele);
                if (text === '取消') {
                    // 关闭页面
                    api.closeWin();
                } else { 
                    // 搜索
                    searchResults();
                }
            }
            function searchResults () {
                var keyWord = $api.val($api.dom('input'));

            }
        </script>
    </body>
</html>
