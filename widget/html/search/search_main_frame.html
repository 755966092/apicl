
<!doctype html>
<html>
    <head>
        <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
        <title>搜索</title>
        <link rel="stylesheet" type="text/css" href="../../css/api.css" />
        <link rel="stylesheet" type="text/css" href="../../css/style.css" />
        <style>
            .contactPerso {
                background-color: #fff;
                border-bottom: .01rem solid #d9d9d9;
                margin-bottom: 0.2rem;
            }
            .contactPerso .title {
                height: 0.7rem;
                line-height: 0.7rem;
                box-sizing: border-box;
                padding: 0 .36rem;
                border-bottom: .01rem solid #d9d9d9;
                font-size: 0.26rem;
                color: #7e7e7e;
            }
            .contactPerso img {
                width: 0.7rem;
                height: 0.7rem;
                margin-right: 0.21rem;
            }
            .chatRecord img {
                width: 0.91rem;
                height: 0.91rem;
                border-radius: .1rem;
            }
            .contactPerso ul {
                box-sizing: border-box;
                padding-left: 0.18rem;
            }
            .contactPerso li {
                height: 1.2rem;
                border-bottom: .01rem solid #d9d9d9;
            }
            .IinCircles li {
                height: 1.57rem;
            }
            .chatRecord li {
                height: 1.24rem;
            }
            .supply li {
                height: 1.34rem;
            }
            /* .contactPerso li:last-child {
                border: 0;
            } */
            .contactPerso h3 {
                
                font-size: 0.3rem;
                max-width: 5rem;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            .colorFont {
                color: #27B24A;
            }
            .h3Title {
                max-width: 4rem;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            .contactPerso .text p {
                color: #999;
                font-size: 0.24rem;
                max-width: 5rem;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            .supply .text p {
                color: #000;
                font-size: 0.28rem;
            }
            .seeMore {
                height: 0.8rem;
                line-height: 0.8rem;
                font-size: 0.26rem;
                box-sizing: border-box;
                padding: 0 .25rem;
                color: #4C5F8C;
            }
            .seeMore .icon {
                width: 0.24rem;
                height: 0.24rem;
                background: #fff url(../../image/icon_supply/icon_search.png)no-repeat;
                background-size: .24rem .24rem;
                margin-right: 0.17rem;
            }
            .seeMore .icon2, 
            .web .icon2 {
                width: 0.15rem;
                height: 0.25rem;
                background: #fff url(../../image/icon_zk.png)no-repeat;
                background-size: .15rem .25rem;
                float: right;
            }
            .circleText {
                width: 2.1rem;
            }
            .label {
                width: 0.41rem;
                height: 0.24rem;
                /* background: url(../../image/icon_supply/icon_gs1.png)no-repeat; */
                /* background-size: .41rem .24rem; */
                margin-right: 0.1rem;
                font-size: 0.18rem;
                border-radius: .04rem;
                border: .01rem solid #5D7099;
                color: #5D7099;
                text-align: center;
                line-height: 0.24rem;
            }
            .web {
                height: 1.24rem;
                background-color: #fff;
                box-sizing: border-box;
                padding: 0 .25rem 0 .18rem;
                margin-bottom: 0.2rem;
            }
            .web img {
                width: 0.91rem;
                height: 0.91rem;
                border-radius: .1rem;
                margin-right: 0.19rem;
            }
            .web h3 {
                font-size: 0.3rem;
            }
            .web p {
                font-size: 0.24rem;
                color: #999;
            }
            .defaultTitle {
                padding: .5rem 0;
                color: #999;
                text-align: center;
                font-size: 0.3rem;
            }
            .defaultTable {
                padding: 0.2rem 0;
                text-align: center;
            }
            .defaultTable span {
                font-size: 0.28rem;
                color: #27B24A;
                margin: 0 .3rem;
            }
            

        </style>
    </head>
    <body>
        <div class="resultList">
            <p class="defaultTitle">搜索指定内容</p>
            <p class="defaultTable"><span>一度人脉</span><span>二度人脉</span><span>三度人脉</span></p>
            <p class="defaultTable"><span>一度人脉</span><span>二度人脉</span><span>三度人脉</span></p>
        </div>
        
        <script type="text/x-dot-template" id="listT">
            {{?it.user.length != 0}}
                <div class="contactPerso">
                    <p class="title">一度人脉和初识好友</p>
                    <ul>
                        {{~it.user :value:index}}
                            {{?index<3}}
                                <li class="flex-def flex-cCenter" data-userId={{=value.user_id}} tapmode onclick="openInfo(this)">
                                    <img  src="{{=value.remark_head_img_url?value.remark_head_img_url:value.head_img_url}}" alt="">
                                    <div class="text">
                                        <h3>{{=value.remark_nickname?value.remark_nickname:value.nickname}}</h3>
                                        {{?value.contain}}
                                            <p>{{=value.contain}}</p>
                                        {{??}}
                                        {{?}}
                                    </div>
                                </li>
                            {{?}}
                        {{~}}
                    </ul>
                    {{?it.user.length > 3}}
                        <p class="seeMore flex-def flex-cCenter flex-zBetween" tapmode onclick="openMorePage()">
                                <span class="icon"></span>
                                <span class="flex-item">查看更多</span>
                            <span class="icon2"></span>
                        </p>
                    {{?}}
                </div>
            {{?}}
            <div class="web flex-def flex-cCenter flex-zBetween" tapmode onclick="searcWeb('{{=it.keyword}}')">
                <img src="../../image/iocn_addressList/icon_search.png" alt="">
                <div class="flex-item">
                    <h3>搜一搜 {{=it.keyword}}</h3>
                    <!-- <h3>搜一搜二度人脉 {{=it[it.length-1]}}</h3> -->
                    <!-- <p>人脉、供求、项目、我在圈等</p> -->
                </div>
                <div class="icon2"></div>
            </div>
        </script>
        <!-- <div class="contactPerso">
            <p class="title">联系人</p>
            <ul>
                <li class="flex-def flex-cCenter">
                    <img  src="../../image/tx_1.jpg" alt="">
                    <div class="text">
                        <h3>姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名</h3>
                        <p>简介</p>
                    </div>
                </li>
                <li class="flex-def flex-cCenter">
                        <img  src="../../image/tx_1.jpg" alt="">
                        <div class="text">
                            <h3>姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名</h3>
                            <p>简介</p>
                        </div>
                    </li>
            </ul>
            <p class="seeMore flex-def flex-cCenter flex-zBetween">
                    <span class="icon"></span>
                    <span class="flex-item">查看更多联系人</span>
                <span class="icon2"></span>
            </p>
        </div> -->
        <!-- <div class="contactPerso chatRecord">
                <p class="title">聊天记录</p>
                <ul>
                    <li class="flex-def flex-cCenter">
                        <img  src="../../image/tx_1.jpg" alt="">
                        <div class="text">
                            <h3>姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名</h3>
                            <p>简介</p>
                        </div>
                    </li>
                    <li class="flex-def flex-cCenter">
                            <img  src="../../image/tx_1.jpg" alt="">
                            <div class="text">
                                <h3>姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名</h3>
                                <p>简介</p>
                            </div>
                        </li>
                </ul>
                <p class="seeMore flex-def flex-cCenter flex-zBetween">
                        <span class="icon"></span>
                        <span class="flex-item">查看更多聊天记录</span>
                    <span class="icon2"></span>
                </p>
            </div>
        
        <div class="contactPerso IinCircles">
                <p class="title">我在圈</p>
                <ul>
                    <li class="flex-def flex-cCenter">
                        <img  src="../../image/tx_1.jpg" alt="">
                        <div class="text">
                            <h3>姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名</h3>
                            <p>简介</p>
                            <p><span class="circleText">成员: 10001</span><span class="circleText">发布: 10001</span></p>
                        </div>
                    </li>
                    <li class="flex-def flex-cCenter">
                            <img  src="../../image/tx_1.jpg" alt="">
                            <div class="text">
                                <h3>姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名</h3>
                                <p>简介</p>
                                <p><span class="circleText">成员: 10001</span><span class="circleText">发布: 10001</span></p>
                            </div>
                        </li>
                </ul>
                <p class="seeMore flex-def flex-cCenter flex-zBetween">
                        <span class="icon"></span>
                        <span class="flex-item">查看更多我在圈</span>
                    <span class="icon2"></span>
                </p>
            </div>
        <div class="contactPerso supply">
            <p class="title">供</p>
            <ul>
                <li class="flex-def flex-cCenter">
                    <img  src="../../image/tx_1.jpg" alt="">
                    <div class="text">
                        <h3 class="flex-def flex-cCenter"><span class="label">个人</span><span class="h3Title">姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名</span></h3>
                        <p>简介</p>
                    </div>
                </li>
            </ul>
            <p class="seeMore flex-def flex-cCenter flex-zBetween">
                    <span class="icon"></span>
                    <span class="flex-item">查看更多供</span>
                <span class="icon2"></span>
            </p>
        </div>
        <div class="contactPerso supply">
            <p class="title">求</p>
            <ul>
                <li class="flex-def flex-cCenter">
                    <img  src="../../image/tx_1.jpg" alt="">
                    <div class="text">
                            <h3 class="flex-def flex-cCenter"><span class="label">公司</span><span class="h3Title">姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名</span></h3>
                        <p>简介</p>
                    </div>
                </li>
            </ul>
            <p class="seeMore flex-def flex-cCenter flex-zBetween">
                    <span class="icon"></span>
                    <span class="flex-item">查看更多求</span>
                <span class="icon2"></span>
            </p>
        </div>
        <div class="contactPerso project">
            <p class="title">项目</p>
            <ul>
                <li class="flex-def flex-cCenter">
                    <img  src="../../image/tx_1.jpg" alt="">
                    <div class="text">
                            <h3 class="flex-def flex-cCenter"><span class="h3Title">姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名姓名</span><span class="label">公司</span></h3>
                        <p>简介</p>
                    </div>
                </li>
            </ul>
            <p class="seeMore flex-def flex-cCenter flex-zBetween">
                    <span class="icon"></span>
                    <span class="flex-item">查看更多项目</span>
                <span class="icon2"></span>
            </p>
        </div> -->
        <!-- <div class="web flex-def flex-cCenter flex-zBetween">
            <img src="../../image/tx_1.jpg" alt="">
            <div class="flex-item">
                <h3>搜一搜 啦啦</h3>
                <p>人脉、供求、项目、我在圈等</p>
            </div>
            <div class="icon2"></div>
        </div> -->
        <script type="text/javascript" src="../../script/api.js"></script>
        <script type="text/javascript" src="../../script/common.js"></script>
        <script type="text/javascript" src="../../script/doT.min.js"></script>
        <script type="text/javascript">
            var user;
            apiready = function(){
                api.addEventListener({
                    name: 'searchSql'
                }, function(ret, err){
                    if (ret.value.user) {
                        user = ret;
                        renderPage(ret)
                    } else{
                        // 搜索结果为空的时候清空页面
                        // getData();
                        $api.html($api.dom('.resultList'), '<p class="defaultTitle">搜索指定内容</p><p class="defaultTable"><span>一度人脉</span><span>二度人脉</span><span>三度人脉</span></p><p class="defaultTable"><span>一度人脉</span><span>二度人脉</span><span>三度人脉</span></p>');
                    }
                });
                api.addEventListener({
                    name: 'searchSqlMore'
                }, function(ret, err){
                    if (ret.value) {
                        user = ret;
                        renderPage(ret)
                    } else {
                        // 搜索结果为空的时候清空页面
                        // getData([]);
                        $api.html($api.dom('.resultList'), '<p class="defaultTitle">搜索指定内容</p><p class="defaultTable"><span>一度人脉</span><span>二度人脉</span><span>三度人脉</span></p><p class="defaultTable"><span>一度人脉</span><span>二度人脉</span><span>三度人脉</span></p>');
                    }
                });
            }
            function openInfo(ele) {
                api.openWin({
                    name: 'txl_memberInfo_Win',
                    url: '../addressList/txl_memberInfo_Win.html',
                    bounces: false,
                    pageParam: {userId : $api.attr(ele, 'data-userId')}
                });
            }
            function renderPage(ret) {
                // ret.value.user.push(ret.value.keyword)
                for (var i = 0; i < ret.value.user.length; i++) {
                    if(i<3) {
                        var element = ret.value.user[i];
                        var reg = new RegExp(ret.value.keyword, '');
                        // 替换搜索关键字
                        if(element.remark_nickname) {
                            element.remark_nickname = element.remark_nickname.replace(reg, '<span class="colorFont">'+ ret.value.keyword +'</span>')
                        }
                        if(element.nickname) {
                            element.nickname = element.nickname.replace(reg, '<span class="colorFont">'+ ret.value.keyword +'</span>')
                        }
                        element.contain = '';
                        if (element.current_contact) {
                            if(element.current_contact.indexOf(ret.value.keyword) != -1){
                                element.current_contact = element.current_contact.replace(reg, '<span class="colorFont">'+ ret.value.keyword +'</span>');
                                element.contain += '电话: '+element.current_contact + ' '; 
                            }
                        }
                        if (element.remark_current_contact) {
                            if(element.remark_current_contact.indexOf(ret.value.keyword) != -1){
                                element.remark_current_contact = element.remark_current_contact.replace(reg, '<span class="colorFont">'+ ret.value.keyword +'</span>')
                                if(element.remark_current_contact != element.current_contact) {
                                    element.contain += '备注电话: '+element.remark_current_contact;
                                }
                            }
                        }
                    }
                }
                getData(ret.value);
            }
            // 查看更多联系人
            function openMorePage() {
                
                api.openWin({
                    name: 'winname',
                    url: './search_main_more_win.html',
                    bounces: false,
                    pageParam: {
                        ret: user
                    }
                });
                // 修改顶部搜索框
               
            }
            // 搜索网络
            function searcWeb(keyword) {
                console.log(keyword);
                if (keyword) {
                    api.ajax({
                        url: apiSite + '/user/search',
                        method: 'post',
                        headers: apiHeader,
                        data: {
                            values: { 
                                token: $api.getStorage('userToken'),
                                keyword: keyword
                            }
                        }
                    }, function(ret, err) {
                        if(ret) {
                            if (ret.code === 200) {
                                console.log(JSON.stringify(ret));
                                if (ret.data.list.length == 0) {
                                    api.alert({
                                        title: '该用户不存在', 
                                        msg: '无法找到该用户, 请检查您填写的号码是否正确'
                                    });
                                } else {
                                    api.openWin({
                                        name: 'search_main_more_win',
                                        url: './search_main_more_win.html',
                                        bounces: false,
                                        pageParam: {
                                            ret: {
                                                value: {
                                                    keyword: keyword,
                                                    user: ret.data.list
                                                }
                                            }
                                        }
                                    });
                                }
                            } else {
                                alert(ret.msg)
                            }
                        } else {
                            alert(JSON.stringify(err))
                        }
                    })
                }
            }
        </script>
    </body>
</html>
