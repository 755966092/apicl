<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <style>
        body,
        html {
            background-color: #EFEFF4;
        }
        
        .main {
            padding: 0 .3rem;
            height: .6rem;
            font-size: 0rem;
            margin-top: .2rem;
            margin-bottom: .2rem;
            position: relative;
        }
        
        input {
            outline: none;
            height: .6rem;
            font-size: .24rem;
            width: 100%;
            padding-left: .5rem;
            box-sizing: border-box;
            background: #fff url(../../image/icon_supply/icon_search.png)no-repeat;
            background-size: .25rem .25rem;
            background-position: .2rem center;
        }
        
        .clearIcon {
            width: .13rem;
            height: .6rem;
            background: url(../../image/icon_other/icon_clear.png)no-repeat;
            -webkit-background-size: .13rem .13rem;
            background-size: .13rem .13rem;
            background-position: 0 center;
            position: absolute;
            right: .5rem;
            top: 0;
            display: none;
        }
        
        .hisSear {
            font-size: 0;
            height: .74rem;
            padding: 0 .3rem;
            background-color: #F8F8F8;
        }
        
        .hisSearTitle {
            font-size: .28rem;
            line-height: .74rem;
            color: #333;
        }
        
        ul {
            background-color: #F8F8F8;
        }
        
        ul li {
            padding: 0 .3rem;
            /*border-bottom: .01rem solid #C8C8C8;*/
            font-size: .28rem;
            color: #777;
            line-height: .8rem;
            box-shadow: 0 1px #c8c8c8;
            /*height: .8rem;*/
        }
        
        .textContent {
            font-size: .24rem;
            line-height: .33rem;
            width: 5.19rem;
            margin: 0 auto;
            color: #8e8e8e;
            margin-top: .2rem;
        }
        
        .hisSearIcon {
            display: inline-block;
            width: .25rem;
            height: .8rem;
            float: right;
            background: url(../../image/icon_other/icon_delet.png)no-repeat;
            -webkit-background-size: .25rem .28rem;
            background-size: .25rem .28rem;
            background-position: 0 center;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="head">
            <span class="callback" tapmode onclick="api.closeWin()">
                返回
            </span>
            <span class="winTitle">
                找人
            </span>
        </div>
    </header>
    <div class="main">
        <!-- <span class="icon_search"></span> -->
        <form>
            <input type="search" name="" id="ipt" placeholder="搜索">
        </form>
        <span class="clearIcon" tapmode onclick="clearText()"></span>
    </div>
    <div class="fellow">
        <!--  <div class="hisSear">
            <span class="hisSearTitle">历史搜索</span>
            <span class="hisSearIcon"   tapmode   onclick="deletHis()"></span>
        </div> -->

        <ul class="resultList"></ul>
        <script type="text/x-dot-template" id="listT">
            {{ for (var i = 0; i
            < it.length; i++) { }} <li class="{{=it[i].select}} chatList" data-targetId="{{=it[i].targetId}}" data-nickname="{{=it[i].nickname}}" tapmode onclick="openChat(this)">
                <li>{{=it[i]}}</li>
                {{ }; }}
        </script>
        <p class="textContent">
            不管您是想找到曾经的发小或是同桌，还是某个项目的关系人，我们都可以帮助您。在上面的搜索栏输入您想找人的信息，如姓名、手机号码。
            <!-- 不管您是想找到曾经的发小或是同桌，还是某个项目的关系人，我们都可以帮助您。在上面的搜索栏输入您想找人的信息，如姓名、公司、行业等，您输入的信息越多，我们找到的信息就会越精准。 -->
        </p>
    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript">
    var hisDataArr = [],
        n = 1;
    apiready = function() {
        moduleInit();
        fnInit();
        // 
    };

    function jianpan() {
        var UIInput = api.require('UIInput');
        UIInput.open({
            rect: {
                x: 200,
                y: 0,
                w: api.winWidth,
                h: 40
            },
            styles: {
                bgColor: '#fff',
                size: 14,
                color: '#000',
                placeholder: {
                    color: '#ccc'
                }
            },
            autoFocus: true,
            maxRows: 4,
            placeholder: '这是一个输入框',
            keyboardType: 'number',
            fixedOn: api.frameName
        }, function(ret, err) {
            if (ret) {
                // // console.log(JSON.stringify(ret));
            } else {
                alert(JSON.stringify(err));
            }
        });
    }
    $api.dom('form').onsubmit = function() {
        return false;
    };
    $api.addEvt($api.byId('ipt'), 'keyup', function(e) {
        if (api.pageParam.type == 'web') {
            if (e.keyCode == 13) {
                searchFellow();
            }
        } else if (api.pageParam.type == 'mix') {
            if (e.keyCode == 13) {
                searchFellow();
            }
        } else {
            if (e.keyCode == 13) {
                searchFellow();
            }
        }

        if (api.systemType == 'ios') {
            keyUp($api.byId('ipt'))
        }
    });

    function deletHis() {
        hisDataArr = [];
        // 历时搜索
        // getData(hisDataArr);
    }

    function clearText() {
        $api.val($api.byId('ipt'), '');
        $api.css($api.dom('.clearIcon'), 'display:none');
        api.closeFrame({
            name: 'fellowSearchFruit'
        });
        // getData(hisDataArr);
    }

    function keyUp(ele) {
        // alert('keyup')
        // if (event.keyCode == 13) {
        var val = $api.val(ele);
        if (val == '') {
            $api.css($api.dom('.clearIcon'), 'display:none');
            // api.closeFrame({
            //     name: 'fellowSearchFruit'
            // });
            // getData(hisDataArr);
        } else {
            $api.css($api.dom('.clearIcon'), 'display:inline-block');
        }
        // }

    }

    function searchFellow() {
        var val = $api.val($api.byId('ipt'));
        // hisDataArr.push(val);
        // // 输入框为空的关闭搜索结果页面
        if (api.pageParam.type == 'web') {
            // 网络数据
            if (val) {
                api.ajax({
                    url: apiSite + '/user/search',
                    method: 'post',
                    headers: apiHeader,
                    data: {
                        values: {
                            token: $api.getStorage('userToken'),
                            keyword: val
                        }
                    }
                }, function(ret, err) {
                    if (ret) {
                        if (ret.code == 200) {
                            console.log(JSON.stringify(ret))
                            openPage(ret.data.list);
                            api.sendEvent({
                                name: 'addf',
                                extra: {
                                    val: ret.data.list
                                }
                            });
                        } else {
                            alert(ret.msg)
                        }
                    } else {
                        alert(JSON.stringify(err))
                    }

                })
            }
        } else {
            // 本地数据
            if (val) {
                sqlSearch(val)
            }
        }
    }

    function searchFellowMix() {
        var val = $api.val($api.byId('ipt'));
        // hisDataArr.push(val);
        // // 输入框为空的关闭搜索结果页面
        // 网络数据
        api.ajax({
            url: apiSite + '/user/search',
            method: 'post',
            headers: apiHeader,
            data: {
                values: {
                    token: $api.getStorage('userToken'),
                    keyword: val
                }
            }
        }, function(ret, err) {
            if (ret) {
                if (ret.code == 200) {
                    // // console.log(JSON.stringify(ret))
                    // 本地数据
                    // db.selectSql({
                    //     name: 'db_' + $api.getStorage('userToken'),
                    //     sql: 'SELECT * FROM addressList WHERE (nickname LIKE "%'+val+'%") or (remark_nickname LIKE "%'+val+'%") or (remark_current_contact LIKE "%'+val+'%")'     
                    // },function(retSql,err){
                    //     if (retSql.status) {
                    // 打开页面事件只执行一次
                    if (ret.data.list.length != 0) {
                        openPage(ret.data.list);
                        api.sendEvent({
                            name: 'addf',
                            extra: {
                                val: ret.data.list
                            }
                        });
                    } else {
                        openPage(ret.data.list);
                        api.sendEvent({
                            name: 'addf',
                            extra: {
                                val: ret.data.list
                            }
                        });
                    }
                    //     }else {
                    //         api.alert({msg:err.msg});
                    //     }
                    // });
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }

        })

    }
    // w本地查询
    function sqlSearch(val) {
        db.selectSql({
            name: 'db_' + $api.getStorage('userToken'),
            sql: 'SELECT * FROM addressList WHERE (nickname LIKE "%' + val + '%") or (remark_nickname LIKE "%' + val + '%") or (remark_current_contact LIKE "%' + val + '%")'
        }, function(retSql, err) {
            if (retSql.status) {
                // // // console.log('本地查询:::'+JSON.stringify(retSql))
                // 打开页面事件只执行一次
                if (retSql.data.length != 0) {
                    openPage(retSql.data);
                    api.sendEvent({
                        name: 'addf',
                        extra: {
                            val: retSql.data
                        }
                    });
                } else {
                    api.toast({
                        msg: '暂无信息'
                    });
                }
            } else {
                api.alert({
                    msg: err.msg
                });
            }
        });
    }

    function openPage(list) {
        // // console.log(JSON.stringify(list))
        var heig = headerH + $api.offset($api.dom('.main')).h + 20;
        n = 0;
        api.openFrame({
            name: 'fellowSearchFruit',
            url: './txl_fellowSearchFruit.html',
            rect: {
                x: 0,
                y: heig,
                w: 'auto',
                h: 'auto'
            },
            pageParam: {
                val: list
            },
            bounces: false
        });
    }
</script>

</html>