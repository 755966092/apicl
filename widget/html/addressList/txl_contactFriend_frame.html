<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/flex.css"/>
    <style type="text/css">
        p {
            text-align: center;
            font-size: .34rem;
            color: #555;
            margin-top: .5rem;
            display: none;
        }
    </style>
</head>
<body>
     <p>暂无初识好友</p>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript" src="../../script/pinyin4js.js"></script>
<script type="text/javascript">
    apiready = function(){
        moduleInit();
        query(1);
    };
    // 查询数据库
    function query(condition) {
        console.log('查询')
        // 查询条件 condition
        var SQLName = 'db_'+$api.getStorage('userToken');
        var SQLsentence;
        if (condition) {
            SQLsentence = 'SELECT * FROM addressList WHERE type = ' + condition; 
        } else {
            SQLsentence = 'SELECT * FROM addressList';
        }
        console.log('查询2')
        // 查询数据库
        db.selectSql({
            name: SQLName,
            sql: SQLsentence
        }, function(ret, err) {
            if (ret.status) {
                console.log('查询3')
                dakai(paixv(ret.data))
                console.log('查询数据库'+JSON.stringify(ret))
                if (ret.data == null) {
                    $api.css($api.dom('p'), 'display:block');
                }
            } else {
                console.log(JSON.stringify(err));
            }
        });
    }
     // 是否是字母
    function f_check_uppercase(obj)   {          
       if (/[A-Z]/.test(obj))    {   
          return true;   
       }    
       return false;   
    }   
    function paixv (data) {
        console.log('排序函数1')
        for (var i = 0; i < data.length; i++) {
                if (f_check_uppercase(data[0].flag)) {
                    data[0].initial = data[0].flag;
                } else {
                    data[0].initial = '#';
                }
                if (i>0) {
                    if (data[i].flag !== data[i-1].flag) {
                        if (f_check_uppercase(data[i].flag)) {
                            data[i].initial = data[i].flag;
                        } else {
                            data[i].initial = '#';
                        }
                    }
                }
             }
            // for (var i = 0; i < data.length; i++) {
            //     if (data[i].initial == '#') {
            //         console.log(JSON.stringify(data[i]))
            //     }
            // }
            var arr = {}
            var a;
            for (var i = 0; i < data.length; i++) {
                if (data[i].initial) {
                //     if (data[i].initial == "#") {
                //         console.log(666)
                //         if (arr[data[i].initial]) {
                //             arr[data[i].initial].push (data[i])
                //             console.log(888)
                //         } else {
                //             arr[data[i].initial] = [];
                //             arr[data[i].initial].push (data[i])
                //             console.log(777)
                //         }
                //     } else {
                        arr[data[i].initial] = [];
                        a = i;
                    // }
                } 
                arr[data[a].initial].push (data[i])
            }
            // console.log(JSON.stringify(arr))
            // console.log('处理完的数据:'+JSON.stringify(arr))
            console.log('排序函数2')
            return arr;

    }
    function dakai(data1) {
        console.log('排序函数1')
        // var searchHei = $api.offset($api.dom('.search')).h
        listContact.open({
                x : 0,
                y : 0,
                w : api.frameWidth,
                h : api.frameHeight,
                bgColor: '#f8f8f8',
                // 分割线颜色
                borderColor: '#EDEDED',
                // rightBtn: [{
                //     color: '#000',
                //     title: '备注'
                // },{
                //     color: '#000',
                //     title: '删除'
                // }],
                imgHeight: 32,
                groupTitle: {
                    color: '#999',       
                    size: 14,   
                    bgColor: '#f8f8f8'
                },
                rightBg: '#fff',
                indicator: {
                    bgColor: 'rgba(0,0,0,0)',
                    color: '#5A5A5A'
                },
                cellBgColor: '#fff',
                // 搜索框
                // searchBar: {
                //     bgColor: '#fff',         //（可选项）搜索条背景色，字符串，默认透明，支持 rgb，rgba，#
                //     placeholder: '搜索'      //（可选项）搜索条提示文字，字符串类型，默认空，不传则不显示提示文字
                // },
                data: data1,
                fixedOn: api.frameName
            }, function(ret, err) {
                if (ret) {
                    // if (ret){
                    //     alert(JSON.stringify(ret))
                    // }
                    if (ret.clickType == 0) {
                        // 获取点击联系人信息
                        // alert(JSON.stringify(data1[ret.key][ret.index]));  
                        addFriends();
                    }
                    
                } else {
                    // alert(JSON.stringify(err.msg));  
                }
            });
    }
    // 打开人脉详情
    function addFriends() {
        api.openWin({
            name: 'txl_memberInfo_Win',
            url: './txl_memberInfo_Win.html',
            pageParam: {
                name: 'value'
            }
        });
    }
</script>
</html>




