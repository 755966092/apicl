<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/flex.css"/>
   <style type="text/css">
        html,body {
            background-color: #f8f8f8;
        }
       .main {

       }
        .search {
            height: .5rem;
            line-height: .5rem;
            background-color: #fff;
            margin: .2rem 0 0 0;
            text-align: center;
            font-size: 0;
        }
        .search .searchIcon {
            display: inline-block;
            width: .26rem;
            height: .5rem;
            background: url(../../image/icon_search.png)no-repeat;
            -webkit-background-size: .25rem .26rem;
            background-size: .25rem .26rem;
            background-position: 0 center;
            vertical-align: top;
        }
        .search .searchText {
            font-size: .24rem;
        }

        
        .list {
            background-color: #fff;
        }
        .list .item {
            font-size: 0;
            height: 1rem;
            box-sizing: border-box;
            padding: 0 .3rem 0 .3rem;
            overflow: hidden;
            border-bottom: 1px solid #f7f7f7;

            display: -webkit-box; /* 老版本语法: Safari, iOS, Android browser, older WebKit browsers. */
            display: -moz-box; /* 老版本语法: Firefox (buggy) */
            display: -ms-flexbox; /* 混合版本语法: IE 10 */
            display: -webkit-flex; /* 新版本语法: Chrome 21+ */
            display: flex; /* 新版本语法: Opera 12.1, Firefox 22+ */

            -webkit-box-align: center;
            -moz-align-items: center;
            -webkit-align-items: center;
            align-items: center;
        }
        .list .item img {
            margin-right: .1rem;
            margin-left: .1rem;
            width: .64rem;
            height: .64rem;
        }
        .list .item .title {
            width: 5rem;
        }
        .list .item .title .name {
            font-size: .28rem;
            white-space:nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .list .item .title .position {
            font-size: .24rem;
            white-space:nowrap;
            overflow: hidden;
            text-overflow: ellipsis;

        }
       
        .slidePage {
            /*width: .3rem;*/

            position: fixed;
            right: .1rem;
            top: 2rem;
            height: 100%;
            font-size: .24rem;
        }
        .slidePage a{
            display: block;
            text-align: center;
        }
        .groupTitle {
            font-size: .24rem;
            padding: .1rem .3rem;
            background-color: #F0F0F6;
        }
   </style>
</head>
<body>
   
       <!--  <ul class="list clearfix">
            <li onclick="selPerson(this)" data-val='no1'>
                <span class="sel"></span>
                <img src="../../image/tx_3.jpg">
                <div class="title">
                    <h3 class="name">Name1</h3>
                    <p class="position">第一学科技公司 董事长</p>
                </div>
            </li>
        </ul> -->
      <!--   <div class=" list resultList"></div>
        <script type="text/x-dot-template" id="listT">
        {{ for (var i = 0; i < it.length; i++) { }} 
            {{?it[i].flag}}
                <p id="{{=it[i].flag}}" class="groupTitle">{{=it[i].flag}}</p>
            {{? }}
            <div data-userId='{{=it[i].user_id}}' data-name={{=it[i].nickname}} class="item" onclick="selPerson(this)" data-val='no1'>
               
                <img src="{{=it[i].head_img_url}}">
                <div class="title">
                    <h3 class="name">{{=it[i].nickname}}</h3>
                    <p class="position">{{=it[i].current_company}}&nbsp;&nbsp;{{=it[i].current_position}}</p>
                </div>
            </div>
        {{ }; }}
        </script>
    </div>
    <div class="slidePage">
        <a href="#A">A</a>
        <a href="#B">B</a>
        <a href="#C">C</a>
        <a href="#D">D</a>
        <a href="#E">E</a>
        <a href="#F">F</a>
        <a href="#G">G</a>
        <a href="#H">H</a>
        <a href="#I">I</a>
        <a href="#J">J</a>
        <a href="#K">K</a>
        <a href="#L">L</a>
        <a href="#M">M</a>
        <a href="#N">N</a>
        <a href="#O">O</a>
        <a href="#P">P</a>
        <a href="#Q">Q</a>
        <a href="#R">R</a>
        <a href="#S">S</a>
        <a href="#T">T</a>
        <a href="#U">U</a>
        <a href="#V">V</a>
        <a href="#W">W</a>
        <a href="#X">X</a>
        <a href="#Y">Y</a>
        <a href="#Z">Z</a>
        <a href="#">#</a>
    </div> -->
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript" src="../../script/pinyin4js.js"></script>
<script type="text/javascript">
    apiready = function(){
        moduleInit();
        // requestData()
        query();
    };

      // 查询数据库
    function query() {
         var SQLName = 'db_'+$api.getStorage('userToken');
        // 查询数据库
        db.selectSql({
            name: SQLName,
            sql: 'SELECT * FROM addressList'
        }, function(ret, err) {
           
            if (ret.status) {
                dakai(paixv(ret.data))
            } else {
                console.log(JSON.stringify(err));
            }
        });
    }


function paixv (data) {
    for (var i = 0; i < data.length; i++) {
            // console.log("letter+++:"+data[i].litter)
             data[0].initial = data[0].flag
             // data[i].flag = data[i].litter[0]
             
            if (i>0) {
                if (data[i].flag !== data[i-1].flag) {
                    // console.log("letter+++:"+data[i].litter)
                    data[i].initial = data[i].flag;
                    // console.log("flag+++:"+data[i].flag)
                }
            }
         }
        // console.log('数据：'+JSON.stringify(data))
        var arr = {}
        var a;
        for (var i = 0; i < data.length; i++) {
            
            if (data[i].initial) {
                arr[data[i].initial] = [];
                a = i;
            } 
            // if (data[a].initial ) {
                
            // }
            arr[data[a].initial].push (data[i])
        }
        return arr;
    }
   


    // 请求数据
    function requestData() {
        api.ajax({
            url: apiSite + '/api/contact/index',
            method: 'post',
            headers: apiHeader,
            data: {
               values: { 
                  token: $api.getStorage('userToken'),
               }
            }
       }, function(ret, err) {
            for (var i = 0; i < ret.data.unavailable_list.length; i++) {
                // ret.data.unavailable_list[i].litter = ConvertPinyin(ret.data.unavailable_list[i].nickname);
                 ret.data.unavailable_list[i].litter = PinyinHelper.getShortPinyin(ret.data.unavailable_list[i].nickname).toUpperCase();
                ret.data.unavailable_list[i].title = ret.data.unavailable_list[i].nickname;
                ret.data.unavailable_list[i].img = ret.data.unavailable_list[i].head_img_url;
                ret.data.unavailable_list[i].titleSize = 15;
                if (ret.data.unavailable_list[i].current_position == null) {
                    ret.data.unavailable_list[i].current_position = '';
                } 
                if (ret.data.unavailable_list[i].current_company == null) {
                    ret.data.unavailable_list[i].current_company = '';
                }
            }
            // 模块数据格式
            // console.log(JSON.stringify(ret.data.unavailable_list))
            var data1 = litterSort(ret.data.unavailable_list)
            dakai(data1)
       })
           
    }
    // 排序
    function litterSort(data) {
        for (var i = 0; i < data.length; i++) {
            for (var j = 0; j < data.length; j++) {
                if (data[i].litter < data[j].litter) {
                    var temp = data[i];
                    data[i] = data[j];
                    data[j] = temp;
                }
            }
         }
         for (var i = 0; i < data.length; i++) {
             data[0].flag = data[0].litter[0]
            if (i>0) {
                if (data[i].litter[0] !== data[i-1].litter[0]) {
                    data[i].flag = data[i].litter[0]
                }
            }
         
         }
        var arr = {}
        for (var i = 0; i < data.length; i++) {
            var a;
            if (data[i].flag) {
                arr[data[i].flag] = [];
                a = i;
            }
            arr[data[a].flag].push (data[i])
        }
        return arr;
    }
    function dakai(data1) {
        console.log(data1);
        listContact.open({
                x : 0,
                y : 0,
                w : api.frameWidth,
                h : api.frameHeight,
                bgColor: '#f8f8f8',
                // 分割线颜色
                borderColor: '#EDEDED',
                // rightBtn: [{
                //     color: '#000',
                //     title: '备注'
                // },{
                //     color: '#000',
                //     title: '删除'
                // }],
                imgHeight: 32,
                groupTitle: {
                    color: '#999',       
                    size: 14,   
                    bgColor: '#f8f8f8'
                },
                rightBg: '#fff',
                indicator: {
                    bgColor: 'rgba(0,0,0,0)',
                    color: '#5A5A5A'
                },
                cellBgColor: '#fff',
                // 搜索框
                // searchBar: {},
                data: data1,
                fixedOn: api.frameName
            }, function(ret, err) {
                if (ret) {
                    // alert(JSON.stringify(ret));  
                    
                } else {
                    // alert(JSON.stringify(err));  
                }
            });
    }
</script>
</html>




