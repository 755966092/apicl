<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"
    />
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/weui.css" />
    <style>
        body {
            padding: .1rem 0;
        }

        .title {
            font-size: 0.28rem;
            color: #999;
            padding: .1rem .3rem;
        }

        .listDate {
            font-size: 0.28rem;
            color: #999;
            max-width: 6rem;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .weui-cell_swiped {
            background: #FF3B30;
        }
    </style>
</head>

<body>
    <div class="resultList"></div>
    <!-- <div class="weui-cells__title">该联系人添加于</div>
    <div class="weui-cells">
        <a class="weui-cell weui-cell_access" href="javascript:;" tapmpde onclick="openNewPage()">
            <div class="weui-cell__bd">
                <p class="listDate">2017年12月22</p>
                <p>北京创业大厦</p>
            </div>
            <div class="weui-cell__ft">
            </div>
        </a>
    </div>
    <div>
        <div class="weui-cells__title">介绍人</div>
        <div class="weui-cells">
            <div class="weui-cell weui-cell_swiped" ontouchstart="gtouchstart(this)" ontouchmove="gtouchmove(this)" ontouchend="gtouchend(this)">
                <div class="weui-cell__bd item">
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <img src="../../image/tx_2.jpg" alt="" style="width:.7rem;margin-right:5px;display:block">
                        </div>
                        <div class="weui-cell__bd">
                            <p>杨慧</p>
                            <p class="listDate">北京环球壹学教育科技有限公司 市场总监</p>
                        </div>
                    </div>
                </div>
                <div class="weui-cell__ft flex-def flex-cCenter">
                    <a class="weui-swiped-btn weui-swiped-btn_warn" href="javascript:">删除</a>
                </div>
            </div>
        </div>
    </div>
    <div>
        <div class="weui-cells__title">对方妻子</div>
        <div class="weui-cells">
            <div class="weui-cell weui-cell_swiped" ontouchstart="gtouchstart(this)" ontouchmove="gtouchmove(this)" ontouchend="gtouchend(this)">
                <div class="weui-cell__bd item">
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <img src="../../image/tx_2.jpg" alt="" style="width:.7rem;margin-right:5px;display:block">
                        </div>
                        <div class="weui-cell__bd">
                            <p>刘亦菲</p>
                            <p class="listDate">北京传媒学院 学生</p>
                        </div>
                    </div>
                </div>
                <div class="weui-cell__ft flex-def flex-cCenter">
                    <a class="weui-swiped-btn weui-swiped-btn_warn" href="javascript:">删除</a>
                </div>
            </div>
        </div>
    </div> -->
    <script type="text/x-dot-template" id="listT">
        <div class="weui-cells__title">该联系人添加于</div>
        <div class="weui-cells">
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmpde onclick="openNewPage()">
                <div class="weui-cell__bd">
                    {{?it.relation_info}}
                    <p class="listDate">{{=it.relation_info.know_time || '相识时间'}}</p>
                    <p>{{=it.relation_info.know_place || '相识地点'}}</p>
                    {{??}}
                    <p class="listDate">相识时间</p>
                    <p>相识地点</p>
                    {{?}}
                </div>
                <div class="weui-cell__ft">
                </div>
            </a>
        </div>
        {{~it.relation_list :value:index}}
        <div class="wrap">
            <div class="weui-cells__title">{{=value.remake}}</div>
            <div class="weui-cells" data-tel="{{=value.other_mobile}}">
                <div class="weui-cell weui-cell_swiped" ontouchstart="gtouchstart(this)" ontouchmove="gtouchmove(this)" ontouchend="gtouchend(this)">
                    <div class="weui-cell__bd item">
                        <div class="weui-cell">
                            <!-- <div class="weui-cell__hd">
                                <img src="../../image/tx_2.jpg" alt="" style="width:.7rem;margin-right:5px;display:block">
                            </div> -->
                            <div class="weui-cell__bd">
                                <p>{{=value.other_name}}</p>
                                <p class="listDate">{{=value.other_remake}}</p>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cell__ft flex-def flex-cCenter">
                        <a class="weui-swiped-btn weui-swiped-btn_warn" href="javascript:" data-id="{{=value.id}}" tapmode onclick="delOther(this)">删除</a>
                    </div>
                </div>
            </div>
        </div>
        {{~}}
    </script>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript">
    var relation_info;
    apiready = function () {
        requireData();
        listenerEvent();
    };
    // 监听事件
    function listenerEvent() {
        api.addEventListener({
            name: 'addRelation'
        }, function (ret, err) {
            requireData();
        });
    }
    // 请求数据
    function requireData() {
        api.ajax({
            url: apiSite + '/RelationUser/relationInfo',
            method: 'post',
            headers: apiHeader,
            data: {
                values: {
                    token: $api.getStorage('userToken'),
                    relation_user_id: api.pageParam.userId
                }
            }
        }, function (ret, err) {
            if (ret) {
                if (ret.code === 200) {
                    // ret.data.relation_info
                    // ret.data.relation_list
                    if (ret.data.relation_info) {
                        ret.data.relation_info.know_time = ret.data.relation_info.know_time.slice(0, ret.data.relation_info.know_time.indexOf(' ')).replace(/[-]/,'年').replace(/[-]/, '月')
                        relation_info = ret.data.relation_info;
                    }
                    getData(ret.data)
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
    // 判断左右滑动
    var startX, startY;
    var endX, endY;
    function gtouchstart(ele) {
        var e = window.event;
        startX = e.touches[0].pageX;
        startY = e.touches[0].pageY;
        // console.log(startY)
    };
    function gtouchmove() {
        var e = window.event;
        endX = e.touches[0].pageX;
        endY = e.touches[0].pageY;
    };
    function gtouchend(ele) {
        if (endX == 0 && endY == 0) {

        } else {
            var X = endX - startX,
                Y = Math.abs(endY - startY);
        }
        //style="transform: translateX(0px)"
        if (X < -20 && Y < 100) {
            X = 0, Y = 0;
            endX = 0;
            endY = 0;
            startX = 0;
            startY = 0;
            // 左滑
            for (var i = 0; i < $api.domAll('.item').length; i++) {
                var element = $api.domAll('.item')[i];
                $api.css(element, 'transform: translateX(0px)');
            }
            $api.css($api.dom(ele, '.weui-cell__bd'), 'transform: translateX(-68px);transition: transform .5s;');
        } else if (X > 20 && Y < 100) {
            X = 0, Y = 0;
            endX = 0;
            endY = 0;
            startX = 0;
            startY = 0;
            // 右滑
            console.log('右滑');
            $api.css($api.dom(ele, '.weui-cell__bd'), 'transform: translateX(0px)');
        }
    }
    // 打开新页面
    function openNewPage() {
        api.openWin({
            name: 'winname',
            url: './txl_addRelationshipInfo_address.html',
            bounces: false,
            pageParam: {
                userId: api.pageParam.userId,
                relation_info: relation_info
            }
        });
    }
    // 删除
    function delOther(ele) {
        api.ajax({
            url: apiSite + '/RelationUser/deleteRelationOther',
            method: 'post',
            headers: apiHeader,
            data: {
                values: {
                    token: $api.getStorage('userToken'),
                    other_id: $api.attr(ele, 'data-id')
                }
            }
        }, function (ret, err) {
            if (ret) {
                if (ret.code === 200) {
                    api.toast({
                        msg: '删除成功',
                        duration: 2000,
                        location: 'bottom'
                    });
                    $api.remove($api.closest(ele, '.wrap'));
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
</script>

</html>