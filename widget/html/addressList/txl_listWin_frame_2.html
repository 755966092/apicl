<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/flex.css"/>
   <style type="text/css">
        .search {
            height: .791rem;
            width: 100%;
            background-color: #EFEFF4;
            box-sizing: border-box;
            padding: .14rem .16rem;
            font-size: 0;   
            position: relative;

        }
        .search input {
            background-color: #fff;
            height: .503rem;    
             /*width: 6.4rem;*/
            width: 100%;
            float: left;
            font-size: .24rem;
            outline: none;
            text-align: center;
            padding: 0 .3rem;
            box-sizing: border-box;
        }
        .sxIcon {
            display: inline-block;
            width: .64rem;
            height: .5rem;
            background: url(../../image/icon_supply/icon_sx.png)no-repeat;
            -webkit-background-size: .35rem .35rem;
            background-size: .35rem .35rem;
            background-position: center center;          
            margin-left: .1rem;
        }
        .searchIcon {
            display: inline-block;
            width: .25rem;
            height: .791rem;
            background: url(../../image/icon_supply/icon_search.png)no-repeat;
            -webkit-background-size: .25rem .26rem;
            background-size: .25rem .26rem;
            background-position: 0 center;
            position: absolute;
            top: 0;
            left: 2.8rem;
        }
        p {
            text-align: center;
            font-size: .3rem;
            color: #999;
            margin-top: .5rem;
            display: none;
        }

        ul li {
            height: .95rem;
            background-color: #fff;
            border-bottom: .01rem solid #d9d9d9;
            padding: 0 .2rem;
        }
        ul li img {
            width: .55rem;
            height: .55rem;
            margin-right: .15rem;
        }
        ul li span {
            font-size: .28rem;
        }
        .loading {
            width: .8rem;
            height: .8rem;
            background: url(../../image/loading_more.gif)no-repeat;
            background-size: .8rem .8rem;
            position: absolute;
            top: 0;
            bottom: 0;
            right: 0;
            left: 0;
            margin: auto;
         }
   </style>
</head>
<body>
<!--
    <div class="search">
        <input type="text" onblur="loseFocus()" onfocus="getFocus()" onkeyup="hideSearIcon(this)" name="" placeholder="搜索">
        <span class="searchIcon"></span>
         <span class="sxIcon"  tapmode onclick="openSlideBar()"></span> 
    </div>-->
    <div class="loading" ></div>
    <div class="main">
        <ul class="resultList"></ul>
        <script type="text/x-dot-template" id="listT">
            {{ for (var i = 0; i < it.length; i++) { }} 
            <li class="flex-def flex-cCenter" tapmode onclick="addFriends(this)" data-id="{{=it[i].user_id}}">
                <img src="{{=it[i].head_img_url}}">
                <!-- {{?it[i].remark_nickname != null}} 
                    <span>{{=it[i].remark_nickname}}</span>
                {{??}} -->
                <span>{{=it[i].nickname}}</span>
                <!-- {{?}} -->
            </li>
            {{ }; }}
        </script>
    </div>
    <p data-type='1' class="no1">暂无我在用户</p>
    <p data-type='2' class="no2">暂无尚未加入</p>
    <p data-type='3' class="no3">暂无二度人脉</p>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript">
    var selVal=0,selectedObj,pageNum = 1,dataArr=[];
    apiready = function(){
        moduleInit();
        requireData(api.pageParam.flag)
        scrollToBottom();
    };
    function scrollToBottom() {
          // 上啦加载
        api.addEventListener({
            name: 'scrolltobottom'
        }, function(ret, err) {
            // alert(JSON.stringify(ret));
            requireData(api.pageParam.flag)
        });
    }
    // 网络获取数据
    function requireData(classify) {
        console.log(pageNum)
        var url;
        if(classify === 1) {
            url = '/contact/levelTwoAvailable';
        } else if (classify === 2) {
            url = '/contact/levelTwoUnavailable';
        } else {
            url = '/contact/levelTwo';
        }
        api.ajax({
            url: apiSite + url,
            method: 'post',
            headers: apiHeader,
            data: {
                   values: { 
                       token: $api.getStorage('userToken'),
                       page_num: pageNum
                   }
            }
        }, function(ret, err) {
            if(ret) {
                console.log(JSON.stringify(ret))
                if(ret.code == 200) {
                    pageNum++;
                    dataArr =  dataArr.concat(ret.data.list)
                    if (ret.data.list.length == 0 && classify===1) {
                        $api.css($api.dom('p.no1'), 'display:block');
                    } else if(ret.data.list.length == 0 && classify===2) {
                        $api.css($api.dom('p.no2'), 'display:block');
                    } else if (ret.data.list.length == 0){
                        $api.css($api.dom('p.no3'), 'display:block');
                    }
                    getData(dataArr);
                    $api.css($api.dom('.loading'), 'display:none');
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
    // 打开人脉详情
    function addFriends(ele) {
        var userId = $api.attr(ele, 'data-id');
        api.openWin({
            name: 'txl_memberInfo_Win',
            url: './txl_memberInfo_Win.html',
            pageParam: {
                userId: userId
            }
        });
    }

     // 获取焦点事件
    function getFocus() {
        $api.css($api.dom('input'), 'text-align:left');
        $api.css($api.dom('.searchIcon'), 'left:.2rem');

    }
    // 逝去焦点事件
    function loseFocus() {
        if ($api.val($api.dom('input')) == '') {
            $api.css($api.dom('input'), 'text-align:center');
            $api.css($api.dom('.searchIcon'), 'left:2.8rem');
        }
    }
    // 添加筛选条件
    function addFilter() {
        api.addEventListener({
            name: 'screeningResultsType'
        }, function(ret, err) {
            if (ret) {
                selVal = ret.value.selVal
                selectedObj = ret.value.selectedObj
                listContact.close();
                // alert('监听到的参数:'+ret.value.selVal)
                query(parseInt(ret.value.selVal));
            } else {
                alert(JSON.stringify(err.msg));
            }
        });
    }
    function openSlideBar() {
        api.openFrame({
            name: 'txl_slideBar_3',
            url: './txl_slideBar_3.html',
            rect: {
                x: 0,
                y: 0,
                w: api.winWidth,
                h: api.winHeight
            },
            slidBackEnabled: false,
            pageParam: {
                selVal: selVal,
                selectedObj: selectedObj
            },
            bounces: false
        });
    }
    function hideSearIcon(ele) {
        var val = $api.val(ele);
        if (val!==''){
            // $api.css($api.dom('.searchIcon'), 'display:none');
            searchSQL(val);
        } else {
            // $api.css($api.dom('.searchIcon'), 'display:inline-block');
            searchSQL();
        }
    }


</script>
</html>




