<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"
    />
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/weui.css" />
  
</head>

<body>
<div class="wrap">
    <div class="weui-cells__title">分组名称</div>
    <div class="weui-cells">
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <input class="weui-input" type="text" placeholder="请输入文本">
            </div>
        </div>
    </div>
    <div class="weui-cells__title length">分组成员()</div>
    <div class="weui-cells">
        <a class="weui-cell weui-cell_access" href="javascript:;">
            <div class="weui-cell__hd">
                <img src="../../image/icon_my/icon_add.png"
                    alt="" style="width:20px;margin-right:5px;display:block">
            </div>
            <div class="weui-cell__bd">
                <p style="color:#27b24a">新增成员</p>
            </div>
        </a>
    </div>
</div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript" src="../../script/jquery.min.js"></script>
<script type="text/javascript" src="../../script/pinyin4js.js"></script>
<script>
    apiready = function(){
        moduleInit();
        $('.length').text('分组成员('+ api.pageParam.length +')');
        $('input').val(api.pageParam.nameˆ)
        console.log($('.wrap').height());
        requireData()
    }
    function requireData() {
        api.ajax({
            url: apiSite + '/UserGroup/getUserGroupList',
            method: 'post',
            headers: apiHeader,
            data: {
                values: { 
                    token: $api.getStorage('userToken'),
                    group_id: api.pageParam.id
                }
            }
        }, function(ret, err) {
            if(ret) {
                if (ret.code === 200) {
                    console.log(JSON.stringify(ret));
                    listOpen(new SrotList(ret.data.list))
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
    function listOpen(data) {
        var wrapH = $('.wrap').height();
        listContact.open({
            y: wrapH,
            h: api.frameHeight - wrapH,
            rightBtn:[{
                color: '#8B0000',
                title: '备注'
            }],
            data: data
        }, function(ret, err) {
            api.alert({
                msg: ret.section + "*" + ret.index
            });
        });
    }
    function SrotList(list) {
        this.list = list;
        this.obj = {};
        this.sortObj = function (key) {
            return function (val1, val2) {
                var data1 = val1[key]
                var data2 = val2[key]
                if (data1 > data2) {
                    return 1
                } else if (data1 < data2) {
                    return -1
                } else {
                    return 0
                }
            }
        }
        this.sqrtData = function () {
            var that = this;
            this.list.forEach(function (value) {
                var zimu = PinyinHelper.getShortPinyin(value.nickname).toUpperCase()[0];
                value.letter = /[A-Z]/.test(zimu) ? zimu : '#';
                value.title = value.nickname
                value.img = value.head_img_url
                value.subTitle = value.company_name
                value.titleSize = 15
            })
            this.list = this.list.sort(this.sortObj('letter'))
            this.list.forEach(function (value) {
                if (!that.obj[value.letter]) {
                    that.obj[value.letter] = []
                }
                that.obj[value.letter].push(value)
            })
            return that.obj
        }
        return this.sqrtData()
    }

</script>

</html>