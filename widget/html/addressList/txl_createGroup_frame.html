<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"
    />
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/weui.css" />
    <style>
        .listDate {
            font-size: 0.28rem;
            color: #999;
            max-width: 6rem;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
    
        .weui-cell_swiped {
            background: #FF3B30;
        }
    </style>
</head>

<body>
  
    <div class="weui-cells__title">分组名称</div>
    <div class="weui-cells">
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <input class="weui-input" oninput="iptText(this)" type="text" placeholder="请输入文本">
            </div>
        </div>
    </div>
    <div class="weui-cells__title">分组成员(9)</div>
    <div class="weui-cells">
        <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="openAddUser()">
            <div class="weui-cell__hd">
                <img src="../../image/icon_my/icon_add.png"
                    alt="" style="width:20px;margin-right:5px;display:block">
            </div>
            <div class="weui-cell__bd">
                <p style="color:#27b24a"ˆ>新增成员</p>
            </div>
        </a>
    </div>
    <!-- <div class="wrap">
        <div class="weui-cells" data-tel="{{=value.other_mobile}}">
            <div class="weui-cell weui-cell_swiped" ontouchstart="gtouchstart(this)" ontouchmove="gtouchmove(this)" ontouchend="gtouchend(this)">
                <div class="weui-cell__bd item">
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <img src="../../image/tx_2.jpg" alt="" style="width:.7rem;margin-right:5px;display:block">
                        </div>
                        <div class="weui-cell__bd">
                            <p>阿斯达是的</p>
                            <p class="listDate"></p>
                        </div>
                    </div>
                </div>
                <div class="weui-cell__ft flex-def flex-cCenter">
                    <a class="weui-swiped-btn weui-swiped-btn_warn" href="javascript:" data-id="{{=value.id}}" tapmode onclick="delOther(this)">删除</a>
                </div>
            </div>
        </div>
    </div> -->
    <div class="resultList weui-cells"></div>
    <script type="text/x-dot-template" id="listT">
            {{~it :value:index}}
                    <div class="weui-cell weui-cell_swiped" ontouchstart="gtouchstart(this)" ontouchmove="gtouchmove(this)" ontouchend="gtouchend(this)">
                        <div class="weui-cell__bd item">
                            <div class="weui-cell">
                                <div class="weui-cell__hd">
                                    <img src="{{=value.img}}" alt="" style="width:.7rem;margin-right:5px;display:block">
                                </div>
                                <div class="weui-cell__bd">
                                    <p>{{=value.title}}</p>
                                    <!-- <p class="listDate">{{=value.other_remake}}</p> -->
                                </div>
                            </div>
                        </div>
                        <div class="weui-cell__ft flex-def flex-cCenter">
                            <a class="weui-swiped-btn weui-swiped-btn_warn" href="javascript:" data-id="{{=value.user_id}}" tapmode onclick="delOther(this)">删除</a>
                        </div>
                    </div>
            {{~}}
        </script>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script>
    var userIdList = [];
    var userList = [];
    var name;
    apiready = function () {
        api.addEventListener({
            name: 'createLabel'
        }, function(ret, err){
            userList = userList.concat(ret.value.paramObj)
            getData(userList)
            userIdList = userIdList.concat(ret.value.selectItemId);
            api.sendEvent({
                name: 'createLabel2',
                extra: { 
                    name: name,
                    userIdList: userIdList,
                }
            });
        });
    }
    function openAddUser() {
        api.openWin({
            name: 'createGroupChat_win',
            url: '../news/createGroupChat_win.html',
            bounces: false,
            pageParam: {key : 'createLabel', userIdList: userIdList}
        });
    }
     // 判断左右滑动
        var startX, startY;
        var endX, endY;
        function gtouchstart(ele) {
            var e = window.event;
            startX = e.touches[0].pageX;
            startY = e.touches[0].pageY;
            // console.log(startY)
        };
        function gtouchmove() {
            var e = window.event;
            endX = e.touches[0].pageX;
            endY = e.touches[0].pageY;
        };
        function gtouchend(ele) {
            if (endX == 0 && endY == 0) {

            } else {
                var X = endX - startX,
                    Y = Math.abs(endY - startY);
            }
            //style="transform: translateX(0px)"
            if (X < -20 && Y < 100) {
                X = 0, Y = 0;
                endX = 0;
                endY = 0;
                startX = 0;
                startY = 0;
                // 左滑
                for (var i = 0; i < $api.domAll('.item').length; i++) {
                    var element = $api.domAll('.item')[i];
                    $api.css(element, 'transform: translateX(0px)');
                }
                $api.css($api.dom(ele, '.weui-cell__bd'), 'transform: translateX(-68px);transition: transform .5s;');
            } else if (X > 20 && Y < 100) {
                X = 0, Y = 0;
                endX = 0;
                endY = 0;
                startX = 0;
                startY = 0;
                // 右滑
                console.log('右滑');
                $api.css($api.dom(ele, '.weui-cell__bd'), 'transform: translateX(0px)');
            }
        }
         // 删除
        function delOther(ele) {
            $api.remove($api.closest(ele, '.weui-cell'));
            userIdList = userIdList.filter(function(value, index) {
                return $api.attr(ele, 'data-id') != value
            });
            userList = userList.filter(function(value){
                return $api.attr(ele, 'data-id') != value.user_id
            })
            api.sendEvent({
                name: 'createLabel2',
                extra: { userIdList: userIdList }
            });
        }
        function iptText(ele) {
            name = $api.val(ele) 
            api.sendEvent({
                name: 'createLabel2',
                extra: { 
                    userIdList: userIdList,
                    name: name
                }
            });
        }
</script>

</html>