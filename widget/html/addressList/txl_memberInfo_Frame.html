<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css//weui.css" />
    <style>
           /* 字体位置 */
    
        .weui-cell {
            font-size: 0.28rem;
        }
        /* 性别图标 */
        .sexIcon {
            margin-left: .2rem;
            width: .21rem;
            height: .21rem;
            background: url(../../image/icon_my/icon_my01.png) no-repeat;
            -webkit-background-size: .21rem .21rem;
            background-size: .21rem .21rem;
        }
        .sexIcon2 {
            background: url(../../image/icon_my/icon_my02.png) no-repeat;
            -webkit-background-size: .21rem .21rem;
            background-size: .21rem .21rem;
        }
    
        .mt30 {
            margin-top: 0.3rem;
        }
    
        /* 头像 */
    
        .weui-cell__hd img.headImg {
            width: .91rem;
            height: .91rem;
            margin-right: .3rem;
            display: block;
            border-radius: .1rem;
        }
    
        /* 职位公司 */
        .companyName {
            font-size: .24rem;
            color: #555;
        }
        /* 备注 */
        .liRightIcon {
            display: inline-block;
            /* background: url(../../image/icon_defaultHead.png); */
            width: .749rem;
            height: .458rem;
            -webkit-background-size: .749rem auto;
            background-size: .749rem auto;
            background-position: 0 center;
        }
        /* 按钮 */
        .page__bd_spacing {
           box-sizing: border-box;
           padding: .3rem .15rem;
        }
        /* 供求圈 */
        .weui-grid {
            background-color: #fff;
            padding: 10px 10px;
            /* height: 1.4rem; */
        }
        .weui-grid__icon {
            width: 0.44rem;
            height: 0.44rem;
        }
        .weui-grid__icon img {
            width: 100%;
            height: auto
        }
        .weui-grid__label {
            font-size: 0.24rem;
        }
    </style>
</head>

<body>
    
    <!-- <p class="wran">加入会员后可查看对方最近一次活跃时间</p> -->
    <div class="main">
        <div class="weui-cells mt30">
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="openInfo(this)" data-val="details">
                <div class="weui-cell__hd">
                    <img class="headImg" src="../../image/icon_defaultHead.png" id="head_img_url" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p class="userName">
                        <span id="nickname"></span>
                        <span id="sex" class="sexIcon"></span>
                    </p>
                    <p class="companyName">
                        <span id="current_company"></span>
                        <span id="current_position"></span>
                        <span id="current_degree"></span>
                    </p>
                </div>
                <div class="weui-cell__ft"></div>
            </a>
        </div>
        <!-- <div class="business flex-def flex-cCenter">
            <div class="supply" tapmode onclick="openSupplyPage(0)">
                <span class="supplyIcon"></span>
                <p class="text">供应</p>
            </div>
            <div class="ask" tapmode onclick="openSupplyPage(1)">
                <span class="askIcon"></span>
                <p class="text">需求</p>
        
            </div>
            <div class="circle" tapmode onclick="openSupplyPage(2)">
                <span class="circleIcon"></span>
                <p class="text">圈子</p>
            </div>
        </div> -->
        <div class="weui-grids">
            <a href="javascript:;" class="weui-grid" tapmode onclick="openSupplyPage(0)">
                <div class="weui-grid__icon flex-def flex-cCenter flex-zCenter">
                    <img src="../../image/icon_my/icon_gdd.png" alt="">
                </div>
                <p class="weui-grid__label">供应</p>
            </a>
            <a href="javascript:;" class="weui-grid" tapmode onclick="openSupplyPage(1)">
                <div class="weui-grid__icon flex-def flex-cCenter flex-zCenter">
                    <img src="../../image/icon_my/icon_qdd.png" alt="">
                </div>
                <p class="weui-grid__label">需求</p>
            </a>
            <a href="javascript:;" class="weui-grid" tapmode onclick="openSupplyPage(2)">
                <div class="weui-grid__icon flex-def flex-cCenter flex-zCenter">
                    <img src="../../image/icon_my/icon_wdq.png" alt="">
                </div>
                <p class="weui-grid__label">圈子</p>
            </a>
        </div>
        <div class="weui-cells mt30">
            <a class="weui-cell weui-cell_access" href="javascript:;">
                <div class="weui-cell__bd">
                    <p id="relationship_level"></p>
                </div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" id="openNetworkOfPeople" tapmode onclick="openNetworkOfPeople()">
                <div class="weui-cell__bd">
                    <p>人脉轨迹图</p>
                </div>
                <div class="weui-cell__ft">
                </div>
            </a>
        </div>
        <div class="weui-cells mt30">
            <a class="weui-cell weui-cell_access" href="javascript:;" data-val="mainPhone" tapmode onclick="openInfo(this)">
                <div class="weui-cell__bd">
                    <p>
                        <span>电话:</span>
                        <span id="phone"></span>
                    </p>
                </div>
                <div class="weui-cell__ft">
                </div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" data-val="otherContact" tapmode onclick="openInfo(this)">
                <div class="weui-cell__bd">
                    <p>其他联系方式</p>
                </div>
                <div class="weui-cell__ft">
                </div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" data-val="address" tapmode onclick="openInfo(this)">
                <div class="weui-cell__bd">
                    <p>地址</p>
                </div>
                <div class="weui-cell__ft">
                </div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" data-val="label" tapmode onclick="openInfo(this)">
                <div class="weui-cell__bd">
                    <p>备注</p>
                </div>
                <span class="liRightIcon" id="liRightIcon"></span>
                <div class="weui-cell__ft">
                </div>
            </a>
        </div>
        <div class="weui-cells weui-cells_radio resultList mt30">
            <!-- <label class="weui-cell weui-check__label" for="x11" tapmode data-statusId='{{=it[i].status_id}}' data-type='{{=it[i].type}}' onclick="selCurrentStatus(this)">
                    <div class="weui-cell__bd">
                        <p>{{=it[i].name}} {{=it[i].position}}</p>
                    </div>
                    <div class="weui-cell__ft">
                            <input type="radio" class="weui-check" checked name="radio1">
                        <span class="weui-icon-checked"></span>
                    </div>
                </label> -->
        </div>
        <script type="text/x-dot-template" id="listT">
                {{?it}} 
                    {{ for (var i = 0; i < it.length; i++) { }}
                        {{?it[i].type==1 }} 
                            <label class="weui-cell weui-check__label" for="x11" tapmode data-statusId='{{=it[i].status_id}}' data-type='{{=it[i].type}}' onclick="selCurrentStatus(this)">
                                <div class="weui-cell__bd">
                                    <p class="statusText" >{{=it[i].name}} {{=it[i].position}}</p>
                                </div>
                                <div class="weui-cell__ft">
                                    {{?it[i].is_default==1}}
                                        <input type="radio" class="weui-check" checked name="radio1">
                                    {{??}}
                                        <input type="radio" class="weui-check" name="radio1">
                                    {{?}}
                                    <span class="weui-icon-checked"></span>
                                </div>
                            </label>
                        {{??}}
                            <label class="weui-cell weui-check__label" for="x11" tapmode data-statusId='{{=it[i].status_id}}' data-type='{{=it[i].type}}' onclick="selCurrentStatus(this)">
                                <div class="weui-cell__bd">
                                    <p class="statusText" >{{=it[i].name}} {{=it[i].position}} 
                                            {{?it[i].degree==0}}
                                            {{??it[i].degree==1}}
                                            专科
                                            {{??it[i].degree==2}}
                                            本科
                                            {{??it[i].degree==3}}
                                            硕士
                                            {{??it[i].degree==4}}
                                                博士
                                            {{??it[i].degree==5}}
                                            博士后
                                            {{??}}
                                                {{=it[i].degree}}
                                            {{?}}</p>
                                </div>
                                <div class="weui-cell__ft">
                                    {{?it[i].is_default==1}}
                                        <input type="radio" class="weui-check" checked name="radio1">
                                    {{??}}
                                        <input type="radio" class="weui-check" name="radio1">
                                    {{?}}
                                    <span class="weui-icon-checked"></span>
                                </div>
                            </label>
                        {{?}}
                        {{ } }}
                {{??}}
                {{?}}
            </script>
        <div class="weui-cells mt30">
            <a class="weui-cell weui-cell_access" href="javascript:;" data-val="study" tapmode onclick="openInfo(this)">
                <div class="weui-cell__bd">
                    <p>学习经历</p>
                </div>
                <div class="weui-cell__ft">
                </div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" data-val="workExper" tapmode onclick="openInfo(this)">
                <div class="weui-cell__bd">
                    <p>工作经历</p>
                </div>
                <div class="weui-cell__ft">
                </div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" data-val="project" tapmode onclick="openInfo(this)">
                <div class="weui-cell__bd">
                    <p>项目业绩</p>
                </div>
                <div class="weui-cell__ft">
                </div>
            </a>
        </div>
        <div class="weui-cells mt30">
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="selectList()">
                <div class="weui-cell__bd">
                    <p>家乡:</p>
                </div>
                <div id="hometown" class="weui-cell__ft">
                </div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="openTime()">
                <div class="weui-cell__bd">
                    <p>生日:</p>
                </div>
                <div id="birthday" class="weui-cell__ft">
                </div>
            </a>
        </div>
        <!-- <div class="btn" id="btn" tapmode onclick="addFriends(this)">发送消息</div> -->
        <div class="page__bd page__bd_spacing">
            <a  id="btn" href="javascript:;" class="btn weui-btn weui-btn_primary" tapmode onclick="addFriends(this)">发送消息</a>
        </div>
        <!-- <div class="shadow"></div> -->
    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript" src="../../data/city_3.js"></script>
<script type="text/javascript">
    var paramNickname, paramRealName, paramSex, paramHeadImg, relationship_level_flag;
    var SQLName = 'db_' + $api.getStorage('userToken');
    var targetRongId;
    apiready = function() {
        moduleInit();
        // $api.css($api.dom('.shadow'), 'height:' + $api.offset($api.dom('.main')).h + 'px;');
        // console.log(JSON.stringify(api.pageParam))
        $api.text($api.byId('userName'), api.pageParam.name);
        $api.attr($api.byId('head_img_url'), 'src', api.pageParam.headImg);
        
        // 初始好友和自己不显示人脉轨迹图按钮

        hideNetworkOfPeople();
        if (api.pageParam.userId == 0) {
            // 进入自己的详情页
            api.ajax({
                url: apiSite + '/user/detail',
                method: 'post',
                headers: apiHeader,
                data: {
                    values: {
                        token: $api.getStorage('userToken'),
                    }
                }
            }, function(ret, err) {
                if (ret) {
                    // console.log('499:::'+JSON.stringify(ret))
                    api.pageParam.userId = ret.data.info.user_id;
                    // console.log('540')
                    initPage();
                    initStatus();
                } else {
                    alert(JSON.stringify(err))
                }
            })
        } else {
            
            // console.log('549')
            initPage();
            initStatus();
        }
        // 初始好友不显示人脉轨迹图
        function hideNetworkOfPeople() {
            // openNetworkOfPeople
            if(api.pageParam.flag == 4 || api.pageParam.userId == 0) {
                $api.css($api.byId('openNetworkOfPeople'), 'display:none');
                // $api.removeCls($api.byId('relationship_level_wrap'), 'wrap1');
                // $api.removeCls($api.dom($api.byId('relationship_level_wrap'), '.wrap'), 'wrap');
            }
        }

        // requireDetailData();
        api.addEventListener({
            name: 'editUserInfo'
        }, function(ret, err) {
            if (ret) {
                // console.log('监听到事件')
                initPage();
            } else {
                alert(JSON.stringify(err));
            }
        });
        // 发送好友验证成功
        api.addEventListener({
            name: 'addFriendsSuccess'
        }, function(ret, err){
            api.toast({
                msg: '发送成功',
                duration: 2000,
                location: 'bottom'
            });
        });
    };
    // 打开供求圈页面
    function openSupplyPage(flag) {
        var url;
        if (flag == 0) {
            // 她的供应
            url = "./txl_hisCircle_win.html"
        } else if (flag == 1) {
            // 他的求组
            url = "./txl_hisCircle_win.1.html"
        } else {
            // 她的圈子
            url = "./txl_hisCircle_win.2.html"
        }
        api.openWin({
            name: 'winname_' + url,
            url: url,
            bounces: false,
            pageParam: {
                userId: api.pageParam.userId
            }
        });
    }
    // 备注当前状态
    function selCurrentStatus(ele) {
        var type = $api.attr(ele, 'data-type'),
            status_id = $api.attr(ele, 'data-statusId');
        api.ajax({
            url: apiSite + '/remark_user/setDefaultStatus',
            method: 'post',
            headers: apiHeader,
            data: {
                values: {
                    token: $api.getStorage('userToken'),
                    remark_user_id: api.pageParam.userId,
                    type: type,
                    status_id: status_id
                }
            }
        }, function(ret, err) {
            if (ret) {
                if (ret.code == 200) {
                    // for (var i = 0; i < $api.domAll('.iconStatus').length; i++) {
                    //     $api.removeCls($api.domAll('.iconStatus')[i], 'sel');
                    // };
                    // $api.addCls($api.dom(ele, '.iconStatus'), 'sel');
                    // $api.text($api.byId('current_company'), $api.text($api.dom(ele, '.statusText')));
                    // $api.text($api.byId('current_company'), $api.text($api.dom(ele, '.statusText')));
                    // $api.text($api.byId('current_company'), $api.text($api.dom(ele, '.statusText')));
                    // alert(JSON.stringify(ret))
                    // console.log('修改当前状态成功')
                    // 更新数据库

                     for (var i = 0; i < $api.domAll('.weui-check').length; i++) {
                        $api.removeAttr($api.domAll('.weui-check')[i], 'checked');
                    };
                    $api.attr($api.dom(ele, '.weui-check'), 'checked', 'checked');
                    $api.text($api.byId('current_company'), $api.text($api.dom(ele, '.statusText')));
                    updateStatusSql(status_id, ele)
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
    // 更新数据库
    function updateStatusSql(status_id, ele) {
        db.executeSql({
            name: SQLName,
            sql: ' UPDATE tb_remarks_status SET is_default = ' + -1
        }, function(ret, err) {
            if (ret.status) {
                db.executeSql({
                    name: SQLName,
                    sql: ' UPDATE tb_remarks_status SET is_default = ' + 1 + ' WHERE status_id = ' + status_id
                }, function(ret, err) {
                    if (ret.status) {
                        // alert( JSON.stringify( ret ) );
                        // console.log('更新成功')
                        // initStatus();
                        // reviseText()

                    } else {
                        alert(JSON.stringify(err));
                    }
                });
            } else {
                alert(JSON.stringify(err));
            }
        });
        // console.log($api.text($api.dom(ele, '.statusText')))
            // 更新列表数据库
        db.executeSql({
            name: SQLName,
            sql: ' UPDATE addressList_simplify SET subTitle = "' + $api.text($api.dom(ele, '.statusText')) + '" WHERE user_id =' + api.pageParam.userId
        }, function(ret, err) {
            if (ret.status) {
                // console.log('执行成功')
                api.sendEvent({
                    name: 'editUserInfoUpdateList'
                });
            } else {
                alert(JSON.stringify(err));
            }
        });

    }
    // 获取会员信息
    function requireData(flag, data) {
        // console.log('执行了')
        var current_company = $api.byId('current_company');
        var current_position = $api.byId('current_position');
        var current_degree = $api.byId('current_degree');
        var phone = $api.byId('phone');
        var hometown = $api.byId('hometown');
        var birthday = $api.byId('birthday');
        var nickname = $api.byId('nickname');
        var sex = $api.byId('sex');
        var head_img_url = $api.byId('head_img_url');
        api.ajax({
            // url: apiSite + '/user/detail',
            url: apiSite + '/remark_user/fullInfo',
            method: 'post',
            headers: apiHeader,
            data: {
                values: {
                    token: $api.getStorage('userToken'),
                    remark_user_id: api.pageParam.userId
                }
            }
        }, function(ret, err) {
            if (ret) {
                if (ret.code == 200) {
                    api.ajax({
                        url: apiSite + '/user/detail',
                        method: 'post',
                        headers: apiHeader,
                        data: {
                            values: {
                                token: $api.getStorage('userToken'),
                                user_id: api.pageParam.userId
                            }
                        }
                    }, function(retDetail, errDetail) {
                        if (retDetail) {
                            infoComparison(data, retDetail.data.info);
                            infoComparison2(ret.data.info, retDetail.data.info);
                            relationship_level_flag = retDetail.data.relationship_level;
                            targetRongId = retDetail.data.info.rongcloud_user_id;
                            if (flag) {
                                // 无本地信息, 网络获取
                                relationship(retDetail.data.relationship_level, retDetail.data.info.status)
                                    // 真实姓名
                                if (ret.data.info.real_name) {
                                    paramRealName = ret.data.info.real_name;
                                } else {
                                    paramRealName = retDetail.data.info.real_name;
                                }
                                // 昵称
                                if (ret.data.info.nickname) {
                                    $api.text(nickname, ret.data.info.nickname);
                                } else {
                                    $api.text(nickname, retDetail.data.info.nickname);
                                }

                                // 头像
                                if (ret.data.info.head_img_url) {
                                    $api.attr(head_img_url, 'src', ret.data.info.head_img_url);
                                } else {
                                    $api.attr(head_img_url, 'src', retDetail.data.info.head_img_url);
                                }
                                // 性别
                                if (ret.data.info.sex) {
                                    if (ret.data.info.sex == 2) {
                                        $api.addCls(sex, 'sexIcon2');
                                    }
                                } else {
                                    if (retDetail.data.info.sex == 2) {
                                        $api.addCls(sex, 'sexIcon2');
                                    }
                                }
                                var companyStr = '';
                                // 当前公司
                                if (ret.data.info.current_company) {
                                    companyStr += (ret.data.info.current_company || '') + ' '
                                        // $api.text(current_company, ret.data.info.current_company || '');
                                } else {
                                    companyStr += (retDetail.data.info.current_company || '') + ' '
                                        // $api.text(current_company, retDetail.data.info.current_company || '');
                                }
                                // 当前职位
                                if (ret.data.info.current_position) {
                                    // $api.text(current_position, ret.data.info.current_position || '');
                                    companyStr += (ret.data.info.current_position || '') + ' '
                                } else {
                                    companyStr += (retDetail.data.info.current_position || '') + ' '
                                        // $api.text(current_position, retDetail.data.info.current_position || '');
                                }
                                // 当前学历
                                if (ret.data.info.current_degree) {
                                    companyStr += (ret.data.info.current_degree || '') + ' '
                                        // $api.text(current_degree, ret.data.info.current_degree || '');
                                } else {
                                    companyStr += (retDetail.data.info.current_degree || '') + ' '
                                        // $api.text(current_degree, retDetail.data.info.current_degree || '');
                                }
                                $api.text(current_company, companyStr);
                                // 家乡
                                if (ret.data.info.hometown) {
                                    $api.text(hometown, ret.data.info.hometown || '');
                                } else {
                                    $api.text(hometown, retDetail.data.info.hometown || '');
                                }

                                // 电话
                                if (ret.data.info.current_contact) {
                                    //console.log('11111111')
                                    $api.text(phone, ret.data.info.current_contact);
                                } else {
                                    //console.log('22222222')
                                    $api.text(phone, retDetail.data.info.current_contact);
                                }

                                //  当前状态
                                if (ret.data.status.length > 0) {
                                    getData(ret.data.status)
                                } else {
                                    getData(retDetail.data.status)
                                }
                                // 生日
                                if (ret.data.info.birthday) {
                                    $api.text(birthday, ret.data.info.birthday == '0000-00-00' ? '' : ret.data.info.birthday);
                                } else {
                                    $api.text(birthday, retDetail.data.info.birthday == '0000-00-00' ? '' : retDetail.data.info.birthday);
                                }
                            } else {
                                // 有本地信息 对比信息

                                paramRealName = retDetail.data.info.real_name;
                                //  当前状态
                                if (retDetail.data.status.length > 0) {
                                    getData(retDetail.data.status);
                                    var statueStr = ''
                                    statueStr = (retDetail.data.info.current_position || '') + ' ' + (retDetail.data.info.current_company || '') + ' ' + (retDetail.data.info.current_degree || '')
                                        // $api.text(current_position, retDetail.data.info.current_position || '');
                                        // $api.text(current_position, retDetail.data.info.current_position || '');
                                    $api.text(current_company, statueStr);
                                    // $api.text(current_degree, retDetail.data.info.current_degree || '');
                                }
                                // 本地数据库有信息, 只获取关系
                                relationship(retDetail.data.relationship_level, retDetail.data.info.status);
                                // 真实姓名
                                if (ret.data.info.real_name) {
                                    paramRealName = ret.data.info.real_name;
                                } else {
                                    paramRealName = retDetail.data.info.real_name;
                                }
                                // 昵称
                                if (ret.data.info.nickname) {
                                    $api.text(nickname, ret.data.info.nickname);
                                } else {
                                    $api.text(nickname, retDetail.data.info.nickname);
                                }

                                // 头像
                                if (ret.data.info.head_img_url) {
                                    $api.attr(head_img_url, 'src', ret.data.info.head_img_url);
                                } else {
                                    $api.attr(head_img_url, 'src', retDetail.data.info.head_img_url);
                                }
                                // 性别
                                if (ret.data.info.sex) {
                                    if (ret.data.info.sex == 2) {
                                        $api.addCls(sex, 'sexIcon2');
                                    }
                                } else {
                                    if (retDetail.data.info.sex == 2) {
                                        $api.addCls(sex, 'sexIcon2');
                                    }
                                }
                                var companyStr = '';
                                // 当前公司
                                if (ret.data.info.current_company) {
                                    companyStr += (ret.data.info.current_company || '') + ' '
                                        // $api.text(current_company, ret.data.info.current_company || '');
                                } else {
                                    companyStr += (retDetail.data.info.current_company || '') + ' '
                                        // $api.text(current_company, retDetail.data.info.current_company || '');
                                }
                                // 当前职位
                                if (ret.data.info.current_position) {
                                    // $api.text(current_position, ret.data.info.current_position || '');
                                    companyStr += (ret.data.info.current_position || '') + ' '
                                } else {
                                    companyStr += (retDetail.data.info.current_position || '') + ' '
                                        // $api.text(current_position, retDetail.data.info.current_position || '');
                                }
                                // 当前学历
                                if (ret.data.info.current_degree) {
                                    companyStr += (ret.data.info.current_degree || '') + ' '
                                        // $api.text(current_degree, ret.data.info.current_degree || '');
                                } else {
                                    companyStr += (retDetail.data.info.current_degree || '') + ' '
                                        // $api.text(current_degree, retDetail.data.info.current_degree || '');
                                }
                                $api.text(current_company, companyStr);
                                // 家乡
                                if (ret.data.info.hometown) {
                                    $api.text(hometown, ret.data.info.hometown || '');
                                } else {
                                    $api.text(hometown, retDetail.data.info.hometown || '');
                                }

                                // 电话
                                if (ret.data.info.current_contact) {
                                    $api.text(phone, ret.data.info.current_contact);
                                } else {
                                    $api.text(phone, retDetail.data.info.current_contact);
                                }

                                //  当前状态
                                if (ret.data.status.length > 0) {
                                    getData(ret.data.status)
                                } else {
                                    getData(retDetail.data.status)
                                }
                                // 生日
                                if (ret.data.info.birthday) {
                                    $api.text(birthday, ret.data.info.birthday == '0000-00-00' ? '' : ret.data.info.birthday);
                                } else {
                                    $api.text(birthday, retDetail.data.info.birthday == '0000-00-00' ? '' : retDetail.data.info.birthday);
                                }
                            }
                        } else {
                            alert(JSON.stringify(errDetail))
                        }
                    })


                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
    // 对比信息
    function infoComparison(obj1, obj2) {
        for (key1 in obj1) {
            for (key2 in obj2) {
                if (obj1[key1] == null) {
                    obj1[key1] = ''
                }
                if (obj2[key2] == null) {
                    obj2[key2] = ''
                }
                if (key1 === key2) {
                    if (!(obj1[key1] == obj2[key2])) {
                        // 更新本地库
                        updateSql(key1, obj2[key2])
                    }
                }
            }
        }
    }

    function infoComparison2(remarkInfo, obj) {
        // console.log('网络信息'+JSON.stringify(obj))
        db.selectSql({
            name: 'db_' + $api.getStorage('userToken'),
            sql: 'SELECT * FROM addressList_simplify WHERE user_id = ' + api.pageParam.userId
        }, function(ret, err) {
            if (ret.status) {
                // 网络信息 obj
                // 备注信息 remarkInfo
                // 本地信息 ret
                // console.log('本地信息'+JSON.stringify( ret ) );
                if (ret.data.length != 0) {
                    if (!remarkInfo.nickname) {
                        if (obj.nickname != ret.data[0].title) {
                            updateListSql('title', obj.nickname);
                            //console.log('nickname')
                        }
                    }
                    if (!remarkInfo.head_img_url) {
                        if (obj.head_img_url != ret.data[0].img) {
                            updateListSql('img', obj.head_img_url);
                        }
                    }
                    var subTitle = obj.current_company + ' ' + obj.current_position + ' ' + obj.current_degree + ' ';
                    if (!remarkInfo.current_company || !remarkInfo.current_position || !remarkInfo.current_degree) {
                        if ($api.trimAll(subTitle) != $api.trimAll(ret.data[0].subTitle)) {
                            updateListSql('subTitle', subTitle)
                                //console.log('subTitle' + subTitle)
                        }
                    }
                    if (!remarkInfo.current_contact) {
                        if (obj.current_contact != ret.data[0].current_contact) {
                            updateListSql('current_contact', obj.current_contact)
                                //console.log('current_contact')
                        }
                    }
                }
            } else {
                alert(JSON.stringify(err));
            }
        });

        //
        // obj.head_img_url
        // obj.current_company
        // obj.current_position
        // obj.current_degree
        // obj.current_contact
    }
    // 更新列表数据库
    function updateListSql(key, data) {
        db.executeSql({
            name: 'db_' + $api.getStorage('userToken'),
            sql: ' UPDATE addressList_simplify SET ' + key + '= "' + data + '" WHERE user_id = ' + api.pageParam.userId
        }, function(ret, err) {
            if (ret.status) {
                // console.log('发送时间')
                api.sendEvent({
                    name: 'editUserInfo',
                    extra: {
                        flag: api.pageParam.flag
                    }
                });
            } else {
                createSimplify(key, data);
            }
        });
    }

    function createSimplify(key, data) {
        db.executeSql({
            name: 'db_' + $api.getStorage('userToken'),
            sql: 'ALTER TABLE addressList_simplify ADD current_contact varchar(255)'
        }, function(ret, err) {
            if (ret.status) {
                updateListSql(key, data);
            } else {
                // alert( JSON.stringify( err ) );
            }
        });
    }
    // 更新数据库
    function updateSql(key, data) {
        db.executeSql({
            name: 'db_' + $api.getStorage('userToken'),
            sql: ' UPDATE addressList SET ' + key + '= "' + data + '" WHERE user_id = ' + api.pageParam.userId
        }, function(ret, err) {
            if (ret.status) {
                // console.log('992')
                initPage();
            } else {
                alert(JSON.stringify(err));
            }
        });
    }
    // 电话
    function requireContact() {
        var phone = $api.byId('phone');
        api.ajax({
            url: apiSite + '/user/contactList',
            method: 'post',
            headers: apiHeader,
            data: {
                values: {
                    token: $api.getStorage('userToken'),
                    user_id: api.pageParam.userId
                }
            }
        }, function(ret, err) {
            if (ret) {
                // console.log('用户自己的'+JSON.stringify(ret.data.list));
                for (var i = 0; i < ret.data.list.length; i++) {
                    if (ret.data.list[i].is_default == 1) {
                        $api.text(phone, ret.data.list[i].phone || '');
                        $api.attr(phone, 'data-id', ret.data.list[i].contact_id || '');
                    }
                }
            } else {
                alert('701' + JSON.stringify(err))
            }
        });
    }
    // 当前状态
    function initStatus() {
        db.selectSql({
            name: SQLName,
            sql: 'SELECT * FROM tb_remarks_status WHERE remark_user_id = ' + api.pageParam.userId
        }, function(ret, err) {
            if (ret.status) {
                // console.log( '626::::' + JSON.stringify( ret ) );
                if (ret.data.length != 0) {
                    // console.log('本地数据库')
                    for (var i = 0; i < ret.data.length; i++) {
                        if (ret.data[i].type == 2) {
                            // 學習
                            // console.log(ret.data[i].degree)
                            switch (ret.data[i].degree) {
                                case '0':
                                    ret.data[i].degree = '';
                                    break;
                                case '1':
                                    ret.data[i].degree = '专科';
                                    break;
                                case '2':
                                    ret.data[i].degree = '本科';
                                    break;
                                case '3':
                                    ret.data[i].degree = '硕士';
                                    break;
                                case '4':
                                    ret.data[i].degree = '博士';
                                    break;
                                case '5':
                                    ret.data[i].degree = '博士后';
                                    break;
                            }
                        }

                    }
                    // console.log('本地数据库tb_remarks_status内容')
                    reviseText(ret.data);
                    getData(ret.data);
                    statusRemarks(ret.data, 1)
                } else {
                    // console.log('获取网络信息')
                    statusRemarks();
                }
            } else {
                statusRemarks();
                // alert( '629'+JSON.stringify( err ) );
                // console.log( '629'+JSON.stringify( err ) );

            }
        });
    }
    // 修改昵称下面的显示
    function reviseText(data) {
        // 当前动态
        var current_company = $api.byId('current_company');
        var current_position = $api.byId('current_position');
        var current_degree = $api.byId('current_degree');
        if (data) {
            for (var i = 0; i < data.length; i++) {
                if (data[i].is_default == 1) {
                    $api.text(current_company, data[i].name + ' ' + data[i].position + ' ' + data[i].degree);

                    // if (data[i].type == 2) {
                    //     $api.text(current_company, data[i].name);
                    //     $api.text(current_position, data[i].position);
                    //     $api.text(current_degree, data[i].degree);
                    // } else {
                    //     $api.text(current_company, data[i].name);
                    //     $api.text(current_position, data[i].position);
                    //     $api.text(current_degree, '');
                    // }
                }
            }
        } else {
            $api.text(current_company, '');
            // $api.text(current_position, '');
            // $api.text(current_degree, '');
        }
    }
    // 当前状态 - 备注信息
    function statusRemarks(data, argument) {
        api.ajax({
            url: apiSite + '/remark_user/fullInfo',
            method: 'post',
            headers: apiHeader,
            data: {
                values: {
                    token: $api.getStorage('userToken'),
                    remark_user_id: api.pageParam.userId,
                }
            }
        }, function(ret, err) {
            if (ret) {
                if (!argument) {
                    if (ret.data.status.length != 0) {
                        handData(ret)
                    } else {
                        statusUser();
                    }
                } else {
                    // console.log('对比')
                        // 对比
                    if (data.length != ret.data.status.length) {
                        // 更新数据库
                        handData(ret)
                        // console.log('更新数据库')
                    }
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
    // 当前状态 - 原始信息
    function statusUser() {
        api.ajax({
            url: apiSite + '/user/detail',
            method: 'post',
            headers: apiHeader,
            data: {
                values: {
                    token: $api.getStorage('userToken'),
                    user_id: api.pageParam.userId
                }
            }
        }, function(ret, err) {
            if (ret) {
                if (ret.data.status.length != 0) {
                    // console.log('原始信息')
                }
                handData(ret)
            }
        })
    }

    function handData(ret) {
        // console.log('707:::' + JSON.stringify(ret))
        if (ret.data.status != '') {
            var sql = 'INSERT OR REPLACE INTO tb_remarks_status(remark_user_id, status_id, name, position, degree, start_date, is_default, type) VALUES ';
            for (var i = 0; i < ret.data.status.length; i++) {
                sql += '(' + api.pageParam.userId + ',' + ret.data.status[i].status_id + ',"' + ret.data.status[i].name + '","' + ret.data.status[i].position + '","' + ret.data.status[i].degree + '","' + ret.data.status[i].start_date + '",' + ret.data.status[i].is_default + ',' + ret.data.status[i].type + '),';
                if (ret.data.status[i].type == 2) {
                    // 學習
                    // console.log(ret.data.status[i].degree)
                    switch (ret.data.status[i].degree) {
                        case '0':
                            ret.data.status[i].degree = '';
                            break;
                        case '1':
                            ret.data.status[i].degree = '专科';
                            break;
                        case '2':
                            ret.data.status[i].degree = '本科';
                            break;
                        case '3':
                            ret.data.status[i].degree = '硕士';
                            break;
                        case '4':
                            ret.data.status[i].degree = '博士';
                            break;
                        case '5':
                            ret.data.status[i].degree = '博士后';
                            break;
                    }
                }
            }
            sql = sql.substring(0, sql.length - 1);
            // console.log(sql)
            db.executeSql({
                name: 'db_' + $api.getStorage('userToken'),
                sql: sql
            }, function(retSql, errSql) {
                if (retSql.status) {
                    reviseText(ret.data.status)
                    getData(ret.data.status)
                } else {
                    alert(JSON.stringify(errSql));
                }
            });
        } else {
            reviseText()
            getData()
        }
    }
    // 初始化页面
    function initPage() {
        var nickname = $api.byId('nickname');
        var sex = $api.byId('sex');
        var head_img_url = $api.byId('head_img_url');
        var phone = $api.byId('phone');
        var hometown = $api.byId('hometown');
        var birthday = $api.byId('birthday');
        // var current_company = $api.byId('current_company');
        // var current_position = $api.byId('current_position');
        // var current_degree = $api.byId('current_degree');
        var relationship_level = $api.byId('relationship_level');
        var liRightIcon = $api.byId('liRightIcon');
        /**
         * 优先本地数据库数据
         * 其次线上备注内容
         * 最后用户原始信息
         *
         * 昵称 - 性别 - 头像 - 家乡 - 生日 - 当前公司 - 当前职位 === 数据库表名 tb_remarks_user_info
         * 电话 === tb_remarks_contact
         */
        var SQLName = 'db_' + $api.getStorage('userToken');
        db.selectSql({
            name: SQLName,
            sql: 'SELECT * FROM addressList WHERE user_id = ' + api.pageParam.userId
        }, function(ret, err) {
            if (ret.status) {
                if (ret.data.length != 0) {
                        // 电话
                    if (ret.data[0].remark_current_contact) {
                        $api.text(phone, ret.data[0].remark_current_contact);
                    } else {
                        $api.text(phone, ret.data[0].current_contact);
                    }
                    // 生日
                    if (ret.data[0].remark_birthday) {
                        $api.text(birthday, ret.data[0].remark_birthday);
                    } else {
                        $api.text(birthday, ret.data[0].birthday);
                    }
                    // 家乡
                    if (ret.data[0].remark_hometown) {
                        $api.text(hometown, ret.data[0].remark_hometown);
                    } else {
                        $api.text(hometown, ret.data[0].hometown);
                    }
                    // 昵称
                    if (ret.data[0].remark_nickname) {
                        $api.text(nickname, ret.data[0].remark_nickname);

                    } else {
                        $api.text(nickname, ret.data[0].nickname);
                    }
                    // 头像
                    if (ret.data[0].remark_head_img_url) {
                        $api.attr(head_img_url, 'src', ret.data[0].remark_head_img_url);
                    } else {
                        $api.attr(head_img_url, 'src', ret.data[0].head_img_url);
                    }
                    // 性别
                    if (ret.data[0].remark_sex) {
                        if (ret.data[0].remark_sex == 2) {
                            $api.addCls(sex, 'sexIcon2');
                        } else {
                            $api.removeCls(sex, 'sexIcon2');
                        }
                    } else {
                        if (ret.data[0].sex == 2) {
                            $api.addCls(sex, 'sexIcon2');
                        } else {
                            $api.removeCls(sex, 'sexIcon2');
                        }
                    }
                    // 电话
                    if (ret.data[0].remark_current_contact) {
                        $api.text(phone, ret.data[0].remark_current_contact);
                    } else if (ret.data[0].current_contact) {
                        $api.text(phone, ret.data[0].current_contact);
                    } else {
                        requireContact();
                    }
                    requireData(0, ret.data[0]);
                } else {
                    // 获取线上
                    requireData(1);
                }
            } else {
                requireData(1);
            }
        });
        db.selectSql({
            name: SQLName,
            sql: 'SELECT * FROM tb_remarks_user_info WHERE remark_user_id = ' + api.pageParam.userId
        }, function(ret, err) {
            if (ret.status) {
                // console.log('902'+JSON.stringify(ret.data))
                if (ret.data.length != 0) {
                    if (ret.data[0].extra_image_url) {
                        $api.css(liRightIcon, 'background: url(' + ret.data[0].extra_image_url + '?imageView2/3/w/200/h/200/q/75|imageslim);-webkit-background-size: .749rem auto;background-size: .749rem auto;background-position: 0 center;');
                    }
                }
            } else {
                // alert( '968:'+JSON.stringify( err ) );
            }
        });
    }

    function relationship(relationship_levelType, status) {
        var btn = $api.byId('btn');
        if (status == 1) {
            // 1 已加入
            // 其他 未加入平台
            $api.css($api.byId('btn'), 'display: block');
            sweitchData1(relationship_levelType, status)
                // $api.text(btn, '加为好友');
        } else {
            sweitchData(relationship_levelType, status)

        }
    }

    function sweitchData1(relationship_levelType, status) {
        var btn = $api.byId('btn');
        switch (relationship_levelType) {
            case 1:
                $api.text(relationship_level, '自己');
                $api.css($api.byId('openNetworkOfPeople'), 'display:none');
                $api.css(btn, 'display: none');
                // for (var i = 0; i < $api.domAll('ul li .icon').length; i++) {
                //     $api.css($api.domAll('ul li .icon')[i], 'display: none');
                // }
                // $api.css($api.dom('.title .icon'), 'display: none');
                // $api.css($api.dom('.shadow'), 'display:block');
                // 右上角三个点
                api.sendEvent({
                    name: 'oneselfPage'
                });
                break;
            case 2:
                $api.text(relationship_level, '一度人脉熟识好友');
                break;
            case 3:
                // if(status == 1) {
                $api.text(relationship_level, '一度人脉相识好友');
                // } else {
                // $api.css($api.byId('btn'), 'display: none');
                // $api.text(relationship_level, '一度人脉尚未加入');
                // }
                // 1 相识
                // -1 一度人脉尚未加入
                break;
            case 4:
                $api.text(relationship_level, '初识好友');
                break;
            case 5:
                $api.text(relationship_level, '二度好友' + compareRelation(status));
                break;
            case 6:
                $api.text(relationship_level, '三度好友' + compareRelation(status));
                break;
            case 7:
                $api.text(relationship_level, '四度好友' + compareRelation(status));
                break;
            case 8:
                $api.text(relationship_level, '五度好友' + compareRelation(status));
                break;
            case 9:
                $api.text(relationship_level, '六度好友' + compareRelation(status));
                break;
            case 10:
                // $api.text(relationship_level, '无任何关系');
                // if(status == 1) {
                // $api.css($api.byId('btn'), 'display: none');
                $api.text(btn, '加为好友');

                $api.text(relationship_level, '无任何关系');
                $api.css($api.byId('openNetworkOfPeople'), 'display:none');
                // $api.removeCls($api.byId('relationship_level_wrap'), 'wrap1');
                // $api.removeCls($api.dom($api.byId('relationship_level_wrap'), '.wrap'), 'wrap');
                // } else {
                //     $api.css($api.byId('btn'), 'display: none');
                //     $api.text(relationship_level, '无任何关系');
                // }
                break;
        }
    }

    function sweitchData(relationship_levelType, status) {
        var btn = $api.byId('btn');
        $api.css($api.byId('btn'), 'display: none');
        switch (relationship_levelType) {
            case 1:
                $api.text(relationship_level, '自己');
                $api.css(btn, 'display: none');
                // for (var i = 0; i < $api.domAll('ul li .icon').length; i++) {
                //     $api.css($api.domAll('ul li .icon')[i], 'display: none');
                // }
                // $api.css($api.dom('.title .icon'), 'display: none');
                // $api.css($api.dom('.shadow'), 'display:block');
                // 右上角三个点
                api.sendEvent({
                    name: 'oneselfPage'
                });
                break;
            case 2:
                $api.text(relationship_level, '一度人脉熟识好友');
                break;
            case 3:

                $api.text(relationship_level, '一度人脉尚未加入');
                // 1 相识
                // -1 一度人脉尚未加入
                break;
            case 4:
                $api.text(relationship_level, '初识好友');
                break;
            case 5:
                $api.text(relationship_level, '二度好友' + compareRelation(status));
                break;
            case 6:
                $api.text(relationship_level, '三度好友' + compareRelation(status));
                break;
            case 7:
                $api.text(relationship_level, '四度好友' + compareRelation(status));
                break;
            case 8:
                $api.text(relationship_level, '五度好友' + compareRelation(status));
                break;
            case 9:
                $api.text(relationship_level, '六度好友' + compareRelation(status));
                break;
            case 10:
                $api.text($api.byId('btn'), '加为好友');
                // $api.css($api.byId('btn'), 'display: none');
                $api.text(relationship_level, '无任何关系');
                $api.css($api.byId('openNetworkOfPeople'), 'display:none');
                // $api.removeCls($api.byId('relationship_level_wrap'), 'wrap1');
                // $api.removeCls($api.dom($api.byId('relationship_level_wrap'), '.wrap'), 'wrap');
                break;
        }
    }

    function compareRelation(status) {
        if (status == 1) {
            return ''
        } else {
            $api.css($api.byId('btn'), 'display: none');
            // 发送时间win页面, 该用户是未加入
            api.sendEvent({
                name: 'NotJoinedTheUser',
            });
            return '尚未加入'
        }
    }

    function addFriends(ele) {
        var nickname = $api.text($api.byId('nickname'));
        var val = $api.text(ele)
        if (val == '发送消息') {
            // 打开聊天
            api.openWin({
                name: 'chatPage',
                url: '../news/chatPage.html',
                pageParam: {
                    targetRongId: targetRongId,
                    nickname: nickname,
                    headImg: $api.attr(head_img_url, 'src'),
                    userId: api.pageParam.userId
                }
            });
        } else {
            api.openWin({
                name: 'txl_addFriendsInfo',
                url: './txl_addFriendsInfo.html',
                bounces: false,
                pageParam: {
                    userId: api.pageParam.userId
                }
            });
        }
    }

    function openInfo(ele) {
        var nickname = $api.byId('nickname');
        var sex = $api.byId('sex');
        var head_img_url = $api.byId('head_img_url');
        paramSex = $api.hasCls(sex, 'sexIcon2') ? '女' : '男';
        paramNickname = $api.text(nickname);
        paramHeadImg = $api.attr(head_img_url, 'src');
        var val = $api.attr(ele, 'data-val');
        api.openWin({
            name: 'txl_addFellow_' + val + '_win.html',
            url: './txl_addFellow_' + val + '_win.html',
            // url: './txl_addFellow_address_win.html',
            pageParam: {
                userId: api.pageParam.userId,
                paramNickname: paramNickname,
                paramRealName: paramRealName,
                paramSex: paramSex,
                paramHeadImg: paramHeadImg,
                flag: api.pageParam.flag
            },
            bounces: false
        });
    }
    // 打开选择器
    function selectList() {
        var _dataSource2 = [],
            _dataSource = [],
            col = 1;
        var active = [];
        var selText = $api.text($api.byId('hometown'));
        col = 2;
        _dataSource = city;
        var selText1 = selText.split('-')
        active = [];
        for (var i = 0; i < _dataSource.length; i++) {
            if (_dataSource[i].name == selText1[0]) {
                active.push(i);
                for (var j = 0; j < _dataSource[i].sub.length; j++) {
                    if (_dataSource[i].sub[j].name == selText1[1]) {
                        active.push(j);
                        break;
                    }
                }
                break;
            }
        }
        var fontsize = 16,
            rowLength = 5;
        if (api.systemType === 'ios') {
            fontsize = 20;
            rowLength = 7;
        }
        UIActionSelector.open({
            datas: _dataSource,
            actives: active,
            layout: {
                row: rowLength,
                col: col,
                height: 30,
                size: fontsize,
                sizeActive: fontsize + 2,
                rowSpacing: 5,
                colSpacing: 5,
                maskBg: 'rgba(0,0,0,0.5)',
                bg: '#fff',
                color: '#888',
                colorSelected: '#000'
            },
            animation: true,
            cancel: {
                text: '取消',
                size: 16,
                w: 60,
                h: 40,
                bg: '#eee',
                // bgActive: '#ccc',
                color: '#000',
                // colorActive: '#fff'
            },
            ok: {
                text: '完成',
                size: 16,
                w: 60,
                h: 40,
                bg: '#eee',
                // bgActive: '#ccc',
                color: '#000',
                // colorActive: '#fff'
            },
            title: {
                text: '请选择',
                size: 20,
                h: 40,
                bg: '#F0F0F0',
                color: '#000'
            },
            fixedOn: api.frameName
        }, function(ret, err) {
            if (ret) {
                if (ret.eventType == 'ok') {
                    $api.text($api.byId('hometown'), ret.level1 + '-' + ret.level2);
                    submitData(ret.level1 + '-' + ret.level2, 1)
                }
            } else {
                alert(JSON.stringify(err.msg));
            }
        });
    }
    // 打开时间选择器
    function openTime() {
        var date, date1, date2;
        var current = $api.text($api.byId('birthday'));
        if (current != '请选择') {
            current = current.split('-')
            date = current[0];
            date1 = current[1];
            date2 = current[2];
            // console.log(current)
        } else {
            date = new Date().getFullYear();
            date1 = new Date().getMonth();
            date2 = new Date().getDate();
        }
        api.openPicker({
            type: 'date',
            date: date + '-' + date1 + '-' + date2,
            title: '选择生日'
        }, function(ret, err) {
            if (ret) {
                $api.text($api.byId('birthday'), ret.year + '-' + ret.month + '-' + ret.day);
                submitData(ret.year + '-' + ret.month + '-' + ret.day, 0)
            } else {
                alert(JSON.stringify(err.msg));
            }
        });
    }

    function submitData(data, flag) {
        var obj = {};
        if (flag) {
            obj = {
                token: $api.getStorage('userToken'),
                remark_user_id: api.pageParam.userId,
                hometown: data,
            }
        } else {
            obj = {
                token: $api.getStorage('userToken'),
                remark_user_id: api.pageParam.userId,
                birthday: data
            }
        }
        // console.log(JSON.stringify(data))
        api.ajax({
            url: apiSite + '/remark_user/editBasicInfo',
            method: 'post',
            headers: apiHeader,
            data: {
                values: obj
            }
        }, function(ret, err) {
            if (ret) {
                if (ret.code === 200) {
                    // console.log('663:' + JSON.stringify(ret))
                    if (relationship_level_flag == 2 || relationship_level_flag == 3 || relationship_level_flag == 4) {
                        api.ajax({
                            url: apiSite + '/remark_user/fullInfo',
                            method: 'post',
                            headers: apiHeader,
                            data: {
                                values: {
                                    token: $api.getStorage('userToken'),
                                    remark_user_id: api.pageParam.userId
                                }
                            }
                        }, function(ret, err) {
                            if (ret) {
                                var SQL = 'INSERT OR REPLACE INTO addressList(user_id, remark_birthday, remark_hometown) VALUES (' + api.pageParam.userId + ',"' + ret.data.info.birthday + '","' + ret.data.info.hometown + '")'
                                db.selectSql({
                                    name: 'db_' + $api.getStorage('userToken'),
                                    sql: 'SELECT * FROM addressList WHERE user_id=' + api.pageParam.userId
                                }, function(retSql, err1) {
                                    if (retSql.status) {
                                        if (retSql.data.length !== 0) {
                                            // console.log('有数据,更新')
                                            // 有数据 更新
                                            db.executeSql({
                                                name: 'db_' + $api.getStorage('userToken'),
                                                sql: 'UPDATE addressList SET remark_birthday = "' + ret.data.info.birthday + '", remark_hometown = "' + ret.data.info.hometown + '" WHERE user_id = ' + api.pageParam.userId
                                            }, function(ret, err) {
                                                if (ret.status) {
                                                    // console.log('688:' + JSON.stringify(ret));
                                                } else {
                                                    alert('690:' + JSON.stringify(err));
                                                }
                                            });
                                        } else {
                                            // console.log('没有数据,插入')
                                            // 没数据 插入新数据
                                            db.executeSql({
                                                name: 'db_' + $api.getStorage('userToken'),
                                                sql: SQL
                                            }, function(ret, err) {
                                                if (ret.status) {
                                                    // console.log('684:::' + JSON.stringify(ret));
                                                } else {
                                                    alert(JSON.stringify(err));
                                                }
                                            });
                                        }
                                    } else {
                                        alert(JSON.stringify(err))
                                    }
                                })
                            } else {
                                alert(ret.msg)
                            }
                        })
                    }
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
    // 打开人脉轨迹图
    function openNetworkOfPeople() {
        api.openWin({
            name: 'txl_friendInfo_networkOfPeople_win',
            url: './txl_friendInfo_networkOfPeople_win.html',
            bounces: false,
            pageParam: {
                userId: api.pageParam.userId
            }
        });
    }
</script>

</html>