<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <style>
        .title {
            margin-top: .37rem;
            border-top: .01rem solid #E4E4E4;
            border-bottom: .01rem solid #E4E4E4;
            background-color: #fff;
            height: 1.6rem;
            
            font-size: 0;
            padding: 0 .3rem;
            
            display: -webkit-box; 
            display: flex;
            -webkit-box-align: center;
            align-items: center; 
        }
        .headImg {
            margin-right: .2rem;
        }
        .title img {
            width: .91rem;
            height: .91rem;
            border-radius: .1rem;
        }
        .title p,
        .titleRight p {
            font-size: .22rem;
            color: #999;
        }
        .titleRight {
           /* display: -webkit-box; 
            display: flex;
            -webkit-box-align: start ;
            align-items: flex-start;
             -webkit-box-direction: normal;
             flex-direction: column;*/
            width: 6rem; 
        }
        .titleRight {
            font-size: .24rem;
        }
        .titleRight .name {
            height: .3rem;
            font-size: 0;
            width: 100%;
            display: -webkit-box; 
            display: flex;
            -webkit-box-align: center ;
            align-items: center;
            -webkit-box-pack: justify;
            justify-content: space-between;
            /*margin-bottom: .1rem;*/
        }
        .titleRight .name h3 {
            font-size: .3rem;
            line-height: .42rem;
            margin-right: .03rem;
        }
        .titleRight .sexIcon {
            margin-left: .2rem;
            width: .21rem;
            height: .21rem;
            background: url(../../image/icon_my/icon_my01.png)no-repeat;
            -webkit-background-size: .21rem .21rem;
            background-size: .21rem .21rem;
            /*float: left;*/

        }
        .titleRight .sexIcon2 {
            background: url(../../image/icon_my/icon_my02.png)no-repeat;
            -webkit-background-size: .21rem .21rem;
            background-size: .21rem .21rem;
        }
        .company {
            display: -webkit-box; 
            display: flex;
            -webkit-box-align: center ;
            align-items: center; 
            width: 100%;
            -webkit-box-pack: justify;
            justify-content: space-between;
            position: relative;
        }
        .company p {
            font-size: .24em;
        }
        .company .companyName  {
            margin-bottom: .1rem;
            font-size: .24rem;
            color: #555;
            line-height: .33rem;
            /*letter-spacing: -.026rem;*/
            
        }
        .company .companyArrow {
            position: absolute;
            right: 0;
            top: .1rem;
            width: .14rem;
            height: .23rem;
            background: url(../../image/icon_zk.png)no-repeat;
            -webkit-background-size: .`14rem .23rem;
            background-size: .14rem .23rem;
            background-position: 0 bottom;
        }
        .wran {
            text-align: center;
            font-size: .24rem;
            line-height: .5rem;
            color: #9b9b9b;
            margin-top: .05rem;
        }

        .business {
            margin-top: .37rem;
            height: 1.2rem;
            font-size: 0;
            display: -webkit-box; 
            display: flex;
            background-color: #fff;
            width: 100%;
        }
        .business>div {
            width: 33.3%;
            line-height: .7rem;
            text-align: center;font-size: .28rem;
            color: #333;
            box-sizing: border-box;

        }
        .business .supplyIcon {
            display: inline-block;
            width: .44rem;
            height: .7rem;
            background: url(../../image/icon_my/icon_gdd.png)no-repeat;
            -webkit-background-size: .42rem .41em;
            background-size: .42rem .41rem;
            background-position: 0 center;
            vertical-align: bottom;
            margin-right: .1rem;

        }
        .business p {
            line-height: .4rem;
            font-size: .24rem;
            color: #555;
        }
        .ask {
            
        }
        .ask>div {
            position: absolute;
            width: 33.33%;
            margin-top: .18rem;
            height: .8rem;
            border-right: .01rem solid #D8D8D8;
            border-left: .01rem solid #D8D8D8;
        }
        .business .askIcon {
            display: inline-block;
            width: .44rem;
            height: .7rem;
            background: url(../../image/icon_my/icon_qdd.png)no-repeat;
            background-size: .48rem .35rem;
            background-position: 0 center;
            vertical-align: bottom;
            margin-right: .1rem;
        }
        .business .circleIcon {
            display: inline-block;
            width: .44rem;
            height: .7rem;
            background: url(../../image/icon_my/icon_wdq.png)no-repeat;
            -webkit-background-size: .42rem .42rem;
            background-size: .42rem .42rem;
            background-position: 0 center;
            vertical-align: bottom;
            margin-right: .1rem;
        }
        
        .mt20 {
            margin-top: .36rem;
            padding-right: 0;
            border-bottom: 0;
        }
        .wrap1 {
            padding-right: 0;
            border-bottom: 0;
        }
        .wrap {
            border-bottom: .01rem solid #d9d9d9;
            box-sizing: border-box;
            height: .8rem;
            padding-right: .3rem;
        }
        ul li {
            line-height: .8rem;
            height: .8rem;
            font-size: 0;
            padding: 0 .3rem;
            background-color: #fff;
            border-bottom: .01rem solid #d9d9d9;
        }
        ul li span {
            font-size: .28rem;
            color: #333;
            max-width: 4.5rem;
            white-space:nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        ul li .icon {
            display: inline-block;
            width: .15rem;
            height: .8rem;
            background: url(../../image/icon_zk.png)no-repeat;
            -webkit-background-size: .15rem .25rem;
            background-size: .15rem .25rem;
            background-position: 0 center;
            float: right;
        }
        ul li .liRight{
            color: #999;
            margin-right: .2rem;
            float: right;
        }
        ul li .liRightIcon {
            float: right;
            display: inline-block;
            background: url(../../image/tx_4.jpg);
            width: .749rem;
            height: .458rem;
            -webkit-background-size: .749rem auto;
            background-size: .749rem auto;
            margin-top: .17rem;
            margin-right: .2rem;
            background-position: 0 center;

        }
        ul li img {
            margin-top: .17rem;
            width: .749rem;
            height: .458rem;
        }
        .btn {
             width: 6.785rem;
            height: .841rem;
            border-radius: .06rem;
            background-color: #1AAD19;
            border: .01rem solid #189c17;
            margin: 0 auto;
            line-height: .841rem;
            text-align: center;
            font-size: .34rem;
            color: #fff;
            margin-top: .36rem;
            margin-bottom: .2rem;
        }
        .activeTime {
            font-size: .22rem;
            position: relative;
        }
        .shadow {
            width: .56rem;
            height: .3rem;
            /*background-color: rgba(129,129,129,0.95);*/
            background: url(../../image/icon_txl/icon_shadow.png)no-repeat;
            -webkit-background-size: .56rem .3rem;
            background-size: .56rem .3rem;
            /*border-radius: .15rem;*/
            position: absolute;
            top: 0;
            left: 0;

        }
        .nameNo1 {
            display: -webkit-box;
            display: flex;
            -webkit-box-align: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <!-- <p class="wran">加入会员后可查看对方最近一次活跃时间</p> -->
    <div class="main">
        <div class="title" tapmode="hover" onclick="openInfo(this)" data-val="details">
            <div class="headImg">
                <img id="head_img_url" src="../../image/icon_defaultHead.png">
            </div>
            <div class="titleRight flex-def flex-zTopBottom">
                <div class="name">
                    <div class="nameNo1">
                        <h3 id="nickname"></h3>
                        <span id="sex" class="sexIcon"></span>
                    </div>
                  <!--   <div class="activeTime">
                        <span class="shadow"></span>
                        1天前活跃
                    </div> -->
                </div>
                <div class="company ">
                    <span class="companyName">
                        <span id="current_company">第一学</span> 
                        <span id="current_position">项目经理</span> 
                    </span>
                </div>
                <p >加入会员后可查看对方最近一次活跃时间</p>
            </div>
        </div>
        <div class="business">
           <div class="supply">
               <span class="supplyIcon"></span>
               <p class="text">供订单</p>
           </div>
           <div class="ask">
               <div></div>
                    <span class="askIcon"></span>
                    <p class="text">求订单</p>
               
           </div>
           <div class="circle">
               <span class="circleIcon"></span>
               <p class="text">参与的圈</p>
           </div>
        </div>
        <ul class="mt20">
            <li tapmode="hover" onclick="openInfo(this)" data-val="friendContact">
                <span id="relationship_level"><!-- 熟识好友，点击查看您与他的交集 --></span>
                <span class="icon"></span>
            </li>
            <li class="mt20" tapmode="hover" onclick="openInfo(this)" data-val="mainPhone">
               <div class="wrap">
                    <span>电话：</span>
                    <span id="phone"></span>
                    <span class="icon"></span>
               </div>
            </li>
            <li tapmode="hover" onclick="openInfo(this)" data-val="otherContact">
                <!-- <div class="wrap"> -->
                    <span>其他联系方式</span>
                    <span class="icon"></span>
                <!-- </div> -->
            </li>
             <li tapmode="hover" onclick="openInfo(this)" data-val="address">
                <span>地址</span>
                <span class="icon"></span>
            </li>
            <li tapmode="hover" onclick="openInfo(this)" data-val="label">
                <span>备注</span>
                <span class="icon"></span>
                <!-- <img class="liRight" src="../../image/tx_4.jpg"> -->
                <span class="liRightIcon" id="liRightIcon"></span>
            </li>
            <li class="mt20" tapmode="hover" onclick="openInfo(this)" data-val="companyPage">
                <div class="wrap">
                    <span>上海策赢网络科技 董事长</span>
                    <span class="icon"></span>
                    <span class="liRight">默认</span>
                </div>
            </li>
            <li>
                <span>中央财经大学 工商管理 硕士</span>
                <span class="icon"></span>
            </li>
            <li class="mt20" tapmode="hover" onclick="openInfo(this)" data-val="study">
                <div class="wrap">
                    <span>学习经历</span>
                    <span class="icon"></span>
                </div>
            </li>
            <li tapmode="hover" class="wrap1" onclick="openInfo(this)" data-val="workExper">
                <div class="wrap">
                    <span>工作经历</span>
                    <span class="icon"></span>
                </div>
            </li>
             <li onclick="openInfo(this)" data-val="project">
                <span>项目业绩</span>
                <span class="icon"></span>
            </li>
             <li class="mt20" tapmode="hover" onclick="selectList()">
                <div class="wrap">
                    <span>家乡：</span>
                    <span id="hometown"></span>
                    <span class="icon"></span>
                </div>
            </li>
            <li tapmode="hover" onclick="openTime()">
                <span>生日：</span>
                <span id="birthday"></span>
                <span class="icon"></span>
            </li>
        </ul>

        <div class="btn"   tapmode="hover"   onclick="addFriends()">
            加为好友
        </div>
    </div>
    
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../data/city_3.js"></script>
<script type="text/javascript">
    var paramNickname,paramRealName,paramSex,paramHeadImg;
    apiready = function(){
        moduleInit();
        requireData();
        requireDetailData();
    };
    // 获取会员信息
    function requireData() {
        api.ajax({
            url: apiSite + '/api/user/detail',
            method: 'post',
            headers: apiHeader,
            data: {
                   values: { 
                       token: $api.getStorage('userToken'),
                       user_id: api.pageParam.userId
                   }
            }
        }, function(ret, err) {
            if(ret) {
                console.log(JSON.stringify(ret.data))
                initPage(ret.data);
                paramNickname = ret.data.info.nickname;
                paramRealName = ret.data.info.real_name;
                paramSex = ret.data.info.sex;
                paramHeadImg = ret.data.info.head_img_url;
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
    function requireDetailData() {
        api.ajax({
            url: apiSite + '/api/remark_user/fullInfo',
            method: 'post',
            headers: apiHeader,
            data: {
                   values: { 
                       token: $api.getStorage('userToken'),
                       remark_user_id: api.pageParam.userId
                   }
            }
        }, function(ret, err) {
            if(ret) {
                console.log('478:::'+JSON.stringify(ret))
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
    // 初始化页面
    function initPage(data) {
        console.log('465:::'+JSON.stringify(data))
        var nickname = $api.byId('nickname');
        var sex = $api.byId('sex');
        var head_img_url = $api.byId('head_img_url');
        var phone = $api.byId('phone');
        var hometown = $api.byId('hometown');
        var birthday = $api.byId('birthday');
        var current_company = $api.byId('current_company');
        var current_position = $api.byId('current_position');
        var relationship_level = $api.byId('relationship_level');
        var liRightIcon = $api.byId('liRightIcon');
        switch(data.relationship_level){
            case 1: $api.text(relationship_level, '熟识好友，点击查看您与他的交集');break;
            case 2: $api.text(relationship_level, '相识好友，点击查看您与他的交集');break;
            case 3: $api.text(relationship_level, '尚未加入，点击查看您与他的交集');break;
            case 4: $api.text(relationship_level, '初识好友，点击查看您与他的交集');break;
            case 5: $api.text(relationship_level, '二度人脉，点击查看您与他的交集');break;
            case 6: $api.text(relationship_level, '三度人脉，点击查看您与他的交集');break;
            case 7: $api.text(relationship_level, '无任何关系, 是平台用户');break;
            case 8: $api.text(relationship_level, '无任何关系, 不是平台用户');break;
        }
        /**
         * 优先本地数据库数据
         * 其次线上备注内容
         * 最后用户原始信息
         *
         * 昵称 - 性别 - 头像 - 家乡 - 生日 - 当前公司 - 当前职位 === 数据库表名 tb_remarks_user_info
         * 电话 === tb_remarks_contact
         */
        var SQLName = 'db_'+$api.getStorage('userToken');
        api.ajax({
            url: apiSite + '/api/remark_user/fullInfo',
            method: 'post',
            headers: apiHeader,
            data: {
                   values: { 
                       token: $api.getStorage('userToken'),
                       remark_user_id: api.pageParam.userId
                   }
            }
        }, function(retAjax, err) {
            if(retAjax) {
                console.log('120:::'+JSON.stringify(retAjax));
                db.selectSql({
                    name: SQLName,
                    sql: 'SELECT * FROM tb_remarks_contact WHERE user_id = ' + api.pageParam.userId
                }, function(ret, err){        
                    if( ret.status ){
                        console.log('506::'+ JSON.stringify( ret ) );
                        // $api.text(phone, data.contact.phone);
                        // $api.attr(phone, 'data-contactId', data.contact.contact_id);
                        if (ret.data.length != 0) {
                            for (var i = 0; i < ret.data.length; i++) {
                                if (ret.data[i].is_default == 1) {
                                    $api.text(phone, ret.data[i].phone);
                                    $api.attr(phone, 'data-contactId', ret.data[i].contact_id);
                                }
                            }
                        } else if (retAjax.data.contact_list.length != 0) {
                            for (var i = 0; i < retAjax.data.contact_list.length; i++) {
                                if (retAjax.data.contact_list[i].is_default == 1) {
                                    $api.text(phone, retAjax.data.contact_list[i].phone);
                                    $api.attr(phone, 'data-contactId', retAjax.data.contact_list[i].contact_id);
                                }
                            }
                        } else {
                            $api.text(phone, data.contact.phone);
                            $api.attr(phone, 'data-contactId', data.contact.contact_id);
                        }
                    }else{
                        alert( JSON.stringify( err ) );
                    }
                });
                db.selectSql({
                    name: SQLName,
                    sql: 'SELECT * FROM tb_remarks_user_info WHERE remark_user_id = ' + api.pageParam.userId
                }, function(retSelSql, err){        
                    if( retSelSql.status ){
                        console.log('488::'+ JSON.stringify( retSelSql ) );
                        // 家乡
                        if (retSelSql.data.length!= 0 && retSelSql.data[0].hometown && retSelSql.data[0].hometown != "null") {
                            // b本地数据库内容
                            $api.text(hometown, retSelSql.data[0].hometown);
                        } else if (retAjax.data.info.hometown) {
                            // 线上备注内容
                            $api.text(hometown, retAjax.data.info.hometown);
                        } else {
                            // 会员原始信息
                            $api.text(hometown, data.info.hometown);
                        }
                        // 生日
                        if (retSelSql.data.length!= 0 && retSelSql.data[0].birthday  && retSelSql.data[0].birthday != "null") {
                            console.log('552'+JSON.stringify(retSelSql.data[0]))
                            // b本地数据库内容
                            $api.text(birthday, retSelSql.data[0].birthday);
                        } else if (retAjax.data.info.birthday) {
                            // 线上备注内容
                            $api.text(birthday, retAjax.data.info.birthday);
                        } else {
                            // 会员原始信息
                            $api.text(birthday, data.info.birthday);
                        }
                        // 头像
                        if (retSelSql.data.length!= 0 && retSelSql.data[0].head_img_url) {
                            // b本地数据库内容
                            $api.attr(head_img_url, 'src', retSelSql.data[0].head_img_url);
                        } else if (retAjax.data.info.head_img_url) {
                            // 线上备注内容
                            $api.attr(head_img_url, 'src', retAjax.data.info.head_img_url);
                        } else {
                            // 会员原始信息
                            $api.attr(head_img_url, 'src', data.info.head_img_url);
                        } 
                        // 备注图片
                        if (retSelSql.data.length!= 0 && retSelSql.data[0].extra_image_url) {
                            // b本地数据库内容
                            $api.css(liRightIcon, 'background: url('+ retSelSql.data[0].extra_image_url +')');
                        } else if (retAjax.data.extra && retAjax.data.extra.image_url) {
                            // 线上备注内容
                            $api.css(liRightIcon, 'background: url('+ retAjax.data.extra.image_url +')');
                        } else {
                            // 会员原始信息
                            if (retAjax.data.extra){
                                $api.css(liRightIcon, 'background: url('+ retAjax.data.extra.image_url +')');
                            }
                        } 

                        // 昵称
                        if (retSelSql.data.length!= 0 && retSelSql.data[0].nickname) {
                            console.log('b本地数据库内容')
                            // b本地数据库内容
                            $api.text(nickname, retSelSql.data[0].nickname);
                        } else if (retAjax.data.info.nickname) {
                            console.log('线上备注内容')
                            // 线上备注内容
                            $api.text(nickname, retAjax.data.info.nickname);
                        } else {
                            console.log('会员原始信息')
                            // 会员原始信息
                            $api.text(nickname, data.info.nickname);
                        }

                        // 性别
                        if (retSelSql.data.length!= 0 && retSelSql.data[0].sex) {
                            // b本地数据库内容
                            if (retSelSql.data[0].sex === 2 ) {
                                $api.addCls(sex, 'sexIcon2');
                            }
                        } else if (retAjax.data.info.sex) {
                            // 线上备注内容
                            if (retAjax.data.info.sex === 2 ) {
                                $api.addCls(sex, 'sexIcon2');
                            }
                        } else {
                            // 会员原始信息
                            if (data.info.sex === 2 ) {
                                $api.addCls(sex, 'sexIcon2');
                            }
                        } 

                        
                    }else{
                        alert( JSON.stringify( err ) );
                    }

                });
                if (data.info.current_positio) {
                    $api.text(current_position, data.info.current_position);
                }
                if (data.info.current_company != null) {
                    $api.text(current_company, data.info.current_company);
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
    function addFriends() {
        api.openWin({
            name: 'txl_addFriendsInfo',
            url: './txl_addFriendsInfo.html',
            bounces: false
        });
    }
    function openInfo(ele) {
        var val = $api.attr(ele, 'data-val');
        api.openWin({
            name: 'txl_addFellow_'+val+'_win.html',
            url: './txl_addFellow_'+val+'_win.html',
            // url: './txl_addFellow_address_win.html',
            pageParam: {
                userId: api.pageParam.userId,
                paramNickname: paramNickname,
                paramRealName: paramRealName,
                paramSex: paramSex,
                paramHeadImg: paramHeadImg
            },
            bounces: false
        });
    }
    // 打开选择器
    function selectList() {
        var _dataSource2 = [],_dataSource = [],col=1;
        var active = [];
        var selText = $api.text($api.byId('hometown'));
            col=2;
            _dataSource = city;
            var selText1 = selText.split('-')
            active = [];
            for (var i = 0; i < _dataSource.length; i++) {
                if (_dataSource[i].name == selText1[0]) {
                    active.push(i);
                    for (var j = 0; j < _dataSource[i].sub.length; j++) {
                        if (_dataSource[i].sub[j].name == selText1[1]) {
                            active.push(j);
                            break;
                        }
                    }
                    break;
                }
            }
        var fontsize = 16,rowLength = 5;
        if (api.systemType === 'ios') {
            fontsize = 20;
            rowLength = 7;
        }
        UIActionSelector.open({
            datas: _dataSource,
            actives: active,
            layout: {
                row: rowLength,
                col: col,
                height: 30,
                size: fontsize,
                sizeActive: fontsize+2,
                rowSpacing: 5,
                colSpacing: 5,
                maskBg: 'rgba(0,0,0,0.5)',
                bg: '#fff',
                color: '#888',
                colorSelected: '#000'
            },
            animation: true,
            cancel: {
                text: '取消',
                size: 16,
                w: 60,
                h: 40,
                bg: '#eee',
                // bgActive: '#ccc',
                color: '#000',
                // colorActive: '#fff'
            },
            ok: {
                text: '完成',
                size: 16,
                w: 60,
                h: 40,
                bg: '#eee',
                // bgActive: '#ccc',
                color: '#000',
                // colorActive: '#fff'
            },
            title: {
                text: '请选择',
                size: 20,
                h: 40,
                bg: '#F0F0F0',
                color: '#000'
            },
            fixedOn: api.frameName
        }, function(ret, err) {
            if (ret) {
                if (ret.eventType == 'ok') {
                    $api.text($api.byId('hometown'), ret.level1+'-'+ret.level2);
                    submitData(ret.level1+'-'+ret.level2,1)
                }
            } else {
                alert(JSON.stringify(err.msg));
            }
        });
    }
    // 打开时间选择器
    function openTime() {
        var date, date1, date2;
        var current = $api.text($api.byId('birthday'));
        if (current!='请选择') {
            current = current.split('-')
            date = current[0];
            date1 = current[1];
            date2 = current[2];
            console.log(current)
        } else　{
            date = new Date().getFullYear();
            date1 = new Date().getMonth();
            date2 = new Date().getDate();
        }
        api.openPicker({
            type: 'date',
            date: date+'-'+date1+'-'+date2,
            title: '选择生日'
        }, function(ret, err) {
            if (ret) {
                $api.text($api.byId('birthday'), ret.year+'-'+ret.month+'-'+ret.day);
                submitData(ret.year+'-'+ret.month+'-'+ret.day,0)
            } else {
                alert(JSON.stringify(err.msg));
            }
        });
    }
    function submitData(data, flag) {
        var obj = {};
        if (flag) {
            obj = {
                token: $api.getStorage('userToken'),
                remark_user_id: api.pageParam.userId,
                hometown: data,
            }
        } else {
            obj = {
                token: $api.getStorage('userToken'),
                remark_user_id: api.pageParam.userId,
                birthday: data
            }
        }
        console.log(JSON.stringify(data))
        api.ajax({
            url: apiSite + '/api/remark_user/editBasicInfo',
            method: 'post',
            headers: apiHeader,
            data: {
                   values: obj
            }
        }, function(ret, err) {
            if(ret) {
                if (ret.code === 200) {
                   console.log('663:'+JSON.stringify(ret))
                   api.ajax({
                       url: apiSite + '/api/remark_user/fullInfo',
                       method: 'post',
                       headers: apiHeader,
                       data: {
                              values: { 
                                  token: $api.getStorage('userToken'),
                                  remark_user_id: api.pageParam.userId
                              }
                       }
                   }, function(ret, err) {
                       if(ret) {
                        // 缓存生日和家乡
                        var sql = 'INSERT OR REPLACE INTO tb_remarks_user_info(remark_user_id, birthday, hometown) VALUES (' + api.pageParam.userId+',"'+ ret.data.info.birthday+'","'+ ret.data.info.hometown + '")'

                        db.selectSql({
                            name: 'db_'+$api.getStorage('userToken'),
                            sql: 'SELECT * FROM tb_remarks_user_info where remark_user_id=' + api.pageParam.userId
                        }, function(ret1, err1){        
                            if( ret1.status ){
                                if (ret1.data.length !== 0) {
                                    console.log(JSON.stringify(ret1))
                                    console.log('有数据,更新')
                                    // 有数据 更新
                                    db.executeSql({
                                        name: 'db_'+$api.getStorage('userToken'),
                                        sql: 'UPDATE tb_remarks_user_info SET birthday = "'+ ret.data.info.birthday +'", hometown = "'+ ret.data.info.hometown +'" WHERE remark_user_id = ' + api.pageParam.userId
                                    }, function(ret, err){        
                                        if( ret.status ){
                                            console.log('688:' + JSON.stringify( ret ) );
                                        }else{
                                            alert('690:' + JSON.stringify( err ) );
                                        }
                                    });
                                } else {
                                    console.log('没有数据,插入')
                                    // 没数据 插入新数据
                                    db.executeSql({
                                        name: 'db_'+$api.getStorage('userToken'),
                                        sql: sql  
                                    }, function(ret, err){        
                                        if( ret.status ){
                                           console.log( '684:::'+JSON.stringify( ret ) );
                                        }else{
                                           alert( JSON.stringify( err ) );
                                       }
                                    });
                                }
                                
                            }else{
                                alert( JSON.stringify( err1 ) );
                            }
                        });
                           
                           
                       } else {
                           alert(JSON.stringify(err))
                       }
                   })
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
</script>
</html>