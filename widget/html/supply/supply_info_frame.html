<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/swiper.min.css" />
    <link rel="stylesheet" type="text/css" href="../../css/weui.css" />
    <style type="text/css">
    
        /*  */
            .introduction {
                font-size: 0.24rem;
                color: #999;
                width: 6.7rem;
                margin: 0 auto;
                margin-top: 0.36rem;
            }

          

            .weui-cell__bd {
                position: relative;
            }

            .weui-input {
                width: 95%;
            }

        

            .weui-panel__bd {
                background-color: #fff;
            }

            .weui-media-box__bd {
                font-size: 0;
            }

            .weui-media-box_appmsg .weui-media-box__hd {
                width: 2.22rem;
                height: 2.22rem;
                margin-right: 0.2rem;
            }

            .weui-media-box__bd {
                height: 2.2rem;
            }

            .currentPrice {
                font-size: .3rem;
                color: #CC0019;
            }

            .originalPrice {
                font-size: .24rem;
                color: #3F3F3F;
                text-decoration: line-through;
            }

            .clear {
                font-size: .3rem;
                color: #5D7099;
            }

            .weui-media-box__title {
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                -webkit-box-orient: vertical;
                -webkit-line-clamp: 2;
                white-space: normal
            }

            .weui-cells {
                border-bottom: #d9d9d9 solid .01rem;
            }
        /*  */
        img.default {
            /* width: 100%; */
            height: 4.36rem;
        }
        
        .main {
            margin-bottom: 1.8rem;
        }
        
        .img {
            font-size: 0;
        }
        
        .img img {
            /* width: 100%; */
            height: 3.76rem;
        }
        
        .title {
            /* height: 1rem; */
            padding: .16rem .3rem;
            box-sizing: border-box;
            /* border-bottom: .01rem solid #E8E8E8; */
            background-color: #fff;
            position: relative;
        }
        
        .title img {
            width: .91rem;
            height: .91rem;
            border-radius: .1rem;
        }
        
        .titleRight {
            font-size: 0;
            padding-left: .2rem;
            box-sizing: border-box;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .titleRight h3 {
            font-size: .3rem;
            line-height: .42rem;
        }
        
        .titleRight p {
            font-size: .24rem;
            line-height: .33rem;
            color: #999;
        }
        
        .title2 {
            /* margin: .2rem 0; */
            padding: .2rem .3rem 0;
            /* border-bottom: .01rem solid #E8E8E8; */
            background-color: #fff;
            position: relative;
        }
        .title2:after{
                content: " ";
                position: absolute;
                left: 0;
                bottom: 0;
                right: 0;
                height: 1px;
                border-top: 1px solid #e5e5e5;
                color: #e5e5e5;
                -webkit-transform-origin: 0 0;
                transform-origin: 0 0;
                -webkit-transform: scaleY(0.5);
                transform: scaleY(0.5);
                z-index: 2;
        }
        .title2 .typeIcon {
            font-size: .2rem;
            color: #CC0019;
            margin-left: .1rem;
            font-weight: 700;
        }
        
        .title2 .shareIcon {
            width: .258rem;
            height: .36rem;
            background: url(../../image/icon_supply/icon_share.png)no-repeat;
            -webkit-background-size: .258rem .36rem;
            background-size: .258rem .36rem;
        }
        
        .title2 .titleName {
            font-size: 0;
        }
        
        .title2 .titleName p {
            font-size: .34rem;
            font-weight: 700;
        }
        
        .price {
            font-size: 0;
            /* margin: .2rem 0 .2rem; */
            /*width: 100%;*/
            padding-bottom: .2rem;
            /* border-bottom: .01rem solid #d9d9d9; */
        }
        
        .price .priceText {
            color: #D0011B;
            font-size: .34rem;
        }
        
        .price .priceText .price1 {
            font-size: .34rem;
        }
        
         .time {
            color: #999;
            font-size: 0;
            background-color: #fff;
            padding: 0 .3rem;
            /* border-top: #d9d9d9 solid 1px; */
        }
        
        .sold_cound,
        .avg_point {
            /* background-color: #a00; */
            margin-left: .1rem;
            font-size: 0;
        }
        
        .avg_point .avg_pointIcon {
            width: .245rem;
            height: .245rem;
            background: url(../../image/icon_supply/icon_xx.png)no-repeat;
            -webkit-background-size: .245rem .245rem;
            background-size: .245rem .245rem;
            margin-right: .06rem;
        }
        
        .sold_cound .count,
        .form {
            padding: 0.02rem 0;
            font-size: .24rem;
            color: #999;
            line-height: 0.3rem;
            /*margin-right: .2rem;*/
            /*margin-bottom: .1rem;*/
        }
        
        .formbg {
            height: 0.3rem;
            background: url(../../image/icon_supply/icon_position2.png)no-repeat;
            background-size: .18rem .24rem;
            padding-left: 0.3rem;
            background-position: left center;
        }
        
        .sel {
            height: .8rem;
            padding: 0 .3rem;
            font-size: 0;
            line-height: .8rem;
            margin: .2rem 0;
            background-color: #fff;
        }
        
        .sel .selTitle {
            font-size: .3rem;
            color: #999;
        }
        
        .sel .selText {
            font-size: .3rem;
            color: #000;
        }
        
        .sel .selIcon {
            width: .15rem;
            height: .25rem;
            background: url(../../image/icon_zk.png)no-repeat;
            -webkit-background-size: .15rem .25rem;
            background-size: .15rem .25rem;
        }
        
        .infoTitle {
            margin-bottom: .3rem;
            font-size: 0;
        }
        
        .infoTitle .line {
            width: .97rem;
            height: .02rem;
            background-color: #999;
        }
        
        .infoTitle .imgIcon {
            width: .34rem;
            height: .29rem;
            background: url(../../image/icon_supply/icon_init.png)no-repeat;
            -webkit-background-size: .34rem .29rem;
            background-size: .34rem .29rem;
            margin-right: .1rem;
        }
        
        .infoTitle .infoTitleText {
            font-size: .34rem;
            line-height: .48rem;
        }
        
        .infoTitle .text {
            margin: 0 .2rem;
            font-size: 0;
        }
        
        .info {
            background-color: #fff;
            padding: .2rem .3rem;
        }
        
        .infoData {
            font-size: 0;
        }
        
        .infoData p {
            font-size: .3rem;
            color: #555;
            margin: .3rem 0;
        }
        
        .infoData img {
            /* width: 6.9rem; */
            width: 100%;
            margin-bottom: .3rem;
        }
        
        .comment {
            margin-top: .2rem;
            background-color: #fff;
           
        }
        .otherLink {
            margin-top: .2rem;
            background-color: #fff;
            font-size: .3rem;
            color: #000;
        }
        .comment .commentCount {
            font-size: .3rem;
        }
        
        .comment .commentTitle {
            width: 100%;
            box-sizing: border-box;
            font-size: 0;
            line-height: .8rem;
            height: .8rem;
            background-color: #fff;
            border-bottom: .01rem solid #D9D9D9;
            padding: 0 .3rem;
        }
        
        .comment .commentIcon {
            width: .15rem;
            height: .25rem;
            background: url(../../image/icon_zk.png)no-repeat;
            -webkit-background-size: .15rem .25rem;
            background-size: .15rem .25rem;
        }
        
        .commentContent {
            font-size: 0;
            padding: .25rem .3rem .25rem 0;
            margin-left: .3rem;
            border-bottom: .01rem solid #d9d9d9;
            background-color: #fff;
        }
        
        .commentContentTitle img {
            width: .76rem;
            height: .76rem;
            margin-right: .2rem;
        }
        
        .commentName {
            width: 6.24rem;
        }
        
        .commentNameLeft {
            font-size: 0;
        }
        
        .commentNameLeft .name {
            font-size: .34rem;
        }
        
        .commentNameRight {
            font-size: .24rem;
            color: #999;
        }
        
        .commentText {
            font-size: .3rem;
            color: #555;
            margin-top: .18rem;
        }
        
        .btn {
            height: .75rem;
        }
        
        .btn>div {
            color: #D0011B;
            font-size: .24rem;
            width: 1.4rem;
            height: .4rem;
            margin: 0 auto;
            border: 2px solid #D0011B;
            border-radius: .1rem;
            text-align: center;
            line-height: .4rem;
        }
        
        footer {
            font-size: 0;
            height: .88rem;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #fff;
            border-top: .01rem solid #F8F8F8;
        }
        
        footer.footer {
            color: #fff;
            font-size: .3rem;
            height: .88rem;
            position: fixed;
            text-align: center;
            line-height: .88rem;
            bottom: 0;
            left: 0;
            width: 100%;
            border-top: .01rem solid #F8F8F8;
           
        }
        .footerwrap {
            width: 100%;
            height: 100%;
            background-color: #0ABB07;
        }
        footer span {
            font-size: .18rem;
            color: #999;
            text-align: center;
            float: left;
        }
        
        footer span:nth-child(1),
        footer span:nth-child(2) {
            width: 25%;
        }
        
        footer span:nth-child(3) {
            font-size: .3rem;
            width: 50%;
            line-height: .88rem;
            background-color: #0ABB07;
            color: #fff;
        }
        
        footer i {
            display: inline-block;
            width: 100%;
            height: .55rem;
            background: url(../../image/icon_supply/icon_chat.png)no-repeat;
            background-size: .4rem .38rem;
            background-position: center bottom;
        }
        
        footer span:nth-child(2) i {
            background: url(../../image/icon_supply/icon_collect.png)no-repeat;
            background-size: .4rem .35rem;
            background-position: center bottom;
        }
        
        footer span i.cancelCollect {
            background: url(../../image/icon_supply/icon_collect02.png)no-repeat;
            background-size: .4rem .35rem;
            background-position: center bottom;
        }
        
        .loading {
            width: .8rem;
            height: .8rem;
            background: url(../../image/loading_more.gif)no-repeat;
            background-size: .8rem .8rem;
            position: absolute;
            top: 0;
            bottom: 0;
            right: 0;
            left: 0;
            margin: auto;
        }
        
        header.header {
            background: linear-gradient(rgba(58, 57, 62, .5), rgba(58, 57, 62, 0));
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 999;
            
        }
        
        
        header .head {
            background-color: rgba(58, 57, 62, 0);
            position: relative;
        }
        body {
            line-height: inherit;
        }
        .swiper-wrapper img {
            height: 4.36rem;
        }
        .classifyLabel {
            border: .01rem solid #0ABB07;
            color: #0ABB07;
            font-size: 0.24rem;
            border-radius: .17rem;
            padding: .01rem .12rem;
            margin: 0.2rem 0;
            margin-right: 0.1rem;
        }
         .icon {
            padding-left: 0.35rem;
            background: url(../../image/icon_supply/icon_pageviews.png) no-repeat;
            background-size: .26rem .16rem;
            background-position: left center;
            font-size: .18rem;
            color: #999;
        }
        .position {
            padding: .1rem 0.3rem;
            background-color: #fff;
        }
        .createTime {
            font-size: 0.28rem;
            color: #999;
        }
        .avgWrap {
            padding: 0.1rem 0;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="head">
            <span class="callback" tapmode onclick="api.closeWin()">返回</span>
            <span class="winTitle">
                信息详情
            </span>
        </div>
    </header>
    <div class="loading"></div>
    <div class="swiper-container">
        <div class="swiper-wrapper">
            <!-- <img src="http://imgsrc.baidu.com/imgad/pic/item/83025aafa40f4bfb281dbe70094f78f0f63618c0.jpg" class="swiper-slide blue-slide">
            <img src="http://imgsrc.baidu.com/imgad/pic/item/5366d0160924ab18cb0aad123ffae6cd7b890bf2.jpg" class="swiper-slide red-slide">
            <img src="http://img.taopic.com/uploads/allimg/140826/267848-140R60T34860.jpg" class="swiper-slide orange-slide"> -->
        </div>
        <div class="swiper-pagination">

        </div>
    </div>
    <div class="resultList"></div>
        <!-- <div class=" mt30 main flex-def flex-zTopBottom">
            <div class="title2">
                <div class="top flex-def flex-zBetween flex-cCenter">
                    <div class="titleName flex-def flex-zLeftRight flex-cCenter ">
                        <p class="supplyName">本地导游</p>
                        <span class="typeIcon">[个人]</span>
                    </div>
                    
                </div>
                <div class="avgWrap flex-def flex-zBetween flex-cCenter">
                    <div class="avg_point">
                        <span class="avg_pointIcon"></span>
                    </div>
                    <span class="icon">33 </span>
                </div>
                <div class="price flex-def flex-zBetween flex-zLeftRight flex-cEnd">
                    <div class="priceText"> ￥
                        <span class="price1">200.00/小时</span>
                    </div>
                    <span class="createTime">2013-02-32: 12:12:12</span>
                </div>
            </div>
            <div class="time" >
                <span class="classifyLabel">情感交流</span>
                <span class="classifyLabel">情感交流</span>
            </div>
            <div class="mt30 position">
                <div class="sold_cound flex-def flex-zLeftRight flex-cCenter flex-zBetween">
                    <span class="count">[已售0] 线下 + 线下服务</span>
                </div>
                <div class="form"> 
                    <span class="form formbg">[北京]距离 nullkm</span>
                </div>
            </div>

            <div class="title mt30 flex-def flex-zLeftRight flex-cCenter" tapmode onclick="openUserInfoPage(this)" data-id="9969">
                <img src="http://img.iinnet.com/Fq9oScpBjR8tVlPr865kPisMnpW3" id="headImg">
                <div class="titleRight">
                    <h3>大中小18765</h3>
                    <p>第一学 前端开发</p>
                </div>
            </div>
            <div class="weui-cells">
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__bd">
                        <p style="font-size:.24rem">TA的公司主页</p>
                    </div>
                    <div class="weui-cell__ft">
                    </div>
                </a>
            </div>
            <div class="info mt30">
                <div class="infoTitle flex-def flex-zCenter flex-cCenter flex-zLeftRight">
                    <span class="line"></span>
                    <div class="text flex-def flex-zLeftRight flex-cCenter">
                        <span class="imgIcon"></span>
                        <span class="infoTitleText">详情</span>
                    </div>
                    <span class="line"></span>
                </div>
                <div class="infoData">
                    <p>本地导游带你嗨</p>
                    <img src="http://img.iinnet.com/Fkj-tQIesaelerXWQEcH8C8Y0i8L?imageMogr2/auto-orient/thumbnail/710x/blur/1x0/quality/100|imageslim"
                        tapmode onclick="openImgView(this)"> </div>
            </div>
            <div class="comment">
                <div class="commentTitle flex-def flex-cCenter flex-zBetween">
                    <span class="commentCount">评论（0）</span>
                </div>
            </div>
            <div class="weui-panel__hd otherLink">外部商品链接</div>
            <div class="weui-panel__bd" id="list">
                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                    <div class="weui-media-box__hd">
                        <img class="weui-media-box__thumb" src="" alt="">
                    </div>
                    <div class="weui-media-box__bd flex-def flex-zBetween flex-zTopBottom">
                        <h4 class="weui-media-box__title" id="title">aaaaa</h4>
                        <div>
                            <p class="flex-def flex-zBetween">
                                <span class="currentPrice" id="currentPrice">$78</span>
                                <span class="clear" tapmode onclick="clearLink()">取消链接</span>
                            </p>
                        </div>
                    </div>
                </a>
            </div>
        </div>  -->
        <!-- <footer>
            <span data-headUrl="http://img.iinnet.com/Fq9oScpBjR8tVlPr865kPisMnpW3" tapmode onclick="openChatPage(this)" data-rongId="47d2b511386521e8235274b1287e5525">
                <i></i>聊天</span>
            <span id="collect" ontouchstart="supplyCollect(this)">
                <i></i>收藏</span>
            <span tapmode onclick="immediateOrder(this)">立即下单</span>
        </footer>
        -->
        <!-- <footer>
            <span data-headUrl="{{=it.info.head_img_url}}" tapmode onclick="openChatPage(this)" data-rongId="{{=it.info.rongcloud_user_id}}">
                <i></i>聊天</span> 
            <span ontouchstart="supplyCollect(this)">
                <i class="cancelCollect"></i>取消收藏</span> 
            <span id="collect" ontouchstart="supplyCollect(this)">
                <i></i>收藏</span> {{?}}
            <span tapmode onclick="immediateOrder(this)">立即下单</span>
        </footer>
         {{= ? 'mt30' : ''}}
    -->
    <script type="text/x-dot-template" id="listT">
        {{?it.info.image_json.length > 0}}
        <div class="main flex-def flex-zTopBottom">
        {{??}}
        <div class="main mt30 flex-def flex-zTopBottom">
        {{?}}
        
            <div class="title2">
                <div class="top flex-def flex-zBetween">
                    <div class="titleName flex-def flex-zLeftRight flex-cCenter ">
                        <p class="supplyName">{{=it.info.title}}</p>
                        <span class="typeIcon">[{{=it.info.type}}]</span>
                    </div>
                    <!-- 分享按钮 -->
                    <!-- <div class="shareIcon"></div> -->
                </div>


                <div class="avgWrap flex-def flex-zBetween flex-cCenter">
                    <span class="avg_point">
                        {{for(var i = 0;i < it.info.avg_point;i++){ }}
                            <span class="avg_pointIcon"></span> {{};}}
                    </span>
                    <span class="icon">{{=it.info.browse_count}}人</span>
                </div>

                <div class="price flex-def flex-zBetween flex-zLeftRight flex-cEnd">
                    <div class="priceText"> ￥
                        <span class="price1">{{=it.info.price}}元/{{=it.info.unit}}</span>
                    </div>
                    <span class="createTime">{{=it.info.create_time}}</span>
                </div>
            </div>
                <div class="time">
                    <span class="classifyLabel">{{=it.info.category_name}}</span>
                    <span class="classifyLabel">{{=it.info.sub_type}}</span>
                </div>
                <div class="mt30 position">
                    <div class="sold_cound flex-def flex-zLeftRight flex-cCenter flex-zBetween">
                        <span class="count">[已售0] {{=it.info.form}}</span>
                    </div>
                    {{?it.info.distance>=0}}
                        <div class="form"> 
                            <span class="form formbg">[{{=it.info.city}}·{{=it.info.district}}] 距离 {{=it.info.distance}}km</span>
                        </div>
                    {{?}}
                </div>
            


            <!-- <div class="sel flex-def flex-zBetween flex-cCenter">
                <div>
                    <span class="selTitle">已选：</span>
                    <span class="selText">设计、“APP图标”</span>
                </div>
                <span class="selIcon"></span>
            </div> -->


            <div class="mt30 title flex-def flex-zLeftRight flex-cCenter" tapmode onclick="openUserInfoPage(this)" data-id="{{=it.info.user_id}}">
                <img src="{{=it.info.head_img_url}}" id="headImg">
                <div class="titleRight">
                    <h3>{{=it.info.nickname}}</h3>
                    {{?it.info.current_company==null&&it.info.current_position!=null}}
                    <p> {{=it.info.current_position}}</p>
                    {{??it.info.current_position==null&&it.info.current_company!=null}}
                    <p>{{=it.info.current_company}}</p>
                    {{??it.info.current_position==null&&it.info.current_company==null}} {{??}}
                    <p>{{=it.info.current_company}} {{=it.info.current_position}}</p>
                    {{?}}
                </div>
                
            </div>
            {{?it.info.type == '公司'}}
                <div class="weui-cells">
                    <a class="weui-cell weui-cell_access" href="javascript:;" data-name="{{=it.info.company_name}}" data-id={{=it.info.company_id}} tapmode onclick="openCompany(this)">
                        <div class="weui-cell__bd">
                            <p style="font-size:.3rem">TA的公司主页</p>
                            <!-- <p style="font-size:.24rem">{{=it.info.company_name}}</p> -->
                        </div>
                        <div class="weui-cell__ft">
                        </div>
                    </a>
                </div>
            {{?}}
            <div class="info mt30">
                <div class="infoTitle flex-def flex-zCenter flex-cCenter flex-zLeftRight">
                    <span class="line"></span>
                    <div class="text flex-def flex-zLeftRight flex-cCenter">
                        <span class="imgIcon"></span>
                        <span class="infoTitleText">详情</span>
                    </div>
                    <span class="line"></span>
                </div>
                <div class="infoData">
                    <p>{{=it.info.description}}</p>
                    {{?it.info.image_json.length != 0}} {{for(var i=0;i
                    < it.info.image_json.length; i++){ }} <img src="{{=it.info.image_json[i]}}" tapmode onclick="openImgView(this)">
                        {{ }; }} {{??it.info.image_json.length == 0}} {{?}}
                </div>
            </div>
            <div class="comment">
                <div class="commentTitle flex-def flex-cCenter flex-zBetween">
                    <span class="commentCount">评论（{{=it.info.comment_count}}）</span>
                    <!-- <span class="commentIcon"></span> -->
                </div>
                {{?it.last_comment!=null}}
                    <div class="commentContent">
                        <div class="commentContentTitle flex-def flex-zLeftRight">
                            <img src="{{=it.last_comment.head_img_url}}">
                            <div class="commentName flex-def flex-zBetween flex-zLeftRight flex-cCenter">
                                <div class="commentNameLeft flex-def flex-cCenter">
                                    <div class="name">{{=it.last_comment.nickname}}</div>
                                    <div class="avg_point">
                                        {{ for(var j = 0;j < it.last_comment.point;j++){ }} 
                                            <span class="avg_pointIcon"></span>
                                        {{ }; }}
                                    </div>
                                </div>
                                <div class="commentNameRight">
                                    {{=it.last_comment.create_time}}
                                </div>
                            </div>
                        </div>
                        <p class="commentText">{{=it.last_comment.content}}</p>
                    </div>
                {{?}} 
                {{?it.info.comment_count==0}} 
                {{??}}
                    <div data-avg="{{=it.info.avg_point}}" class="btn flex-def flex-cCenter" tapmode onclick="openCommentPage(this)">
                        <div>查看全部</div>
                    </div>
                {{?}}
                </div>
            {{?it.info.extra_product.length>0}}
                 <div class="weui-panel__hd otherLink " >外部商品链接</div>
                 <div class="weui-panel__bd " id="list">
                    {{~it.info.extra_product :value:index}}
                        <a href="javascript:void(0);" tapmode onclick="openOtherLink(this)" data-title="{{=value.title}}" data-url="{{=value.item_url}}" class="weui-media-box weui-media-box_appmsg">
                            <div class="weui-media-box__hd">
                                <img class="weui-media-box__thumb" src="{{=value.img_url}}" alt="">
                            </div>
                            <div class="weui-media-box__bd flex-def flex-zBetween flex-zTopBottom">
                                <h4 class="weui-media-box__title" id="title">{{=value.title}}</h4>
                                <div>
                                    <!-- <p class="currentPrice" id="currentPrice">$30</p> -->
                                    <p class="flex-def flex-zBetween">
                                        <span class="currentPrice" id="currentPrice">{{=value.price}}</span>
                                        <span class="clear" tapmode onclick="clearLink()">去看看</span>
                                    </p>
                                </div>
                            </div>
                        </a>
                    {{~}}
                 </div>
            {{?}}
        {{?!it.is_self_add}}
            <footer>
                <span data-headUrl="{{=it.info.head_img_url}}" tapmode onclick="openChatPage(this)" data-rongId="{{=it.info.rongcloud_user_id}}">
                    <i></i>聊天
                </span> 
                {{?it.is_collect}}
                    <span ontouchstart="supplyCollect(this)"><i class="cancelCollect"></i>取消收藏</span> 
                {{??}}
                    <span id="collect" ontouchstart="supplyCollect(this)"><i></i>收藏</span> 
                {{?}}
                <span tapmode onclick="immediateOrder(this)">立即下单</span>
            </footer>
        {{??}}
            <footer class="footer" ontouchstart="editSupply()">
                
                <p class="footerwrap">编辑</p>
            </footer>
        {{?}}
    </script>


</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/jquery.min.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript" src="../../script/swiper.min.js"></script>
<script type="text/javascript">
    var transmitData, _dataSource = ["次", "幅", "单", "小时", "分钟", "天", "周", "月", "份", "个", "扇", "课时", "面议", "其他"],
        paramImg = [];
    apiready = function() {
        
        fnInit();
        moduleInit();
       
        initialise(api.pageParam.flag, api.pageParam.compaby_name, api.pageParam.supply_id);
        api.addEventListener({
            name: 'editSupplyAfter'
        }, function(ret, err) {
            if (ret) {
                initialise(ret.value.flag, ret.value.compaby_name, ret.value.supply_id)
            } else {
                alert(JSON.stringify(err));
            }
        });
    };
    // 打开聊天页面
    function openChatPage(ele) {
        var rong_id = $api.attr(ele, 'data-rongId');
        var userName = $api.text($api.dom('h3'));
        // 头像 昵称 供应名字 价格 单位
        var userHeadImg = $api.attr($api.byId('headImg'), 'src');
        var supplyName = $api.text($api.dom('.supplyName'));
        var priceUint = $api.text($api.dom('.price'));
        api.openWin({
            name: 'chatPage',
            url: '../news/chatPage.html',
            pageParam: {
                type: 'supplyInfo',
                targetRongId: rong_id,
                nickname: userName,
                headImg: userHeadImg,
                supplyName: supplyName,
                priceUint: priceUint,
                order_id: api.pageParam.order_id
            }
        });
    }
    // 打开用户详情
    function openUserInfoPage(ele) {
        var userId = $api.attr(ele, 'data-id');
        api.openWin({
            name: 'winName',
            url: '../addressList/txl_memberInfo_Win.html',
            pageParam: {
                userId: userId
            }
        });
    }
    // 打开评论页面
    function openCommentPage(ele) {
        var avg = $api.attr(ele, 'data-avg');
        api.openWin({
            name: 'supply_commentPage_win',
            url: './supply_commentPage_win.html',
            pageParam: {
                supply_id: api.pageParam.supply_id,
                avg: avg
            }
        });
    }
    // 编辑供应
    function editSupply() {
        api.openWin({
            name: 'winName',
            url: './supply_releaseSupply_win.html',
            pageParam: {
                flag: api.pageParam.flag,
                compaby_name: api.pageParam.compaby_name,
                supply_id: api.pageParam.supply_id
            }
        });
    }
    // 收藏供应
    function supplyCollect(ele) {
        var url;
        if ($api.text(ele) === '收藏') {
            $api.html(ele, '<i class="cancelCollect"></i>取消收藏');
            url = '/supply/collect';
        } else {
            $api.html(ele, '<i></i>收藏');
            url = '/supply/cancelCollect';

        }
        api.ajax({
            url: apiSite + url,
            method: 'post',
            headers: apiHeader,
            data: {
                values: {
                    token: $api.getStorage('userToken'),
                    supply_id: api.pageParam.supply_id
                }
            }
        }, function(ret, err) {
            if (ret) {
                // alert(JSON.stringify(ret))
                if ($api.text(ele) === '收藏') {
                    api.toast({
                        msg: '取消收藏成功'
                    });
                } else {

                    api.toast({
                        msg: '收藏供应成功'
                    });
                }

            } else {
                alert(JSON.stringify(err.msg))
            }
        })
    }
    // 初始化页面
    function initialise(flag, compaby_name, supply_id) {
        // if (flag) {
        //     $api.css($api.byId('companyTtile'), 'display:block');
        //     $api.text($api.byId('compaby_name'), compaby_name);
        // } else {
        //     $api.css($api.byId('companyTtile'), 'display:none');
        // }
        // 请求数据
        bMap.getLocation({
            accuracy: '100m', //10m/100m/1km/3km
            autoStop: true,
            filter: 1
        }, function(retloaction, errlocation) {
            if (retloaction.status) {
                renderData(retloaction, flag, compaby_name, supply_id);
            } else {
                renderData(retloaction, flag, compaby_name, supply_id);
            }
        });

    }

    function renderData(retloaction, flag, compaby_name, supply_id) {
        api.ajax({
            url: apiSite + '/supply/detail',
            method: 'post',
            headers: apiHeader,
            data: {
                values: {
                    token: $api.getStorage('userToken'),
                    supply_id: supply_id,
                    latitude: retloaction.lat,
                    longitude: retloaction.lon
                }
            }
        }, function(ret, err) {
            if (ret) {
                if (ret.code == 200) {
                    renderPage(ret, flag, compaby_name, supply_id)
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(err.msg)
            }
        })
    }

    function renderPage(ret, flag, compaby_name, supply_id) {
        var sub_type = ['自产自销', '代理代销', '技能服务', '出租租赁', '相亲交友'];
            // 解析图片json
        ret.data.info.sub_type = sub_type[ret.data.info.sub_type-1]
            ret.data.info.image_json = eval(ret.data.info.image_json);
        paramImg = ret.data.info.image_json;
        var eleHtml = '';
        for (var i = 0; i < ret.data.info.image_json.length; i++) {
            if (i < 5) {
                eleHtml += '<img src="' + ret.data.info.image_json[i] + '?imageMogr2/auto-orient/thumbnail/!750x436r/gravity/Center/crop/x436/format/jpg/interlace/1/blur/1x0/quality/100|imageslim" class="swiper-slide blue-slide">'
                ret.data.info.image_json[i] = ret.data.info.image_json[i] + '?imageMogr2/auto-orient/thumbnail/710x/blur/1x0/quality/100|imageslim'
            }
        }
        if (ret.data.info.form == 1) {
            ret.data.info.form = '线上服务'
        } else if (ret.data.info.form == 2) {
            ret.data.info.form = '线下服务'
        } else {
            ret.data.info.form = '线上 + 线下服务'
        }
        if (eleHtml) {
            scrollPage();
            $api.html($api.dom('.swiper-wrapper'), eleHtml);
        } 
        else if (ret.data.info.extra_product.length > 0){
            $api.css($api.dom('.resultList'), 'margin-top:1.4rem;');
            $api.css($api.dom('header.header'), 'background: rgba(58,57,62,1);');
        } else {
            $api.css($api.dom('header.header'), 'background: rgba(58,57,62,1);position:relative');
            //  $api.html($api.dom('.swiper-wrapper'), '<img class="default" src="../../image/noimage.jpg">');
        }
        if (ret.data.info.image_json.length > 1) {
            swiperFun();
        }
        // 处理时间显示
        ret.data.info.create_time = initTime(ret.data.info.create_time)
        if (ret.data.info.unit > 0) {
            ret.data.info.unit = _dataSource[ret.data.info.unit - 1]
        } else {
            ret.data.info.unit = '其他'
        }
        ret.data.info.type = ret.data.info.type === 1 ? "个人" : "公司";
        var retSql = db.selectSqlSync({
            name: 'db_' + $api.getStorage('userToken'),
            sql: 'SELECT * FROM addressList_simplify WHERE user_id = ' + ret.data.info.user_id
        });
        if (retSql.status) {
            // 如果有备注返回备注
            if (retSql.data.length == 1) {
                ret.data.info.company_name = retSql.data[0].subTitle;
                ret.data.info.head_img_url = retSql.data[0].img;
                ret.data.info.nickname = retSql.data[0].title;
            }
        } else {
            alert('292' + JSON.stringify(err));
        }
        $api.css($api.dom('.loading'), 'display:none');

        getData(ret.data);
        $api.fixTabBar($api.dom('footer'))
        // ret.data
        transmitData = ret.data.info;
    }
    function scrollPage() {
         // 初始化页面
        window.onscroll = function () {
            var opacityNum = document.body.scrollTop / 145;
            if (opacityNum < 0.1) {
                $api.css($api.dom('header.header'), 'background: linear-gradient(rgba(58,57,62,.5), rgba(58,57,62,0));');
            } else {
                $api.css($api.dom('header.header'), 'background-color: rgba(58,57,62,' + opacityNum + ')');
            }
        }
    }
    function swiperFun() {
        var mySwiper = new Swiper('.swiper-container', {
            loop: true,
            autoplay: 3000,
            pagination: '.swiper-pagination',
            observer: true, //修改swiper自己或子元素时，自动初始化swiper
            observeParents: true, //修改swiper的父元素时，自动初始化swiper
        });
    }

    function immediateOrder(ele) {
        // 下单
        api.openWin({
            name: 'supply_info_immediate_order',
            url: './supply_info_immediate_order_2.html',
            softInputMode: 'pan',
            pageParam: {
                transmitData: transmitData,
            }
        });
        // 接单
        // api.openWin({
        //     name: 'supply_info_immediate_order',
        //     url: './supply_info_immediate_order.html',
        //     softInputMode: 'pan',
        //     pageParam: {
        //         transmitData: transmitData,
        //         supply_id: api.pageParam.supply_id
        //     }
        // });
    }
    // 打开图片页面
    function openImgView(ele) {
        api.openWin({
            name: 'view_the_image_page_win',
            url: './view_the_image_page_win.html',
            bounces: false,
            pageParam: {
                url: $api.attr(ele, 'src'),
                paramImg: paramImg
            }
        });
    }


    // doT模版获取数据
    function getData(data) {
        // 原生方法
        //  document.getElementsByClassName('resultList')[0].innerHTML = doT.template(document.getElementById('listT').innerHTML)(data)
        // console.log('渲染模版111')
        var listTText = $api.byId("listT").text;
        // console.log('渲染模版222')
        var fnListT = doT.template(listTText);
        // console.log('渲染模版333')
        var html = fnListT(data);
        // console.log('渲染模版444')
        // console.log(html+' at 304')
        var list = $api.dom(".resultList");
        // 替换resultList所有内容
        $api.html(list, html);
        // console.log('渲染完成')
        // alert('getData:' + JSON.stringify(data))
    }

    // 打开公司主页
    function openCompany(ele) {
        api.openWin({
            name: 'me_gs_homePage',
            url: '../me/me_gs_homePage.html',
            bounces: false,
            pageParam: {
                companyId: $api.attr(ele, 'data-id'),
                statu: 1,
                name: $api.attr(ele, 'data-name'),
            }
        });
    }
    // 打开外链
    function openOtherLink(ele) {
        api.openWin({
            name: 'winname',
            url: './supply_otherLink_win.html',
            bounces: false,
            pageParam: {
                title: $api.attr(ele, 'data-title'),
                url: $api.attr(ele, 'data-url'),
            }
        });
    }
</script>

</html>