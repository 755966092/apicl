<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>我</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/style.css"/>
    <style>
        .empty{ text-align: center; padding: 120px 0; }
        body,html {
            background-color: #EDECF3;
        }
        
         header {
            background-color: #3A393E;
            height: 1rem;
           color: #fff;
            line-height: 1rem;
            text-align: center;
            position: relative;
            font-size: .36rem;
            position: relative;
        }
        header span:nth-child(1) {
            position: absolute;
            left: 0;
            background: url(../../image/icon_fanh.png)no-repeat;
             background-size: .22rem .37rem;
            padding-left: .6rem;
            background-position: .25rem .34rem;
        }
        header span:nth-child(3) {
            position: absolute;
            right: .2rem;
        }


        .main ul {
            margin-top: .2rem;
        }
        .main ul li {
            height: .82rem;
            line-height: .82rem;
            padding: 0 .6rem 0 .3rem;
            font-size: .28rem;
            border-bottom: 1px solid #EDEDED;
            background: #fff;
            
            position: relative;
            
        }
        .main ul li:nth-child(3),
        .main ul li:nth-child(4),
        .main ul li:nth-child(6),
        .main ul li:nth-child(8),
        .main ul li:nth-child(10)
         {
            margin-bottom: .2rem;
        }
        .main ul li:nth-child(1) {
           
            height: 1.6rem;
            background: #fff;
            line-height: 1.6rem;
            display: -webkit-flex;
            display: flex;
            align-items: center;
            margin-bottom: .2rem;
        }

        .main ul li:nth-child(1) img {
            width: 1.18rem;
            height: 1.18rem;
            vertical-align:middle;
            position: absolute;
            right: 1rem;
        }
      
        .main ul li:nth-child(1) p img {
            vertical-align:baseline;
            width: .3rem;
            height: .3rem;
        }
       /* .main ul li:nth-child(1) p:nth-child(2) {
            font-size: .24rem;
        }*/
        .uaseName {
            display: inline-block;
            vertical-align:middle;
        }
        .main ul li span:first-child {
            position: relative;
        }
        .main ul li span:last-child {
            display: inline-block;
            width: .15rem;
            height: .8rem;
            background: url(../../image/icon_member/icon_zk.png)no-repeat;
            -webkit-background-size: .15rem .25rem;
            background-size: .15rem .25rem;
            background-position: 0 .3rem;
            float: right;
        }
        .main ul li .zkicon{
            display: inline-block;
            height: 1.8rem;
            width: .15rem;
            position: absolute;
            right: .58rem;
            background-position: center center;
        }
        
        li.select span:first-child:before {
            content: "";
            display: inline-block;
            width: .1rem;
            height: .1rem;
            background-color: #f00;
            border-radius: .2rem;
            position: absolute;
            top: .2rem;
            right: -.1rem;
        }
    </style>
</head>
<body>
 <header>
        <span onclick="api.closeWin()">返回</span>
        <span>个人信息</span>
        <!-- <span onclick="openPhoto()">相册</span> -->
    </header>
    <div class="main">
        <ul>
            <li onclick="login(this)" data-val="info">
                <img class="headImg"  src="../../image/tx_2.jpg">
                <!-- <div class="uaseName">
                    <p>
                        <span class="userName"></span>
                        <a href=""></a>
                    </p>
                    <p>个人说明</p>
                </div> -->
                <p>头像</p>
                <span class="zkicon"></span>
            </li>
            <li onclick="login(this)" data-val="name"><span>真实姓名</span><span></span></li>
            <li onclick="login(this)" data-val="nicheng"><span>昵称</span><span></span></li>
            <li onclick="login(this)" data-val="sex"><span>性别</span><span></span></li>
            <li onclick="login(this)" data-val="jx"><span>家乡</span><span></span></li>
            <li onclick="login(this)" data-val="sr"><span>生日</span><span></span></li>
            <li onclick="login(this)" data-val="zz"><span>住址</span><span></span></li>
            <li onclick="login(this)" data-val="lxfs"><span>联系方式</span><span></span></li>
            <li onclick="login(this)" data-val="xxjl"><span>学习经历</span><span></span></li>
            <li onclick="login(this)" data-val="gzjl"><span>工作经历</span><span></span></li>
            <li onclick="login(this)" data-val="xmyj"><span>项目业绩</span><span></span></li>
            <li onclick="login(this)" data-val="zydh"><span>主要电话</span><span></span></li>
            <li onclick="login(this)" data-val="mqdt"><span>目前动态</span><span></span></li>
        </ul>
    </div>
    <script type="text/javascript" src="../../script/api.js"></script>
    <script type="text/javascript" src="../../script/common.js"></script>
    <script type="text/javascript">
    var  userName, headImg, sex, currentCompany, currentPosition,imgChche;
        apiready = function(){
            userInfo(userTokenAll);
        }
        // 获取用户信息
        function userInfo(userToken) {
            // 如果没有本地缓存，就从网络获取，有就使用本地缓存
            if ($api.getStorage('userName')) {
            // if ($api.getStorage('userName')) {
            // if (0) {
                // 本地数据设置页面内容
                userName =   $api.getStorage('userName'); 
                headImg =   $api.getStorage('headImg'); 
                // headImg =   imgChche; 
                // alert(headImg)
                sex =   $api.getStorage('sex'); 
                currentCompany =   $api.getStorage('currentCompany'); 
                currentPosition =   $api.getStorage('currentPosition');
                reviseContent(userName, headImg, sex, currentCompany, currentPosition);
            } else {
                 api.ajax({
                    url: apiSite + '/api/user_center/index',
                    method: 'post',
                    headers: apiHeader,
                    data: {
                        values: { 
                            token: userToken
                        }
                    }
                }, function(ret, err) {
                    if (ret) {
                            
                            userName = ret.data.info.nickname,
                            headImg = ret.data.info.head_img_url,
                            sex = ret.data.info.sex,
                            // sex = (ret.data.info.sex === 1)?'男':'女',
                            // 当前公司
                            currentCompany = ret.data.info.current_company, 
                            // 当前职位
                            currentPosition = ret.data.info.current_position;
                            // 设置本地缓存
                            $api.setStorage('userName', userName); 
                            
                            $api.setStorage('sex', sex); 
                            $api.setStorage('currentCompany', currentCompany); 
                            $api.setStorage('currentPosition', currentPosition);
                            
                            // 初始化页面内容   
                            reviseContent(userName, headImg, sex, currentCompany, currentPosition);
                            // 图片缓存
                            api.imageCache({
                                url: headImg,
                                policy: 'cache_else_network'
                            }, function(ret, err) {
                                if (ret) {
                                    $api.setStorage('headImg', ret.url); 
                                } else {
                                    alert(JSON.stringify(err));
                                }
                            });
                    } else {
                        alert(JSON.stringify(err));
                    }
                });
            }
        }
        //
        function login(ele) {
           // 根据点击的按钮进入不同的页面
            var val = $api.attr(ele, 'data-val');
            api.openWin({
                name: 'winName',
                url: './me/me_' + val + '.html',
                pageParam: {
                    name: 'value'
                }
            });
        }

        // 修改文本内容
        function reviseContent(userName, headImg, sex, currentCompany, currentPosition) {
            var name = $api.dom('.userName'),
                head = $api.dom('.headImg'),
                sexImg = $api.dom('.sexImg');
            // 设置用户昵称
            $api.text(name, userName);
            // 设置用户头像
            $api.attr(head, 'src', headImg);
            // 设置用户性别
            if (sex == 1 ) {
                
            } else {
                $api.attr(sexImg, 'src', '../../image/icon_my/icon_my02.png');
            }
            
        }
    </script>
</body>
</html>