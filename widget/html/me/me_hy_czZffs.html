<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <style>
        body,html{
            background-color: rgba(0,0,0,0.3);
            height: 100%;
        }
        .main {
            width: 6.1rem;
            height: 6.5rem;
            background-color: #fff;
            border-radius: .2rem;
            margin: 0 auto;
            vertical-align: middle;
            /* 垂直居中 */
            position: absolute;
            top: 0;
            bottom: 0;  
            left: 0;
            right: 0; 
            margin: auto;
        }
       
        .zf, .title {
            font-size: .32rem;
            line-height: .5rem; 
            height: 1.56rem;
            vertical-align: middle;
            border-bottom: .01rem solid #EFEFEF;
        }
        .zf {
            line-height: 1.2rem;
            vertical-align: middle;
            height: 1.2rem;
            position: relative;
        }
        
         .title {
            font-size: .34rem;
            text-align: center;
            /*line-height: 1.56rem;*/
        }
        
        /* 选择图标 */
        .icon {
            display: inline-block;
            width: .43rem;
            height: 1.2rem;
            background: url(../../image/icon_member/icon_cz01.png)no-repeat;
            -webkit-background-size: .43rem .43rem;
            background-size: .43rem .43rem;
            background-position: 0 center;
            margin-left: .8rem;
            margin-right: .6rem;
            }
        input {
            opacity: 0.5;
             width: .43rem;
            height: 1.2rem;
            position: absolute;
            left: .83rem;
            opacity: 0;
        }
        .select1 {
             background: url(../../image/icon_member/icon_cz02.png)no-repeat;
            -webkit-background-size: .43rem .43rem;
            background-size: .43rem .43rem;
            background-position: 0 center;
        }
        /* 支付图标 */
        .zfb, .wx, .banlan {
            margin-right: .2rem;
            margin-left: .8rem; 
            display: inline-block;
            width: .58rem;
            height: 1.2rem;
            background: url(../../image/icon_member/icon_zfb.png)no-repeat;
            -webkit-background-size: .58rem .58rem;
            background-size: .58rem .58rem;
            background-position: 0 center;
        }
        .wx {
             background: url(../../image/icon_member/icon_wx.png)no-repeat;
            -webkit-background-size: .58rem .58rem;
            background-size: .58rem .58rem;
            background-position: 0 center;
        } 
        .banlan {
             background: url(../../image/icon_member/icon_ye.png)no-repeat;
            -webkit-background-size: .58rem .58rem;
            background-size: .58rem .58rem;
            background-position: 0 center;
        }
        
        /* 底部按钮 */
        .btn {
            line-height: .8rem;
            font-size: 0;
            margin-top: .3rem;
        }
        .enter {
            display: block;
            height: .8rem;
            font-size: .34rem;
            width: 4.52rem;
            text-align: center;
            background-color: #EEEEEE;
            color: #08BB08;
            margin: 0 auto;

        }
        .clear {
            border-bottom-left-radius: .2rem;
        }
        .enter {
            background-color: #08BB08;
            color: #fff;
            border-radius: .1rem;
        }
    </style>
</head>
<body ontouchstart="close11()">
<!-- onclick="event.stopPropagation();" -->
    <div class="main" ontouchstart='event.stopPropagation();'>
        <div class="title flex-def flex-zCenter flex-zTopBottom"> 
             <p>充值</p>
             <p><span class="type"></span>会员￥<span class="money"></span></p>
        </div>
        <p class="zf zf1"   tapmode   onclick="selType(this)">
            <!-- <input class="fl" type="radio" name="zf"> -->
            <span class="zfb fl"></span>
            <span class="text fl">支付宝支付</span>
            <span  data-val='alipay' class="icon select1 fr"></span>
        </p>
        <p class="zf"   tapmode   onclick="selType(this)" >
            <!-- <input class="fl" type="radio" name="zf"> -->
            <span class="wx fl"></span>
           <span class="text fl">微信支付</span>
            <span data-val='wechat' class="icon  fr"></span>
        </p>
        <p class="zf"   tapmode   onclick="selType(this)" >
            <!-- <input class="fl" type="radio" name="zf"> -->
            <span class="banlan fl"></span>
           <span class="text fl">余额支付</span>
            <span data-val='balance' class="icon  fr"></span>
        </p>
        <div class="btn">
            <!-- <span class="clear fl"   tapmode   onclick="submit(this)">取消</span> -->
            <span class="enter"   tapmode   onclick="submit(this)">确定支付</span>
            <!-- <span>立即付款</span> -->
        </div>
     </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript">
    var money,type;
    apiready = function(){
        moduleInit();
        money = api.pageParam.money;
        type = api.pageParam.type;
        $api.text($api.dom('.money'), money);
        $api.text($api.dom('.type'), type);
    }
        
    function close11() {
        // alert(111)
        api.closeFrame();
    }
   function selType(ele) {
        for (var i = 0; i < $api.domAll('.zf').length; i++) {
            $api.removeCls($api.dom($api.domAll('.zf')[i], '.icon'), 'select1');
        }
        $api.addCls($api.dom(ele, '.icon'), 'select1');
        console.log(ele)

   }
    function submit(ele) {
        var val = $api.attr($api.dom('.select1'), 'data-val');


        if (val === 'balance') {
            // 余额支付
            api.openFrame({
                name: 'me_hy_czZffs_2',
                url: './me_hy_czZffs_2.html',
                rect: {
                    x: 0,
                    y: 0,
                    w: 'auto',
                    h: 'auto'
                },
                pageParam: {
                    month:  api.pageParam.month,
                    pay_method: val
                },
                bounces: false
            });
        } else {
            // 微信 支付宝支付
            payMoney(val);
        }
        
        
    }
    function payMoney(val) {
        api.ajax({
            url: apiSite + '/finance_center/purchaseVip',
            method: 'post',
            headers: apiHeader,
            data: {
                   values: { 
                        token: $api.getStorage('userToken'),
                        month:  api.pageParam.month,
                        pay_method: val
                   }
            }
        }, function(ret, err) {
            if(ret) {
                // // alert(JSON.stringify(ret))
                console.log(val)
                if (val === 'wechat') {
                    wxPayFun(ret)
                } else if (val === 'alipay') {
                    alipayFun(ret)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
    function wxPayFun(retAJAX) {
        wxPay.payOrder({
            apiKey: retAJAX.data.config.appid,
            orderId: retAJAX.data.config.prepayid,
            mchId: retAJAX.data.config.partnerid,
            nonceStr: retAJAX.data.config.noncestr,
            timeStamp: retAJAX.data.config.timestamp,
            package: retAJAX.data.config.package,
            sign: retAJAX.data.config.sign
        }, function(ret, err) {
            if (ret.status) {
                //支付成功
                api.execScript({
                    name: 'winName_hy',
                    script: 'requestData();'
                });
                // 支付成功
                api.closeWin();
            } else {
                alert(ret.msg)
            }
        })
    }
    function alipayFun(retAJAX) {
        aliPay.payOrder({
          orderInfo: retAJAX.data.config
        },function(ret,err) {
            if (ret.status) {
                api.execScript({
                    name: 'winName_hy',
                    script: 'requestData();'
                });
                // 支付成功
                api.closeWin();
            } else {
                alert(ret.msg)
            }
        });
    }
</script>
</html>