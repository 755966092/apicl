    <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <style>
        html,body {
            /* width: 100%; */
            height: 100%;
        }
        .state {
            height: 1.5rem;
            background-color: #fff;
            padding: 0 .3rem;
            box-sizing: border-box;
         }
         .state .icon {
             width: .56rem;
             height: .597rem;
             background: url(../../image/icon_my/icon_clearOrder.png)no-repeat;
             -webkit-background-size: .56rem .59rem;
             background-size: .56rem .59rem;
             margin-right: .22rem;
         }
         .state .icon2 {
             width: .56rem;
             height: .597rem;
             background: url(../../image/icon_my/icon_orderCom.png)no-repeat;
             -webkit-background-size: .56rem .59rem;
             background-size: .56rem .59rem;
             margin-right: .22rem;
         }
         .state .icon3 {
            width: .56rem;
            height: .597rem;
            background: url(../../image/icon_my/icon_wwc.png)no-repeat;
            -webkit-background-size: .56rem .59rem;
            background-size: .56rem .59rem;
            margin-right: .22rem;
         }
         .state h3 {
             font-size: .34rem;
             line-height: .48rem;
             width: 5.5rem;
           /* white-space:nowrap;
             overflow: hidden;
             text-overflow: ellipsis;*/
         }.state p {
             font-size: .24rem;
             width: 5.5rem;
           /* white-space:nowrap;
             overflow: hidden;
             text-overflow: ellipsis;*/
             color: #666;
             line-height: .33rem;
             margin-top: .1rem;
        }


        .userInfo {
            height: 1rem;
            background-color: #fff;
            margin-top: .2rem;
            padding: 0 .3rem;
            border-bottom: .01rem solid #E6E6E6;
         }.userInfo img {
            width: .7rem;
            height: .7rem;
            margin-right: .2rem;
         }.userInfo .userName {
             font-size: .3rem;
             line-height: .42rem;
         }.userInfo .position {
             font-size: .24rem;
             line-height: .33rem;
             color: #999;
         }.userInfo .icon_tel {
            margin-right: .3rem;
            width: .34rem;
            height: .325rem;
            background: url(../../image/icon_my/icon_tel.png)no-repeat;
            background-size: .34rem .325rem;
         }.userInfo .icon_chat {
            width: .39rem;
            height: .34rem;
            background: url(../../image/icon_my/icon_chat.png)no-repeat;
            background-size: .39rem .34rem;
        }

        .userPosition {
            margin-top: .2rem;
            height: 1.2rem;
            padding-left: .3rem;
            background: #fff url(../../image/icon_my/icon_position.png)no-repeat;
            -webkit-background-size: .32rem .429rem;
            background-size: .32rem .429rem;
            background-position: .3rem center;

         }.userPosition h3 {
            font-size: .3rem;
            line-height: .42rem;
         }.userPosition p {
            font-size: .24rem;
            line-height: .33rem;
         }.userPosition .wrap {
            padding-left: .55rem;
            height: 1.2rem;
            border-bottom: .01rem solid #E2E2E2;
            box-sizing: border-box;
        }
        .serverTime {
            height: .797rem;
            background: #fff url(../../image/icon_my/icon_time.png) no-repeat;
            -webkit-background-size: .34rem .34rem;
            background-size: .34rem .34rem;
            background-position: .3rem center;
            padding-left: .3rem;
         }.serverTime p {
            padding-left: .55rem;
            font-size: .3rem;
            line-height: .797rem;
            border-bottom: .01rem solid #E2E2E2;
            box-sizing: border-box;
        }
        .serverType {
            height: .797rem;
            background: #fff url(../../image/icon_my/icon_fw.png) no-repeat;
            -webkit-background-size: .34rem .31rem;
            background-size: .34rem .31rem;
            background-position: .3rem center;
            border-bottom: .01rem solid #E2E2E2;

         }.serverType p {
            border: 0;
        }

        .label{
            font-size: .20rem;
            color: #cc0019;
            margin-right: .1rem;
        }
        .label1 {
            font-size: .20rem;
            color: #0076FF;
            line-height: .35rem;
            height: .26rem;
            border-radius: .06rem;
            margin-right: .1rem;
            padding: 0 .05rem;
            border: .01rem solid #0076FF;
        }
        .orderInfo {
            background-color: #fff;
            border-bottom: .01rem solid #ECECEC;
            padding: .3rem .3rem;
            box-sizing: border-box;
         }.orderInfo .top {
            /* height: 1.81rem; */
            font-size: 0;
         }.orderInfo .top img {
            width: .91rem;
            height: .91rem;
            margin-right: .2rem;
         }.orderInfo .top .text .supplyName{
            max-width: 3.5rem;
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
            font-size: .28rem;
            color: #333;
         }.orderInfo .top .text .price{
            font-size: .34rem;
         }.orderInfo .top .text .infoText{
             max-width: 3.5rem;
             display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
            overflow: hidden;
            font-size: .24rem;
            color: #555;
         }.orderInfo .top .text .count{
            margin-left: .1rem;
            /* float: right; */
            
            text-align: right;
            font-size: .24rem;
            color: #999;
         }.orderInfo .top .info{
            margin-top: .1rem;
        }

        .orderInfo .bottom .wrap{
            height: 1.71rem;
            border-top: .01rem solid #ECECEC;
            box-sizing: border-box;
            font-size: 0;
            padding-top: .2rem;
         }.orderInfo .bottom {
            padding-left: .3rem;
         }.total {
            font-size: .24rem;
            text-align: right;
         }.totalData {
            font-size: .34rem;
            color: #1AAD19;
         }.totalNumber{
            color: #1AAD19;
         }.btn {
            width: 1.34rem;
            height: .54rem;
            text-align: center;
            /*line-height: .54rem;*/
            line-height: .6rem;
            font-size: .28rem;
            border-radius: .06rem;
            margin-left: .32rem;
            border: .01rem solid #000;
         }.btnGroup {
            text-align: right;
            margin-top: .5rem;
        }
        .orderTime {
            /*height: 1.96rem;*/
            background-color: #fff;
            margin-top: .2rem;
            padding: .3rem;
         }p {
            font-size: .24rem;
            line-height: .48rem;
         } p .code {
            color: #3f3f3f;
        }

        .remark {
            height: .8rem;
            background: #fff url(../../image/icon_my/icon_bz.png)no-repeat;
            -webkit-background-size: .34rem .33rem;
            background-size: .34rem .33rem;
            background-position: .3rem center;
            font-size: .24rem;
            margin-top: .2rem;
            line-height: .8rem;
            padding-left: .73rem;
         }span {
            color: #3f3f3f;
        }

        .appraise {
            /* width: 100%; */
            background-color: #EDECF3;
            font-size: .34rem;
            text-align: center;
            height: .9rem;
            line-height: .9rem;
            color: #fff;
            margin-top: .75rem;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
        .appraise1 {
            background-color: #1AAD19;
        }
    </style>
</head>
<body>
    <div class="hull">
        <div class="main resultList">
            <div class="state flex-def flex-cCenter">
                <div class="icon2"></div>
                <div class="text">
                    <h3>äº¤æ˜“æˆåŠŸ</h3>
                    <p>é’±æ¬¾å·²æ”¯ä»˜ç»™å¯¹æ–¹ï¼Œå¦‚æœ‰å¼‚è®®è¯·ä¸å¯¹æ–¹è”ç³»</p>
                </div>
            </div>
            <div class="serverTime">
                <p>æœåŠ¡æ—¶é—´ï¼š
                    <span>2017-12-11 17:12:00</span>
                </p>
            </div>
            <div class="serverTime serverType">
                <p>æœåŠ¡å½¢å¼ï¼š
                    <span>çº¿ä¸Š</span>
                </p>
            </div>
            <div class="userInfo flex-def flex-cCenter">
                <img class="userHead_img" src="http://img.iinnet.com/FvZfKY3unCYn9_3cr3vdkHmZvdWX" data-id="1025" tapmode onclick="openUserInfoPage(this)">
                <div class="text flex-def flex-zBetween flex-item">
                    <div class="left">
                        <p class="userName">ç‹å°å‘†</p>
                        <!-- éœ€è¦èäº‘idæ‰å¯ä»¥å‘èµ·èŠå¤© -->
                        <!-- <p class="position">ä¸Šæµ·ç­–èµ¢ç½‘ç»œç§‘æŠ€ è‘£äº‹é•¿</p> -->
                    </div>
                    <div class="right flex-def flex-cCenter">
                        <!-- <span tapmode onclick="callTpl()" class="icon_tel"></span> -->
                        <!-- å–å®¶ç”µè¯å­—æ®µ -->
                        <span tapmode onclick="openChatPage(this)" class="icon_chat" data-rong_id='06cb17509ff084bf1da1645d4ef694d3'></span>
                    </div>
                </div>
            </div>
            <div class="orderInfo">
                <div class="top flex-def" tapmode onclick="openSupplyInfoPage(this)" data-id="90">
                    <img src="http://img.iinnet.com/Fhho88W8a-CToagI32UntNxuBwDa?imageView2/1/w/200/h/200/q/75|imageslim">
                    <div class="text flex-item">
                        <div class="title flex-def flex-zBetween">
                            <div class="flex-def flex-cCenter">
                                <span class="label">[ä¸ªäºº]</span>
                                <p class="supplyName">ç¾é£Ÿå›¾ç‰‡</p>
                            </div>
                            <p class="price">6.68å…ƒ/ä»½</p>
                        </div>
                        <div class="info flex-def flex-zBetween">
                            <p class="infoText">åƒè´§çš„æœ€çˆ±ï¼Œé¢œå€¼æ§çš„ä¸“å±

             ä¸€ç»„å›¾20å¼ å“¦ğŸ¤”ğŸ¤”</p>
            <div>
                <!-- ä¼˜æƒ .æŠ˜æ‰£ -->
                <p class="count">é€€æ¬¾:8.68</p>
                <p class="count">è¡¥å·®ä»·:3.00</p>
                <p class="count">ä¼˜æƒ :1.00</p>
            </div>
            </div>
            <p class="count">x1</p>
            </div>
            </div>
            <div class="bottom">
                <div class="wrap">
                    <p class="total">åˆè®¡ï¼š
                        <span class="totalData">ï¿¥
                            <span class="totalNumber">8.68</span>å…ƒ</span>
                    </p>
                    <div class="btnGroup">
                        <span data-reasonList='[]' data-supplyId='90' data-id='139' tapmode onclick="oriderOperate(this)" class="btn" data-url='/supply_order/buyerDeleteOrder'>åˆ é™¤è®¢å•</span>
                        <span data-reasonList='[]' data-supplyId='90' data-id='139' tapmode onclick="oriderOperate(this)"
                            class="btn" data-url='/supply_order/buyerCreateOrder'>å†æ¥ä¸€å•</span>
                    </div>
                </div>
            </div>
            </div>
            <div class="orderTime">
                <p>è®¢å•ç¼–å·ï¼š
                    <span class="code" id="code">201712111412109217653340</span>
                    <span class="label1 fr" tapmode onclick="copyString()" id="copy">å¤åˆ¶</span>
                </p>
                <p>ä¸‹å•æ—¶é—´ï¼š
                    <span class="code">2017-12-11 14:12:10</span>
                </p>
            </div>

        </div>
        <script type="text/x-dot-template" id="listT">
            <div class="state flex-def flex-cCenter">
                {{?it.status_info.icon == 'FINISH'}}
                    <div class="icon2"></div>
                {{??it.status_info.icon == 'QUESTION'}}
                    <div class="icon3"></div>
                {{??}}
                    <div class="icon"></div>
                {{?}}
                <div class="text">
                    <h3>{{=it.status_info.text}}</h3>
                    <p>{{=it.status_info.description}}</p>
                </div>
            </div>
            {{?it.order_info.name == null}}

            {{??}}
            <div class="userPosition">
                <div class="wrap flex-def flex-zTopBottom flex-zCenter">
                    <h3>{{=it.order_info.name}}</h3>
                    <p>{{=it.order_info.address}}</p>
                </div>
            </div>
            {{?}}

            <div class="serverTime">
                <p>æœåŠ¡æ—¶é—´ï¼š<span>{{=it.order_info.service_time}}</span></p>
            </div>
            <div class="serverTime serverType">
                <p>æœåŠ¡å½¢å¼ï¼š
                    {{?it.supply_info.form==1}}
                    <span>çº¿ä¸Š</span>
                    {{??it.supply_info.form==2}}
                    <span>çº¿ä¸‹</span>
                    {{??}}
                    <span>çº¿ä¸Š + çº¿ä¸‹</span>
                    {{?}}
                </p>
            </div>

             <div class="userInfo flex-def flex-cCenter">
                {{?it.buyer_info}}
                <img class="userHead_img" data-id="{{=it.buyer_info.user_id}}" tapmode onclick="openUserInfoPage(this)" src="{{=it.buyer_info.head_img_url}}">
                <div class="text flex-def flex-zBetween flex-item">
                    <div class="left">
                        <p class="userName">{{=it.buyer_info.nickname}}</p>
                        <!-- éœ€è¦èäº‘idæ‰å¯ä»¥å‘èµ·èŠå¤© -->
                        <!-- <p class="position">ä¸Šæµ·ç­–èµ¢ç½‘ç»œç§‘æŠ€ è‘£äº‹é•¿</p> -->
                    </div>
                    <div class="right flex-def flex-cCenter">
                        <!-- <span tapmode onclick="callTpl()" class="icon_tel"></span> -->
                        <!-- å–å®¶ç”µè¯å­—æ®µ -->

                        <span tapmode onclick="openChatPage(this)" class="icon_chat" data-rong_id='{{=it.buyer_info.rongcloud_user_id}}'></span>
                    </div>
                </div>
                {{??}}
                <img class="userHead_img" src="{{=it.seller_info.head_img_url}}" data-id="{{=it.seller_info.user_id}}" tapmode onclick="openUserInfoPage(this)">
                <div class="text flex-def flex-zBetween flex-item">
                    <div class="left">
                        <p class="userName">{{=it.seller_info.nickname}}</p>
                        <!-- éœ€è¦èäº‘idæ‰å¯ä»¥å‘èµ·èŠå¤© -->
                        <!-- <p class="position">ä¸Šæµ·ç­–èµ¢ç½‘ç»œç§‘æŠ€ è‘£äº‹é•¿</p> -->
                    </div>
                    <div class="right flex-def flex-cCenter">
                        <!-- <span tapmode onclick="callTpl()" class="icon_tel"></span> -->
                        <!-- å–å®¶ç”µè¯å­—æ®µ -->
                        <span tapmode onclick="openChatPage(this)" class="icon_chat" data-rong_id='{{=it.seller_info.rongcloud_user_id}}'></span>
                    </div>
                </div>
                {{?}}
            </div>
            <div class="orderInfo" >
                <div class="top flex-def" tapmode onclick="openSupplyInfoPage(this)" data-id="{{=it.supply_info.supply_id}}">
                    {{?it.supply_info.image[0]}}
                        <img src="{{=it.supply_info.image[0]}}?imageView2/1/w/200/h/200/q/75|imageslim">
                    {{??}}
                        <img src="../../image/noimage.jpg">
                    {{?}}
                    <div class="text flex-item">
                        <div class="title flex-def flex-zBetween">
                            <div class="flex-def flex-cCenter">
                                <span class="label">[ä¸ªäºº]</span>
                                <p class="supplyName">{{=it.supply_info.title}}</p>
                            </div>
                            <p class="price">{{=it.supply_info.price}}å…ƒ/{{=it.supply_info.unit}}</p>
                        </div>
                        <div class="info flex-def flex-zBetween">
                            <p class="infoText">{{=it.supply_info.description}}</p>
                            <div>
                                  <!-- ä¼˜æƒ .æŠ˜æ‰£ -->
                                {{?it.order_info.extra_money=='0.00' && it.order_info.discount_money=='0.00' && it.order_info.refund_money=='0.00'}}
                                {{??it.order_info.extra_money=='0.00'}}
                                <!-- ä¸æ˜¾ç¤ºè¡¥å·®ä»· -->
                                    {{?it.order_info.discount_money=='0.00'}}
                                    <p class="count">é€€æ¬¾:{{=it.order_info.refund_money}}</p>
                                    {{??it.order_info.discount_money=='0.00'}}
                                    <p class="count">ä¼˜æƒ :{{=it.order_info.discount_money}}</p>
                                    {{??}}
                                    <p class="count">é€€æ¬¾:{{=it.order_info.refund_money}}</p>
                                    <p class="count">ä¼˜æƒ :{{=it.order_info.discount_money}}</p>
                                    {{?}}

                                {{??it.order_info.discount_money=='0.00'}}
                                <!-- ä¸ç°å®ä¼˜æƒ  -->
                                    {{?it.order_info.extra_money=='0.00'}}
                                        <p class="count">é€€æ¬¾:{{=it.order_info.refund_money}}</p>
                                    {{??it.order_info.refund_money=='0.00'}}
                                        <p class="count">è¡¥å·®ä»·:{{=it.order_info.extra_money}}</p>
                                    {{??}}
                                        <p class="count">è¡¥å·®ä»·:{{=it.order_info.extra_money}}</p>
                                        <p class="count">é€€æ¬¾:{{=it.order_info.refund_money}}</p>
                                    {{?}}
                                {{??it.order_info.refund_money=='0.00'}}
                                <!-- ä¸ç°å®é€€æ¬¾ -->
                                    {{?it.order_info.extra_money=='0.00'}}
                                        <p class="count">ä¼˜æƒ :{{=it.order_info.discount_money}}</p>
                                    {{??it.order_info.discount_money=='0.00'}}
                                        <p class="count">è¡¥å·®ä»·:{{=it.order_info.extra_money}}</p>
                                    {{??}}
                                    <p class="count">è¡¥å·®ä»·:{{=it.order_info.extra_money}}</p>
                                    <p class="count">ä¼˜æƒ :{{=it.order_info.discount_money}}</p>
                                    {{?}}
                                {{??}}
                                    <p class="count">é€€æ¬¾:{{=it.order_info.refund_money}}</p>
                                    <p class="count">è¡¥å·®ä»·:{{=it.order_info.extra_money}}</p>
                                    <p class="count">ä¼˜æƒ :{{=it.order_info.discount_money}}</p>
                                {{?}}
                            </div>
                        </div>
                            <p class="count">x{{=it.order_info.amount}}</p>
                    </div>
                </div>
                <div class="bottom">
                    <div class="wrap">
                        <p class="total">åˆè®¡ï¼š<span class="totalData">ï¿¥<span class="totalNumber">{{=it.order_info.total_money}}</span>å…ƒ</span></p>

                        <div class="btnGroup">

                            {{for(var i = 0; i < it.button_info.buttonArr.length; i++){ }}
                                {{?it.button_info.buttonArr[i].key === 'ç¡®è®¤å®Œæˆ' || it.button_info.buttonArr[i].key === 'å®Œæˆ' || it.button_info.buttonArr[i].key === 'è¯„ä»·è®¢å•'}}
                                {{??}}
                                <span data-reasonList='{{=JSON.stringify(it.reason_list)}}' data-supplyId='{{=it.supply_info.supply_id}}' data-id='{{=it.order_info.order_id}}' tapmode onclick="oriderOperate(this)" class="btn" data-url='{{=it.button_info.buttonArr[i].url}}'>{{=it.button_info.buttonArr[i].key}}</span>
                                {{?}}
                            {{ }; }}
                        </div>
                    </div>
                </div>
            </div>
            <div class="orderTime">
                <p>è®¢å•ç¼–å·ï¼š<span class="code" id="code">{{=it.order_info.gen_order_id}}</span>
                    <span class="label1 fr" tapmode onclick="copyString()"   id="copy">å¤åˆ¶</span>
                </p>
                <p>ä¸‹å•æ—¶é—´ï¼š<span class="code">{{=it.order_info.create_time}}</span></p>
                {{?it.order_info.reason}}
                <p>å–æ¶ˆåŸå› ï¼š<span class="code">{{=it.order_info.reason}}</span></p>
                {{?}}
            </div>
            {{?it.order_info.note}}
            <div class="remark">
                å¤‡æ³¨ï¼š<span>{{=it.order_info.note}}</span>
            </div>
            {{?}}
            {{?it.button_info.finish.is_show || it.button_info.confirm_finish.is_show}}
                <div class="appraise" data-url = "{{=it.btnurl}}" data-id='{{=it.order_info.order_id}}' tapmode onclick="completeOrder(this)">
                    <div class="appraise1" >å®Œæˆ</div>
                </div>


            {{??it.button_info.comment.is_show}}
                 <div class="appraise" tapmode='hover' onclick="commentSupply()">
                      <div class="appraise1">è¯„ä»·</div>
                 </div>
                
            {{??}}
            {{?}}

        </script>
    </div>
    <div class="loading"></div>

</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript" src="../../script/jquery.min.js"></script>
<script type="text/javascript">
    var _dataSource = ["æ¬¡","å¹…","å•","å°æ—¶","åˆ†é’Ÿ","å¤©","å‘¨","æœˆ","ä»½", "ä¸ª", "æ‰‡", "è¯¾æ—¶", "é¢è®®","å…¶ä»–","æœªå®šä¹‰"];
    var priceFlag=0,statusFlag;
    apiready = function(){
        
        
        moduleInit();
        requireData();
        api.addEventListener({
            name: 'saleMoney'
        }, function(ret, err) {
            if (ret) {
                requireData();
            } else {
                alert(JSON.stringify(err));
            }
        });
        api.setCustomRefreshHeaderInfo({
            bgColor: '#EFEFF4',
            image: {
                pull: [
                    'widget://image/loading/1.png',
                    'widget://image/loading/2.png',
                    'widget://image/loading/3.png',
                    'widget://image/loading/4.png',
                    'widget://image/loading/5.png',
                    // 'widget://image/loading/6.png',
                    'widget://image/loading/7.png',
                    'widget://image/loading/8.png',
                ],
                // transform: [
                // 'widget://image/loading/1.png',
                // 'widget://image/loading/2.png',
                // 'widget://image/loading/3.png',
                // 'widget://image/loading/4.png',
                // 'widget://image/loading/5.png',
                // 'widget://image/loading/6.png',
                // 'widget://image/loading/7.png',
                // 'widget://image/loading/8.png',

                // ],
                load: [
                'widget://image/loading/1.png',
                'widget://image/loading/2.png',
                'widget://image/loading/3.png',
                'widget://image/loading/4.png',
                'widget://image/loading/5.png',
                // 'widget://image/loading/6.png',
                'widget://image/loading/7.png',
                'widget://image/loading/8.png',


                ]
            }
        }, function(ret, err) {
            //åœ¨è¿™é‡Œä»æœåŠ¡å™¨åŠ è½½æ•°æ®ï¼ŒåŠ è½½å®Œæˆåè°ƒç”¨api.refreshHeaderLoadDone()æ–¹æ³•æ¢å¤ç»„ä»¶åˆ°é»˜è®¤çŠ¶æ€
            requireData();
        });
    };
    // è¿›å…¥ç”¨æˆ·è¯¦æƒ…
    function openUserInfoPage(ele) {
        api.openWin({
            name: 'txl_memberInfo_Win',
            url: '../addressList/txl_memberInfo_Win.html',
            pageParam: {
                userId: $api.attr(ele, 'data-id')
            }
        });
    }
    // è¿›å…¥ä¾›åº”è¯¦æƒ…
    function openSupplyInfoPage(ele) {
        api.openWin({
            name: 'winName',
            url: '../supply/supply_info.html',
            pageParam: {
                supply_id: $api.attr(ele, 'data-id')
            }
        });
    }
    // èŠå¤©
    function openChatPage(ele) {
        var rong_id = $api.attr(ele, 'data-rong_id');
        var headImg = $api.attr($api.dom('.userHead_img'), 'src');
        var userName = $api.text($api.dom('.userName'));
        // å¤´åƒ æ˜µç§° ä¾›åº”åå­— ä»·æ ¼ å•ä½
        var userHeadImg = $api.attr($api.dom('.userHead_img'), 'src');
        var supplyName = $api.text($api.dom('.supplyName'));
        var priceUint = $api.text($api.dom('.price'));
        //console.log(userHeadImg)
        api.openWin({
            name: 'winName',
            url: '../news/chatPage.html',
            pageParam: {
                type:'supply',
                targetRongId: rong_id,
                nickname: userName,
                headImg: headImg,
                userHeadImg: userHeadImg,
                supplyName: supplyName,
                priceUint: priceUint,
                order_id: api.pageParam.order_id
            }
        });
    }
    // è¯„ä»·
    function commentSupply() {
        var obj = {
            token:$api.getStorage('userToken'),
            order_id: api.pageParam.order_id
        }
        api.openWin({
            name: 'supply_commentPage',
            url: '../supply/supply_commentPage.html',
            pageParam: {
                obj: obj,
                flag: flag
            }
        });
    }
    // è·å–æ•°æ®
    function requireData() {
        var settings = {
            "async": true,
            "crossDomain": true,
            "url": apiSite + '/supply_order/detail',
            "method": "POST",
            "headers": {
                "ky-token": "28e8075c489d7b9ed9df196380585b89",
                "cache-control": "no-cache",
                "postman-token": "39a78f26-867b-0f1a-ed38-7c7043c7491f"
            },
             data: {
                values: {
                    token: $api.getStorage('userToken'),
                    order_id: api.pageParam.order_id
                }
            }
        }

        $.ajax(settings).done(function (ret) {
            if (ret.data.identity === 'buyer') {
                        flag = 1
                    } else {
                        flag = 0
                    }
                    $api.css($api.dom('.loading'), 'display:none');
                    $api.css($api.dom('.hull'), 'display:block');
                    // alert(JSON.stringify(ret))
                    // å¤„ç†è®¢å•å•ä½
                    if (ret.data.supply_info.unit) {
                        ret.data.supply_info.unit = _dataSource[ret.data.supply_info.unit-1];
                    } else {
                        ret.data.supply_info.unit = 'æœªå®šä¹‰';

                    }
                    // è¦æ˜¾ç¤ºçš„æŒ‰é’®
                    // .button_info
                    //      .pay
                    //      .confirm_service    å–å®¶ç¡®è®¤ä¾›åº”è®¢å•æ¥å•æ“ä½œ
                    //      .refuse_service     å–å®¶æ‹’ç»ä¾›åº”è®¢å•æ¥å•æ“ä½œ
                    //
                    //
                    //      .discount   å–å®¶ä¸ºä¹°å®¶ä¼˜æƒ 
                    //      .finish å®Œæˆè®¢å•
                    //
                    //      .cancel å–æ¶ˆè®¢å•
                    //      .confirm_cancel å–å®¶åŒæ„ä¹°å®¶å–æ¶ˆä¾›åº”è®¢å•æ“ä½œ
                    //      .refuse_cancel  å–å®¶æ‹’ç»ä¹°å®¶å–æ¶ˆä¾›åº”è®¢å•æ“ä½œ
                    //      .refund     å–å®¶ä¸ºä¹°å®¶é€€æ¬¾
                    //
                    //      .confirm_finish ä¹°å®¶åŒæ„ä¹°å®¶å®Œæˆä¾›åº”è®¢å•æ“ä½œ  -- å®Œæˆè®¢å•
                    //      .extra      ä¹°å®¶è¡¥å·®ä»·æ“ä½œ  -- è¡¥å…¨å·®ä»·
                    //      .again      ä¹°å®¶è´­ä¹°ä¾›åº”æ“ä½œ    -- å†æ¥ä¸€å•
                    //      .comment    ä¹°å®¶è¯„ä»·è®¢å•æ“ä½œ    -- è¯„ä»·è®¢å•
                    //      .delete     ä¹°å®¶åˆ é™¤è®¢å•        -- åˆ é™¤è®¢å•
                    //
                     //
                    ret.data.button_info.buttonArr=[];
                    for(key in ret.data.button_info) {
                        for(key1 in ret.data.button_info[key]) {
                            if (ret.data.button_info[key].is_show == true){
                                //console.log(key)
                                // key å³æ˜¯è¦æ˜¾ç¤ºçš„æŒ‰é’®
                                ret.data.button_info[key].key = key;
                                ret.data.button_info.buttonArr.push(ret.data.button_info[key])
                                break;
                                // console.log(key1 +':::'+ret.data.button_info[key][key1])
                            }
                        }
                    }
                    for (var i = 0; i < ret.data.button_info.buttonArr.length; i++) {
                        switch(ret.data.button_info.buttonArr[i].key){
                            case 'confirm_finish': ret.data.button_info.buttonArr[i].key = 'ç¡®è®¤å®Œæˆ'; break;
                            case 'extra': ret.data.button_info.buttonArr[i].key = 'è¡¥å·®ä»·'; break;
                            case 'again': ret.data.button_info.buttonArr[i].key = 'å†æ¥ä¸€å•'; break;
                            case 'comment': ret.data.button_info.buttonArr[i].key = 'è¯„ä»·è®¢å•'; break;
                            case 'delete': ret.data.button_info.buttonArr[i].key = 'åˆ é™¤è®¢å•'; break;
                            case 'pay': ret.data.button_info.buttonArr[i].key = 'ä»˜æ¬¾'; break;
                            case 'finish': ret.data.button_info.buttonArr[i].key = 'å®Œæˆ'; break;
                            case 'cancel': ret.data.button_info.buttonArr[i].key = 'å–æ¶ˆè®¢å•'; break;

                            // å–å®¶é¡µé¢
                            case 'confirm_service': ret.data.button_info.buttonArr[i].key = 'ç¡®è®¤æ¥å•'; break;
                            case 'refuse_service': ret.data.button_info.buttonArr[i].key = 'æ‹’ç»æ¥å•'; break;
                            case 'extend': ret.data.button_info.buttonArr[i].key = 'å»¶è¿ŸæœåŠ¡'; break;
                            case 'discount': ret.data.button_info.buttonArr[i].key = 'ä¼˜æƒ '; break;
                            case 'confirm_cancel': ret.data.button_info.buttonArr[i].key = 'åŒæ„å–æ¶ˆ'; break;
                            case 'refuse_cancel': ret.data.button_info.buttonArr[i].key = 'æ‹’ç»å–æ¶ˆ'; break;
                            case 'refund': ret.data.button_info.buttonArr[i].key = 'é€€æ¬¾'; break;
                        }

                    }
                    for (var i = 0; i < ret.data.button_info.buttonArr.length; i++) {
                        if (ret.data.button_info.buttonArr[i].key === 'ç¡®è®¤å®Œæˆ') {
                            ret.data.btnurl = ret.data.button_info.buttonArr[i].url;
                        } else if (ret.data.button_info.buttonArr[i].key === 'å®Œæˆ') {
                            ret.data.btnurl = ret.data.button_info.buttonArr[i].url;
                        } else if (ret.data.button_info.buttonArr[i].key === 'è¯„ä»·è®¢å•'){
                            ret.data.btnurl = ret.data.button_info.buttonArr[i].url;
                        } else {

                        }
                    }
                    priceFlag = ret.data.supply_info.price;
                    statusFlag = ret.data.order_info.status;
                    //console.log(JSON.stringify(ret.data))
                    if (getData(ret.data)) {
                        if (api.systemType === 'ios') {
                            for (var i = 0; i < $api.domAll('.btn').length; i++) {
                                $api.css($api.domAll('.btn')[i], 'line-height:.54rem');
                            }
                            for (var i = 0; i < $api.domAll('.label').length; i++) {

                                 $api.css($api.domAll('.label')[i], 'line-height:.26rem');
                            }
                        }
                    }
        });
        api.ajax({
            url: apiSite + '/supply_order/detail',
            method: 'post',
            headers: apiHeader,
            data: {
                   values: {
                        token: $api.getStorage('userToken'),
                        order_id: api.pageParam.order_id
                   }
            }
        }, function(ret, err) {
            if(ret) {
                    // åœæ­¢ä¸‹æ‹‰åˆ·æ–°
                    api.refreshHeaderLoadDone();
                if (ret.code === 200){
                    if (ret.data.identity === 'buyer') {
                        flag = 1
                    } else {
                        flag = 0
                    }
                    $api.css($api.dom('.loading'), 'display:none');
                    $api.css($api.dom('.hull'), 'display:block');
                    // alert(JSON.stringify(ret))
                    // å¤„ç†è®¢å•å•ä½
                    if (ret.data.supply_info.unit) {
                        ret.data.supply_info.unit = _dataSource[ret.data.supply_info.unit-1];
                    } else {
                        ret.data.supply_info.unit = 'æœªå®šä¹‰';

                    }
                    // è¦æ˜¾ç¤ºçš„æŒ‰é’®
                    // .button_info
                    //      .pay
                    //      .confirm_service    å–å®¶ç¡®è®¤ä¾›åº”è®¢å•æ¥å•æ“ä½œ
                    //      .refuse_service     å–å®¶æ‹’ç»ä¾›åº”è®¢å•æ¥å•æ“ä½œ
                    //
                    //
                    //      .discount   å–å®¶ä¸ºä¹°å®¶ä¼˜æƒ 
                    //      .finish å®Œæˆè®¢å•
                    //
                    //      .cancel å–æ¶ˆè®¢å•
                    //      .confirm_cancel å–å®¶åŒæ„ä¹°å®¶å–æ¶ˆä¾›åº”è®¢å•æ“ä½œ
                    //      .refuse_cancel  å–å®¶æ‹’ç»ä¹°å®¶å–æ¶ˆä¾›åº”è®¢å•æ“ä½œ
                    //      .refund     å–å®¶ä¸ºä¹°å®¶é€€æ¬¾
                    //
                    //      .confirm_finish ä¹°å®¶åŒæ„ä¹°å®¶å®Œæˆä¾›åº”è®¢å•æ“ä½œ  -- å®Œæˆè®¢å•
                    //      .extra      ä¹°å®¶è¡¥å·®ä»·æ“ä½œ  -- è¡¥å…¨å·®ä»·
                    //      .again      ä¹°å®¶è´­ä¹°ä¾›åº”æ“ä½œ    -- å†æ¥ä¸€å•
                    //      .comment    ä¹°å®¶è¯„ä»·è®¢å•æ“ä½œ    -- è¯„ä»·è®¢å•
                    //      .delete     ä¹°å®¶åˆ é™¤è®¢å•        -- åˆ é™¤è®¢å•
                    //
                     //
                    ret.data.button_info.buttonArr=[];
                    for(key in ret.data.button_info) {
                        for(key1 in ret.data.button_info[key]) {
                            if (ret.data.button_info[key].is_show == true){
                                //console.log(key)
                                // key å³æ˜¯è¦æ˜¾ç¤ºçš„æŒ‰é’®
                                ret.data.button_info[key].key = key;
                                ret.data.button_info.buttonArr.push(ret.data.button_info[key])
                                break;
                                // console.log(key1 +':::'+ret.data.button_info[key][key1])
                            }
                        }
                    }
                    for (var i = 0; i < ret.data.button_info.buttonArr.length; i++) {
                        switch(ret.data.button_info.buttonArr[i].key){
                            case 'confirm_finish': ret.data.button_info.buttonArr[i].key = 'ç¡®è®¤å®Œæˆ'; break;
                            case 'extra': ret.data.button_info.buttonArr[i].key = 'è¡¥å·®ä»·'; break;
                            case 'again': ret.data.button_info.buttonArr[i].key = 'å†æ¥ä¸€å•'; break;
                            case 'comment': ret.data.button_info.buttonArr[i].key = 'è¯„ä»·è®¢å•'; break;
                            case 'delete': ret.data.button_info.buttonArr[i].key = 'åˆ é™¤è®¢å•'; break;
                            case 'pay': ret.data.button_info.buttonArr[i].key = 'ä»˜æ¬¾'; break;
                            case 'finish': ret.data.button_info.buttonArr[i].key = 'å®Œæˆ'; break;
                            case 'cancel': ret.data.button_info.buttonArr[i].key = 'å–æ¶ˆè®¢å•'; break;

                            // å–å®¶é¡µé¢
                            case 'confirm_service': ret.data.button_info.buttonArr[i].key = 'ç¡®è®¤æ¥å•'; break;
                            case 'refuse_service': ret.data.button_info.buttonArr[i].key = 'æ‹’ç»æ¥å•'; break;
                            case 'extend': ret.data.button_info.buttonArr[i].key = 'å»¶è¿ŸæœåŠ¡'; break;
                            case 'discount': ret.data.button_info.buttonArr[i].key = 'ä¼˜æƒ '; break;
                            case 'confirm_cancel': ret.data.button_info.buttonArr[i].key = 'åŒæ„å–æ¶ˆ'; break;
                            case 'refuse_cancel': ret.data.button_info.buttonArr[i].key = 'æ‹’ç»å–æ¶ˆ'; break;
                            case 'refund': ret.data.button_info.buttonArr[i].key = 'é€€æ¬¾'; break;
                        }

                    }
                    for (var i = 0; i < ret.data.button_info.buttonArr.length; i++) {
                        if (ret.data.button_info.buttonArr[i].key === 'ç¡®è®¤å®Œæˆ') {
                            ret.data.btnurl = ret.data.button_info.buttonArr[i].url;
                        } else if (ret.data.button_info.buttonArr[i].key === 'å®Œæˆ') {
                            ret.data.btnurl = ret.data.button_info.buttonArr[i].url;
                        } else if (ret.data.button_info.buttonArr[i].key === 'è¯„ä»·è®¢å•'){
                            ret.data.btnurl = ret.data.button_info.buttonArr[i].url;
                        } else {

                        }
                    }
                    priceFlag = ret.data.supply_info.price;
                    statusFlag = ret.data.order_info.status;
                    //console.log(JSON.stringify(ret.data))
                    if (getData(ret.data)) {
                        if (api.systemType === 'ios') {
                            for (var i = 0; i < $api.domAll('.btn').length; i++) {
                                $api.css($api.domAll('.btn')[i], 'line-height:.54rem');
                            }
                            for (var i = 0; i < $api.domAll('.label').length; i++) {

                                 $api.css($api.domAll('.label')[i], 'line-height:.26rem');
                            }
                        }
                    }
                } else {
                    // alert(JSON.stringify(ret));
                    setTimeout(function() {
                        api.closeWin();
                    },500)
                }

            } else {
                alert(JSON.stringify(err.msg))
            }
        })
    }
    // doTæ¨¡ç‰ˆè·å–æ•°æ®
    function getData(data) {
        var listTText = $api.byId('listT').text;
        var fnListT = doT.template(listTText);
        var html = fnListT(data);
        var list = $api.dom('.resultList');
        console.log(html)
        // æ›¿æ¢resultListæ‰€æœ‰å†…å®¹
        $api.html(list, html);
        $api.fixTabBar($api.dom('.appraise'))
        return true;
    }
    // å¤åˆ¶è®¢å•å·
    function copyString() {
        var val = $api.text($api.byId('code'));
        clipBoard.set({
            value: val
        }, function(ret, err) {
            if (ret) {
                alert('å¤åˆ¶æˆåŠŸ');
            } else {
                alert(JSON.stringify(err.msg));
            }
        });
    }
    // æ“ä½œæŒ‰é’®
    function oriderOperate(ele) {
        var url = $api.attr(ele, 'data-url');
        var id = $api.attr(ele, 'data-id');
        var supplyId = $api.attr(ele, 'data-supplyId');
        // alert(url)
        var param = {};
        param.token = $api.getStorage('userToken');
        param.order_id = id;

        var flagText = $api.text(ele);

        if (flagText === 'å†æ¥ä¸€å•') {
            api.openWin({
                name: 'supply_info_immediate_order_2',
                url: '../supply/supply_info_immediate_order_2.html',
                pageParam: {
                    supplyId: supplyId
                }
            });
        } else if (flagText === 'å»¶è¿ŸæœåŠ¡'){
            ajaxOperate(param, url)
            requireData();
        } else if (flagText === 'ä»˜æ¬¾'){
           api.openFrame({
                name: 'supply_modeOfPayment',
                url: '../supply/supply_modeOfPayment.html',
                bounces: false,
                rect: {
                    x: 0,
                    y: 0,
                    w: 'auto',
                    h: 'auto'
                },
                pageParam: {
                    obj: {
                        token: $api.getStorage('userToken'),
                        order_id: id,
                        title: $api.text($api.dom('.supplyName')),
                    },
                    price: $api.text($api.dom('.totalNumber')),
                    flag: 1
                }
            });
        } else if (flagText === 'å–æ¶ˆè®¢å•'){
            var reasonList = JSON.parse($api.attr(ele, 'data-reasonList'));
            var datas = []
            for(key in reasonList) {
                datas.push({
                    name:reasonList[key],
                    id:key
                })
            }
            var UIActionSelector = api.require('UIActionSelector');
                UIActionSelector.open({
                    datas: datas,
                    actives: [1],
                    layout: {
                        row: 7,
                        col: 1,
                        height: 30,
                        size: 16,
                        sizeActive: 18,
                        rowSpacing: 5,
                        colSpacing: 5,
                        maskBg: 'rgba(0,0,0,0.5)',
                        bg: '#fff',
                        color: '#888',
                        colorSelected: '#000'
                    },
                    animation: true,
                    cancel: {
                        text: 'å–æ¶ˆ',
                        size: 12,
                        w: 90,
                        h: 35,
                        bg: '#eee',
                        // bgActive: '#ccc',
                        color: '#000',
                        // colorActive: '#fff'
                    },
                    ok: {
                        text: 'ç¡®å®š',
                        size: 12,
                        w: 90,
                        h: 35,
                        bg: '#eee',
                        // bgActive: '#ccc',
                        color: '#000',
                        // colorActive: '#fff'
                    },
                    title: {
                        text: 'è¯·é€‰æ‹©å–æ¶ˆè®¢å•åŸå› ',
                        size: 20,
                        h: 35,
                        bg: '#eee',
                        color: '#000'
                    },
                    fixedOn: api.frameName
                }, function(ret, err) {
                    if (ret) {
                        if (ret.eventType == 'ok') {
                            param.reason = ret.selectedInfo[0].id;

                            ajaxOperate(param, url)
                        }
                    } else {
                        alert(JSON.stringify(err.msg));
                    }
                });
        } else if (flagText === 'è¡¥å·®ä»·') {
            //console.log($api.not($api.closest(ele, '.btnGroup'), '.selector'))
            var total;
            param.title = $api.text($api.dom('.supplyName'));
            if ($api.domAll('.btn').length == 2) {
                // å·²ä»˜æ¬¾
                total = 0;
            } else {
                // æœªä»˜æ¬¾
                total = $api.text($api.dom('.totalNumber'));
            }
            api.openFrame({
                name: 'me_gdd_info_frame_sale',
                url: './me_gdd_info_frame_sale.html',
                rect: {
                    x: 0,
                    y: 0,
                    w: api.winWidth,
                    h: api.winHeight
                },
                pageParam: {
                    param: param,
                    total: total,
                    flag: 'priceDifference'
                },
                bounces: false
            });
        } else if (flagText === 'é€€æ¬¾') {
            var tatol = $api.text($api.dom('.totalNumber'));
            api.openFrame({
                name: 'me_gdd_info_frame_refund',
                url: './me_gdd_info_frame_refund.html',
                rect: {
                    x: 0,
                    y: 0,
                    w: api.winWidth,
                    h: api.winHeight
                },
                pageParam: {
                    tatol: tatol,
                    param: param
                },
                bounces: false
            });
            // api.prompt({
            //     title: 'é€€æ¬¾',
            //     // msg: 'message',
            //     text: 'è¯·è¾“å…¥é€€æ¬¾é‡‘é¢',
            //     buttons: ['ç¡®å®š', 'å–æ¶ˆ']
            // }, function(ret, err) {
            //     if (ret) {
            //         if(buttonIndex == 1) {
            //             param.money = ret.text
            //             api.ajax({
            //                 url: apiSite + '/supply_order/sellerRefundService',
            //                 method: 'post',
            //                 headers: apiHeader,
            //                 data: {
            //                        values: param
            //                 }
            //             }, function(ret, err) {
            //                 if(ret) {
            //                     // alert(JSON.stringify(ret))
            //                     if (ret.code === 200) {
            //                     } else {
            //                         alert(ret.msg)
            //                     }
            //                 } else {
            //                     alert(JSON.stringify(err))
            //                 }
            //             })
            //         }
            //     } else {
            //         alert(JSON.stringify(err));
            //     }
            // });
        }else if (flagText === 'ä¼˜æƒ ') {
            api.openFrame({
                name: 'me_gdd_info_frame_sale',
                url: './me_gdd_info_frame_sale.html',
                rect: {
                    x: 0,
                    y: 0,
                    w: api.winWidth,
                    h: api.winHeight
                },
                pageParam: {
                    param: param
                },
                bounces: false
            });
            // api.prompt({
            //     title: 'ä¼˜æƒ ',
            //     // msg: 'message',
            //     text: 'è¯·è¾“å…¥ä¼˜æƒ ä»·',
            //     buttons: ['ç¡®å®š', 'å–æ¶ˆ']
            // }, function(ret, err) {
            //     if (ret) {
            //         if (ret.buttonIndex == 1) {
            //             param.money = ret.text;
            //             api.ajax({
            //                 url: apiSite + '/supply_order/sellerDiscountService',
            //                 method: 'post',
            //                 headers: apiHeader,
            //                 data: {
            //                        values: param
            //                 }
            //             }, function(ret, err) {
            //                 if(ret) {
            //                     if (ret.code === 200) {
            //                         api.sendEvent({
            //                             name: 'saleMoney'
            //                         });
            //                         setTimeout(function(){api.closeFrame();},500)
            //                     } else {
            //                         alert(ret.msg)
            //                     }
            //                 } else {
            //                     alert(JSON.stringify(err))
            //                 }
            //             })
            //         }
            //     } else {
            //         alert(JSON.stringify(err));
            //     }
            // });

        } else if (flagText === 'æ‹’ç»å–æ¶ˆ') {

           var reasonList = JSON.parse($api.attr(ele, 'data-reasonList'));
            var datas = []
            for(key in reasonList) {
                datas.push({
                    name:reasonList[key],
                    id:key
                })
            }
            var UIActionSelector = api.require('UIActionSelector');
            UIActionSelector.open({
                datas: datas,
                actives: [1],
                layout: {
                    row: 7,
                    col: 1,
                    height: 30,
                    size: 16,
                    sizeActive: 18,
                    rowSpacing: 5,
                    colSpacing: 5,
                    maskBg: 'rgba(0,0,0,0.5)',
                    bg: '#fff',
                    color: '#888',
                    colorSelected: '#000'
                },
                animation: true,
                cancel: {
                    text: 'å–æ¶ˆ',
                    size: 12,
                    w: 90,
                    h: 35,
                    bg: '#eee',
                    // bgActive: '#ccc',
                    color: '#000',
                    // colorActive: '#fff'
                },
                ok: {
                    text: 'ç¡®å®š',
                    size: 12,
                    w: 90,
                    h: 35,
                    bg: '#eee',
                    // bgActive: '#ccc',
                    color: '#000',
                    // colorActive: '#fff'
                },
                title: {
                    text: 'è¯·é€‰æ‹©é€€æ¬¾åŸå› ',
                    size: 20,
                    h: 35,
                    bg: '#eee',
                    color: '#000'
                },
                fixedOn: api.frameName
            }, function(ret, err) {
                if (ret) {
                    if (ret.eventType == 'ok') {
                        $api.css($api.dom('.loading'), 'display: block');
                        obj = {
                            token: $api.getStorage('userToken'),
                            order_id: id,
                            reason:  ret.selectedInfo[0].id
                        }
                        ajaxOperate(obj, url)
                    }
                } else {
                    alert(JSON.stringify(err.msg));
                }
            });
        } else {
            ajaxOperate(param ,url)
        }

    }
    // æ‹¨æ‰“ç”µè¯
    function callTpl(){
        api.call({
            type: 'tel',
            number: '10086'
        });
    }
    function completeOrder(ele) {
        var id = $api.attr(ele, 'data-id');
        var url = $api.attr(ele, 'data-url');
        //console.log(url)
        api.ajax({
            url: apiSite + url,
            method: 'post',
            headers: apiHeader,
            data: {
                   values: {
                       token: $api.getStorage('userToken'),
                       order_id: id
                   }
            }
        }, function(ret, err) {
            if(ret) {
                if (ret.code == 200) {
                    api.sendEvent({
                        name: 'filterOrder'
                    });
                    requireData();
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }

    function ajaxOperate(obj, url) {
        api.ajax({
            url: apiSite + url,
            method: 'post',
            headers: apiHeader,
            data: {
                   values: obj
            }
        }, function(ret, err) {
            if(ret) {
                if (ret.code !== 200) {
                    alert(ret.msg)
                } else {
                    requireData();
                    api.sendEvent({
                        name: 'filterOrder'
                    });
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
</script>
</html>