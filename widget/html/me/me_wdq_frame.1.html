<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/weui.css" />
    <style type="text/css">
        html {
            height: 100%;
        }
        body {
            position: relative;
            height: 100%;
        }
        .title {
            margin: .2rem 0;
        }

        .title .text {
            font-size: .24rem;
            color: #777;
            margin-right: .2rem;
        }

        .title .line {
            width: .97rem;
            height: .03rem;
            background-color: #999;
        }

        .title .icon {
            width: .284rem;
            height: .34rem;
            /*background-color: #f00;*/
            background: url(../../image/icon_my/icon_myCircle_1.png)no-repeat;
            -webkit-background-size: .284rem .34rem;
            background-size: .284rem .34rem;
            margin-right: .07rem;
            margin-left: .2rem;
        }

      


        .icon {
            width: 2.2rem;
            height: 2.2rem;
            background: url(../../image/iocn_addressList/icon_noInfo.png)no-repeat;
            -webkit-background-size: 2.2rem 2.2rem;
            background-size: 2.2rem 2.2rem;
            margin: 0 auto;
        }
        .nomain {
            position: absolute;
            top: 0;bottom: 0;left: 0;right: 0;
            margin: auto;
        }
        .hide {
            display: none;
        }
        .nomain p {
            font-size: .3rem;
            color: #999;
            /*width: 3.9rem;*/
            margin: .36rem auto 0;
            text-align: center;
        }
        .nomain .jump {
            color: #89B2EF;
            font-size: 0.34rem;
        }
        .des .icon {
            background: url(../../image/icon_my/icon_myCircle_2.png)no-repeat;
            -webkit-background-size: .284rem .34rem;
            background-size: .284rem .34rem;
        }



        .weui-panel__bd {
            background-color: #fff;
        }
        .weui-media-box__desc {
            -webkit-line-clamp: 1;
        }
        .weui-media-box_appmsg .weui-media-box__hd {
            margin-right: 0.2rem;
        }
         .no1 {
            margin-right: .6rem;
        }

        .label {
            font-size: .24rem;
            color: #999;
        }
        .count {
            font-size: .24rem;
            color: #0ABB07;
        }
         .weui-media-box_appmsg .weui-media-box__thumb {
            border-radius: .1rem;
        }
        .weui-media-box {
            padding-top: .2rem;
            padding-bottom: 0.2rem;
        }
    </style>
</head>

<body>
    <div class="resultList"></div>
    <script type="text/x-dot-template" id="listT">
            {{?it.verify_waiting_list.length !== 0}}
                <div class="title flex-def flex-cCenter flex-zCenter" style="background:#f00">
                    <span class="line"></span>
                    <span class="icon"></span>
                    <span class="text">待审核</span>
                    <span class="line"></span>
                </div>
            {{?}}
            <div class="weui-panel__bd ">
                {{ for (var i = 0; i < it.verify_waiting_list.length; i++) { }}
                    <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg" >
                        <div class="weui-media-box__hd">
                            <img class="weui-media-box__thumb" src="{{=it.verify_waiting_list[i].image_url}}"
                            alt="">
                        </div>
                        <div class="weui-media-box__bd">
                            <h4 class="weui-media-box__title">{{=it.verify_waiting_list[i].title}}</h4>
                            <p class="weui-media-box__desc">{{=it.verify_waiting_list[i].description}}</p>
                            <p class="weui-media-box__desc">
                                <span class="label">成员:</span>
                                <span class="count no1">{{=it.verify_waiting_list[i].member_count}}</span>
                                <span class="label">发布:</span>
                                <span class="count">{{=it.verify_waiting_list[i].topic_count}}</span>
                            </p>
                        </div>
                    </a>
                {{ }; }}
                </div>
            {{?it.verify_fail_list.length !== 0}}
            <div class="title flex-def flex-cCenter flex-zCenter">
                <span class="line"></span>
                <span class="icon"></span>
                <span class="text">审核未通过</span>
                <span class="line"></span>
            </div>
        {{?}}
        <div class="weui-panel__bd ">
            {{ for (var i = 0; i < it.verify_fail_list.length; i++) { }}
                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg" >
                    <div class="weui-media-box__hd">
                        <img class="weui-media-box__thumb" src="{{=it.verify_fail_list[i].image_url}}"
                        alt="">
                    </div>
                    <div class="weui-media-box__bd">
                        <h4 class="weui-media-box__title">{{=it.verify_fail_list[i].title}}</h4>
                        <p class="weui-media-box__desc">{{=it.verify_fail_list[i].description}}</p>
                        <p class="weui-media-box__desc">
                            <span class="label">成员:</span>
                            <span class="count no1">{{=it.verify_fail_list[i].member_count}}</span>
                            <span class="label">发布:</span>
                            <span class="count">{{=it.verify_fail_list[i].topic_count}}</span>
                        </p>
                    </div>
                </a>
            {{ }; }}
            </div>
            {{?it.available_list.length !== 0}}
                <div class="title des flex-def flex-cCenter flex-zCenter">
                    <span class="line"></span>
                    <span class="icon"></span>
                    <span class="text">已创建</span>
                    <span class="line"></span>
                </div>
            {{?}}
            <div class="weui-panel__bd ">
            {{ for (var i = 0; i < it.available_list.length; i++) { }}
                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg" tapmode onclick="openCircleInfo(this)" data-name="{{=it.available_list[i].title}}" data-id="{{=it.available_list[i].circle_id}}">
                    <div class="weui-media-box__hd">
                        <img class="weui-media-box__thumb" src="{{=it.available_list[i].image_url}}"
                        alt="">
                    </div>
                    <div class="weui-media-box__bd">
                        <h4 class="weui-media-box__title">{{=it.available_list[i].title}}</h4>
                        <p class="weui-media-box__desc">{{=it.available_list[i].description}}</p>
                        <p class="weui-media-box__desc">
                            <span class="label">成员:</span>
                            <span class="count no1">{{=it.available_list[i].member_count}}</span>
                            <span class="label">发布:</span>
                            <span class="count">{{=it.available_list[i].topic_count}}</span>
                        </p>
                    </div>
                </a>
            {{ }; }}
            </div>
    </script>
    <div class="nomain hide flex-def flex-cCenter flex-zCenter">
       <div class="wrap">
            <div class="icon">
        </div>
            <p>空空如也</p>
            <p class="jump" tapmode onclick="openCreateCirclePage()">快去创建圈子吧</p>
       </div>
    </div>
    <div class="loading "></div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript">
    apiready = function() {
        // 请求数据
        requireData();
        // 监听创建圈子事件
        foundCircle();
        // 下拉刷新
        api.setCustomRefreshHeaderInfo({
            bgColor: '#EFEFF4',
        }, function(ret, err) {
            requireData();
        })

    };
    // 打开创建圈子页面
    function openCreateCirclePage() {
        api.openWin({
            name: 'winname',
            url: '../find/find_foundCircle_win.html',
            bounces: false,
        });
    }
    // 进入圈子详情
    function openCircleInfo(ele) {
        api.openWin({
            name: 'winName',
            url: '../find/find_dynamicState_win.html',
            pageParam: {
                circle_id: $api.attr(ele, 'data-id'),
                circle_name: $api.attr(ele, 'data-name'),
                flag: 1
            }
        });
    }
    // 监听创建圈子事件
    function foundCircle() {
        api.addEventListener({
            name: 'frame4Open'
        }, function(ret, err) {
            requireData()
        });
        api.addEventListener({
            name: 'circleTopicComment'
        }, function(ret, err){
            requireData()
        });
    }
    function requireData() {
        api.ajax({
            url: apiSite + '/user_center/myCircle',
            method: 'post',
            headers: apiHeader,
            data: {
                   values: {
                       token: $api.getStorage('userToken'),
                   }
            }
        }, function(ret, err) {
            if(ret) {
                //console.log(JSON.stringify(ret))
                // 停止下拉刷新
                api.refreshHeaderLoadDone();
                if (ret.data.verify_waiting_list == '' && ret.data.verify_fail_list == '' && ret.data.available_list == '') {
                     $api.css($api.dom('.main'), 'display:none');
                     $api.css($api.dom('.loading'), 'display:none');
                     $api.removeCls($api.dom('.nomain'), 'hide');
                } else {
                    $api.addCls($api.dom('.nomain'), 'hide');
                    $api.css($api.dom('.loading'), 'display:none');
                    getData(ret.data)
                }
            } else {
                alert(JSON.stringify(err.msg))
            }
        })
    }
</script>

</html>
