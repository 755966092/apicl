<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/weui.css" />
    <style>
        .btn {
            padding: 0 .36rem;;
        }
        .loading {
            width: 100%;
            height: 13.34rem;
            background: rgba(0, 0, 0, 0.3) url(../../image/loading_more.gif)no-repeat;
            -webkit-background-size: .8rem .8rem;
            background-size: .8rem .8rem;
            background-position: center center;
            display: none;
        }
        .mt20 {
            margin-top: 0.3rem;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="head">
            <span class="callback" tapmode onclick="api.closeWin()">返回</span>
            <span class="winTitle">
                隐私
            </span>
        </div>
    </header>
    <div class="weui-cells weui-cells_form mt20" >
        <div class="weui-cell weui-cell_switch">
            <div class="weui-cell__bd">加我为朋友时需要验证</div>
            <div class="weui-cell__ft">
                <label for="addFriend" class="weui-switch-cp">
                    <input checked value="addFriend" onchange="changeState(this)" id="addFriend" class="weui-switch-cp__input" type="checkbox" >
                    <div class="weui-switch-cp__box"></div>
                </label>
            </div>
        </div>
    </div>
    <!-- <div class="weui-cells weui-cells_form mt20">
        <div class="weui-cell weui-cell_switch">
            <div class="weui-cell__bd">不自动加入强关系组</div>
            <div class="weui-cell__ft">
                <label for="addGroup" class="weui-switch-cp">
                    <input value="addGroup" onchange="changeState(this)" id="addGroup" class="weui-switch-cp__input" type="checkbox" >
                    <div class="weui-switch-cp__box"></div>
                </label>
            </div>
        </div>
    </div>
    <div class="weui-cells">
        <a class="weui-cell weui-cell_access" href="javascript:;" tapmode onclick="openPage(this)" data-val="whoCanSeeMe">
            <div class="weui-cell__bd">
                <p>谁可以看我的资料</p>
            </div>
            <div class="weui-cell__ft">
                <p id="whoCanSeeMe">三度以内好友</p>
            </div>
        </a>
    </div> -->
    <div class="weui-cells mt20">
        <a class="weui-cell weui-cell_access" href="javascript:;" data-val="blacklist" tapmode onclick="openPage(this)">
            <div class="weui-cell__bd">
                <p>通讯录黑名单</p>
            </div>
            <div class="weui-cell__ft">
            </div>
        </a>
    </div>

    <div class="weui-cells mt20">
        <a class="weui-cell weui-cell_access" href="javascript:;" data-val="noSupply" tapmode onclick="openPage(this)">
            <div class="weui-cell__bd">
                <p>不让TA看我的供应</p>
            </div>
            <div class="weui-cell__ft">
            </div>
        </a>
        <a class="weui-cell weui-cell_access" href="javascript:;" data-val="noDemand" tapmode onclick="openPage(this)">
            <div class="weui-cell__bd">
                <p>不让TA看我的需求</p>
            </div>
            <div class="weui-cell__ft">
            </div>
        </a>
        <!-- <a class="weui-cell weui-cell_access" href="javascript:;" data-val="noProject" tapmode onclick="openPage(this)">
            <div class="weui-cell__bd">
                <p>不让TA看我的项目</p>
            </div>
            <div class="weui-cell__ft">
            </div>
        </a>
        <a class="weui-cell weui-cell_access" href="javascript:;" data-val="noCircle" tapmode onclick="openPage(this)">
            <div class="weui-cell__bd">
                <p>不让TA看我的圈子</p>
            </div>
            <div class="weui-cell__ft">
            </div>
        </a> -->
    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script>
    apiready = function(){
        fnInit();
        eventListener();
        requireData();
    }
    // 获取网络数据
    function requireData() {
        api.ajax({
            url: apiSite + '/userPrivacy/isApplyReason',
            method: 'post',
            headers: apiHeader,
            data: {
                values: { 
                    token: $api.getStorage('userToken'),
                }
            }
        }, function(ret, err) {
            if(ret) {
                if (ret.code === 200) {
                    initPage(ret)
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
    // 初始化页面
    function initPage(ret) {
        console.log(JSON.stringify(ret))
        if(ret.data.list.is_apply_reason === 2) {
            // 加好友不需要验证
             $api.removeAttr($api.byId('addFriend'), 'checked');
        } else {
            // 加好友需要验证
            $api.attr($api.byId('addFriend'), 'checked', 'checked');
        }
    }
    // 监听事件
    function eventListener() {
        api.addEventListener({
            name: 'whoCanSeeMe'
        }, function(ret, err){
            $api.text($api.byId('whoCanSeeMe'), ret.value.text);
        });
    }
    // 切换复选框
    function changeState(ele) {
        // if ($api.attr(ele, 'checked')) {
        if (ele.checked) {
            // $api.removeAttr(ele, 'checked');
            ele.removeAttribute('checked')
            console.log('选中')
            makeApplyReason(1);
        } else {
            // $api.attr(ele, 'checked', 'checked');
            ele.setAttribute('checked', 'checked')
            console.log('未选中')
            makeApplyReason(2);
        }
    }
    // 设置加好友是否需要验证
    function makeApplyReason(n) {
        api.ajax({
            url: apiSite + '/userPrivacy/makeApplyReason',
            method: 'post',
            headers: apiHeader,
            data: {
                values: { 
                    token: $api.getStorage('userToken'),
                    statu: n
                }
            }
        }, function(ret, err) {
            if(ret) {
                if (ret.code === 200) {
                    api.toast({
                        msg: '设置成功',
                        duration: 2000,
                        location: 'bottom'
                    });
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
    // 打开页面
    function openPage(ele) {
        var val = ele.getAttribute('data-val');
        var obj = {}
        if (val === 'whoCanSeeMe') {
            obj.text = $api.text($api.byId('whoCanSeeMe'));
        } else {
            obj.type = val;
            val = 'contacts'
        }
        api.openWin({
            name: 'winname_' + val,
            url: 'me_sz_'+val+'.html',
            bounces: false,
            pageParam: obj
        });
    }
</script>

</html>