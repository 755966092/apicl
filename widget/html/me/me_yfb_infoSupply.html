

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <style type="text/css">
        html,body {
            background-color: #F8F8F8;
            height: 100%;
        }
        .main {
            margin-bottom: 1.2rem;
        }
        .img {
            font-size: 0;
        }
        .img img {
            width: 7.5rem;
            height: 7.5rem;
        }
        .title {
            height: 1rem;
            padding: 0 .3rem;
            box-sizing: border-box;
            border-bottom: 1px solid #E8E8E8;
            background-color: #fff;
        }
        .title img {
            width: .7rem;
            height: .7rem;
        }
        .titleRight {
            font-size: 0;
            padding-left: .2rem;
            box-sizing: border-box;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: hidden;
        }
        .titleRight h3 {
            font-size: .3rem;
            line-height: .42rem;

        }
        .titleRight p {
            font-size: .24rem;
            line-height: .33rem;
            color: #999;
        }
        .title2 {
            padding: .2rem .3rem .1rem;
            border-bottom: 1px solid #E8E8E8;
            background-color: #fff;
        }
        .title2 .typeIcon {
            width: .41rem;
            height: .24rem;
            background: url(../../image/icon_supply/icon_gs2.png)no-repeat;
            -webkit-background-size: .41rem .24rem;
            background-size: .41rem .24rem;
            padding-right: .1rem;
        }
        .title2 .shareIcon {
            width: .258rem;
            height: .36rem;
            background: url(../../image/icon_supply/icon_share.png)no-repeat;
            -webkit-background-size: .258rem .36rem;
            background-size: .258rem .36rem;

        }
        .title2 .titleName {
            font-size: 0;

        }
        .title2 .titleName p {
            font-size: .34rem;
        }
        .price {
            font-size: 0;
            margin: .2rem 0 .45rem;
            /*width: 100%;*/
        }
        .price .priceText {
            color: #D0011B;
            font-size: .34rem;
        }
        .price .time {
            color: #999;
            font-size: .24rem;
        }

        .sold_cound {
            font-size: 0;
        }
        .avg_point .avg_pointIcon {
            width: .245rem;
            height: .245rem;
            background: url(../../image/icon_supply/icon_xx.png)no-repeat;
            -webkit-background-size: .245rem .245rem;
            background-size: .245rem .245rem;
            margin-right: .06rem;
        }
        .sold_cound .count, .form{
            font-size: .24rem;
            color: #999;
            margin-right: .2rem;
            margin-bottom: .1rem;
        }

        .sel {
            height: .8rem;
            padding: 0 .3rem;
            font-size: 0;
            line-height: .8rem;
            margin: .2rem 0;
            background-color: #fff;
        }
        .sel .selTitle {
            font-size: .3rem;
            color: #999;
        }
        .sel .selText {
            font-size: .3rem;
            color: #000;
        }
        .sel .selIcon {
            width: .15rem;
            height: .25rem;
            background: url(../../image/icon_zk.png)no-repeat;
            -webkit-background-size: .15rem .25rem;
            background-size: .15rem .25rem;
        }
        .infoTitle {
            margin-bottom: .3rem;
            font-size: 0;
        }
        .infoTitle .line {
            width: .97rem;
            height: .03rem;
            background-color: #999;
        }
        .infoTitle .imgIcon {
            width: .34rem;
            height: .29rem;
            background: url(../../image/icon_supply/icon_init.png)no-repeat;
            -webkit-background-size: .34rem .29rem;
            background-size: .34rem .29rem;
            margin-right: .1rem;
        }
        .infoTitle .infoTitleText {
            font-size: .34rem;
            line-height: .48rem;


        }

        .infoTitle .text {
            margin: 0 .2rem;
            font-size: 0;
        }
        .info {
            background-color: #fff;
            padding: .2rem .3rem;
        }
        .infoData {
            font-size: 0;
        }
        .infoData p {
            font-size: .3rem;
            color: #555;
            margin: .3rem 0;
        }
        .infoData img {
            width: 6.9rem;
            margin-bottom: .3rem;
        }
        .comment {
            margin-top: .2rem;
            background-color: #fff;
        }
        .comment .commentCount {
            font-size: .3rem;
        }
        .comment .commentTitle {
            width: 100%;
            box-sizing: border-box;
            font-size: 0;
            line-height: .65rem;
            height: .65rem;
            background-color: #fff;
            border-bottom: 1px solid #D9D9D9;
            padding: 0 .3rem;
        }
        .comment .commentIcon {
            width: .15rem;
            height: .25rem;
            background: url(../../image/icon_zk.png)no-repeat;
            -webkit-background-size: .15rem .25rem;
            background-size: .15rem .25rem;

        }
        .commentContent {
            font-size: 0;
            padding: .25rem .3rem .25rem 0;
            margin-left: .3rem;
            border-bottom: 1px solid #d9d9d9;
            background-color: #fff;
        }
        .commentContentTitle img {
            width: .76rem;
            height: .76rem;
            margin-right: .2rem;
        }
        .commentName {
            width: 6.24rem;
        }
 
        .commentNameLeft {
            font-size: 0;
        }
        .commentNameLeft .name {
            font-size: .34rem;
        }
        .commentNameRight {
            font-size: .24rem;
            color: #999;
        }
        .commentText {
            font-size: .3rem;
            color: #555;
            margin-top: .18rem;
        }
        .btn {
            height: .75rem;
        }
        .btn>div {
            color: #D0011B;
            font-size: .24rem;
            width: 1.4rem;
            height: .4rem;
            margin: 0 auto;
            border: 2px solid #D0011B;
            border-radius: .1rem;
            text-align: center;
            line-height: .4rem;

        }
        footer {
            font-size: 0;       
            height: .88rem;   
            /*line-height: .88rem;*/
            position: fixed;
            bottom: 0;  
            left: 0;    
            width: 100%;     
            background-color: #fff;
            border-top: .01rem solid #F8F8F8;
         }
         footer span {
            font-size: .18rem;  
            color: #999;
            text-align: center; 
            float: left;
         }
         footer span:nth-child(1),
         footer span:nth-child(2) {
             width: 25%;    
         }
 
         footer span:nth-child(3) {
             font-size: .3rem;  
             width: 50%; 
             line-height: .88rem;  
             background-color: #0ABB07;
             color: #fff;
         }
         
        footer i {

             display: inline-block;  
             width: 100%;    
             height: .55rem; 
             background: url(../../image/icon_supply/icon_del.png)no-repeat;
            background-size: .39rem .38rem;
            background-position: center bottom;
         }
         footer i.sus {
            background: url(../../image/icon_supply/icon_sus.png)no-repeat;
            background-size: .4rem .4rem;
            background-position: center bottom;
        }
         
        
         #cloaswin {
            width: .44rem;  
            height: .44rem; 
            background: url(../../image/icon_supply/icon_callback.png)no-repeat;
            -webkit-background-size: .44rem .44rem;
            background-size: .44rem .44rem;
            position: fixed;    
            top: .55rem;                
            left: .3rem;        
         }  
         .label {
            font-size: .2rem;
            color: #0076FF;
            border: 1px solid #0076FF;
            text-align: center;
            padding: 0 .05rem;
            margin-right: .1rem;
            border-radius: .06rem;
        }
    </style>
</head>     
<body>
    <div id="cloaswin" onclick="api.closeWin();"></div>
    <div class="loading" ></div>
    <div class="resultList"></div>
    <script type="text/x-dot-template" id="listT">
        <div class="main flex-def flex-zTopBottom">
            <div class="img">
                {{?it.info.image_json[0]!='0'}}
                    <img src="{{=it.info.image_json[0]}}">
                {{??it.info.image_json[0]=='0'}}
                    <img src="../../image/tx_4.jpg">
                {{?}}
                
            </div>
            <div class="title flex-def flex-zLeftRight flex-cCenter">
                <img src="{{=it.info.head_img_url}}" alt="">
                <div class="titleRight">
                    <h3>{{=it.info.nickname}}</h3>
                    {{?it.info.current_company==null&&it.info.current_position!=null}}
                        <p> {{=it.info.current_position}}</p>
                    {{??it.info.current_position==null&&it.info.current_company!=null}}
                        <p>{{=it.info.current_company}}</p>
                    {{??it.info.current_position==null&&it.info.current_company==null}}
                    {{??}}
                        <p>{{=it.info.current_company}} {{=it.info.current_position}}</p>
                    {{?}}
                </div>
            </div>
            <div class="title2">
                <div class="top flex-def flex-zBetween">
                    <div class="titleName flex-def flex-zLeftRight flex-cCenter">
                        <span class="typeIcon"></span>
                        <p>{{=it.info.title}}</p>
                    </div>
                    <div class="shareIcon"></div>
                </div>
                <div class="price flex-def flex-zBetween flex-zLeftRight">
                    <div class="priceText">
                        ￥{{=it.info.price}}/{{=it.info.unit}}
                    </div>
                    <div class="time">
                        {{=it.info.create_time}}
                    </div>
                </div>
                <div class="sold_cound flex-def flex-zLeftRight flex-cCenter">
                    <span class="count">[已售{{=it.info.sold_count}}]</span>
                    <span class="avg_point ">
                        {{for(var i = 0;i < it.info.avg_point;i++){ }}
                            <span class="avg_pointIcon"></span>
                        {{};}}
                    </span>
                </div>
                {{?it.info.form == 1}}
                    <div class="form">线上服务</div>
                {{??}}
                    <div class="form">线下服务</div>
                {{?}}
            </div>
            <div class="sel flex-def flex-zBetween flex-cCenter">
                <div>
                    <span class="selTitle">已选：</span>
                    <span class="selText">设计、“APP图标”</span>
                </div>
                <span class="selIcon"></span>
            </div>
            <div class="info">
                <div class="infoTitle flex-def flex-zCenter flex-cCenter flex-zLeftRight">
                    <span class="line"></span>
                    <div class="text flex-def flex-zLeftRight flex-cCenter">
                        <span class="imgIcon"></span>
                        <span class="infoTitleText">详情</span>
                    </div>
                    <span class="line"></span>
                </div>
                <div class="infoData">
                    <p>{{=it.info.description}}</p>
                    {{?it.info.image_json[0]!='0'}}
                        {{for(var i=0;i< it.info.image_json.length; i++){ }}
                            <img src="{{=it.info.image_json[i]}}">
                        {{ }; }}
                    {{??it.info.image_json[0]=='0'}}
                    {{?}}
                    
                </div>
            </div>
            <div class="comment">
                <div class="commentTitle flex-def flex-cCenter flex-zBetween">
                    <span class="commentCount">评论（{{=it.info.comment_count}}）</span>
                    <span class="commentIcon"></span>
                </div>
                {{for(var i = 0;i < it.info.comment_count;i++){ }}
                <div class="commentContent">
                    <div class="commentContentTitle flex-def flex-zLeftRight">
                        <img src="{{=it.last_comment.head_img_url}}">
                        <div class="commentName flex-def flex-zBetween flex-zLeftRight flex-cCenter">
                            <div class="commentNameLeft">
                                <div class="name">{{=it.last_comment.nickname}}</div>
                                <div class="avg_point">
                                    {{for(var i = 0;i < it.last_comment.point;i++){ }}
                                        <span class="avg_pointIcon"></span>
                                    {{};}}
                                </div>
                            </div>
                            <div class="commentNameRight">
                                {{=it.last_comment.create_time}}
                            </div>
                        </div>
                    </div>
                    <p class="commentText">{{=it.last_comment.content}}</p>
                </div>
                {{};}}
                
                {{?it.info.comment_count==0}}
                {{??}}
                    <div class="btn flex-def flex-cCenter">
                        <div>查看全部</div>
                    </div>
                {{?}}
                
            </div>
          
        </div>
         <footer>    
            <span ontouchstart="handleBtn(this,0)">
                <i class="sus"></i>暂停
            </span>
            <span ontouchstart="handleBtn(this,1)">
                <i></i>
                删除
            </span>
            <span ontouchstart="editSupply()">编辑</span>
        </footer>
    </script>
  
   
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/jquery.min.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript">
    var _dataSource = ["次","幅","单","小时","分钟","天","周","月","份", "个", "扇", "课时", "面议","其他","未定义"];
    apiready = function(){
        // 初始化页面
        initialise()
    };
    // 初始化页面
    function  initialise() {
        // 请求数据
        api.ajax({
            url: apiSite + '/api/supply/detail',
            method: 'post',
            headers: apiHeader,
            data: {
               values: { 
                   token: $api.getStorage('userToken'),
                   supply_id: api.pageParam.supply_id
               }
            }
        }, function(ret, err) {
            if (ret.data.info.image_json != 'null') {
                // 解析图片json
                ret.data.info.image_json = eval(ret.data.info.image_json);    
            } else {
                ret.data.info.image_json = '0'
            }   
            if ( ret.data.info.unit > 0) {
                 ret.data.info.unit = _dataSource[ ret.data.info.unit-1]
            } else {
                 ret.data.info.unit = '未定义'
            }
            $api.css($api.dom('.loading'), 'display:none');     
            getData(ret.data);
        })
    }
    function handleBtn(ele,n) {

        var url;
        if (n) {
            // 删除按钮
            url = '/api/supply/delete'
        } else {
            // 暂停按钮
            url = '/api/supply/pause'
            if ($api.text(ele) === '暂停') {
                $api.html(ele, '<i class="sus"></i>开始');
            } else {
                $api.html(ele, '<i class="sus"></i>暂停');
            }
            

        }
        api.ajax({
            url: apiSite + url,
            method: 'post',
            headers: apiHeader,
            data: {
                   values: { 
                       token: $api.getStorage('userToken'),
                       supply_id: api.pageParam.supply_id
                   }
            }
        }, function(ret, err) {
            if(ret.code!==200) {
                // alert(JSON.stringify(ret))
                if (url === '/api/supply/delete') {
                    api.sendEvent({
                        name: 'renovateMySupply'
                    });
                    setTimeout(function() {api.closeWin();},500)
                }
            } else {
                alert(JSON.stringify(err.msg))
            }
        })
    }

    // 编辑供应
    function editSupply() {
        api.openWin({
            name: 'supply_releaseSupply_win',
            url: '../supply/supply_releaseSupply_win.html',
            pageParam: {
                supply_id: api.pageParam.supply_id
            }
        });
    }
</script>
</html>