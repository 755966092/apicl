<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/weui.css" />
    <style>
   
    
    .main ul {
        margin-top: .2rem;
    }
    
    .main ul li {

        margin-top: .01rem; 
        height: .82rem;
        line-height: .82rem;
        padding-left: .3rem;
        font-size: .28rem;
        background: #fff;
        position: relative;
    }
    .main ul li .wrap {
        padding-right: .3rem;
        border-bottom: .01rem solid #EDEDED;
    }
    .main ul li:last-child .wrap {
        border: 0;  
    }
    .main ul li:last-child {
        border-bottom: .01rem solid #EDEDED;
    }
    .main ul li .icon_zk {
        display: inline-block;
        padding-right: .15rem;
        height: .8rem;
        background: url(../../image/icon_member/icon_zk.png)no-repeat;
        -webkit-background-size: .15rem .25rem;
        background-size: .15rem .25rem;
        background-position: 0 .3rem;
        float: right;
    }
    
    .icon_xl {
        /* width: 100%; */
        height: 1.31rem;
        background: url(../../image/icon_gs/icon_xl.png)no-repeat;
        -webkit-background-size: 1.56rem 1.31rem;
        background-size: 1.56rem 1.31rem;
        background-position: center center;
        margin-top: 2.7rem;
        margin-bottom: .3rem;
    }
    
    .possess {
        text-align: center;
        font-size: .24rem;
        color: #555;
        line-height: .4rem;
    }

    .workCertification {
        font-size: 0.3rem;
        color: #999;
        padding: 0 .3rem;
        line-height: 0.8rem;
    }
    </style>
</head>

<body>
    <header class="header">
        <div class="head">
            <span class="callback" tapmode onclick="api.closeWin()">返回</span>
            <span class="winTitle">
                公司主页
            </span>
        </div>
    </header>
    <div class="main">
        <div class="resultList">
            <!-- <p class="workCertification">已认证</p>
            <li tapmode onclick="openCompanyInfoPage(this)" data-val="zy">
               <div class="wrap">
                    <span>第一学教育科技（北京）有限公司</span>
                    <span class="icon_zk"></span>
               </div>
            </li>
            <p class="workCertification">未认证</p>
            <li tapmode onclick="openCompanyInfoPage(this)" data-val="wrz">
                <div class="wrap">
                    <span>卓越创新（北京）投资管理控股有限公司</span>
                    <span class="icon_zk"></span>   
                </div>
            </li> -->
        </div>
        <script type="text/x-dot-template" id="listT">
            {{?it.is_verify.length!=0}}
                <p class="workCertification">已认证</p>
            {{?}}
            <div class="weui-cells">
                {{~it.is_verify:value:index}}
                    <a class="weui-cell weui-cell_access" href="javascript:;" data-adminId="{{=value.admin_id}}" data-name="{{=value.company_name}}" tapmode onclick="openCompanyInfoPage(this)" data-statu='1' data-val="zy" data-id="{{=value.company_id}}">
                        <div class="weui-cell__bd">
                            <p>{{=value.company_name}}</p>
                        </div>
                        <div class="weui-cell__ft">
                        </div>
                    </a>
                {{~}}
            </div>
            {{?it.no_verify.length!=0}}
                <p class="workCertification">未认证</p>
            {{?}}
            {{~it.no_verify:value:index}}
                <div class="weui-cells">
                    <a class="weui-cell weui-cell_access" href="javascript:;" data-adminId="{{=value.admin_id}}" data-name="{{=value.company_name}}" tapmode onclick="openCompanyInfoPage(this)" data-id="{{=value.company_id}}" data-statu='2' data-val="wrz">
                        <div class="weui-cell__bd">
                            <p>{{=value.company_name}}</p>
                        </div>
                        <div class="weui-cell__ft">
                        </div>
                    </a>
                </div>
            {{~}}
            
            {{?it.verify.length!=0}}
                <p class="workCertification">认证中</p>
            {{?}}
            {{~it.verify:value:index}}
                <div class="weui-cells">
                    <a class="weui-cell weui-cell_access" href="javascript:;" data-adminId="{{=value.admin_id}}" data-name="{{=value.company_name}}" tapmode onclick="openCompanyInfoPage(this)" data-id="{{=value.company_id}}" data-statu='2' data-val="wrz">
                        <div class="weui-cell__bd">
                            <p>{{=value.company_name}}</p>
                        </div>
                        <div class="weui-cell__ft">
                        </div>
                    </a>
                </div>
            {{~}}
        </script>
        <div class="icon_xl"></div>

        <p class="possess">拥有公司主页后
            <br>您公司的供求信息也会在主页中得到展示</p>
    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.min.js"></script>
<script type="text/javascript">
var userId;
apiready = function() {
    fnInit();
    requireData();
    // 设置新的管理员后刷新页面
    api.addEventListener({
        name: 'SetNewAdministrator'
    }, function(ret, err){
        requireData();
    });
};
// 请求数据
function requireData() {
    var obj = {
        is_verify:[],
        no_verify:[],
        verify:[]
    }
    api.ajax({
        url: apiSite + '/user_center/workList',
        method: 'post',
        headers: apiHeader,
        data: {
            values: { 
                token: $api.getStorage('userToken'),
            }
        }
    }, function(ret, err) {
        if(ret) {
            if (ret.code === 200) {
                userId = ret.data.list[0].user_id;
                for (var i = 0; i < ret.data.list.length; i++) {
                    var element = ret.data.list[i];
                    if (element.is_verify === 1) {
                        // 审核通过
                        obj.is_verify.push(element)
                    } else if (element.is_verify === 0) {
                        // 审核中
                        obj.verify.push(element)
                    } else {
                        obj.no_verify.push(element)
                    }
                }
                getData(obj);
            } else {
                alert(ret.msg)
            }
        } else {
            alert(JSON.stringify(err))
        }
    })
}
function openCompanyInfoPage(ele) {
    var val = $api.attr(ele, 'data-val');
    var adminId = $api.attr(ele, 'data-adminId');
    var statu = $api.attr(ele, 'data-statu');
    // 普通用户 statu 进入公司主页
    // 公司管理员进入公司信息编辑页面
    // 未认证公司进入公司认证页面
    if (adminId != userId && statu==1) {
        // 非管理员
        val = 'homePage'
    }
    api.openWin({
        name: val + 'Win',
        url: './me_gs_' + val + '.html',
        pageParam: {
            companyId: $api.attr(ele, 'data-id'),
            statu: statu,
            name: $api.attr(ele, 'data-name'),
        },
        bounces: false
    });
}
</script>

</html>
