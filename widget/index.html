<!doctype html>
<html>
<head>
    <meta charset="utf-8"><meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <link rel="stylesheet" type="text/css" href="css/api.css">
    <title>我在</title>
    <style type="text/css">
        html,body {
            background-color: #fff;
        }
    </style>
</head>
<body>
</body>
</html>
<script type="text/javascript" src="script/api.js"></script>
<script type="text/javascript" src="script/common.js"></script>
<script type="text/javascript">
    apiready = function () {
        moduleInit();
        // $api.rmStorage('guidePages');
        /**
        * 缓存当前本地版本号
        * 判断缓存的是否和当前版本号相同, 相同进入主页, 不相同进入引导页
        */
        
        judgment();
    }
    function judgment() {
        // $api.rmStorage('guidePages');
        if ($api.getStorage('guidePages') == api.appVersion) {
            // 不进入引导页
            openMain();
        } else {
             // 进入引导页
             openGuidePage();
        }
    }
    function openGuidePage() {
        api.openWin({
                name: 'guidePage_win',
                url: './html/guidePage/guidePage_win.html',
                bounces: false,
                slidBackEnabled: false
            });
    }
    function openMain() {
        if($api.getStorage('rongToken')) {
                rongyun($api.getStorage('rongToken'));
                api.openWin({
                    name: 'main',
                    url: 'html/main.html',
                    slidBackEnabled: false,
                    animation: {
                        type: 'none',
                        subType: 'from_right',
                        duration: 0
                    }
                });
            } else {
                api.openWin({
                    name: 'loginPage',
                    url: './html/enroll/me_login.html',
                    slidBackEnabled: false
                });
            }
    }
    // 判断线上
    function ajaxVer() {
        api.ajax({
            url: apiSite + '/common/checkVersion',
            method: 'post',
            headers: apiHeader
        }, function(ret, err) {
            if(ret) {
                if (ret.code === 200) {
                    if(ret.data.current_version == api.appVersion) {
                    // if(ret.data.current_version == '1.0.9') {
                        // 判断是否是地第一次进入app
                        judgment();
                    } else {
                        // 不进入引导页
                        openMain();
                    }
                } else {
                    alert(ret.msg)
                }
            } else {
                alert(JSON.stringify(err))
            }
        })
    }
</script>


